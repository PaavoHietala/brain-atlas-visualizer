(()=>{var Uv=Object.create;var ni=Object.defineProperty;var Nv=Object.getOwnPropertyDescriptor;var Gv=Object.getOwnPropertyNames;var _v=Object.getPrototypeOf,bv=Object.prototype.hasOwnProperty;var zv=(t,e)=>()=>(t&&(e=t(t=0)),e);var ce=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),xr=(t,e)=>{for(var r in e)ni(t,r,{get:e[r],enumerable:!0})},Wv=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Gv(e))!bv.call(t,a)&&a!==r&&ni(t,a,{get:()=>e[a],enumerable:!(n=Nv(e,a))||n.enumerable});return t};var xn=(t,e,r)=>(r=t!=null?Uv(_v(t)):{},Wv(e||!t||!t.__esModule?ni(r,"default",{value:t,enumerable:!0}):r,t));var ai=ce((FV,Xf)=>{"use strict";Xf.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,a,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!t(e[a],r[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[a]))return!1;for(a=n;a--!==0;){var i=s[a];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var si=ce((kV,If)=>{"use strict";var Yf=Object.prototype.toString;If.exports=function(e){var r=Yf.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Yf.call(e.callee)==="[object Function]"),n}});var ac=ce((UV,nc)=>{"use strict";var rc;Object.keys||(Tn=Object.prototype.hasOwnProperty,ii=Object.prototype.toString,qf=si(),oi=Object.prototype.propertyIsEnumerable,Zf=!oi.call({toString:null},"toString"),Qf=oi.call(function(){},"prototype"),Sn=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],ta=function(t){var e=t.constructor;return e&&e.prototype===t},Jf={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},ec=(function(){if(typeof window>"u")return!1;for(var t in window)try{if(!Jf["$"+t]&&Tn.call(window,t)&&window[t]!==null&&typeof window[t]=="object")try{ta(window[t])}catch{return!0}}catch{return!0}return!1})(),tc=function(t){if(typeof window>"u"||!ec)return ta(t);try{return ta(t)}catch{return!1}},rc=function(e){var r=e!==null&&typeof e=="object",n=ii.call(e)==="[object Function]",a=qf(e),s=r&&ii.call(e)==="[object String]",i=[];if(!r&&!n&&!a)throw new TypeError("Object.keys called on a non-object");var o=Qf&&n;if(s&&e.length>0&&!Tn.call(e,0))for(var f=0;f<e.length;++f)i.push(String(f));if(a&&e.length>0)for(var c=0;c<e.length;++c)i.push(String(c));else for(var g in e)!(o&&g==="prototype")&&Tn.call(e,g)&&i.push(String(g));if(Zf)for(var u=tc(e),l=0;l<Sn.length;++l)!(u&&Sn[l]==="constructor")&&Tn.call(e,Sn[l])&&i.push(Sn[l]);return i});var Tn,ii,qf,oi,Zf,Qf,Sn,ta,Jf,ec,tc;nc.exports=rc});var fc=ce((NV,oc)=>{"use strict";var Hv=Array.prototype.slice,Av=si(),sc=Object.keys,ra=sc?function(e){return sc(e)}:ac(),ic=Object.keys;ra.shim=function(){if(Object.keys){var e=(function(){var r=Object.keys(arguments);return r&&r.length===arguments.length})(1,2);e||(Object.keys=function(n){return Av(n)?ic(Hv.call(n)):ic(n)})}else Object.keys=ra;return Object.keys||ra};oc.exports=ra});var fi=ce((GV,cc)=>{"use strict";var na=Object.defineProperty||!1;if(na)try{na({},"a",{value:1})}catch{na=!1}cc.exports=na});var gc=ce((_V,uc)=>{"use strict";uc.exports=SyntaxError});var pc=ce((bV,lc)=>{"use strict";lc.exports=TypeError});var vc=ce((zV,hc)=>{"use strict";hc.exports=Object.getOwnPropertyDescriptor});var yc=ce((WV,dc)=>{"use strict";var aa=vc();if(aa)try{aa([],"length")}catch{aa=null}dc.exports=aa});var Cc=ce((HV,Sc)=>{"use strict";var xc=fi(),$v=gc(),Yr=pc(),Tc=yc();Sc.exports=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new Yr("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new Yr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Yr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Yr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Yr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Yr("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,o=arguments.length>6?arguments[6]:!1,f=!!Tc&&Tc(e,r);if(xc)xc(e,r,{configurable:i===null&&f?f.configurable:!i,enumerable:a===null&&f?f.enumerable:!a,value:n,writable:s===null&&f?f.writable:!s});else if(o||!a&&!s&&!i)e[r]=n;else throw new $v("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var Ec=ce((AV,wc)=>{"use strict";var ci=fi(),mc=function(){return!!ci};mc.hasArrayLengthDefineBug=function(){if(!ci)return null;try{return ci([],"length",{value:1}).length!==1}catch{return!0}};wc.exports=mc});var ui=ce(($V,Dc)=>{"use strict";var jv=fc(),Kv=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Pv=Object.prototype.toString,Xv=Array.prototype.concat,Mc=Cc(),Yv=function(t){return typeof t=="function"&&Pv.call(t)==="[object Function]"},Rc=Ec()(),Iv=function(t,e,r,n){if(e in t){if(n===!0){if(t[e]===r)return}else if(!Yv(n)||!n())return}Rc?Mc(t,e,r,!0):Mc(t,e,r)},Oc=function(t,e){var r=arguments.length>2?arguments[2]:{},n=jv(e);Kv&&(n=Xv.call(n,Object.getOwnPropertySymbols(e)));for(var a=0;a<n.length;a+=1)Iv(t,n[a],e[n[a]],r[n[a]])};Oc.supportsDescriptors=!!Rc;Dc.exports=Oc});var gi=ce((jV,sa)=>{"use strict";typeof self<"u"?sa.exports=self:typeof window<"u"?sa.exports=window:sa.exports=Function("return this")()});var li=ce((KV,Lc)=>{"use strict";var qv=gi();Lc.exports=function(){return typeof global!="object"||!global||global.Math!==Math||global.Array!==Array?qv:global}});var Bc=ce((PV,Vc)=>{"use strict";var Zv=ui(),Qv=li();Vc.exports=function(){var e=Qv();if(Zv.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(e,"globalThis");(!r||r.configurable&&(r.enumerable||!r.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e}});var Nc=ce((XV,Uc)=>{"use strict";var Jv=ui(),ed=gi(),Fc=li(),td=Bc(),rd=Fc(),kc=function(){return rd};Jv(kc,{getPolyfill:Fc,implementation:ed,shim:td});Uc.exports=kc});var Ku=ce((ju,Ni)=>{(function(t,e,r){function n(o){var f=this,c=i();f.next=function(){var g=2091639*f.s0+f.c*23283064365386963e-26;return f.s0=f.s1,f.s1=f.s2,f.s2=g-(f.c=g|0)},f.c=1,f.s0=c(" "),f.s1=c(" "),f.s2=c(" "),f.s0-=c(o),f.s0<0&&(f.s0+=1),f.s1-=c(o),f.s1<0&&(f.s1+=1),f.s2-=c(o),f.s2<0&&(f.s2+=1),c=null}function a(o,f){return f.c=o.c,f.s0=o.s0,f.s1=o.s1,f.s2=o.s2,f}function s(o,f){var c=new n(o),g=f&&f.state,u=c.next;return u.int32=function(){return c.next()*4294967296|0},u.double=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.quick=u,g&&(typeof g=="object"&&a(g,c),u.state=function(){return a(c,{})}),u}function i(){var o=4022871197,f=function(c){c=String(c);for(var g=0;g<c.length;g++){o+=c.charCodeAt(g);var u=.02519603282416938*o;o=u>>>0,u-=o,u*=o,o=u>>>0,u-=o,o+=u*4294967296}return(o>>>0)*23283064365386963e-26};return f}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.alea=s})(ju,typeof Ni=="object"&&Ni,typeof define=="function"&&define)});var Xu=ce((Pu,Gi)=>{(function(t,e,r){function n(i){var o=this,f="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var g=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^g^g>>>8},i===(i|0)?o.x=i:f+=i;for(var c=0;c<f.length+64;c++)o.x^=f.charCodeAt(c)|0,o.next()}function a(i,o){return o.x=i.x,o.y=i.y,o.z=i.z,o.w=i.w,o}function s(i,o){var f=new n(i),c=o&&o.state,g=function(){return(f.next()>>>0)/4294967296};return g.double=function(){do var u=f.next()>>>11,l=(f.next()>>>0)/4294967296,p=(u+l)/(1<<21);while(p===0);return p},g.int32=f.next,g.quick=g,c&&(typeof c=="object"&&a(c,f),g.state=function(){return a(f,{})}),g}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xor128=s})(Pu,typeof Gi=="object"&&Gi,typeof define=="function"&&define)});var Iu=ce((Yu,_i)=>{(function(t,e,r){function n(i){var o=this,f="";o.next=function(){var g=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^(g^g<<1))|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,i===(i|0)?o.x=i:f+=i;for(var c=0;c<f.length+64;c++)o.x^=f.charCodeAt(c)|0,c==f.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function a(i,o){return o.x=i.x,o.y=i.y,o.z=i.z,o.w=i.w,o.v=i.v,o.d=i.d,o}function s(i,o){var f=new n(i),c=o&&o.state,g=function(){return(f.next()>>>0)/4294967296};return g.double=function(){do var u=f.next()>>>11,l=(f.next()>>>0)/4294967296,p=(u+l)/(1<<21);while(p===0);return p},g.int32=f.next,g.quick=g,c&&(typeof c=="object"&&a(c,f),g.state=function(){return a(f,{})}),g}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xorwow=s})(Yu,typeof _i=="object"&&_i,typeof define=="function"&&define)});var Zu=ce((qu,bi)=>{(function(t,e,r){function n(i){var o=this;o.next=function(){var c=o.x,g=o.i,u,l,p;return u=c[g],u^=u>>>7,l=u^u<<24,u=c[g+1&7],l^=u^u>>>10,u=c[g+3&7],l^=u^u>>>3,u=c[g+4&7],l^=u^u<<7,u=c[g+7&7],u=u^u<<13,l^=u^u<<9,c[g]=l,o.i=g+1&7,l};function f(c,g){var u,l,p=[];if(g===(g|0))l=p[0]=g;else for(g=""+g,u=0;u<g.length;++u)p[u&7]=p[u&7]<<15^g.charCodeAt(u)+p[u+1&7]<<13;for(;p.length<8;)p.push(0);for(u=0;u<8&&p[u]===0;++u);for(u==8?l=p[7]=-1:l=p[u],c.x=p,c.i=0,u=256;u>0;--u)c.next()}f(o,i)}function a(i,o){return o.x=i.x.slice(),o.i=i.i,o}function s(i,o){i==null&&(i=+new Date);var f=new n(i),c=o&&o.state,g=function(){return(f.next()>>>0)/4294967296};return g.double=function(){do var u=f.next()>>>11,l=(f.next()>>>0)/4294967296,p=(u+l)/(1<<21);while(p===0);return p},g.int32=f.next,g.quick=g,c&&(c.x&&a(c,f),g.state=function(){return a(f,{})}),g}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xorshift7=s})(qu,typeof bi=="object"&&bi,typeof define=="function"&&define)});var Ju=ce((Qu,zi)=>{(function(t,e,r){function n(i){var o=this;o.next=function(){var c=o.w,g=o.X,u=o.i,l,p;return o.w=c=c+1640531527|0,p=g[u+34&127],l=g[u=u+1&127],p^=p<<13,l^=l<<17,p^=p>>>15,l^=l>>>12,p=g[u]=p^l,o.i=u,p+(c^c>>>16)|0};function f(c,g){var u,l,p,d,h,v=[],y=128;for(g===(g|0)?(l=g,g=null):(g=g+"\0",l=0,y=Math.max(y,g.length)),p=0,d=-32;d<y;++d)g&&(l^=g.charCodeAt((d+32)%g.length)),d===0&&(h=l),l^=l<<10,l^=l>>>15,l^=l<<4,l^=l>>>13,d>=0&&(h=h+1640531527|0,u=v[d&127]^=l+h,p=u==0?p+1:0);for(p>=128&&(v[(g&&g.length||0)&127]=-1),p=127,d=512;d>0;--d)l=v[p+34&127],u=v[p=p+1&127],l^=l<<13,u^=u<<17,l^=l>>>15,u^=u>>>12,v[p]=l^u;c.w=h,c.X=v,c.i=p}f(o,i)}function a(i,o){return o.i=i.i,o.w=i.w,o.X=i.X.slice(),o}function s(i,o){i==null&&(i=+new Date);var f=new n(i),c=o&&o.state,g=function(){return(f.next()>>>0)/4294967296};return g.double=function(){do var u=f.next()>>>11,l=(f.next()>>>0)/4294967296,p=(u+l)/(1<<21);while(p===0);return p},g.int32=f.next,g.quick=g,c&&(c.X&&a(c,f),g.state=function(){return a(f,{})}),g}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xor4096=s})(Qu,typeof zi=="object"&&zi,typeof define=="function"&&define)});var tg=ce((eg,Wi)=>{(function(t,e,r){function n(i){var o=this,f="";o.next=function(){var g=o.b,u=o.c,l=o.d,p=o.a;return g=g<<25^g>>>7^u,u=u-l|0,l=l<<24^l>>>8^p,p=p-g|0,o.b=g=g<<20^g>>>12^u,o.c=u=u-l|0,o.d=l<<16^u>>>16^p,o.a=p-g|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,i===Math.floor(i)?(o.a=i/4294967296|0,o.b=i|0):f+=i;for(var c=0;c<f.length+20;c++)o.b^=f.charCodeAt(c)|0,o.next()}function a(i,o){return o.a=i.a,o.b=i.b,o.c=i.c,o.d=i.d,o}function s(i,o){var f=new n(i),c=o&&o.state,g=function(){return(f.next()>>>0)/4294967296};return g.double=function(){do var u=f.next()>>>11,l=(f.next()>>>0)/4294967296,p=(u+l)/(1<<21);while(p===0);return p},g.int32=f.next,g.quick=g,c&&(typeof c=="object"&&a(c,f),g.state=function(){return a(f,{})}),g}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.tychei=s})(eg,typeof Wi=="object"&&Wi,typeof define=="function"&&define)});var rg=ce(()=>{});var ag=ce((ng,Ta)=>{(function(t,e,r){var n=256,a=6,s=52,i="random",o=r.pow(n,a),f=r.pow(2,s),c=f*2,g=n-1,u;function l(x,T,w){var S=[];T=T==!0?{entropy:!0}:T||{};var M=v(h(T.entropy?[x,C(e)]:x??y(),3),S),E=new p(S),R=function(){for(var D=E.g(a),L=o,V=0;D<f;)D=(D+V)*n,L*=n,V=E.g(1);for(;D>=c;)D/=2,L/=2,V>>>=1;return(D+V)/L};return R.int32=function(){return E.g(4)|0},R.quick=function(){return E.g(4)/4294967296},R.double=R,v(C(E.S),e),(T.pass||w||function(D,L,V,B){return B&&(B.S&&d(B,E),D.state=function(){return d(E,{})}),V?(r[i]=D,L):D})(R,M,"global"in T?T.global:this==r,T.state)}function p(x){var T,w=x.length,S=this,M=0,E=S.i=S.j=0,R=S.S=[];for(w||(x=[w++]);M<n;)R[M]=M++;for(M=0;M<n;M++)R[M]=R[E=g&E+x[M%w]+(T=R[M])],R[E]=T;(S.g=function(D){for(var L,V=0,B=S.i,F=S.j,z=S.S;D--;)L=z[B=g&B+1],V=V*n+z[g&(z[B]=z[F=g&F+L])+(z[F]=L)];return S.i=B,S.j=F,V})(n)}function d(x,T){return T.i=x.i,T.j=x.j,T.S=x.S.slice(),T}function h(x,T){var w=[],S=typeof x,M;if(T&&S=="object")for(M in x)try{w.push(h(x[M],T-1))}catch{}return w.length?w:S=="string"?x:x+"\0"}function v(x,T){for(var w=x+"",S,M=0;M<w.length;)T[g&M]=g&(S^=T[g&M]*19)+w.charCodeAt(M++);return C(T)}function y(){try{var x;return u&&(x=u.randomBytes)?x=x(n):(x=new Uint8Array(n),(t.crypto||t.msCrypto).getRandomValues(x)),C(x)}catch{var T=t.navigator,w=T&&T.plugins;return[+new Date,t,w,t.screen,C(e)]}}function C(x){return String.fromCharCode.apply(0,x)}if(v(r.random(),e),typeof Ta=="object"&&Ta.exports){Ta.exports=l;try{u=rg()}catch{}}else typeof define=="function"&&define.amd?define(function(){return l}):r["seed"+i]=l})(typeof self<"u"?self:ng,[],Math)});var ig=ce((rB,sg)=>{var uT=Ku(),gT=Xu(),lT=Iu(),pT=Zu(),hT=Ju(),vT=tg(),Cr=ag();Cr.alea=uT;Cr.xor128=gT;Cr.xorwow=lT;Cr.xorshift7=pT;Cr.xor4096=hT;Cr.tychei=vT;sg.exports=Cr});var Ep=ce((mp,wp)=>{(function(t){if(typeof mp=="object")wp.exports=t();else if(typeof define=="function"&&define.amd)define(t);else{var e;try{e=window}catch{e=self}e.SparkMD5=t()}})(function(t){"use strict";var e=function(y,C){return y+C&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(y,C,x,T,w,S){return C=e(e(C,y),e(T,S)),e(C<<w|C>>>32-w,x)}function a(y,C){var x=y[0],T=y[1],w=y[2],S=y[3];x+=(T&w|~T&S)+C[0]-680876936|0,x=(x<<7|x>>>25)+T|0,S+=(x&T|~x&w)+C[1]-389564586|0,S=(S<<12|S>>>20)+x|0,w+=(S&x|~S&T)+C[2]+606105819|0,w=(w<<17|w>>>15)+S|0,T+=(w&S|~w&x)+C[3]-1044525330|0,T=(T<<22|T>>>10)+w|0,x+=(T&w|~T&S)+C[4]-176418897|0,x=(x<<7|x>>>25)+T|0,S+=(x&T|~x&w)+C[5]+1200080426|0,S=(S<<12|S>>>20)+x|0,w+=(S&x|~S&T)+C[6]-1473231341|0,w=(w<<17|w>>>15)+S|0,T+=(w&S|~w&x)+C[7]-45705983|0,T=(T<<22|T>>>10)+w|0,x+=(T&w|~T&S)+C[8]+1770035416|0,x=(x<<7|x>>>25)+T|0,S+=(x&T|~x&w)+C[9]-1958414417|0,S=(S<<12|S>>>20)+x|0,w+=(S&x|~S&T)+C[10]-42063|0,w=(w<<17|w>>>15)+S|0,T+=(w&S|~w&x)+C[11]-1990404162|0,T=(T<<22|T>>>10)+w|0,x+=(T&w|~T&S)+C[12]+1804603682|0,x=(x<<7|x>>>25)+T|0,S+=(x&T|~x&w)+C[13]-40341101|0,S=(S<<12|S>>>20)+x|0,w+=(S&x|~S&T)+C[14]-1502002290|0,w=(w<<17|w>>>15)+S|0,T+=(w&S|~w&x)+C[15]+1236535329|0,T=(T<<22|T>>>10)+w|0,x+=(T&S|w&~S)+C[1]-165796510|0,x=(x<<5|x>>>27)+T|0,S+=(x&w|T&~w)+C[6]-1069501632|0,S=(S<<9|S>>>23)+x|0,w+=(S&T|x&~T)+C[11]+643717713|0,w=(w<<14|w>>>18)+S|0,T+=(w&x|S&~x)+C[0]-373897302|0,T=(T<<20|T>>>12)+w|0,x+=(T&S|w&~S)+C[5]-701558691|0,x=(x<<5|x>>>27)+T|0,S+=(x&w|T&~w)+C[10]+38016083|0,S=(S<<9|S>>>23)+x|0,w+=(S&T|x&~T)+C[15]-660478335|0,w=(w<<14|w>>>18)+S|0,T+=(w&x|S&~x)+C[4]-405537848|0,T=(T<<20|T>>>12)+w|0,x+=(T&S|w&~S)+C[9]+568446438|0,x=(x<<5|x>>>27)+T|0,S+=(x&w|T&~w)+C[14]-1019803690|0,S=(S<<9|S>>>23)+x|0,w+=(S&T|x&~T)+C[3]-187363961|0,w=(w<<14|w>>>18)+S|0,T+=(w&x|S&~x)+C[8]+1163531501|0,T=(T<<20|T>>>12)+w|0,x+=(T&S|w&~S)+C[13]-1444681467|0,x=(x<<5|x>>>27)+T|0,S+=(x&w|T&~w)+C[2]-51403784|0,S=(S<<9|S>>>23)+x|0,w+=(S&T|x&~T)+C[7]+1735328473|0,w=(w<<14|w>>>18)+S|0,T+=(w&x|S&~x)+C[12]-1926607734|0,T=(T<<20|T>>>12)+w|0,x+=(T^w^S)+C[5]-378558|0,x=(x<<4|x>>>28)+T|0,S+=(x^T^w)+C[8]-2022574463|0,S=(S<<11|S>>>21)+x|0,w+=(S^x^T)+C[11]+1839030562|0,w=(w<<16|w>>>16)+S|0,T+=(w^S^x)+C[14]-35309556|0,T=(T<<23|T>>>9)+w|0,x+=(T^w^S)+C[1]-1530992060|0,x=(x<<4|x>>>28)+T|0,S+=(x^T^w)+C[4]+1272893353|0,S=(S<<11|S>>>21)+x|0,w+=(S^x^T)+C[7]-155497632|0,w=(w<<16|w>>>16)+S|0,T+=(w^S^x)+C[10]-1094730640|0,T=(T<<23|T>>>9)+w|0,x+=(T^w^S)+C[13]+681279174|0,x=(x<<4|x>>>28)+T|0,S+=(x^T^w)+C[0]-358537222|0,S=(S<<11|S>>>21)+x|0,w+=(S^x^T)+C[3]-722521979|0,w=(w<<16|w>>>16)+S|0,T+=(w^S^x)+C[6]+76029189|0,T=(T<<23|T>>>9)+w|0,x+=(T^w^S)+C[9]-640364487|0,x=(x<<4|x>>>28)+T|0,S+=(x^T^w)+C[12]-421815835|0,S=(S<<11|S>>>21)+x|0,w+=(S^x^T)+C[15]+530742520|0,w=(w<<16|w>>>16)+S|0,T+=(w^S^x)+C[2]-995338651|0,T=(T<<23|T>>>9)+w|0,x+=(w^(T|~S))+C[0]-198630844|0,x=(x<<6|x>>>26)+T|0,S+=(T^(x|~w))+C[7]+1126891415|0,S=(S<<10|S>>>22)+x|0,w+=(x^(S|~T))+C[14]-1416354905|0,w=(w<<15|w>>>17)+S|0,T+=(S^(w|~x))+C[5]-57434055|0,T=(T<<21|T>>>11)+w|0,x+=(w^(T|~S))+C[12]+1700485571|0,x=(x<<6|x>>>26)+T|0,S+=(T^(x|~w))+C[3]-1894986606|0,S=(S<<10|S>>>22)+x|0,w+=(x^(S|~T))+C[10]-1051523|0,w=(w<<15|w>>>17)+S|0,T+=(S^(w|~x))+C[1]-2054922799|0,T=(T<<21|T>>>11)+w|0,x+=(w^(T|~S))+C[8]+1873313359|0,x=(x<<6|x>>>26)+T|0,S+=(T^(x|~w))+C[15]-30611744|0,S=(S<<10|S>>>22)+x|0,w+=(x^(S|~T))+C[6]-1560198380|0,w=(w<<15|w>>>17)+S|0,T+=(S^(w|~x))+C[13]+1309151649|0,T=(T<<21|T>>>11)+w|0,x+=(w^(T|~S))+C[4]-145523070|0,x=(x<<6|x>>>26)+T|0,S+=(T^(x|~w))+C[11]-1120210379|0,S=(S<<10|S>>>22)+x|0,w+=(x^(S|~T))+C[2]+718787259|0,w=(w<<15|w>>>17)+S|0,T+=(S^(w|~x))+C[9]-343485551|0,T=(T<<21|T>>>11)+w|0,y[0]=x+y[0]|0,y[1]=T+y[1]|0,y[2]=w+y[2]|0,y[3]=S+y[3]|0}function s(y){var C=[],x;for(x=0;x<64;x+=4)C[x>>2]=y.charCodeAt(x)+(y.charCodeAt(x+1)<<8)+(y.charCodeAt(x+2)<<16)+(y.charCodeAt(x+3)<<24);return C}function i(y){var C=[],x;for(x=0;x<64;x+=4)C[x>>2]=y[x]+(y[x+1]<<8)+(y[x+2]<<16)+(y[x+3]<<24);return C}function o(y){var C=y.length,x=[1732584193,-271733879,-1732584194,271733878],T,w,S,M,E,R;for(T=64;T<=C;T+=64)a(x,s(y.substring(T-64,T)));for(y=y.substring(T-64),w=y.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<w;T+=1)S[T>>2]|=y.charCodeAt(T)<<(T%4<<3);if(S[T>>2]|=128<<(T%4<<3),T>55)for(a(x,S),T=0;T<16;T+=1)S[T]=0;return M=C*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(M[2],16),R=parseInt(M[1],16)||0,S[14]=E,S[15]=R,a(x,S),x}function f(y){var C=y.length,x=[1732584193,-271733879,-1732584194,271733878],T,w,S,M,E,R;for(T=64;T<=C;T+=64)a(x,i(y.subarray(T-64,T)));for(y=T-64<C?y.subarray(T-64):new Uint8Array(0),w=y.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<w;T+=1)S[T>>2]|=y[T]<<(T%4<<3);if(S[T>>2]|=128<<(T%4<<3),T>55)for(a(x,S),T=0;T<16;T+=1)S[T]=0;return M=C*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(M[2],16),R=parseInt(M[1],16)||0,S[14]=E,S[15]=R,a(x,S),x}function c(y){var C="",x;for(x=0;x<4;x+=1)C+=r[y>>x*8+4&15]+r[y>>x*8&15];return C}function g(y){var C;for(C=0;C<y.length;C+=1)y[C]=c(y[C]);return y.join("")}g(o("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(y,C){var x=(y&65535)+(C&65535),T=(y>>16)+(C>>16)+(x>>16);return T<<16|x&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function y(C,x){return C=C|0||0,C<0?Math.max(C+x,0):Math.min(C,x)}ArrayBuffer.prototype.slice=function(C,x){var T=this.byteLength,w=y(C,T),S=T,M,E,R,D;return x!==t&&(S=y(x,T)),w>S?new ArrayBuffer(0):(M=S-w,E=new ArrayBuffer(M),R=new Uint8Array(E),D=new Uint8Array(this,w,M),R.set(D),E)}})();function u(y){return/[\u0080-\uFFFF]/.test(y)&&(y=unescape(encodeURIComponent(y))),y}function l(y,C){var x=y.length,T=new ArrayBuffer(x),w=new Uint8Array(T),S;for(S=0;S<x;S+=1)w[S]=y.charCodeAt(S);return C?w:T}function p(y){return String.fromCharCode.apply(null,new Uint8Array(y))}function d(y,C,x){var T=new Uint8Array(y.byteLength+C.byteLength);return T.set(new Uint8Array(y)),T.set(new Uint8Array(C),y.byteLength),x?T:T.buffer}function h(y){var C=[],x=y.length,T;for(T=0;T<x-1;T+=2)C.push(parseInt(y.substr(T,2),16));return String.fromCharCode.apply(String,C)}function v(){this.reset()}return v.prototype.append=function(y){return this.appendBinary(u(y)),this},v.prototype.appendBinary=function(y){this._buff+=y,this._length+=y.length;var C=this._buff.length,x;for(x=64;x<=C;x+=64)a(this._hash,s(this._buff.substring(x-64,x)));return this._buff=this._buff.substring(x-64),this},v.prototype.end=function(y){var C=this._buff,x=C.length,T,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S;for(T=0;T<x;T+=1)w[T>>2]|=C.charCodeAt(T)<<(T%4<<3);return this._finish(w,x),S=g(this._hash),y&&(S=h(S)),this.reset(),S},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},v.prototype.setState=function(y){return this._buff=y.buff,this._length=y.length,this._hash=y.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(y,C){var x=C,T,w,S;if(y[x>>2]|=128<<(x%4<<3),x>55)for(a(this._hash,y),x=0;x<16;x+=1)y[x]=0;T=this._length*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(T[2],16),S=parseInt(T[1],16)||0,y[14]=w,y[15]=S,a(this._hash,y)},v.hash=function(y,C){return v.hashBinary(u(y),C)},v.hashBinary=function(y,C){var x=o(y),T=g(x);return C?h(T):T},v.ArrayBuffer=function(){this.reset()},v.ArrayBuffer.prototype.append=function(y){var C=d(this._buff.buffer,y,!0),x=C.length,T;for(this._length+=y.byteLength,T=64;T<=x;T+=64)a(this._hash,i(C.subarray(T-64,T)));return this._buff=T-64<x?new Uint8Array(C.buffer.slice(T-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(y){var C=this._buff,x=C.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,S;for(w=0;w<x;w+=1)T[w>>2]|=C[w]<<(w%4<<3);return this._finish(T,x),S=g(this._hash),y&&(S=h(S)),this.reset(),S},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var y=v.prototype.getState.call(this);return y.buff=p(y.buff),y},v.ArrayBuffer.prototype.setState=function(y){return y.buff=l(y.buff,!0),v.prototype.setState.call(this,y)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(y,C){var x=f(new Uint8Array(y)),T=g(x);return C?h(T):T},v})});var pv={};xr(pv,{loadFreeSurferAnnotation:()=>tV,loadFreeSurferCurvature:()=>Uf,loadFreeSurferSurface:()=>kf,parseFreeSurferAnnotation:()=>lv,parseFreeSurferCurvature:()=>gv,parseFreeSurferSurface:()=>uv});function uv(t){let e=new DataView(t),r=0,n=e.getUint8(r++),a=e.getUint8(r++),s=e.getUint8(r++);if(n!==255||a!==255||s!==254)throw new Error(`Invalid FreeSurfer surface file magic number: ${n}, ${a}, ${s}`);let i="";for(;r<t.byteLength;){let u=e.getUint8(r++);if(u===10&&e.getUint8(r)===10){r++;break}i+=String.fromCharCode(u)}let o=e.getInt32(r,!1);r+=4;let f=e.getInt32(r,!1);r+=4,console.log(`FreeSurfer surface: ${o} vertices, ${f} faces`);let c=[];for(let u=0;u<o;u++){let l=e.getFloat32(r,!1);r+=4;let p=e.getFloat32(r,!1);r+=4;let d=e.getFloat32(r,!1);r+=4,c.push([l,p,d])}let g=[];for(let u=0;u<f;u++){let l=e.getInt32(r,!1);r+=4;let p=e.getInt32(r,!1);r+=4;let d=e.getInt32(r,!1);r+=4,g.push([l,p,d])}return{vertices:c,triangles:g,numVertices:o,numFaces:f,comment:i}}function gv(t){let e=new DataView(t),r=0,n=e.getUint8(r++),a=e.getUint8(r++),s=e.getUint8(r++);if(n!==255||a!==255||s!==255)throw new Error(`Invalid FreeSurfer curvature file magic number: ${n}, ${a}, ${s}`);let i=e.getInt32(r,!1);r+=4;let o=e.getInt32(r,!1);r+=4;let f=e.getInt32(r,!1);r+=4,console.log(`FreeSurfer curvature: ${i} vertices, ${f} values per vertex`);let c=new Float32Array(i);for(let g=0;g<i;g++)c[g]=e.getFloat32(r,!1),r+=4;return c}function lv(t){let e=new DataView(t),r=0,n=e.getInt32(r,!1);if(r+=4,n<0||n>1e7)throw new Error(`Invalid number of vertices: ${n}`);let a=new Int32Array(n),s=new Int32Array(n);for(let f=0;f<n;f++){if(r+8>t.byteLength)throw new Error(`Buffer overflow reading vertex ${f} at offset ${r}`);a[f]=e.getInt32(r,!1),r+=4,s[f]=e.getInt32(r,!1),r+=4}if(r>=t.byteLength)return{numVertices:n,vertexIndices:a,vertexLabels:s,colorTable:null};let i=e.getInt32(r,!1);r+=4;let o=null;if(i===1){let f=e.getInt32(r,!1);r+=4,f<0&&(r+=4);let g=e.getInt32(r,!1);if(r+=4,g<0||g>1e4)throw new Error(`Invalid filename length: ${g}`);if(r+=g,r+4>t.byteLength)throw new Error(`Not enough data for numTableEntries at offset ${r}`);let u=e.getInt32(r,!1);if(r+=4,u<0||u>1e4)throw new Error(`Invalid number of table entries: ${u}`);o={numEntries:u,entries:[]};for(let l=0;l<u;l++){if(r+4>t.byteLength){console.warn(`Buffer overflow at entry ${l}, stopping color table read`);break}let p=e.getInt32(r,!1);if(r+=4,r+4>t.byteLength){console.warn(`Buffer overflow reading name length at entry ${l}`);break}let d=e.getInt32(r,!1);if(r+=4,d<0||d>1e3){console.warn(`Invalid name length ${d} at entry ${l}, skipping rest`);break}let h="";for(let w=0;w<d;w++){if(r>=t.byteLength){console.warn(`Buffer overflow reading name at entry ${l}`);break}let S=e.getUint8(r++);S>0&&(h+=String.fromCharCode(S))}if(r+16>t.byteLength){console.warn(`Buffer overflow reading RGBA at entry ${l}: ${h}`);break}let v=e.getInt32(r,!1);r+=4;let y=e.getInt32(r,!1);r+=4;let C=e.getInt32(r,!1);r+=4;let x=e.getInt32(r,!1);r+=4;let T=v+y*256+C*65536;o.entries.push({structure:p,name:h,r:v,g:y,b:C,a:x,label:T})}}return{numVertices:n,vertexIndices:a,vertexLabels:s,colorTable:o}}async function kf(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load surface: ${t}`);let r=await e.arrayBuffer();return uv(r)}async function Uf(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load curvature: ${t}`);let r=await e.arrayBuffer();return gv(r)}async function tV(t){let e=await fetch(t);if(!e.ok)throw new Error(`Failed to load annotation: ${t}`);let r=await e.arrayBuffer();return lv(r)}var Nf=zv(()=>{});var $c=xn(ai(),1);var Gc=xn(Nc(),1),ot=(0,Gc.default)(),_c={vtkObject:()=>null};function ze(t){if(t==null||t.isA)return t;if(!t.vtkClass)return ot.console&&ot.console.error&&ot.console.error("Invalid VTK object"),null;let e=_c[t.vtkClass];if(!e)return ot.console&&ot.console.error&&ot.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;let r={...t};Object.keys(r).forEach(a=>{r[a]&&typeof r[a]=="object"&&r[a].vtkClass&&(r[a]=ze(r[a]))});let n=e(r);return n&&n.modified&&n.modified(),n}function nd(t,e){_c[t]=e}ze.register=nd;var Ir=class extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}};var pi=0,jc=t=>{throw new Error(`Named parameter '${t}' is missing`)},Kc=Symbol("void");function ad(){return pi}var Pc={};function Tr(){}var sd=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];sd.forEach(t=>{Pc[t]=Tr});ot.console=console.hasOwnProperty("log")?console:Pc;var Qt={debug:Tr,error:ot.console.error||Tr,info:ot.console.info||Tr,log:ot.console.log||Tr,warn:ot.console.warn||Tr};function Xc(t,e){Qt[t]&&(Qt[t]=e||Tr)}function Yc(){Qt.log(...arguments)}function Ic(){Qt.info(...arguments)}function oa(){Qt.debug(...arguments)}function q(){Qt.error(...arguments)}function ca(){Qt.warn(...arguments)}var bc={};function qc(t){bc[t]||(Qt.error(t),bc[t]=!0)}var Fe=Object.create(null);Fe.Float32Array=Float32Array;Fe.Float64Array=Float64Array;Fe.Uint8Array=Uint8Array;Fe.Int8Array=Int8Array;Fe.Uint16Array=Uint16Array;Fe.Int16Array=Int16Array;Fe.Uint32Array=Uint32Array;Fe.Int32Array=Int32Array;Fe.Uint8ClampedArray=Uint8ClampedArray;try{Fe.BigInt64Array=BigInt64Array,Fe.BigUint64Array=BigUint64Array}catch{}function kt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(Fe[t]||Float64Array)(...r)}function ua(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return(Fe[t]||Float64Array).from(...r)}function ga(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Te(t){return ga(t[0]==="_"?t.slice(1):t)}function Zc(t){return t.charAt(0).toLowerCase()+t.slice(1)}function Qc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,n=["TB","GB","MB","KB"],a=Number(t),s="B";for(;a>r;)a/=r,s=n.pop();return`${a.toFixed(e)} ${s}`}function Jc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",r=[],n=t;for(;n>1e3;)r.push(`000${n%1e3}`.slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function eu(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function id(t){return Object.values(Fe).some(e=>t instanceof e)}function od(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function fd(t,e){return Object.keys(t).find(r=>t[r]===e)}function tu(t){return t&&t.isA?t.getState():t}function hi(t){setTimeout(t,0)}function ru(t,e){let r=performance.now();t.finally(()=>{let n=performance.now()-r;e(n)})}function ne(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};eu(e);let r=[];if(Number.isInteger(e.mtime)||(e.mtime=++pi),!("classHierarchy"in e))e.classHierarchy=new Ir("vtkObject");else if(!(e.classHierarchy instanceof Ir)){let s=new Ir;for(let i=0;i<e.classHierarchy.length;i++)s.push(e.classHierarchy[i]);e.classHierarchy=s}function n(s){r[s]=null}function a(s){function i(){n(s)}return Object.freeze({unsubscribe:i})}return t.isDeleted=()=>!!e.deleted,t.modified=s=>{if(e.deleted){q("instance deleted - cannot call any method");return}s&&s<t.getMTime()||(e.mtime=++pi,r.forEach(i=>i&&i(t)))},t.onModified=s=>{if(e.deleted)return q("instance deleted - cannot call any method"),null;let i=r.length;return r.push(s),a(i)},t.getMTime=()=>e.mtime,t.isA=s=>{let i=e.classHierarchy.length;for(;i--;)if(e.classHierarchy[i]===s)return!0;return!1},t.getClassName=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-s]},t.set=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,f=!1;return Object.keys(s).forEach(c=>{let g=o?null:t[`set${ga(c)}`];g&&Array.isArray(s[c])&&g.length>1?f=g(...s[c])||f:g?f=g(s[c])||f:(["mtime"].indexOf(c)===-1&&!i&&ca(`Warning: Set value to model directly ${c}, ${s[c]}`),f=e[c]!==s[c]||f,e[c]=s[c])}),f},t.get=function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];if(!i.length)return e;let f={};return i.forEach(c=>{f[c]=e[c]}),f},t.getReferenceByName=s=>e[s],t.delete=()=>{Object.keys(e).forEach(s=>delete e[s]),r.forEach((s,i)=>n(i)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;let s={...e,vtkClass:t.getClassName()};Object.keys(s).forEach(o=>{s[o]===null||s[o]===void 0||o[0]==="_"?delete s[o]:s[o].isA?s[o]=s[o].getState():Array.isArray(s[o])?s[o]=s[o].map(tu):id(s[o])&&(s[o]=Array.from(s[o]))});let i={};return Object.keys(s).sort().forEach(o=>{i[o]=s[o]}),i.mtime&&delete i.mtime,i},t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${s.getClassName()} into ${t.getClassName()}`);let o=s.get(),f=Object.keys(e).sort();Object.keys(o).sort().forEach(g=>{let u=f.indexOf(g);u===-1?i&&oa(`add ${g} in shallowCopy`):f.splice(u,1),e[g]=o[g]}),f.length&&i&&oa(`Untouched keys: ${f.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}var cd={object(t,e,r){return function(){return{...e[r.name]}}}};function pe(t,e,r){r.forEach(n=>{if(typeof n=="object"){let a=cd[n.type];a?t[`get${Te(n.name)}`]=a(t,e,n):t[`get${Te(n.name)}`]=()=>e[n.name]}else t[`get${Te(n)}`]=()=>e[n]})}var nu={enum(t,e,r){let n=`_on${Te(r.name)}Changed`;return a=>{if(typeof a=="string"){if(r.enum[a]!==void 0)return e[r.name]!==r.enum[a]?(e[r.name]=r.enum[a],t.modified(),!0):!1;throw q(`Set Enum with invalid argument ${r}, ${a}`),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(e[r.name]!==a){if(Object.keys(r.enum).map(s=>r.enum[s]).indexOf(a)!==-1){let s=e[r.name];return e[r.name]=a,e[n]?.(t,e,a,s),t.modified(),!0}throw q(`Set Enum outside numeric range ${r}, ${a}`),new RangeError("Set Enum outside numeric range")}return!1}throw q(`Set Enum with invalid argument (String/Number) ${r}, ${a}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,r){r.params?.length===1&&ca('Setter of type "object" with a single "param" field is not supported');let n=`_on${Te(r.name)}Changed`;return function(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];let o;if(s.length>1&&r.params?.length?o=r.params.reduce((f,c,g)=>Object.assign(f,{[c]:s[g]}),{}):o=s[0],!(0,$c.default)(e[r.name],o)){let f=e[r.name];return e[r.name]=o,e[n]?.(t,e,o,f),t.modified(),!0}return!1}}};function zc(t){if(typeof t=="object"){let e=nu[t.type];if(e)return(r,n)=>e(r,n,t);throw q(`No setter for field ${t}`),new TypeError("No setter for field")}return function(r,n){let a=`_on${Te(t)}Changed`;return function(i){if(n.deleted)return q("instance deleted - cannot call any method"),!1;if(n[t]!==i){let o=n[t.name];return n[t]=i,n[a]?.(r,n,i,o),r.modified(),!0}return!1}}}function Sr(t,e,r){r.forEach(n=>{typeof n=="object"?t[`set${Te(n.name)}`]=zc(n)(t,e):t[`set${Te(n)}`]=zc(n)(t,e)})}function re(t,e,r){pe(t,e,r),Sr(t,e,r)}function Ut(t,e,r){r.forEach(n=>{t[`get${Te(n)}`]=()=>e[n]?Array.from(e[n]):e[n],t[`get${Te(n)}ByReference`]=()=>e[n]})}function vi(t,e,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(s=>{if(e[s]&&n&&e[s].length!==n)throw new RangeError(`Invalid initial number of values for array (${s})`);let i=`_on${Te(s)}Changed`;t[`set${Te(s)}`]=function(){if(e.deleted)return q("instance deleted - cannot call any method"),!1;for(var o=arguments.length,f=new Array(o),c=0;c<o;c++)f[c]=arguments[c];let g=f,u,l=!1;if(g.length===1&&(g[0]==null||g[0].length>=0)&&(g=g[0],l=!0),g==null)u=e[s]!==g;else{if(n&&g.length!==n)if(g.length<n&&a!==void 0)for(g=Array.from(g),l=!1;g.length<n;)g.push(a);else throw new RangeError(`Invalid number of values for array setter (${s})`);u=e[s]==null||e[s].length!==g.length;for(let p=0;!u&&p<g.length;++p)u=e[s][p]!==g[p];u&&l&&(g=Array.from(g))}if(u){let p=e[s.name];e[s]=g,e[i]?.(t,e,g,p),t.modified()}return u},t[`set${Te(s)}From`]=o=>{let f=e[s];o.forEach((c,g)=>{f[g]=c})}})}function la(t,e,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Ut(t,e,r),vi(t,e,r,n,a)}function Jt(t,e,r){for(let n=0;n<r.length;n++){let a=r[n];e[a]!==void 0&&(e[`_${a}`]=e[a],delete e[a])}}function au(t,e,r,n){e.inputData?e.inputData=e.inputData.map(ze):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(ze):e.inputConnection=[],e.output?e.output=e.output.map(ze):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(ze):e.inputArrayToProcess=[],e.numberOfInputs=r;function a(p){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){q("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){q(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[d]!==p||e.inputConnection[d])&&(e.inputData[d]=p,e.inputConnection[d]=null,t.modified&&t.modified())}function s(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function i(p){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){q("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){let h=`algorithm ${t.getClassName()} only has `;h+=`${e.numberOfInputs}`,h+=" input ports. To add more input ports, use addInputConnection()",q(h);return}e.inputData[d]=null,e.inputConnection[d]=p}function o(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function f(){let p=e.numberOfInputs;for(;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function c(p){if(e.deleted){q("instance deleted - cannot call any method");return}i(p,f())}function g(p){if(e.deleted){q("instance deleted - cannot call any method");return}a(p,f())}function u(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(q("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=()=>{let p=t.getMTime(),d=1/0,h=n;for(;h--;){if(!e.output[h]||e.output[h].isDeleted())return!0;let v=e.output[h].getMTime();if(v<p)return!0;v<d&&(d=v)}for(h=e.numberOfInputs;h--;)if(e.inputConnection[h]?.filter.shouldUpdate()||t.getInputData(h)?.getMTime()>d)return!0;return!1};function l(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=()=>u(p);return d.filter=t,d}if(e.numberOfInputs){let p=e.numberOfInputs;for(;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=i,t.addInputData=g,t.addInputConnection=c,t.getInputData=s,t.getInputConnection=o}n&&(t.getOutputData=u,t.getOutputPort=l),t.update=()=>{let p=[];if(e.numberOfInputs){let d=0;for(;d<e.numberOfInputs;)p[d]=t.getInputData(d),d++}t.requestData&&!t.isDeleted()&&t.shouldUpdate()&&t.requestData(p,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>n||e.output.length,t.getInputArrayToProcess=p=>{let d=e.inputArrayToProcess[p],h=e.inputData[p];return d&&h?h[`get${d.fieldAssociation}`]().getArray(d.arrayName):null},t.setInputArrayToProcess=function(p,d,h){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:d,fieldAssociation:h,attributeType:v}}}var di=Symbol("Event abort");function su(t,e,r){let n=[],a=t.delete,s=1;function i(c){for(let g=0;g<n.length;++g){let[u]=n[g];if(u===c){n.splice(g,1);return}}}function o(c){function g(){i(c)}return Object.freeze({unsubscribe:g})}function f(){if(e.deleted){q("instance deleted - cannot call any method");return}let c=n.slice();for(let g=0;g<c.length;++g){let[,u,l]=c[g];if(u){if(l<0)setTimeout(()=>u.apply(t,arguments),1-l);else if(u.apply(t,arguments)===di)break}}}t[`invoke${Te(r)}`]=f,t[`on${Te(r)}`]=function(c){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!c.apply)return console.error(`Invalid callback for event ${r}`),null;if(e.deleted)return q("instance deleted - cannot call any method"),null;let u=s++;return n.push([u,c,g]),n.sort((l,p)=>p[2]-l[2]),o(u)},t.delete=()=>{a(),n.forEach(c=>{let[g]=c;return i(g)})}}function j(t,e){let r=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={},s={};return t(s,a,n),Object.freeze(s)};return e&&ze.register(e,r),r}function iu(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return e.filter(i=>!!i).map(i=>i(...a))}}function yi(t){return t&&t.isA&&t.isA("vtkObject")}function fa(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(yi(t)){if(n.indexOf(t)>=0)return r;n.push(t);let a=e(t);a!==void 0&&r.push(a);let s=t.get();Object.keys(s).forEach(i=>{let o=s[i];Array.isArray(o)?o.forEach(f=>{fa(f,e,r,n)}):fa(o,e,r,n)})}return r}function ou(t,e,r){var n=this;let a,s=function(){for(var i=arguments.length,o=new Array(i),f=0;f<i;f++)o[f]=arguments[f];let c=n,g=()=>{a=null,r||t.apply(c,o)},u=r&&!a;clearTimeout(a),a=setTimeout(g,e),u&&t.apply(c,o)};return s.cancel=()=>clearTimeout(a),s}function fu(t,e){let r=!1,n=null;function a(){r=!1,n!==null&&(s(...n),n=null)}function s(){for(var i=arguments.length,o=new Array(i),f=0;f<i;f++)o[f]=arguments[f];if(r){n=o;return}r=!0,t(...o),setTimeout(a,e)}return s}function xi(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=(n,a)=>{e.keystore[n]=a},t.getKey=n=>e.keystore[n],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=n=>delete e.keystore[n],t.clearKeystore=()=>t.getAllKeys().forEach(n=>delete e.keystore[n])}var ud=1,ia="__root__";function cu(t,e){xi(t,e);let r=t.delete;e.proxyId=`${ud++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),pe(t,e,["proxyId","proxyGroup","proxyName"]),re(t,e,["proxyManager"]);let n={},a={};function s(c,g){a[g]||(a[g]=[]);let u=a[g];for(let l=0;l<c.length;l++)u.push(c[l].name),n[c[l].name]=c[l],c[l].children&&c[l].children.length&&s(c[l].children,c[l].name)}s(e.ui,ia),t.updateUI=c=>{e.ui=JSON.parse(JSON.stringify(c||[])),Object.keys(n).forEach(g=>delete n[g]),Object.keys(a).forEach(g=>delete a[g]),s(e.ui,ia),t.modified()};function i(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ia;return a[c]}t.updateProxyProperty=(c,g)=>{let u=n[c];u?Object.assign(u,g):n[c]={...g}},t.activate=()=>{if(e.proxyManager){let c=`setActive${Te(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[c]&&e.proxyManager[c](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(c,g)=>{g in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[g]=[]),e.propertyLinkSubscribers[g].push(c)},t.gcPropertyLinks=c=>{let g=e.propertyLinkSubscribers[c]||[];for(;g.length;)g.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(c){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[c])return e.propertyLinkMap[c];let u=null,l=[],p=0,d=!1;function h(T){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(d)return null;let S=[],M=null;for(p=l.length;p--;){let R=l[p];R.instance===T?M=R:S.push(R)}if(!M)return null;let E=M.instance[`get${Te(M.propertyName)}`]();if(!od(E,u)||w){for(u=E,d=!0;S.length;){let R=S.pop();R.instance.set({[R.propertyName]:u})}d=!1}return e.propertyLinkMap[c].persistent&&(e.propertyLinkMap[c].value=E),E}function v(T,w){let S=[];for(p=l.length;p--;){let M=l[p];M.instance===T&&(M.propertyName===w||w===void 0)&&(M.subscription.unsubscribe(),S.push(p))}for(;S.length;)l.splice(S.pop(),1)}function y(T,w){let S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,M=T.onModified(h),E=l[0];return l.push({instance:T,propertyName:w,subscription:M}),S&&(e.propertyLinkMap[c].persistent&&e.propertyLinkMap[c].value!==void 0?T.set({[w]:e.propertyLinkMap[c].value}):E&&h(E.instance,!0)),{unsubscribe:()=>v(T,w)}}function C(){for(;l.length;)l.pop().subscription.unsubscribe()}let x={bind:y,unbind:v,unsubscribe:C,persistent:g};return e.propertyLinkMap[c]=x,x};function o(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ia,g=[],u=e.proxyId,l=i(c)||[];for(let p=0;p<l.length;p++){let d=l[p],h=t[`get${Te(d)}`],v=h?h():void 0,y={id:u,name:d,value:v},C=o(d);C.length&&(y.children=C),g.push(y)}return g}t.listPropertyNames=()=>o().map(c=>c.name),t.getPropertyByName=c=>o().find(g=>g.name===c),t.getPropertyDomainByName=c=>(n[c]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{let c=Object.keys(e.propertyLinkMap),g=c.length;for(;g--;)e.propertyLinkMap[c[g]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=()=>null;function f(){if(e.links)for(let c=0;c<e.links.length;c++){let{link:g,property:u,persistent:l,updateOnBind:p,type:d}=e.links[c];if(d==="application"){let h=e.proxyManager.getPropertyLink(g,l);t.registerPropertyLinkForGC(h,"application"),h.bind(t,u,p)}}}hi(f)}function uu(t,e,r){let n=t.delete,a=[],s=Object.keys(r),i=s.length;for(;i--;){let o=s[i],{modelKey:f,property:c,modified:g=!0}=r[o],u=Te(c),l=Te(o);t[`get${l}`]=e[f][`get${u}`],t[`set${l}`]=e[f][`set${u}`],g&&a.push(e[f].onModified(t.modified))}t.delete=()=>{for(;a.length;)a.pop().unsubscribe();n()}}function gu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(o){let f=Object.keys(o),c=f.length;for(;c--;){let g=f[c];e[g].set(o[g])}}let s=Object.keys(n),i=s.length;for(;i--;){let o=s[i];e[o]=n[o];let f=r[o];t[`set${Te(o)}`]=c=>{if(c!==e[o]){e[o]=c;let g=f[c];a(g),t.modified()}}}s.length&&pe(t,e,s)}var Wc=10,Hc=40,Ac=800;function lu(t){let e=0,r=0,n=0,a=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*Wc,a=r*Wc,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||a)&&t.deltaMode&&(t.deltaMode===1?(n*=Hc,a*=Hc):(n*=Ac,a*=Ac)),n&&!e&&(e=n<1?-1:1),a&&!r&&(r=a<1?-1:1),{spinX:e,spinY:r||e,pixelX:n,pixelY:a||n}}var m={algo:au,capitalize:ga,chain:iu,debounce:ou,enumToString:fd,event:su,EVENT_ABORT:di,formatBytesToProperUnit:Qc,formatNumbersWithThousandSeparator:Jc,get:pe,getArray:Ut,getCurrentGlobalMTime:ad,getStateArrayMapFunc:tu,isVtkObject:yi,keystore:xi,measurePromiseExecution:ru,moveToProtected:Jt,newInstance:j,newTypedArray:kt,newTypedArrayFrom:ua,normalizeWheel:lu,obj:ne,proxy:cu,proxyPropertyMapping:uu,proxyPropertyState:gu,safeArrays:eu,set:Sr,setArray:vi,setGet:re,setGetArray:la,setImmediate:hi,setLoggerFunction:Xc,throttle:fu,traverseInstanceTree:fa,TYPED_ARRAYS:Fe,uncapitalize:Zc,VOID:Kc,vtkDebugMacro:oa,vtkErrorMacro:q,vtkInfoMacro:Ic,vtkLogMacro:Yc,vtkOnceErrorMacro:qc,vtkWarningMacro:ca,objectSetterMap:nu,requiredParam:jc},Ee=Object.freeze({__proto__:null,requiredParam:jc,VOID:Kc,setLoggerFunction:Xc,vtkLogMacro:Yc,vtkInfoMacro:Ic,vtkDebugMacro:oa,vtkErrorMacro:q,vtkWarningMacro:ca,vtkOnceErrorMacro:qc,TYPED_ARRAYS:Fe,newTypedArray:kt,newTypedArrayFrom:ua,capitalize:ga,_capitalize:Te,uncapitalize:Zc,formatBytesToProperUnit:Qc,formatNumbersWithThousandSeparator:Jc,setImmediateVTK:hi,measurePromiseExecution:ru,obj:ne,get:pe,set:Sr,setGet:re,getArray:Ut,setArray:vi,setGetArray:la,moveToProtected:Jt,algo:au,EVENT_ABORT:di,event:su,newInstance:j,chain:iu,isVtkObject:yi,traverseInstanceTree:fa,debounce:ou,throttle:fu,keystore:xi,proxy:cu,proxyPropertyMapping:uu,proxyPropertyState:gu,normalizeWheel:lu,default:m});var Nt={};xr(Nt,{ARRAY_TYPE:()=>ie,EPSILON:()=>X,RANDOM:()=>rt,equals:()=>hd,setMatrixArrayType:()=>gd,toRadian:()=>pd});var X=1e-6,ie=typeof Float32Array<"u"?Float32Array:Array,rt=Math.random;function gd(t){ie=t}var ld=Math.PI/180;function pd(t){return t*ld}function hd(t,e){return Math.abs(t-e)<=X*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Se={};xr(Se,{add:()=>_d,adjoint:()=>wd,clone:()=>dd,copy:()=>yd,create:()=>Ti,determinant:()=>Ed,equals:()=>Hd,exactEquals:()=>Wd,frob:()=>Gd,fromMat2d:()=>Bd,fromMat4:()=>vd,fromQuat:()=>Fd,fromRotation:()=>Ld,fromScaling:()=>Vd,fromTranslation:()=>Dd,fromValues:()=>xd,identity:()=>Sd,invert:()=>md,mul:()=>Ad,multiply:()=>pu,multiplyScalar:()=>bd,multiplyScalarAndAdd:()=>zd,normalFromMat4:()=>kd,projection:()=>Ud,rotate:()=>Rd,scale:()=>Od,set:()=>Td,str:()=>Nd,sub:()=>$d,subtract:()=>hu,translate:()=>Md,transpose:()=>Cd});function Ti(){var t=new ie(9);return ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function vd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function dd(t){var e=new ie(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function yd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function xd(t,e,r,n,a,s,i,o,f){var c=new ie(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=a,c[5]=s,c[6]=i,c[7]=o,c[8]=f,c}function Td(t,e,r,n,a,s,i,o,f,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=f,t[8]=c,t}function Sd(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Cd(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function md(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],f=e[6],c=e[7],g=e[8],u=g*i-o*c,l=-g*s+o*f,p=c*s-i*f,d=r*u+n*l+a*p;return d?(d=1/d,t[0]=u*d,t[1]=(-g*n+a*c)*d,t[2]=(o*n-a*i)*d,t[3]=l*d,t[4]=(g*r-a*f)*d,t[5]=(-o*r+a*s)*d,t[6]=p*d,t[7]=(-c*r+n*f)*d,t[8]=(i*r-n*s)*d,t):null}function wd(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],f=e[6],c=e[7],g=e[8];return t[0]=i*g-o*c,t[1]=a*c-n*g,t[2]=n*o-a*i,t[3]=o*f-s*g,t[4]=r*g-a*f,t[5]=a*s-r*o,t[6]=s*c-i*f,t[7]=n*f-r*c,t[8]=r*i-n*s,t}function Ed(t){var e=t[0],r=t[1],n=t[2],a=t[3],s=t[4],i=t[5],o=t[6],f=t[7],c=t[8];return e*(c*s-i*f)+r*(-c*a+i*o)+n*(f*a-s*o)}function pu(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],f=e[5],c=e[6],g=e[7],u=e[8],l=r[0],p=r[1],d=r[2],h=r[3],v=r[4],y=r[5],C=r[6],x=r[7],T=r[8];return t[0]=l*n+p*i+d*c,t[1]=l*a+p*o+d*g,t[2]=l*s+p*f+d*u,t[3]=h*n+v*i+y*c,t[4]=h*a+v*o+y*g,t[5]=h*s+v*f+y*u,t[6]=C*n+x*i+T*c,t[7]=C*a+x*o+T*g,t[8]=C*s+x*f+T*u,t}function Md(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],f=e[5],c=e[6],g=e[7],u=e[8],l=r[0],p=r[1];return t[0]=n,t[1]=a,t[2]=s,t[3]=i,t[4]=o,t[5]=f,t[6]=l*n+p*i+c,t[7]=l*a+p*o+g,t[8]=l*s+p*f+u,t}function Rd(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],f=e[5],c=e[6],g=e[7],u=e[8],l=Math.sin(r),p=Math.cos(r);return t[0]=p*n+l*i,t[1]=p*a+l*o,t[2]=p*s+l*f,t[3]=p*i-l*n,t[4]=p*o-l*a,t[5]=p*f-l*s,t[6]=c,t[7]=g,t[8]=u,t}function Od(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Dd(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Ld(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Vd(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Bd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Fd(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r+r,o=n+n,f=a+a,c=r*i,g=n*i,u=n*o,l=a*i,p=a*o,d=a*f,h=s*i,v=s*o,y=s*f;return t[0]=1-u-d,t[3]=g-y,t[6]=l+v,t[1]=g+y,t[4]=1-c-d,t[7]=p-h,t[2]=l-v,t[5]=p+h,t[8]=1-c-u,t}function kd(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],f=e[6],c=e[7],g=e[8],u=e[9],l=e[10],p=e[11],d=e[12],h=e[13],v=e[14],y=e[15],C=r*o-n*i,x=r*f-a*i,T=r*c-s*i,w=n*f-a*o,S=n*c-s*o,M=a*c-s*f,E=g*h-u*d,R=g*v-l*d,D=g*y-p*d,L=u*v-l*h,V=u*y-p*h,B=l*y-p*v,F=C*B-x*V+T*L+w*D-S*R+M*E;return F?(F=1/F,t[0]=(o*B-f*V+c*L)*F,t[1]=(f*D-i*B-c*R)*F,t[2]=(i*V-o*D+c*E)*F,t[3]=(a*V-n*B-s*L)*F,t[4]=(r*B-a*D+s*R)*F,t[5]=(n*D-r*V-s*E)*F,t[6]=(h*M-v*S+y*w)*F,t[7]=(v*T-d*M-y*x)*F,t[8]=(d*S-h*T+y*C)*F,t):null}function Ud(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Nd(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Gd(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _d(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function hu(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function bd(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function zd(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Wd(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Hd(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],f=t[6],c=t[7],g=t[8],u=e[0],l=e[1],p=e[2],d=e[3],h=e[4],v=e[5],y=e[6],C=e[7],x=e[8];return Math.abs(r-u)<=X*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=X*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-p)<=X*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-d)<=X*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(i-h)<=X*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-v)<=X*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(f-y)<=X*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(c-C)<=X*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(g-x)<=X*Math.max(1,Math.abs(g),Math.abs(x))}var Ad=pu,$d=hu;var O={};xr(O,{add:()=>Oy,adjoint:()=>Zd,clone:()=>Kd,copy:()=>Pd,create:()=>jd,determinant:()=>Qd,equals:()=>By,exactEquals:()=>Vy,frob:()=>Ry,fromQuat:()=>dy,fromQuat2:()=>gy,fromRotation:()=>oy,fromRotationTranslation:()=>yu,fromRotationTranslationScale:()=>hy,fromRotationTranslationScaleOrigin:()=>vy,fromScaling:()=>iy,fromTranslation:()=>sy,fromValues:()=>Xd,fromXRotation:()=>fy,fromYRotation:()=>cy,fromZRotation:()=>uy,frustum:()=>yy,getRotation:()=>py,getScaling:()=>xu,getTranslation:()=>ly,identity:()=>vu,invert:()=>qd,lookAt:()=>wy,mul:()=>Fy,multiply:()=>du,multiplyScalar:()=>Dy,multiplyScalarAndAdd:()=>Ly,ortho:()=>Cy,orthoNO:()=>Su,orthoZO:()=>my,perspective:()=>xy,perspectiveFromFieldOfView:()=>Sy,perspectiveNO:()=>Tu,perspectiveZO:()=>Ty,rotate:()=>ty,rotateX:()=>ry,rotateY:()=>ny,rotateZ:()=>ay,scale:()=>ey,set:()=>Yd,str:()=>My,sub:()=>ky,subtract:()=>Cu,targetTo:()=>Ey,translate:()=>Jd,transpose:()=>Id});function jd(){var t=new ie(16);return ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Kd(t){var e=new ie(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Pd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xd(t,e,r,n,a,s,i,o,f,c,g,u,l,p,d,h){var v=new ie(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=n,v[4]=a,v[5]=s,v[6]=i,v[7]=o,v[8]=f,v[9]=c,v[10]=g,v[11]=u,v[12]=l,v[13]=p,v[14]=d,v[15]=h,v}function Yd(t,e,r,n,a,s,i,o,f,c,g,u,l,p,d,h,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=f,t[8]=c,t[9]=g,t[10]=u,t[11]=l,t[12]=p,t[13]=d,t[14]=h,t[15]=v,t}function vu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Id(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],s=e[6],i=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=a,t[13]=i,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function qd(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],f=e[6],c=e[7],g=e[8],u=e[9],l=e[10],p=e[11],d=e[12],h=e[13],v=e[14],y=e[15],C=r*o-n*i,x=r*f-a*i,T=r*c-s*i,w=n*f-a*o,S=n*c-s*o,M=a*c-s*f,E=g*h-u*d,R=g*v-l*d,D=g*y-p*d,L=u*v-l*h,V=u*y-p*h,B=l*y-p*v,F=C*B-x*V+T*L+w*D-S*R+M*E;return F?(F=1/F,t[0]=(o*B-f*V+c*L)*F,t[1]=(a*V-n*B-s*L)*F,t[2]=(h*M-v*S+y*w)*F,t[3]=(l*S-u*M-p*w)*F,t[4]=(f*D-i*B-c*R)*F,t[5]=(r*B-a*D+s*R)*F,t[6]=(v*T-d*M-y*x)*F,t[7]=(g*M-l*T+p*x)*F,t[8]=(i*V-o*D+c*E)*F,t[9]=(n*D-r*V-s*E)*F,t[10]=(d*S-h*T+y*C)*F,t[11]=(u*T-g*S-p*C)*F,t[12]=(o*R-i*L-f*E)*F,t[13]=(r*L-n*R+a*E)*F,t[14]=(h*x-d*w-v*C)*F,t[15]=(g*w-u*x+l*C)*F,t):null}function Zd(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],f=e[6],c=e[7],g=e[8],u=e[9],l=e[10],p=e[11],d=e[12],h=e[13],v=e[14],y=e[15];return t[0]=o*(l*y-p*v)-u*(f*y-c*v)+h*(f*p-c*l),t[1]=-(n*(l*y-p*v)-u*(a*y-s*v)+h*(a*p-s*l)),t[2]=n*(f*y-c*v)-o*(a*y-s*v)+h*(a*c-s*f),t[3]=-(n*(f*p-c*l)-o*(a*p-s*l)+u*(a*c-s*f)),t[4]=-(i*(l*y-p*v)-g*(f*y-c*v)+d*(f*p-c*l)),t[5]=r*(l*y-p*v)-g*(a*y-s*v)+d*(a*p-s*l),t[6]=-(r*(f*y-c*v)-i*(a*y-s*v)+d*(a*c-s*f)),t[7]=r*(f*p-c*l)-i*(a*p-s*l)+g*(a*c-s*f),t[8]=i*(u*y-p*h)-g*(o*y-c*h)+d*(o*p-c*u),t[9]=-(r*(u*y-p*h)-g*(n*y-s*h)+d*(n*p-s*u)),t[10]=r*(o*y-c*h)-i*(n*y-s*h)+d*(n*c-s*o),t[11]=-(r*(o*p-c*u)-i*(n*p-s*u)+g*(n*c-s*o)),t[12]=-(i*(u*v-l*h)-g*(o*v-f*h)+d*(o*l-f*u)),t[13]=r*(u*v-l*h)-g*(n*v-a*h)+d*(n*l-a*u),t[14]=-(r*(o*v-f*h)-i*(n*v-a*h)+d*(n*f-a*o)),t[15]=r*(o*l-f*u)-i*(n*l-a*u)+g*(n*f-a*o),t}function Qd(t){var e=t[0],r=t[1],n=t[2],a=t[3],s=t[4],i=t[5],o=t[6],f=t[7],c=t[8],g=t[9],u=t[10],l=t[11],p=t[12],d=t[13],h=t[14],v=t[15],y=e*i-r*s,C=e*o-n*s,x=e*f-a*s,T=r*o-n*i,w=r*f-a*i,S=n*f-a*o,M=c*d-g*p,E=c*h-u*p,R=c*v-l*p,D=g*h-u*d,L=g*v-l*d,V=u*v-l*h;return y*V-C*L+x*D+T*R-w*E+S*M}function du(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],f=e[5],c=e[6],g=e[7],u=e[8],l=e[9],p=e[10],d=e[11],h=e[12],v=e[13],y=e[14],C=e[15],x=r[0],T=r[1],w=r[2],S=r[3];return t[0]=x*n+T*o+w*u+S*h,t[1]=x*a+T*f+w*l+S*v,t[2]=x*s+T*c+w*p+S*y,t[3]=x*i+T*g+w*d+S*C,x=r[4],T=r[5],w=r[6],S=r[7],t[4]=x*n+T*o+w*u+S*h,t[5]=x*a+T*f+w*l+S*v,t[6]=x*s+T*c+w*p+S*y,t[7]=x*i+T*g+w*d+S*C,x=r[8],T=r[9],w=r[10],S=r[11],t[8]=x*n+T*o+w*u+S*h,t[9]=x*a+T*f+w*l+S*v,t[10]=x*s+T*c+w*p+S*y,t[11]=x*i+T*g+w*d+S*C,x=r[12],T=r[13],w=r[14],S=r[15],t[12]=x*n+T*o+w*u+S*h,t[13]=x*a+T*f+w*l+S*v,t[14]=x*s+T*c+w*p+S*y,t[15]=x*i+T*g+w*d+S*C,t}function Jd(t,e,r){var n=r[0],a=r[1],s=r[2],i,o,f,c,g,u,l,p,d,h,v,y;return e===t?(t[12]=e[0]*n+e[4]*a+e[8]*s+e[12],t[13]=e[1]*n+e[5]*a+e[9]*s+e[13],t[14]=e[2]*n+e[6]*a+e[10]*s+e[14],t[15]=e[3]*n+e[7]*a+e[11]*s+e[15]):(i=e[0],o=e[1],f=e[2],c=e[3],g=e[4],u=e[5],l=e[6],p=e[7],d=e[8],h=e[9],v=e[10],y=e[11],t[0]=i,t[1]=o,t[2]=f,t[3]=c,t[4]=g,t[5]=u,t[6]=l,t[7]=p,t[8]=d,t[9]=h,t[10]=v,t[11]=y,t[12]=i*n+g*a+d*s+e[12],t[13]=o*n+u*a+h*s+e[13],t[14]=f*n+l*a+v*s+e[14],t[15]=c*n+p*a+y*s+e[15]),t}function ey(t,e,r){var n=r[0],a=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ty(t,e,r,n){var a=n[0],s=n[1],i=n[2],o=Math.hypot(a,s,i),f,c,g,u,l,p,d,h,v,y,C,x,T,w,S,M,E,R,D,L,V,B,F,z;return o<X?null:(o=1/o,a*=o,s*=o,i*=o,f=Math.sin(r),c=Math.cos(r),g=1-c,u=e[0],l=e[1],p=e[2],d=e[3],h=e[4],v=e[5],y=e[6],C=e[7],x=e[8],T=e[9],w=e[10],S=e[11],M=a*a*g+c,E=s*a*g+i*f,R=i*a*g-s*f,D=a*s*g-i*f,L=s*s*g+c,V=i*s*g+a*f,B=a*i*g+s*f,F=s*i*g-a*f,z=i*i*g+c,t[0]=u*M+h*E+x*R,t[1]=l*M+v*E+T*R,t[2]=p*M+y*E+w*R,t[3]=d*M+C*E+S*R,t[4]=u*D+h*L+x*V,t[5]=l*D+v*L+T*V,t[6]=p*D+y*L+w*V,t[7]=d*D+C*L+S*V,t[8]=u*B+h*F+x*z,t[9]=l*B+v*F+T*z,t[10]=p*B+y*F+w*z,t[11]=d*B+C*F+S*z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ry(t,e,r){var n=Math.sin(r),a=Math.cos(r),s=e[4],i=e[5],o=e[6],f=e[7],c=e[8],g=e[9],u=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*a+c*n,t[5]=i*a+g*n,t[6]=o*a+u*n,t[7]=f*a+l*n,t[8]=c*a-s*n,t[9]=g*a-i*n,t[10]=u*a-o*n,t[11]=l*a-f*n,t}function ny(t,e,r){var n=Math.sin(r),a=Math.cos(r),s=e[0],i=e[1],o=e[2],f=e[3],c=e[8],g=e[9],u=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a-c*n,t[1]=i*a-g*n,t[2]=o*a-u*n,t[3]=f*a-l*n,t[8]=s*n+c*a,t[9]=i*n+g*a,t[10]=o*n+u*a,t[11]=f*n+l*a,t}function ay(t,e,r){var n=Math.sin(r),a=Math.cos(r),s=e[0],i=e[1],o=e[2],f=e[3],c=e[4],g=e[5],u=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a+c*n,t[1]=i*a+g*n,t[2]=o*a+u*n,t[3]=f*a+l*n,t[4]=c*a-s*n,t[5]=g*a-i*n,t[6]=u*a-o*n,t[7]=l*a-f*n,t}function sy(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function iy(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oy(t,e,r){var n=r[0],a=r[1],s=r[2],i=Math.hypot(n,a,s),o,f,c;return i<X?null:(i=1/i,n*=i,a*=i,s*=i,o=Math.sin(e),f=Math.cos(e),c=1-f,t[0]=n*n*c+f,t[1]=a*n*c+s*o,t[2]=s*n*c-a*o,t[3]=0,t[4]=n*a*c-s*o,t[5]=a*a*c+f,t[6]=s*a*c+n*o,t[7]=0,t[8]=n*s*c+a*o,t[9]=a*s*c-n*o,t[10]=s*s*c+f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function fy(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cy(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uy(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yu(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=n+n,f=a+a,c=s+s,g=n*o,u=n*f,l=n*c,p=a*f,d=a*c,h=s*c,v=i*o,y=i*f,C=i*c;return t[0]=1-(p+h),t[1]=u+C,t[2]=l-y,t[3]=0,t[4]=u-C,t[5]=1-(g+h),t[6]=d+v,t[7]=0,t[8]=l+y,t[9]=d-v,t[10]=1-(g+p),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function gy(t,e){var r=new ie(3),n=-e[0],a=-e[1],s=-e[2],i=e[3],o=e[4],f=e[5],c=e[6],g=e[7],u=n*n+a*a+s*s+i*i;return u>0?(r[0]=(o*i+g*n+f*s-c*a)*2/u,r[1]=(f*i+g*a+c*n-o*s)*2/u,r[2]=(c*i+g*s+o*a-f*n)*2/u):(r[0]=(o*i+g*n+f*s-c*a)*2,r[1]=(f*i+g*a+c*n-o*s)*2,r[2]=(c*i+g*s+o*a-f*n)*2),yu(t,e,r),t}function ly(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function xu(t,e){var r=e[0],n=e[1],a=e[2],s=e[4],i=e[5],o=e[6],f=e[8],c=e[9],g=e[10];return t[0]=Math.hypot(r,n,a),t[1]=Math.hypot(s,i,o),t[2]=Math.hypot(f,c,g),t}function py(t,e){var r=new ie(3);xu(r,e);var n=1/r[0],a=1/r[1],s=1/r[2],i=e[0]*n,o=e[1]*a,f=e[2]*s,c=e[4]*n,g=e[5]*a,u=e[6]*s,l=e[8]*n,p=e[9]*a,d=e[10]*s,h=i+g+d,v=0;return h>0?(v=Math.sqrt(h+1)*2,t[3]=.25*v,t[0]=(u-p)/v,t[1]=(l-f)/v,t[2]=(o-c)/v):i>g&&i>d?(v=Math.sqrt(1+i-g-d)*2,t[3]=(u-p)/v,t[0]=.25*v,t[1]=(o+c)/v,t[2]=(l+f)/v):g>d?(v=Math.sqrt(1+g-i-d)*2,t[3]=(l-f)/v,t[0]=(o+c)/v,t[1]=.25*v,t[2]=(u+p)/v):(v=Math.sqrt(1+d-i-g)*2,t[3]=(o-c)/v,t[0]=(l+f)/v,t[1]=(u+p)/v,t[2]=.25*v),t}function hy(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=e[3],f=a+a,c=s+s,g=i+i,u=a*f,l=a*c,p=a*g,d=s*c,h=s*g,v=i*g,y=o*f,C=o*c,x=o*g,T=n[0],w=n[1],S=n[2];return t[0]=(1-(d+v))*T,t[1]=(l+x)*T,t[2]=(p-C)*T,t[3]=0,t[4]=(l-x)*w,t[5]=(1-(u+v))*w,t[6]=(h+y)*w,t[7]=0,t[8]=(p+C)*S,t[9]=(h-y)*S,t[10]=(1-(u+d))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function vy(t,e,r,n,a){var s=e[0],i=e[1],o=e[2],f=e[3],c=s+s,g=i+i,u=o+o,l=s*c,p=s*g,d=s*u,h=i*g,v=i*u,y=o*u,C=f*c,x=f*g,T=f*u,w=n[0],S=n[1],M=n[2],E=a[0],R=a[1],D=a[2],L=(1-(h+y))*w,V=(p+T)*w,B=(d-x)*w,F=(p-T)*S,z=(1-(l+y))*S,b=(v+C)*S,W=(d+x)*M,G=(v-C)*M,k=(1-(l+h))*M;return t[0]=L,t[1]=V,t[2]=B,t[3]=0,t[4]=F,t[5]=z,t[6]=b,t[7]=0,t[8]=W,t[9]=G,t[10]=k,t[11]=0,t[12]=r[0]+E-(L*E+F*R+W*D),t[13]=r[1]+R-(V*E+z*R+G*D),t[14]=r[2]+D-(B*E+b*R+k*D),t[15]=1,t}function dy(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r+r,o=n+n,f=a+a,c=r*i,g=n*i,u=n*o,l=a*i,p=a*o,d=a*f,h=s*i,v=s*o,y=s*f;return t[0]=1-u-d,t[1]=g+y,t[2]=l-v,t[3]=0,t[4]=g-y,t[5]=1-c-d,t[6]=p+h,t[7]=0,t[8]=l+v,t[9]=p-h,t[10]=1-c-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yy(t,e,r,n,a,s,i){var o=1/(r-e),f=1/(a-n),c=1/(s-i);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*f,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(a+n)*f,t[10]=(i+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*s*2*c,t[15]=0,t}function Tu(t,e,r,n,a){var s=1/Math.tan(e/2),i;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(n-a),t[10]=(a+n)*i,t[14]=2*a*n*i):(t[10]=-1,t[14]=-2*n),t}var xy=Tu;function Ty(t,e,r,n,a){var s=1/Math.tan(e/2),i;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(n-a),t[10]=a*i,t[14]=a*n*i):(t[10]=-1,t[14]=-n),t}function Sy(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),f=2/(i+o),c=2/(a+s);return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((i-o)*f*.5),t[9]=(a-s)*c*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function Su(t,e,r,n,a,s,i){var o=1/(e-r),f=1/(n-a),c=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*o,t[13]=(a+n)*f,t[14]=(i+s)*c,t[15]=1,t}var Cy=Su;function my(t,e,r,n,a,s,i){var o=1/(e-r),f=1/(n-a),c=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+r)*o,t[13]=(a+n)*f,t[14]=s*c,t[15]=1,t}function wy(t,e,r,n){var a,s,i,o,f,c,g,u,l,p,d=e[0],h=e[1],v=e[2],y=n[0],C=n[1],x=n[2],T=r[0],w=r[1],S=r[2];return Math.abs(d-T)<X&&Math.abs(h-w)<X&&Math.abs(v-S)<X?vu(t):(g=d-T,u=h-w,l=v-S,p=1/Math.hypot(g,u,l),g*=p,u*=p,l*=p,a=C*l-x*u,s=x*g-y*l,i=y*u-C*g,p=Math.hypot(a,s,i),p?(p=1/p,a*=p,s*=p,i*=p):(a=0,s=0,i=0),o=u*i-l*s,f=l*a-g*i,c=g*s-u*a,p=Math.hypot(o,f,c),p?(p=1/p,o*=p,f*=p,c*=p):(o=0,f=0,c=0),t[0]=a,t[1]=o,t[2]=g,t[3]=0,t[4]=s,t[5]=f,t[6]=u,t[7]=0,t[8]=i,t[9]=c,t[10]=l,t[11]=0,t[12]=-(a*d+s*h+i*v),t[13]=-(o*d+f*h+c*v),t[14]=-(g*d+u*h+l*v),t[15]=1,t)}function Ey(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=n[0],f=n[1],c=n[2],g=a-r[0],u=s-r[1],l=i-r[2],p=g*g+u*u+l*l;p>0&&(p=1/Math.sqrt(p),g*=p,u*=p,l*=p);var d=f*l-c*u,h=c*g-o*l,v=o*u-f*g;return p=d*d+h*h+v*v,p>0&&(p=1/Math.sqrt(p),d*=p,h*=p,v*=p),t[0]=d,t[1]=h,t[2]=v,t[3]=0,t[4]=u*v-l*h,t[5]=l*d-g*v,t[6]=g*h-u*d,t[7]=0,t[8]=g,t[9]=u,t[10]=l,t[11]=0,t[12]=a,t[13]=s,t[14]=i,t[15]=1,t}function My(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ry(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Oy(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Cu(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Dy(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Ly(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function Vy(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function By(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],f=t[6],c=t[7],g=t[8],u=t[9],l=t[10],p=t[11],d=t[12],h=t[13],v=t[14],y=t[15],C=e[0],x=e[1],T=e[2],w=e[3],S=e[4],M=e[5],E=e[6],R=e[7],D=e[8],L=e[9],V=e[10],B=e[11],F=e[12],z=e[13],b=e[14],W=e[15];return Math.abs(r-C)<=X*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(n-x)<=X*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-T)<=X*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-w)<=X*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(i-S)<=X*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(o-M)<=X*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(f-E)<=X*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(c-R)<=X*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(g-D)<=X*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(u-L)<=X*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(l-V)<=X*Math.max(1,Math.abs(l),Math.abs(V))&&Math.abs(p-B)<=X*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(d-F)<=X*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(h-z)<=X*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(v-b)<=X*Math.max(1,Math.abs(v),Math.abs(b))&&Math.abs(y-W)<=X*Math.max(1,Math.abs(y),Math.abs(W))}var Fy=du,ky=Cu;var Me={};xr(Me,{add:()=>eT,calculateW:()=>$x,clone:()=>qx,conjugate:()=>Xx,copy:()=>Qx,create:()=>ki,dot:()=>Hu,equals:()=>iT,exactEquals:()=>sT,exp:()=>_u,fromEuler:()=>Yx,fromMat3:()=>zu,fromValues:()=>Zx,getAngle:()=>zx,getAxisAngle:()=>bx,identity:()=>_x,invert:()=>Px,len:()=>nT,length:()=>Au,lerp:()=>rT,ln:()=>bu,mul:()=>tT,multiply:()=>Gu,normalize:()=>Ui,pow:()=>jx,random:()=>Kx,rotateX:()=>Wx,rotateY:()=>Hx,rotateZ:()=>Ax,rotationTo:()=>oT,scale:()=>Wu,set:()=>Jx,setAxes:()=>cT,setAxisAngle:()=>Nu,slerp:()=>xa,sqlerp:()=>fT,sqrLen:()=>aT,squaredLength:()=>$u,str:()=>Ix});var N={};xr(N,{add:()=>_y,angle:()=>nx,bezier:()=>Iy,ceil:()=>by,clone:()=>Uy,copy:()=>Ny,create:()=>pa,cross:()=>Cn,dist:()=>gx,distance:()=>Ru,div:()=>ux,divide:()=>Mu,dot:()=>va,equals:()=>ox,exactEquals:()=>ix,floor:()=>zy,forEach:()=>hx,fromValues:()=>ha,hermite:()=>Yy,inverse:()=>Py,len:()=>Ci,length:()=>mu,lerp:()=>Xy,max:()=>Hy,min:()=>Wy,mul:()=>cx,multiply:()=>Eu,negate:()=>Ky,normalize:()=>Si,random:()=>qy,rotateX:()=>ex,rotateY:()=>tx,rotateZ:()=>rx,round:()=>Ay,scale:()=>$y,scaleAndAdd:()=>jy,set:()=>Gy,sqrDist:()=>lx,sqrLen:()=>px,squaredDistance:()=>Ou,squaredLength:()=>Du,str:()=>sx,sub:()=>fx,subtract:()=>wu,transformMat3:()=>Qy,transformMat4:()=>Zy,transformQuat:()=>Jy,zero:()=>ax});function pa(){var t=new ie(3);return ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Uy(t){var e=new ie(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function mu(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function ha(t,e,r){var n=new ie(3);return n[0]=t,n[1]=e,n[2]=r,n}function Ny(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Gy(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function _y(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function wu(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Eu(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Mu(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function by(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function zy(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Wy(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Hy(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Ay(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function $y(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function jy(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Ru(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return Math.hypot(r,n,a)}function Ou(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a}function Du(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function Ky(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Py(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Si(t,e){var r=e[0],n=e[1],a=e[2],s=r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function va(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Cn(t,e,r){var n=e[0],a=e[1],s=e[2],i=r[0],o=r[1],f=r[2];return t[0]=a*f-s*o,t[1]=s*i-n*f,t[2]=n*o-a*i,t}function Xy(t,e,r,n){var a=e[0],s=e[1],i=e[2];return t[0]=a+n*(r[0]-a),t[1]=s+n*(r[1]-s),t[2]=i+n*(r[2]-i),t}function Yy(t,e,r,n,a,s){var i=s*s,o=i*(2*s-3)+1,f=i*(s-2)+s,c=i*(s-1),g=i*(3-2*s);return t[0]=e[0]*o+r[0]*f+n[0]*c+a[0]*g,t[1]=e[1]*o+r[1]*f+n[1]*c+a[1]*g,t[2]=e[2]*o+r[2]*f+n[2]*c+a[2]*g,t}function Iy(t,e,r,n,a,s){var i=1-s,o=i*i,f=s*s,c=o*i,g=3*s*o,u=3*f*i,l=f*s;return t[0]=e[0]*c+r[0]*g+n[0]*u+a[0]*l,t[1]=e[1]*c+r[1]*g+n[1]*u+a[1]*l,t[2]=e[2]*c+r[2]*g+n[2]*u+a[2]*l,t}function qy(t,e){e=e||1;var r=rt()*2*Math.PI,n=rt()*2-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t}function Zy(t,e,r){var n=e[0],a=e[1],s=e[2],i=r[3]*n+r[7]*a+r[11]*s+r[15];return i=i||1,t[0]=(r[0]*n+r[4]*a+r[8]*s+r[12])/i,t[1]=(r[1]*n+r[5]*a+r[9]*s+r[13])/i,t[2]=(r[2]*n+r[6]*a+r[10]*s+r[14])/i,t}function Qy(t,e,r){var n=e[0],a=e[1],s=e[2];return t[0]=n*r[0]+a*r[3]+s*r[6],t[1]=n*r[1]+a*r[4]+s*r[7],t[2]=n*r[2]+a*r[5]+s*r[8],t}function Jy(t,e,r){var n=r[0],a=r[1],s=r[2],i=r[3],o=e[0],f=e[1],c=e[2],g=a*c-s*f,u=s*o-n*c,l=n*f-a*o,p=a*l-s*u,d=s*g-n*l,h=n*u-a*g,v=i*2;return g*=v,u*=v,l*=v,p*=2,d*=2,h*=2,t[0]=o+g+p,t[1]=f+u+d,t[2]=c+l+h,t}function ex(t,e,r,n){var a=[],s=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],s[0]=a[0],s[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),s[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function tx(t,e,r,n){var a=[],s=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],s[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),s[1]=a[1],s[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function rx(t,e,r,n){var a=[],s=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],s[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),s[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),s[2]=a[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function nx(t,e){var r=t[0],n=t[1],a=t[2],s=e[0],i=e[1],o=e[2],f=Math.sqrt(r*r+n*n+a*a),c=Math.sqrt(s*s+i*i+o*o),g=f*c,u=g&&va(t,e)/g;return Math.acos(Math.min(Math.max(u,-1),1))}function ax(t){return t[0]=0,t[1]=0,t[2]=0,t}function sx(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ix(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ox(t,e){var r=t[0],n=t[1],a=t[2],s=e[0],i=e[1],o=e[2];return Math.abs(r-s)<=X*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=X*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(a-o)<=X*Math.max(1,Math.abs(a),Math.abs(o))}var fx=wu,cx=Eu,ux=Mu,gx=Ru,lx=Ou,Ci=mu,px=Du,hx=(function(){var t=pa();return function(e,r,n,a,s,i){var o,f;for(r||(r=3),n||(n=0),a?f=Math.min(a*r+n,e.length):f=e.length,o=n;o<f;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();var Gt={};xr(Gt,{add:()=>Ri,ceil:()=>vx,clone:()=>mi,copy:()=>Ei,create:()=>Lu,cross:()=>wx,dist:()=>Fx,distance:()=>ku,div:()=>Bx,divide:()=>Fu,dot:()=>Li,equals:()=>Fi,exactEquals:()=>Bi,floor:()=>dx,forEach:()=>Gx,fromValues:()=>wi,inverse:()=>mx,len:()=>Ux,length:()=>da,lerp:()=>Vi,max:()=>xx,min:()=>yx,mul:()=>Vx,multiply:()=>Bu,negate:()=>Cx,normalize:()=>Di,random:()=>Ex,round:()=>Tx,scale:()=>Oi,scaleAndAdd:()=>Sx,set:()=>Mi,sqrDist:()=>kx,sqrLen:()=>Nx,squaredDistance:()=>Uu,squaredLength:()=>ya,str:()=>Dx,sub:()=>Lx,subtract:()=>Vu,transformMat4:()=>Mx,transformQuat:()=>Rx,zero:()=>Ox});function Lu(){var t=new ie(4);return ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function mi(t){var e=new ie(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function wi(t,e,r,n){var a=new ie(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a}function Ei(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Mi(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t}function Ri(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Vu(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Bu(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Fu(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function vx(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function dx(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function yx(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function xx(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Tx(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Oi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Sx(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function ku(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],s=e[3]-t[3];return Math.hypot(r,n,a,s)}function Uu(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],s=e[3]-t[3];return r*r+n*n+a*a+s*s}function da(t){var e=t[0],r=t[1],n=t[2],a=t[3];return Math.hypot(e,r,n,a)}function ya(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a}function Cx(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function mx(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Di(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r*r+n*n+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=r*i,t[1]=n*i,t[2]=a*i,t[3]=s*i,t}function Li(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function wx(t,e,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],i=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],f=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],g=e[0],u=e[1],l=e[2],p=e[3];return t[0]=u*c-l*f+p*o,t[1]=-(g*c)+l*i-p*s,t[2]=g*f-u*i+p*a,t[3]=-(g*o)+u*s-l*a,t}function Vi(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=e[3];return t[0]=a+n*(r[0]-a),t[1]=s+n*(r[1]-s),t[2]=i+n*(r[2]-i),t[3]=o+n*(r[3]-o),t}function Ex(t,e){e=e||1;var r,n,a,s,i,o;do r=rt()*2-1,n=rt()*2-1,i=r*r+n*n;while(i>=1);do a=rt()*2-1,s=rt()*2-1,o=a*a+s*s;while(o>=1);var f=Math.sqrt((1-i)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*a*f,t[3]=e*s*f,t}function Mx(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*i,t[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*i,t[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*i,t[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*i,t}function Rx(t,e,r){var n=e[0],a=e[1],s=e[2],i=r[0],o=r[1],f=r[2],c=r[3],g=c*n+o*s-f*a,u=c*a+f*n-i*s,l=c*s+i*a-o*n,p=-i*n-o*a-f*s;return t[0]=g*c+p*-i+u*-f-l*-o,t[1]=u*c+p*-o+l*-i-g*-f,t[2]=l*c+p*-f+g*-o-u*-i,t[3]=e[3],t}function Ox(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Dx(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Bi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Fi(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],i=e[0],o=e[1],f=e[2],c=e[3];return Math.abs(r-i)<=X*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=X*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-f)<=X*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-c)<=X*Math.max(1,Math.abs(s),Math.abs(c))}var Lx=Vu,Vx=Bu,Bx=Fu,Fx=ku,kx=Uu,Ux=da,Nx=ya,Gx=(function(){var t=Lu();return function(e,r,n,a,s,i){var o,f;for(r||(r=4),n||(n=0),a?f=Math.min(a*r+n,e.length):f=e.length,o=n;o<f;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function ki(){var t=new ie(4);return ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function _x(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Nu(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function bx(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>X?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function zx(t,e){var r=Hu(t,e);return Math.acos(2*r*r-1)}function Gu(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=r[0],f=r[1],c=r[2],g=r[3];return t[0]=n*g+i*o+a*c-s*f,t[1]=a*g+i*f+s*o-n*c,t[2]=s*g+i*c+n*f-a*o,t[3]=i*g-n*o-a*f-s*c,t}function Wx(t,e,r){r*=.5;var n=e[0],a=e[1],s=e[2],i=e[3],o=Math.sin(r),f=Math.cos(r);return t[0]=n*f+i*o,t[1]=a*f+s*o,t[2]=s*f-a*o,t[3]=i*f-n*o,t}function Hx(t,e,r){r*=.5;var n=e[0],a=e[1],s=e[2],i=e[3],o=Math.sin(r),f=Math.cos(r);return t[0]=n*f-s*o,t[1]=a*f+i*o,t[2]=s*f+n*o,t[3]=i*f-a*o,t}function Ax(t,e,r){r*=.5;var n=e[0],a=e[1],s=e[2],i=e[3],o=Math.sin(r),f=Math.cos(r);return t[0]=n*f+a*o,t[1]=a*f-n*o,t[2]=s*f+i*o,t[3]=i*f-s*o,t}function $x(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t}function _u(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=Math.sqrt(r*r+n*n+a*a),o=Math.exp(s),f=i>0?o*Math.sin(i)/i:0;return t[0]=r*f,t[1]=n*f,t[2]=a*f,t[3]=o*Math.cos(i),t}function bu(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=Math.sqrt(r*r+n*n+a*a),o=i>0?Math.atan2(i,s)/i:0;return t[0]=r*o,t[1]=n*o,t[2]=a*o,t[3]=.5*Math.log(r*r+n*n+a*a+s*s),t}function jx(t,e,r){return bu(t,e),Wu(t,t,r),_u(t,t),t}function xa(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=e[3],f=r[0],c=r[1],g=r[2],u=r[3],l,p,d,h,v;return p=a*f+s*c+i*g+o*u,p<0&&(p=-p,f=-f,c=-c,g=-g,u=-u),1-p>X?(l=Math.acos(p),d=Math.sin(l),h=Math.sin((1-n)*l)/d,v=Math.sin(n*l)/d):(h=1-n,v=n),t[0]=h*a+v*f,t[1]=h*s+v*c,t[2]=h*i+v*g,t[3]=h*o+v*u,t}function Kx(t){var e=rt(),r=rt(),n=rt(),a=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*r),t[1]=a*Math.cos(2*Math.PI*r),t[2]=s*Math.sin(2*Math.PI*n),t[3]=s*Math.cos(2*Math.PI*n),t}function Px(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r*r+n*n+a*a+s*s,o=i?1/i:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-a*o,t[3]=s*o,t}function Xx(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function zu(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;n=Math.sqrt(e[a*3+a]-e[s*3+s]-e[i*3+i]+1),t[a]=.5*n,n=.5/n,t[3]=(e[s*3+i]-e[i*3+s])*n,t[s]=(e[s*3+a]+e[a*3+s])*n,t[i]=(e[i*3+a]+e[a*3+i])*n}return t}function Yx(t,e,r,n){var a=.5*Math.PI/180;e*=a,r*=a,n*=a;var s=Math.sin(e),i=Math.cos(e),o=Math.sin(r),f=Math.cos(r),c=Math.sin(n),g=Math.cos(n);return t[0]=s*f*g-i*o*c,t[1]=i*o*g+s*f*c,t[2]=i*f*c-s*o*g,t[3]=i*f*g+s*o*c,t}function Ix(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var qx=mi,Zx=wi,Qx=Ei,Jx=Mi,eT=Ri,tT=Gu,Wu=Oi,Hu=Li,rT=Vi,Au=da,nT=Au,$u=ya,aT=$u,Ui=Di,sT=Bi,iT=Fi,oT=(function(){var t=pa(),e=ha(1,0,0),r=ha(0,1,0);return function(n,a,s){var i=va(a,s);return i<-.999999?(Cn(t,e,a),Ci(t)<1e-6&&Cn(t,r,a),Si(t,t),Nu(n,t,Math.PI),n):i>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Cn(t,a,s),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+i,Ui(n,n))}})(),fT=(function(){var t=ki(),e=ki();return function(r,n,a,s,i,o){return xa(t,n,i,o),xa(e,a,s,o),xa(r,t,e,2*o*(1-o)),r}})(),cT=(function(){var t=Ti();return function(e,r,n,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Ui(e,zu(e,t))}})();var cg=xn(ig(),1);var Sa=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],og=[1,0,0,0,1,0,0,0,1],Ca=1e-6,ma=1e-12;var{vtkErrorMacro:ug,vtkWarningMacro:mr}=m,gg=0,fg=20;function En(t){return()=>ug(`vtkMath::${t} - NOT IMPLEMENTED`)}function wn(t,e,r,n){let a;for(let s=0;s<e;s++)a=t[r*e+s],t[r*e+s]=t[n*e+s],t[n*e+s]=a}function mn(t,e,r,n){let a;for(let s=0;s<e;s++)a=t[s*e+r],t[s*e+r]=t[s*e+n],t[s*e+n]=a}function ue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,e=Array(t);for(let r=0;r<t;++r)e[r]=0;return e}var dT=()=>Math.PI;function yT(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function oe(t){return t/180*Math.PI}function _t(t){return t*180/Math.PI}var{round:Zr,floor:Ki,ceil:xT,min:TT,max:ST}=Math;function CT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0;for(let a=e,s=t.length;a<s;a+=r)t[a]<n&&(n=t[a]);return n}function mT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=-1/0;for(let a=e,s=t.length;a<s;a+=r)n<t[a]&&(n=t[a]);return n}function wT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,a=-1/0;for(let s=e,i=t.length;s<i;s+=r)t[s]<n&&(n=t[s]),a<t[s]&&(a=t[s]);return[n,a]}var ET=En("ceilLog2"),MT=En("factorial");function $e(t){let e=1;for(;e<t;)e*=2;return e}function Qr(t){return t===$e(t)}function RT(t,e){let r=1;for(let n=1;n<=e;++n)r*=(t-n+1)/n;return Math.floor(r)}function OT(t,e){if(t<e)return 0;let r=ue(e);for(let n=0;n<e;++n)r[n]=n;return r}function DT(t,e,r){let n=0;for(let a=e-1;a>=0;--a)if(r[a]<t-e+a){let s=r[a]+1;for(;a<e;)r[a++]=s++;n=1;break}return n}function LT(t){(0,cg.default)(`${t}`,{global:!0}),gg=t}function VT(){return gg}function BT(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+r*Math.random()}var FT=En("gaussian");function bt(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function xe(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function lg(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function pg(t,e){return t[0]*=e,t[1]*=e,t}function Ra(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function kT(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function $(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function UT(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[0]*e[2],r[3]=t[1]*e[0],r[4]=t[1]*e[1],r[5]=t[1]*e[2],r[6]=t[2]*e[0],r[7]=t[2]*e[1],r[8]=t[2]*e[2]}function Re(t,e,r){let n=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],s=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=a,r[2]=s,r}function Ae(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function ke(t){let e=Ae(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function hg(t){let e=Ae(t,3);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e),e}function NT(t,e,r,n){let a=t[0]*t[0],s=t[1]*t[1],i=t[2]*t[2],o=Math.sqrt(a+s+i),f,c,g;a>s&&a>i?(f=0,c=1,g=2):s>i?(f=1,c=2,g=0):(f=2,c=0,g=1);let u=t[f]/o,l=t[c]/o,p=t[g]/o,d=Math.sqrt(u*u+p*p);if(n!==0){let h=Math.sin(n),v=Math.cos(n);e&&(e[f]=(p*v-u*l*h)/d,e[c]=h*d,e[g]=(-(u*v)-l*p*h)/d),r&&(r[f]=(-(p*h)-u*l*v)/d,r[c]=v*d,r[g]=(u*h-l*p*v)/d)}else e&&(e[f]=p/d,e[c]=0,e[g]=-u/d),r&&(r[f]=-u*l/d,r[c]=d,r[g]=-l*p/d)}function GT(t,e,r){let n=$(e,e);if(n===0)return r[0]=0,r[1]=0,r[2]=0,!1;let a=$(t,e)/n;for(let s=0;s<3;s++)r[s]=e[s];return lg(r,a),!0}function Hi(t,e){return t[0]*e[0]+t[1]*e[1]}function _T(t,e,r){let n=Hi(e,e);if(n===0)return r[0]=0,r[1]=0,!1;let a=Hi(t,e)/n;for(let s=0;s<2;s++)r[s]=e[s];return pg(r,a),!0}function Le(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function bT(t,e){let r=[0,0,0];return Re(t,e,r),Math.atan2(Ae(r),$(t,e))}function zT(t,e,r){let n=Math.abs(t-r);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(n**2)/(2*e))}function WT(t,e,r){let n=Math.abs(t-r);return Math.exp(-(n**2)/(2*e))}function HT(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[1]*e[0],r[3]=t[1]*e[1]}function vg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Pi(t){let e=vg(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function ve(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function AT(t,e){let r,n,a,s=[0,0,0];for(let i=0;i<3;i++)a=Math.abs(t[i*3]),(n=Math.abs(t[i*3+1]))>a&&(a=n),(n=Math.abs(t[i*3+2]))>a&&(a=n),s[i]=1/a;a=s[0]*Math.abs(t[0]),r=0,(n=s[1]*Math.abs(t[3]))>=a&&(a=n,r=1),(n=s[2]*Math.abs(t[6]))>=a&&(r=2),r!==0&&(wn(t,3,r,0),s[r]=s[0]),e[0]=r,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],a=s[1]*Math.abs(t[4]),r=1,(n=s[2]*Math.abs(t[7]))>=a&&(r=2,wn(t,3,1,2),s[2]=s[1]),e[1]=r,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function $T(t,e,r){let n=r[e[0]];r[e[0]]=r[0],r[0]=n,n=r[e[1]],r[e[1]]=r[1],r[1]=n-t[3]*r[0],n=r[e[2]],r[e[2]]=r[2],r[2]=n-t[6]*r[0]-t[7]*r[1],r[2]/=t[8],r[1]=(r[1]-t[5]*r[2])/t[4],r[0]=(r[0]-t[1]*r[1]-t[2]*r[2])/t[0]}function jT(t,e,r){let n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],f=t[5],c=t[6],g=t[7],u=t[8],l=+ve(o,g,f,u),p=-ve(i,c,f,u),d=+ve(i,c,o,g),h=-ve(a,g,s,u),v=+ve(n,c,s,u),y=-ve(n,c,a,g),C=+ve(a,o,s,f),x=-ve(n,i,s,f),T=+ve(n,i,a,o),w=n*l+a*p+s*d,S=l*e[0]+h*e[1]+C*e[2],M=p*e[0]+v*e[1]+x*e[2],E=d*e[0]+y*e[1]+T*e[2];r[0]=S/w,r[1]=M/w,r[2]=E/w}function KT(t,e,r){let n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],a=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],s=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];r[0]=n,r[1]=a,r[2]=s}function Ai(t,e,r){let n=[...t],a=[...e];for(let s=0;s<3;s++)r[s]=n[0]*a[s]+n[1]*a[s+3]+n[2]*a[s+6],r[s+3]=n[3]*a[s]+n[4]*a[s+3]+n[5]*a[s+6],r[s+6]=n[6]*a[s]+n[7]*a[s+3]+n[8]*a[s+6]}function PT(t,e,r,n,a,s,i){n!==a&&ug("Number of columns of A must match number of rows of B.");let o=[...t],f=[...e];for(let c=0;c<r;c++)for(let g=0;g<s;g++){i[c*s+g]=0;for(let u=0;u<n;u++)i[c*s+g]+=o[c*n+u]*f[g+s*u]}}function qr(t,e){let r;r=t[3],e[3]=t[1],e[1]=r,r=t[6],e[6]=t[2],e[2]=r,r=t[7],e[7]=t[5],e[5]=r,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function XT(t,e){let r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],f=t[6],c=t[7],g=t[8],u=+ve(i,c,o,g),l=-ve(s,f,o,g),p=+ve(s,f,i,c),d=-ve(n,c,a,g),h=+ve(r,f,a,g),v=-ve(r,f,n,c),y=+ve(n,i,a,o),C=-ve(r,s,a,o),x=+ve(r,s,n,i),T=r*u+n*l+a*p;T===0&&mr("Matrix has 0 determinant"),e[0]=u/T,e[3]=l/T,e[6]=p/T,e[1]=d/T,e[4]=h/T,e[7]=v/T,e[2]=y/T,e[5]=C/T,e[8]=x/T}function Oa(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function dg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ca;if(t.length!==e.length)return!1;function n(a,s){return Math.abs(a-e[s])<=r}return t.every(n)}var er=dg;function yg(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function xg(t,e){for(let r=0;r<t;r++){for(let n=0;n<t;n++)e[r*t+n]=0;e[r*t+r]=1}return e}function YT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ca;return er(t,Sa,e)}function IT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ca;return er(t,og,e)}function Tg(t,e){let r=t[0]*t[0],n=t[0]*t[1],a=t[0]*t[2],s=t[0]*t[3],i=t[1]*t[1],o=t[2]*t[2],f=t[3]*t[3],c=t[1]*t[2],g=t[1]*t[3],u=t[2]*t[3],l=i+o+f,p=1/(r+l),d=(r-l)*p;p*=2,e[0]=i*p+d,e[3]=(c+s)*p,e[6]=(g-a)*p,e[1]=(c-s)*p,e[4]=o*p+d,e[7]=(u+n)*p,e[2]=(g+a)*p,e[5]=(u-n)*p,e[8]=f*p+d}function Ea(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;let r=`${t}`.split("e"),n="";return+r[1]+e>0&&(n="+"),+`${Math.round(`${+r[0]}e${n}${+r[1]+e}`)}e-${e}`}function Da(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Ea(t[0],r),e[1]=Ea(t[1],r),e[2]=Ea(t[2],r),e}function Mn(t,e,r,n){let a,s,i,o,f,c,g,u,l,p,d,h,v,y,C,x,T=ue(e),w=ue(e),S=(E,R,D)=>{y=E[R],v=E[D],E[R]=y-h*(v+y*p),E[D]=v+h*(y-v*p)};for(xg(e,n),f=0;f<e;f++)T[f]=r[f]=t[f+f*e],w[f]=0;for(a=0;a<fg;a++){for(d=0,f=0;f<e-1;f++)for(o=f+1;o<e;o++)d+=Math.abs(t[f*e+o]);if(d===0)break;for(a<3?g=.2*d/(e*e):g=0,f=0;f<e-1;f++)for(o=f+1;o<e;o++)if(y=100*Math.abs(t[f*e+o]),a>3&&Math.abs(r[f])+y===Math.abs(r[f])&&Math.abs(r[o])+y===Math.abs(r[o]))t[f*e+o]=0;else if(Math.abs(t[f*e+o])>g){for(v=r[o]-r[f],Math.abs(v)+y===Math.abs(v)?l=t[f*e+o]/v:(u=.5*v/t[f*e+o],l=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(l=-l)),C=1/Math.sqrt(1+l*l),h=l*C,p=h/(1+C),v=l*t[f*e+o],w[f]-=v,w[o]+=v,r[f]-=v,r[o]+=v,t[f*e+o]=0,s=0;s<=f-1;s++)S(t,s*e+f,s*e+o);for(s=f+1;s<=o-1;s++)S(t,f*e+s,s*e+o);for(s=o+1;s<e;s++)S(t,f*e+s,o*e+s);for(s=0;s<e;s++)S(n,s*e+f,s*e+o)}for(f=0;f<e;f++)T[f]+=w[f],r[f]=T[f],w[f]=0}if(a>=fg)return mr("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(s=0;s<e-1;s++){for(i=s,x=r[i],a=s+1;a<e;a++)(r[a]>=x||Math.abs(r[a]-x)<ma)&&(i=a,x=r[i]);i!==s&&(r[i]=r[s],r[s]=x,mn(n,e,s,i))}let M=(e>>1)+(e&1);for(c=0,a=0;a<e*e;a++)n[a]>=0&&c++;if(c<M)for(a=0;a<e;a++)n[a*e+s]*=-1;return 1}function Sg(t,e){let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r[0]=t[0]+t[4]+t[8],r[5]=t[0]-t[4]-t[8],r[10]=-t[0]+t[4]-t[8],r[15]=-t[0]-t[4]+t[8],r[1]=r[4]=t[7]-t[5],r[2]=r[8]=t[2]-t[6],r[3]=r[12]=t[3]-t[1],r[6]=r[9]=t[3]+t[1],r[7]=r[13]=t[2]+t[6],r[11]=r[14]=t[7]+t[5];let n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0],s=[...r];Mn(s,4,a,n),e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12]}function qT(t,e,r){let n=t[0]*e[0],a=t[0]*e[1],s=t[0]*e[2],i=t[0]*e[3],o=t[1]*e[0],f=t[1]*e[1],c=t[1]*e[2],g=t[1]*e[3],u=t[2]*e[0],l=t[2]*e[1],p=t[2]*e[2],d=t[2]*e[3],h=t[3]*e[0],v=t[3]*e[1],y=t[3]*e[2],C=t[3]*e[3];r[0]=n-f-p-C,r[1]=a+o+d-y,r[2]=s-g+u+v,r[3]=i+c-l+h}function Cg(t,e){for(let l=0;l<9;l++)e[l]=t[l];let r=ue(3),n=ue(3),a;for(let l=0;l<3;l++){let p=Math.abs(e[l*3]),d=Math.abs(e[l*3+1]),h=Math.abs(e[l*3+2]);a=d>p?d:p,a=h>a?h:a,r[l]=1,a!==0&&(r[l]/=a)}let s=Math.abs(e[0])*r[0],i=Math.abs(e[3])*r[1],o=Math.abs(e[6])*r[2];n[0]=0,a=s,i>=a&&(a=i,n[0]=1),o>=a&&(n[0]=2),n[0]!==0&&(mn(e,3,n[0],0),r[n[0]]=r[0]);let f=Math.abs(e[4])*r[1],c=Math.abs(e[7])*r[2];n[1]=1,a=f,c>=a&&(n[1]=2,mn(e,3,1,2)),n[2]=2;let g=0;if(Oa(e)<0){g=1;for(let l=0;l<9;l++)e[l]=-e[l]}let u=ue(4);if(Sg(e,u),Tg(u,e),g)for(let l=0;l<9;l++)e[l]=-e[l];n[1]!==1&&mn(e,3,n[1],1),n[0]!==0&&mn(e,3,n[0],0)}function mg(t,e,r){let n,a,s,i,o,f,c=[...t];if(Mn(c,3,e,r),e[0]===e[1]&&e[0]===e[2]){yg(r);return}for(qr(r,r),n=0;n<3;n++)if(e[(n+1)%3]===e[(n+2)%3]){for(f=Math.abs(r[n*3]),i=0,a=1;a<3;a++)f<(o=Math.abs(r[n*3+a]))&&(f=o,i=a);i!==n&&(o=e[i],e[i]=e[n],e[n]=o,wn(r,3,n,i)),r[i*3+i]<0&&(r[i*3]=-r[i*3],r[i*3+1]=-r[i*3+1],r[i*3+2]=-r[i*3+2]),a=(i+1)%3,s=(i+2)%3,r[a*3]=0,r[a*3+1]=0,r[a*3+2]=0,r[a*3+a]=1;let g=Re([r[i*3],r[i*3+1],r[i*3+2]],[r[a*3],r[a*3+1],r[a*3+2]],[]);ke(g);let u=Re(g,[r[i*3],r[i*3+1],r[i*3+2]],[]);for(let l=0;l<3;l++)r[s*3+l]=g[l],r[a*3+l]=u[l];qr(r,r);return}for(f=Math.abs(r[0]),i=0,n=1;n<3;n++)f<(o=Math.abs(r[n*3]))&&(f=o,i=n);if(i!==0){let g=e[i];e[i]=e[0],e[0]=g,wn(r,3,i,0)}if(Math.abs(r[4])<Math.abs(r[7])){let g=e[2];e[2]=e[1],e[1]=g,wn(r,3,1,2)}for(n=0;n<2;n++)r[n*3+n]<0&&(r[n*3]=-r[n*3],r[n*3+1]=-r[n*3+1],r[n*3+2]=-r[n*3+2]);Oa(r)<0&&(r[6]=-r[6],r[7]=-r[7],r[8]=-r[8]),qr(r,r)}function ZT(t,e,r,n){let a,s=[...t],i=Oa(s);if(i<0)for(a=0;a<9;a++)s[a]=-s[a];Cg(s,e),qr(s,s),Ai(s,e,n),mg(n,r,n),Ai(e,n,e),qr(n,n),i<0&&(r[0]=-r[0],r[1]=-r[1],r[2]=-r[2])}function Xi(t,e,r){let n,a,s,i,o=0,f,c,g,u=ue(r);for(n=0;n<r;n++){for(i=0,a=0;a<r;a++)(g=Math.abs(t[n*r+a]))>i&&(i=g);if(i===0)return mr("Unable to factor linear system"),0;u[n]=1/i}for(a=0;a<r;a++){for(n=0;n<a;n++){for(f=t[n*r+a],s=0;s<n;s++)f-=t[n*r+s]*t[s*r+a];t[n*r+a]=f}for(i=0,n=a;n<r;n++){for(f=t[n*r+a],s=0;s<a;s++)f-=t[n*r+s]*t[s*r+a];t[n*r+a]=f,(c=u[n]*Math.abs(f))>=i&&(i=c,o=n)}if(a!==o){for(s=0;s<r;s++)c=t[o*r+s],t[o*r+s]=t[a*r+s],t[a*r+s]=c;u[o]=u[a]}if(e[a]=o,Math.abs(t[a*r+a])<=ma)return mr("Unable to factor linear system"),0;if(a!==r-1)for(c=1/t[a*r+a],n=a+1;n<r;n++)t[n*r+a]*=c}return 1}function Yi(t,e,r,n){let a,s,i,o,f;for(i=-1,a=0;a<n;a++){if(o=e[a],f=r[o],r[o]=r[a],i>=0)for(s=i;s<=a-1;s++)f-=t[a*n+s]*r[s];else f!==0&&(i=a);r[a]=f}for(a=n-1;a>=0;a--){for(f=r[a],s=a+1;s<n;s++)f-=t[a*n+s]*r[s];r[a]=f/t[a*n+a]}}function Ii(t,e,r){if(r===2){let a=ue(2),s=ve(t[0],t[1],t[2],t[3]);return s===0?0:(a[0]=(t[3]*e[0]-t[1]*e[1])/s,a[1]=(-(t[2]*e[0])+t[0]*e[1])/s,e[0]=a[0],e[1]=a[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);let n=ue(r);return Xi(t,n,r)===0?0:(Yi(t,n,e,r),1)}function La(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=n||ue(r),i=a||ue(r);if(Xi(t,s,r)===0)return null;for(let o=0;o<r;o++){for(let f=0;f<r;f++)i[f]=0;i[o]=1,Yi(t,s,i,r);for(let f=0;f<r;f++)e[f*r+o]=i[f]}return e}function QT(t,e){let r=+Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let a=0;a<e;a++)for(let s=a;s<e;s++)Math.abs(t[a*e+s])>n&&(n=Math.abs(t[a*e+s]));for(let a=0;a<e;a++)Math.abs(t[a*e+a])<r&&(r=Math.abs(t[a*e+a]));return r===0?Number.MAX_VALUE:n/r}function JT(t,e,r){return Mn(t,3,e,r)}function $i(t,e,r,n){if(t<r)return mr("Insufficient number of samples. Underdetermined."),0;let a,s,i,o=ue(r*r),f=ue(r),c=ue(r*r);for(i=0;i<t;i++)for(a=0;a<r;a++)for(s=a;s<r;s++)o[a*r+s]+=e[i*r+a]*e[i*r+s];for(a=0;a<r;a++)for(s=0;s<a;s++)o[a*r+s]=o[s*r+a];for(Mn(o,r,f,c),a=0;a<r;a++)n[a]=c[a*r+r-1];return 1}function e2(t,e,r,n,a,s){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<r||t<a)return mr("Insufficient number of samples. Underdetermined."),0;let o=ue(a),f=1,c,g=0,u,l,p,d=0;if(i){for(l=0;l<a;l++)o[l]=1;for(u=0;u<t;u++)for(l=0;l<a;l++)Math.abs(n[u*a+l])>ma&&(f=0,o[l]=0);if(f&&a===1)return mr("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),$i(t,e,r,s);if(f)d=1;else for(l=0;l<a;l++)o[l]&&(d=1)}d&&(c=ue(r),g=$i(t,e,r,c));let h=ue(r*r),v=ue(r*r),y=ue(r*a);for(p=0;p<t;p++)for(u=0;u<r;u++){for(l=u;l<r;l++)h[u*r+l]+=e[p*r+u]*e[p*r+l];for(l=0;l<a;l++)y[u*a+l]+=e[p*r+u]*n[p*a+l]}for(u=0;u<r;u++)for(l=0;l<u;l++)h[u*r+l]=h[l*r+u];let C=La(h,v,r);if(C)for(u=0;u<r;u++)for(l=0;l<a;l++)for(s[u*a+l]=0,p=0;p<r;p++)s[u*a+l]+=v[u*r+p]*y[p*a+l];if(d){for(l=0;l<a;l++)if(o[l])for(u=0;u<r;u++)s[u*a+l]=c[u*a]}return d?g&&C:C}function t2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Jr(t,e){let r,n,[a,s,i]=t,o=1/3,f=1/6,c=2/3,g=a,u=a;s>g?g=s:s<u&&(u=s),i>g?g=i:i<u&&(u=i);let l=g;l>0?n=(g-u)/g:n=0,n>0?(a===g?r=f*(s-i)/(g-u):s===g?r=o+f*(i-a)/(g-u):r=c+f*(a-s)/(g-u),r<0&&(r+=1)):r=0,e[0]=r,e[1]=n,e[2]=l}function zt(t,e){let[r,n,a]=t,s=1/3,i=1/6,o=2/3,f=5/6,c,g,u;r>i&&r<=s?(g=1,c=(s-r)/i,u=0):r>s&&r<=.5?(g=1,u=(r-s)/i,c=0):r>.5&&r<=o?(u=1,g=(o-r)/i,c=0):r>o&&r<=f?(u=1,c=(r-o)/i,g=0):r>f&&r<=1?(c=1,u=(1-r)/i,g=0):(c=1,g=r/i,u=0),c=n*c+(1-n),g=n*g+(1-n),u=n*u+(1-n),c*=a,g*=a,u*=a,e[0]=c,e[1]=g,e[2]=u}function wg(t,e){let[r,n,a]=t,s=(r+16)/116,i=n/500+s,o=s-a/200;s**3>.008856?s**=3:s=(s-16/116)/7.787,i**3>.008856?i**=3:i=(i-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787;let f=.9505,c=1,g=1.089;e[0]=f*i,e[1]=c*s,e[2]=g*o}function Eg(t,e){let[r,n,a]=t,s=.9505,i=1,o=1.089,f=r/s,c=n/i,g=a/o;f>.008856?f**=1/3:f=7.787*f+16/116,c>.008856?c**=1/3:c=7.787*c+16/116,g>.008856?g**=1/3:g=7.787*g+16/116,e[0]=116*c-16,e[1]=500*(f-c),e[2]=200*(c-g)}function Mg(t,e){let[r,n,a]=t,s=r*3.2406+n*-1.5372+a*-.4986,i=r*-.9689+n*1.8758+a*.0415,o=r*.0557+n*-.204+a*1.057;s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92,i>.0031308?i=1.055*i**(1/2.4)-.055:i*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92;let f=s;f<i&&(f=i),f<o&&(f=o),f>1&&(s/=f,i/=f,o/=f),s<0&&(s=0),i<0&&(i=0),o<0&&(o=0),e[0]=s,e[1]=i,e[2]=o}function Rg(t,e){let[r,n,a]=t;r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,a>.04045?a=((a+.055)/1.055)**2.4:a/=12.92,e[0]=r*.4124+n*.3576+a*.1805,e[1]=r*.2126+n*.7152+a*.0722,e[2]=r*.0193+n*.1192+a*.9505}function tr(t,e){let r=[0,0,0];Rg(t,r),Eg(r,e)}function Rn(t,e){let r=[0,0,0];wg(t,r),Mg(r,e)}function On(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Dn(t){return!(t[1]-t[0]<0)}function r2(t,e,r){return r[0]=Math.min(t[0],e[0]),r[1]=Math.max(t[0],e[0]),r[2]=Math.min(t[1],e[1]),r[3]=Math.max(t[1],e[1]),r[4]=Math.min(t[2],e[2]),r[5]=Math.max(t[2],e[2]),r}function Ma(t,e,r){return t<e?e:t>r?r:t}function Va(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=Ma(t[0],e[0],r[0]),n[1]=Ma(t[1],e[1],r[1]),n[2]=Ma(t[2],e[2],r[2]),n}function n2(t,e){let r=0;return e[0]!==e[1]&&(t<e[0]?r=e[0]:t>e[1]?r=e[1]:r=t,r=(r-e[0])/(e[1]-e[0])),r}var a2=En("GetScalarTypeFittingRange"),s2=En("GetAdjustedScalarRange");function i2(t,e){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]<e[r]||t[r]>e[r+1]||t[r+1]<e[r]||t[r+1]>e[r+1])return 0;return 1}function o2(t,e,r){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]+r[n/2]<e[n]||t[n]-r[n/2]>e[n+1]||t[n+1]+r[n/2]<e[n]||t[n+1]-r[n/2]>e[n+1])return 0;return 1}function f2(t,e,r){if(!t||!e||!r)return 0;for(let n=0;n<3;n++)if(t[n]+r[n]<e[2*n]||t[n]-r[n]>e[2*n+1])return 0;return 1}function c2(t,e,r,n){let a=ue(3),s=ue(3),i=ue(3),o=ue(3),f=ue(3),c=ue(3);for(let T=0;T<3;++T)a[T]=t[T]-e[T],s[T]=e[T]-r[T],i[T]=r[T]-t[T],o[T]=-a[T],f[T]=-s[T],c[T]=-i[T];let g=Ae(o),u=Ae(f),l=Ae(i),p=ue(3);Re(a,s,p);let d=Ae(p),h=g*u*l/(2*d),v=2*d*d,y=u*u*$(a,c)/v,C=l*l*$(o,s)/v,x=g*g*$(i,f)/v;for(let T=0;T<3;++T)n[T]=y*t[T]+C*e[T]+x*r[T];return h}var u2=1/0,g2=-1/0,qi=t=>!Number.isFinite(t),{isFinite:l2,isNaN:ji}=Number,wr=ji;function Er(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function p2(t){let e=-1,r=-1;for(let n=0;n<t.length;n++){let a=Math.abs(t[n]);a>e&&(r=n,e=a)}return r}function h2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,r=new Array(e),n=new Array(e);for(let s=0;s<e;++s)r[s]=s,n[s]=s;for(let s=e-1;s>0;s--){let i=-1/0,o=0,f=0;for(let c=0;c<=s;++c){let g=r[c];for(let u=0;u<=s;++u){let l=n[u],p=Math.abs(t[g+e*l]);p>i&&(i=p,o=c,f=u)}}[r[s],r[o]]=[r[o],r[s]],[n[s],n[f]]=[n[f],n[s]]}let a=new Array(e*e).fill(0);for(let s=0;s<e;++s){let i=r[s]+e*n[s];a[i]=t[i]<0?-1:1}return a}function Og(t){let e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function v2(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(Og).join("")}`}function wa(t){return Math.round(t*255)}function d2(t){return t.length===3?`rgb(${t.map(wa).join(", ")})`:`rgba(${wa(t[0]||0)}, ${wa(t[1]||0)}, ${wa(t[2]||0)}, ${t[3]||0})`}var Zi={Pi:dT,ldexp:yT,radiansFromDegrees:oe,degreesFromRadians:_t,round:Zr,floor:Ki,ceil:xT,ceilLog2:ET,min:TT,max:ST,arrayMin:CT,arrayMax:mT,arrayRange:wT,isPowerOfTwo:Qr,nearestPowerOfTwo:$e,factorial:MT,binomial:RT,beginCombination:OT,nextCombination:DT,randomSeed:LT,getSeed:VT,random:BT,gaussian:FT,add:bt,subtract:xe,multiplyScalar:lg,multiplyScalar2D:pg,multiplyAccumulate:Ra,multiplyAccumulate2D:kT,dot:$,outer:UT,cross:Re,norm:Ae,normalize:ke,perpendiculars:NT,projectVector:GT,projectVector2D:_T,distance2BetweenPoints:Le,angleBetweenVectors:bT,gaussianAmplitude:zT,gaussianWeight:WT,dot2D:Hi,outer2D:HT,norm2D:vg,normalize2D:Pi,determinant2x2:ve,LUFactor3x3:AT,LUSolve3x3:$T,linearSolve3x3:jT,multiply3x3_vect3:KT,multiply3x3_mat3:Ai,multiplyMatrix:PT,transpose3x3:qr,invert3x3:XT,identity3x3:yg,identity:xg,isIdentity:YT,isIdentity3x3:IT,determinant3x3:Oa,quaternionToMatrix3x3:Tg,areEquals:dg,areMatricesEqual:er,roundNumber:Ea,roundVector:Da,matrix3x3ToQuaternion:Sg,multiplyQuaternion:qT,orthogonalize3x3:Cg,diagonalize3x3:mg,singularValueDecomposition3x3:ZT,solveLinearSystem:Ii,invertMatrix:La,luFactorLinearSystem:Xi,luSolveLinearSystem:Yi,estimateMatrixCondition:QT,jacobi:JT,jacobiN:Mn,solveHomogeneousLeastSquares:$i,solveLeastSquares:e2,hex2float:t2,rgb2hsv:Jr,hsv2rgb:zt,lab2xyz:wg,xyz2lab:Eg,xyz2rgb:Mg,rgb2xyz:Rg,rgb2lab:tr,lab2rgb:Rn,uninitializeBounds:On,areBoundsInitialized:Dn,computeBoundsFromPoints:r2,clampValue:Ma,clampVector:Va,clampAndNormalizeValue:n2,getScalarTypeFittingRange:a2,getAdjustedScalarRange:s2,extentIsWithinOtherExtent:i2,boundsIsWithinOtherBounds:o2,pointIsWithinBounds:f2,solve3PointCircle:c2,inf:u2,negInf:g2,isInf:qi,isNan:ji,isNaN:ji,isFinite:l2,createUninitializedBounds:Er,getMajorAxisIndex:p2,getSparseOrthogonalMatrix:h2,floatToHex2:Og,floatRGB2HexCode:v2,float2CssRGBA:d2};var{vtkDebugMacro:Ba}=m;function y2(t,e){e.classHierarchy.push("vtkCamera");let r=new Float64Array(3),n=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),s=O.identity(new Float64Array(16)),i=O.identity(new Float64Array(16)),o=new Float64Array(3),f=new Float64Array(3),c=new Float64Array(3),g=O.identity(new Float64Array(16)),u=O.identity(new Float64Array(16)),l=new Float64Array(3),p=new Float64Array(3);function d(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{let h=t.getViewMatrix();e.viewUp[0]=h[4],e.viewUp[1]=h[5],e.viewUp[2]=h[6],t.modified()},t.setPosition=(h,v,y)=>{h===e.position[0]&&v===e.position[1]&&y===e.position[2]||(e.position[0]=h,e.position[1]=v,e.position[2]=y,t.computeDistance(),t.modified())},t.setFocalPoint=(h,v,y)=>{h===e.focalPoint[0]&&v===e.focalPoint[1]&&y===e.focalPoint[2]||(e.focalPoint[0]=h,e.focalPoint[1]=v,e.focalPoint[2]=y,t.computeDistance(),t.modified())},t.setDistance=h=>{if(e.distance===h)return;e.distance=h,e.distance<1e-20&&(e.distance=1e-20,Ba("Distance is set to minimum."));let v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,t.modified()},t.computeDistance=()=>{let h=e.focalPoint[0]-e.position[0],v=e.focalPoint[1]-e.position[1],y=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(h*h+v*v+y*y),e.distance<1e-20){e.distance=1e-20,Ba("Distance is set to minimum.");let C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance}e.directionOfProjection[0]=h/e.distance,e.directionOfProjection[1]=v/e.distance,e.directionOfProjection[2]=y/e.distance,d()},t.dolly=h=>{if(h<=0)return;let v=e.distance/h;t.setPosition(e.focalPoint[0]-v*e.directionOfProjection[0],e.focalPoint[1]-v*e.directionOfProjection[1],e.focalPoint[2]-v*e.directionOfProjection[2])},t.roll=h=>{let v=e.position,y=e.focalPoint,C=e.viewUp,x=new Float64Array([C[0],C[1],C[2],0]);O.identity(g);let T=new Float64Array([y[0]-v[0],y[1]-v[1],y[2]-v[2]]);O.rotate(g,g,oe(h),T),Gt.transformMat4(x,x,g),e.viewUp[0]=x[0],e.viewUp[1]=x[1],e.viewUp[2]=x[2],t.modified()},t.azimuth=h=>{let v=e.focalPoint;O.identity(u),O.translate(u,u,v),O.rotate(u,u,oe(h),e.viewUp),O.translate(u,u,[-v[0],-v[1],-v[2]]),N.transformMat4(l,e.position,u),t.setPosition(l[0],l[1],l[2])},t.yaw=h=>{let v=e.position;O.identity(u),O.translate(u,u,v),O.rotate(u,u,oe(h),e.viewUp),O.translate(u,u,[-v[0],-v[1],-v[2]]),N.transformMat4(p,e.focalPoint,u),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=h=>{let v=e.focalPoint,y=t.getViewMatrix(),C=[-y[0],-y[1],-y[2]];O.identity(u),O.translate(u,u,v),O.rotate(u,u,oe(h),C),O.translate(u,u,[-v[0],-v[1],-v[2]]),N.transformMat4(l,e.position,u),t.setPosition(l[0],l[1],l[2])},t.pitch=h=>{let v=e.position,y=t.getViewMatrix(),C=[y[0],y[1],y[2]];O.identity(u),O.translate(u,u,v),O.rotate(u,u,oe(h),C),O.translate(u,u,[-v[0],-v[1],-v[2]]),N.transformMat4(p,e.focalPoint,u),t.setFocalPoint(...p)},t.zoom=h=>{h<=0||(e.parallelProjection?e.parallelScale/=h:e.viewAngle/=h,t.modified())},t.translate=(h,v,y)=>{let C=[h,v,y];bt(e.position,C,e.position),bt(e.focalPoint,C,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=h=>{let v=[...e.viewUp,1],y=[],C=[],x=[];v[0]+=e.position[0],v[1]+=e.position[1],v[2]+=e.position[2],Gt.transformMat4(y,[...e.position,1],h),Gt.transformMat4(C,[...e.focalPoint,1],h),Gt.transformMat4(x,v,h),x[0]-=y[0],x[1]-=y[1],x[2]-=y[2],t.setPosition(...y.slice(0,3)),t.setFocalPoint(...C.slice(0,3)),t.setViewUp(...x.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=h=>{let v=h;v<1e-20&&(v=1e-20,Ba("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+v)},t.setThicknessFromFocalPoint=h=>{let v=h;v<1e-20&&(v=1e-20,Ba("Thickness is set to minimum.")),t.setClippingRange(e.distance-v/2,e.distance+v/2)},t.setRoll=h=>{},t.getRoll=()=>{},t.setObliqueAngles=(h,v)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Float64Array(24),y=[[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1],[0,0,1,1],[0,0,-1,1]],C=t.getCompositeProjectionMatrix(h,-1,1);for(let x=0;x<6;x++)Gt.transformMat4(y[x],y[x],C),hg(y[x]),v[4*x+0]=y[x][0],v[4*x+1]=y[x][1],v[4*x+2]=y[x][2],v[4*x+3]=y[x][3];return v},t.getCameraLightTransformMatrix=h=>(O.copy(h,e.cameraLightTransform),h),t.computeCameraLightTransform=()=>{O.copy(s,t.getViewMatrix()),O.invert(s,s),O.fromScaling(i,[e.distance,e.distance,e.distance]),O.multiply(s,s,i),O.identity(e.cameraLightTransform),O.translate(e.cameraLightTransform,s,[0,0,-1])},t.deepCopy=h=>{},t.physicalOrientationToWorldDirection=h=>{let v=Me.fromValues(h[0],h[1],h[2],h[3]),y=Me.create(),C=Me.fromValues(0,0,1,0);return Me.conjugate(y,v),Me.multiply(C,v,C),Me.multiply(C,C,y),[C[0],C[1],C[2]]},t.getPhysicalToWorldMatrix=h=>{t.getWorldToPhysicalMatrix(h),O.invert(h,h)},t.getWorldToPhysicalMatrix=h=>{O.identity(h);let v=[3];Re(e.physicalViewNorth,e.physicalViewUp,v),h[0]=v[0],h[1]=v[1],h[2]=v[2],h[4]=e.physicalViewUp[0],h[5]=e.physicalViewUp[1],h[6]=e.physicalViewUp[2],h[8]=-e.physicalViewNorth[0],h[9]=-e.physicalViewNorth[1],h[10]=-e.physicalViewNorth[2],O.transpose(h,h),N.set(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),O.scale(h,h,o),O.translate(h,h,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=h=>{O.invert(s,h),N.transformMat4(o,r,s),t.computeDistance();let v=e.distance;t.setPosition(o[0],o[1],o[2]),N.transformMat4(f,n,s),N.subtract(f,f,o),N.normalize(f,f),t.setDirectionOfProjection(f[0],f[1],f[2]),N.transformMat4(c,a,s),N.subtract(c,c,o),N.normalize(c,c),t.setViewUp(c[0],c[1],c[2]),t.setDistance(v)},t.computeViewParametersFromPhysicalMatrix=h=>{t.getWorldToPhysicalMatrix(s),O.multiply(s,h,s),t.computeViewParametersFromViewMatrix(s)},t.setModelTransformMatrix=h=>{e.modelTransformMatrix=h},t.getModelTransformMatrix=()=>e.modelTransformMatrix,t.setViewMatrix=h=>{e.viewMatrix=h,e.viewMatrix&&(O.copy(s,e.viewMatrix),t.computeViewParametersFromViewMatrix(s),O.transpose(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.modelTransformMatrix?(O.multiply(s,e.viewMatrix,e.modelTransformMatrix),s):e.viewMatrix;O.lookAt(s,e.position,e.focalPoint,e.viewUp),O.transpose(s,s);let h=new Float64Array(16);return e.modelTransformMatrix?O.multiply(h,s,e.modelTransformMatrix):O.copy(h,s),h},t.setProjectionMatrix=h=>{e.projectionMatrix=h},t.getProjectionMatrix=(h,v,y)=>{let C=new Float64Array(16);if(O.identity(C),e.projectionMatrix){let w=1/e.physicalScale;return N.set(o,w,w,w),O.copy(C,e.projectionMatrix),O.scale(C,C,o),O.transpose(C,C),C}O.identity(s);let x=e.clippingRange[1]-e.clippingRange[0],T=[e.clippingRange[0]+(v+1)*x/2,e.clippingRange[0]+(y+1)*x/2];if(e.parallelProjection){let w=e.parallelScale*h,S=e.parallelScale,M=(e.windowCenter[0]-1)*w,E=(e.windowCenter[0]+1)*w,R=(e.windowCenter[1]-1)*S,D=(e.windowCenter[1]+1)*S;O.ortho(s,M,E,R,D,T[0],T[1]),O.transpose(s,s)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{let w=Math.tan(oe(e.viewAngle)/2),S,M;e.useHorizontalViewAngle===!0?(S=e.clippingRange[0]*w,M=e.clippingRange[0]*w/h):(S=e.clippingRange[0]*w*h,M=e.clippingRange[0]*w);let E=(e.windowCenter[0]-1)*S,R=(e.windowCenter[0]+1)*S,D=(e.windowCenter[1]-1)*M,L=(e.windowCenter[1]+1)*M,V=T[0],B=T[1];s[0]=2*V/(R-E),s[5]=2*V/(L-D),s[2]=(E+R)/(R-E),s[6]=(D+L)/(L-D),s[10]=-(V+B)/(B-V),s[14]=-1,s[11]=-2*V*B/(B-V),s[15]=0}}return O.copy(C,s),C},t.getCompositeProjectionMatrix=(h,v,y)=>{let C=t.getViewMatrix(),x=t.getProjectionMatrix(h,v,y);return O.multiply(x,C,x),x},t.setDirectionOfProjection=(h,v,y)=>{if(e.directionOfProjection[0]===h&&e.directionOfProjection[1]===v&&e.directionOfProjection[2]===y)return;e.directionOfProjection[0]=h,e.directionOfProjection[1]=v,e.directionOfProjection[2]=y;let C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance,d()},t.setDeviceAngles=(h,v,y,C)=>{let x=[3];Re(e.physicalViewNorth,e.physicalViewUp,x);let T=O.identity(new Float64Array(16));O.rotate(T,T,oe(h),e.physicalViewUp),O.rotate(T,T,oe(v),x),O.rotate(T,T,oe(y),e.physicalViewNorth),O.rotate(T,T,oe(-C),e.physicalViewUp);let w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),S=new Float64Array(e.physicalViewNorth);N.transformMat4(w,w,T),N.transformMat4(S,S,T),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(S[0],S[1],S[2]),t.modified()},t.setOrientationWXYZ=(h,v,y,C)=>{let x=O.identity(new Float64Array(16));if(h!==0&&(v!==0||y!==0||C!==0)){let S=oe(h),M=Me.create();Me.setAxisAngle(M,[v,y,C],S),O.fromQuat(x,M)}let T=new Float64Array(3);N.transformMat4(T,[0,0,-1],x);let w=new Float64Array(3);N.transformMat4(w,[0,1,0],x),t.setDirectionOfProjection(...T),t.setViewUp(...w),t.modified()},t.computeClippingRange=h=>{let v=null,y=null;v=e.viewPlaneNormal,y=e.position;let C=-v[0],x=-v[1],T=-v[2],w=-(C*y[0]+x*y[1]+T*y[2]),S=[C*h[0]+x*h[2]+T*h[4]+w,1e-18];for(let M=0;M<2;M++)for(let E=0;E<2;E++)for(let R=0;R<2;R++){let D=C*h[R]+x*h[2+E]+T*h[4+M]+w;S[0]=D<S[0]?D:S[0],S[1]=D>S[1]?D:S[1]}return S}}var x2={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,modelTransformMatrix:null,cameraLightTransform:O.create(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function Dg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,x2,r),m.obj(t,e),m.get(t,e,["distance"]),m.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),m.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),m.setGetArray(t,e,["clippingRange","windowCenter"],2),m.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),y2(t,e)}var T2=m.newInstance(Dg,"vtkCamera"),Lg={newInstance:T2,extend:Dg};var S2=["HeadLight","CameraLight","SceneLight"];function C2(t,e){e.classHierarchy.push("vtkLight");let r=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?N.transformMat4(r,e.position,e.transformMatrix):N.set(r,e.position[0],e.position[1],e.position[2]),r),t.getTransformedFocalPoint=()=>(e.transformMatrix?N.transformMat4(r,e.focalPoint,e.transformMatrix):N.set(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r),t.getDirection=()=>(e.directionMTime<e.mtime&&(N.sub(e.direction,e.focalPoint,e.position),ke(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=n=>{let a=new Float64Array(3);N.sub(a,e.position,n),e.focalPoint=a},t.setDirectionAngle=(n,a)=>{let s=oe(n),i=oe(a);t.setPosition(Math.cos(s)*Math.sin(i),Math.sin(s),Math.cos(s)*Math.cos(i)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}var m2={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function Vg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m2,r),m.obj(t,e),m.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),m.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),C2(t,e)}var w2=m.newInstance(Vg,"vtkLight"),Bg={newInstance:w2,extend:Vg,LIGHT_TYPES:S2};var{vtkErrorMacro:Fa}=m;function E2(t){return()=>Fa(`vtkViewport::${t} - NOT IMPLEMENTED`)}function M2(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=n=>e.props.includes(n),t.addViewProp=n=>{n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=n=>{let a=e.props.filter(s=>s!==n);e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=()=>{e.props=[]};function r(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(n);let s=n.getNestedProps();if(s&&s.length)for(let i=0;i<s.length;i++)r(s[i],a);return a}t.getViewPropsWithNestedProps=()=>{let n=[],a=t.getActors2D();a.sort((i,o)=>i.getLayerNumber()-o.getLayerNumber());let s=e.props.filter(i=>!a.includes(i));for(let i=0;i<s.length;i++)r(s[i],n);return n=n.concat(a),n},t.addActor2D=t.addViewProp,t.removeActor2D=n=>{t.removeViewProp(n)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(n=>{e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D),t.displayToView=()=>Fa("call displayToView on your view instead"),t.viewToDisplay=()=>Fa("callviewtodisplay on your view instead"),t.getSize=()=>Fa("call getSize on your View instead"),t.normalizedDisplayToProjection=(n,a,s)=>{let i=t.normalizedDisplayToNormalizedViewport(n,a,s);return t.normalizedViewportToProjection(i[0],i[1],i[2])},t.normalizedDisplayToNormalizedViewport=(n,a,s)=>{let i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/i[0],(a-e.viewport[1])/i[1],s]},t.normalizedViewportToProjection=(n,a,s)=>[n*2-1,a*2-1,s*2-1],t.projectionToNormalizedDisplay=(n,a,s)=>{let i=t.projectionToNormalizedViewport(n,a,s);return t.normalizedViewportToNormalizedDisplay(i[0],i[1],i[2])},t.normalizedViewportToNormalizedDisplay=(n,a,s)=>{let i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*i[0]+e.viewport[0],a*i[1]+e.viewport[1],s]},t.projectionToNormalizedViewport=(n,a,s)=>[(n+1)*.5,(a+1)*.5,(s+1)*.5],t.PickPropFrom=E2("PickPropFrom")}var R2={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function Fg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R2,r),m.obj(t,e),m.event(t,e,"event"),m.setGetArray(t,e,["viewport"],4),m.setGetArray(t,e,["background","background2"],3),M2(t,e)}var O2=m.newInstance(Fg,"vtkViewport"),kg={newInstance:O2,extend:Fg};function D2(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=r=>{if(!e.transform)return t.evaluateFunction(r);let n=[];return e.transform.transformPoint(r,n),t.evaluateFunction(n)},t.evaluateFunction=r=>{m.vtkErrorMacro("not implemented")}}var L2={};function Ug(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,L2,r),m.obj(t,e),m.setGet(t,e,["transform"]),D2(t,e)}var V2=m.newInstance(Ug,"vtkImplicitFunction"),Ng={newInstance:V2,extend:Ug};var Qi=1e-6,Gg="coincide",_g="disjoint";function B2(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function bg(t,e,r){let n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function zg(t,e,r,n){let a=[];xe(t,e,a);let s=$(r,a);n[0]=t[0]-s*r[0],n[1]=t[1]-s*r[1],n[2]=t[2]-s*r[2]}function Wg(t,e,r){let n=$(t,e),a=$(e,e);return a===0&&(a=1),r[0]=t[0]-n*e[0]/a,r[1]=t[1]-n*e[1]/a,r[2]=t[2]-n*e[2]/a,r}function Hg(t,e,r,n){let a=[];xe(t,e,a);let s=$(r,a),i=$(r,r);i!==0?(n[0]=t[0]-s*r[0]/i,n[1]=t[1]-s*r[1]/i,n[2]=t[2]-s*r[2]/i):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function Ag(t,e,r,n){let a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},s=[],i=[];xe(e,t,s),xe(r,t,i);let o=$(n,i),f=$(n,s),c,g;return f<0?c=-f:c=f,o<0?g=-o*Qi:g=o*Qi,c<=g||(a.t=o/f,a.x[0]=t[0]+a.t*s[0],a.x[1]=t[1]+a.t*s[1],a.x[2]=t[2]+a.t*s[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function $g(t,e,r,n){let a={intersection:!1,l0:[],l1:[],error:null},s=[];Re(e,n,s);let i=s.map(u=>Math.abs(u));if(i[0]+i[1]+i[2]<Qi){let u=[];return xe(t,r,u),$(e,u)===0?a.error=Gg:a.error=_g,a}let o;i[0]>i[1]&&i[0]>i[2]?o="x":i[1]>i[2]?o="y":o="z";let f=[],c=-$(e,t),g=-$(n,r);switch(o){case"x":f[0]=0,f[1]=(g*e[2]-c*n[2])/s[0],f[2]=(c*n[1]-g*e[1])/s[0];break;case"y":f[0]=(c*n[2]-g*e[2])/s[1],f[1]=0,f[2]=(g*e[0]-c*n[0])/s[1];break;case"z":f[0]=(g*e[1]-c*n[1])/s[2],f[1]=(c*n[0]-g*e[0])/s[2],f[2]=0;break}return a.l0=f,bt(f,s,a.l1),a.intersection=!0,a}var F2={evaluate:B2,distanceToPlane:bg,projectPoint:zg,projectVector:Wg,generalizedProjectPoint:Hg,intersectWithLine:Ag,intersectWithPlane:$g,DISJOINT:_g,COINCIDE:Gg};function k2(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=r=>bg(r,e.origin,e.normal),t.projectPoint=(r,n)=>{zg(r,e.origin,e.normal,n)},t.projectVector=(r,n)=>Wg(r,e.normal,n),t.push=r=>{if(r!==0)for(let n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=(r,n)=>{Hg(r,e.origin,e.normal,n)},t.evaluateFunction=(r,n,a)=>Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(a-e.origin[2]),t.evaluateGradient=r=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(r,n)=>Ag(r,n,e.origin,e.normal),t.intersectWithPlane=(r,n)=>$g(r,n,e.origin,e.normal)}var U2={normal:[0,0,1],origin:[0,0,0]};function jg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,U2,r),Ng.extend(t,e,r),m.setGetArray(t,e,["normal","origin"],3),k2(t,e)}var N2=m.newInstance(jg,"vtkPlane"),dt={newInstance:N2,extend:jg,...F2};var _a=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function Kg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Wt(t){return t?.length>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function eo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function to(t){return eo(t,_a)}function Ua(t,e,r,n){let[a,s,i,o,f,c]=t;return t[0]=a<e?a:e,t[1]=s>e?s:e,t[2]=i<r?i:r,t[3]=o>r?o:r,t[4]=f<n?f:n,t[5]=c>n?c:n,t}function ro(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let r=0;r<e.length;++r)Ua(t,...e[r]);else for(let r=0;r<e.length;r+=3)Ua(t,...e.slice(r,r+3));return t}function Pg(t,e,r,n,a,s,i){let[o,f,c,g,u,l]=t;return i===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],f),t[2]=Math.min(e[2],c),t[3]=Math.max(e[3],g),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],l)):(t[0]=Math.min(e,o),t[1]=Math.max(r,f),t[2]=Math.min(n,c),t[3]=Math.max(a,g),t[4]=Math.min(s,u),t[5]=Math.max(i,l)),t}function Xg(t,e,r,n){let[a,s,i,o,f,c]=t;return t[0]=e,t[1]=e>s?e:s,t[2]=r,t[3]=r>o?r:o,t[4]=n,t[5]=n>c?n:c,a!==e||i!==r||f!==n}function Yg(t,e,r,n){let[a,s,i,o,f,c]=t;return t[0]=e<a?e:a,t[1]=e,t[2]=r<i?r:i,t[3]=r,t[4]=n<f?n:f,t[5]=n,s!==e||o!==r||c!==n}function no(t,e){return e==null?G2(t):(t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t)}function G2(t){let e=[0,0,0],r=-1,n=0,a=0;for(let s=0;s<3;++s)a=t[s*2+1]-t[s*2],a>n&&(n=a,r=s),e[s]=a>0?1:0;if(r<0)return no(t,.5);for(let s=0;s<3;++s)if(!e[s]){let i=.005*n;t[s*2]-=i,t[s*2+1]+=i}return t}function ao(t,e,r,n){return Wt(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function so(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function _2(t,e,r,n){if(!Wt(t))return!1;let a=so(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],ao(t,e,r,n),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function Ln(t,e){return t[e*2+1]-t[e*2]}function Vn(t){return[Ln(t,0),Ln(t,1),Ln(t,2)]}function Ig(t){return t.slice(0,2)}function qg(t){return t.slice(2,4)}function Zg(t){return t.slice(4,6)}function Qg(t){let e=Vn(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function io(t){if(Wt(t)){let e=Vn(t);return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}return null}function Jg(t){let e=io(t);return e!==null?Math.sqrt(e):null}function ba(t){return[t[0],t[2],t[4]]}function za(t){return[t[1],t[3],t[5]]}function ka(t,e){return t<=0&&e>=0||t>=0&&e<=0}function oo(t,e){return e[0]=[t[0],t[2],t[4]],e[1]=[t[0],t[2],t[5]],e[2]=[t[0],t[3],t[4]],e[3]=[t[0],t[3],t[5]],e[4]=[t[1],t[2],t[4]],e[5]=[t[1],t[2],t[5]],e[6]=[t[1],t[3],t[4]],e[7]=[t[1],t[3],t[5]],e}function el(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function tl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=oo(t,[]);for(let a=0;a<n.length;++a)N.transformMat4(n[a],n[a],e);return to(r),ro(r,n)}function rl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function nl(t,e,r,n){let a=[].concat(_a),s=t.getData();for(let i=0;i<s.length;i+=3){let o=[s[i],s[i+1],s[i+2]],f=$(o,e);a[0]=Math.min(f,a[0]),a[1]=Math.max(f,a[1]);let c=$(o,r);a[2]=Math.min(c,a[2]),a[3]=Math.max(c,a[3]);let g=$(o,n);a[4]=Math.min(g,a[4]),a[5]=Math.max(g,a[5])}return a}function al(t,e,r,n,a){let s=!0,i=[],o=0,f=[],c=[0,0,0],g=0,u=1,l=2;for(let p=0;p<3;p++)e[p]<t[2*p]?(i[p]=u,c[p]=t[2*p],s=!1):e[p]>t[2*p+1]?(i[p]=g,c[p]=t[2*p+1],s=!1):i[p]=l;if(s)return n[0]=e[0],n[1]=e[1],n[2]=e[2],a[0]=0,1;for(let p=0;p<3;p++)i[p]!==l&&r[p]!==0?f[p]=(c[p]-e[p])/r[p]:f[p]=-1;for(let p=0;p<3;p++)f[o]<f[p]&&(o=p);if(f[o]>1||f[o]<0)return 0;a[0]=f[o];for(let p=0;p<3;p++)if(o!==p){if(n[p]=e[p]+f[o]*r[p],n[p]<t[2*p]||n[p]>t[2*p+1])return 0}else n[p]=c[p];return 1}function sl(t,e,r){let n=[],a=0,s=1,i=1;for(let o=4;o<=5;++o){n[2]=t[o];for(let f=2;f<=3;++f){n[1]=t[f];for(let c=0;c<=1;++c)if(n[0]=t[c],a=dt.evaluate(r,e,n),i&&(s=a>=0?1:-1,i=0),a===0||s>0&&a<0||s<0&&a>0)return 1}}return 0}function il(t,e){if(!(Wt(t)&&Wt(e)))return!1;let r=[0,0,0,0,0,0],n;for(let a=0;a<3;a++)if(n=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(n=!0,r[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(n=!0,r[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(n=!0,r[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(n=!0,r[a*2+1]=t[a*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function Na(t,e){if(!(Wt(t)&&Wt(e)))return!1;for(let r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function Ga(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function b2(t,e){return!(!Na(t,e)||!Ga(t,...ba(e))||!Ga(t,...za(e)))}function ol(t,e,r){let n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0],s=0;for(let u=0;u<2;u++)for(let l=2;l<4;l++)for(let p=4;p<6;p++){let d=[t[u],t[l],t[p]];a[s++]=dt.evaluate(r,e,d)}let i=2;for(;i--&&!(ka(a[n[i][0]],a[n[i][4]])&&ka(a[n[i][1]],a[n[i][5]])&&ka(a[n[i][2]],a[n[i][6]])&&ka(a[n[i][3]],a[n[i][7]])););if(i<0)return!1;let o=Math.sign(r[i]),f=Math.abs((t[i*2+1]-t[i*2])*r[i]),c=o>0?1:0;for(let u=0;u<4;u++){if(f===0)continue;let l=Math.abs(a[n[i][u]])/f;o>0&&l<c&&(c=l),o<0&&l>c&&(c=l)}let g=(1-c)*t[i*2]+c*t[i*2+1];return o>0?t[i*2]=g:t[i*2+1]=g,!0}function fl(t,e){for(let n=0;n<3;++n)e[n]=e[n]<1?1:e[n];let r=e[0]*e[1]*e[2];for(;r>t;){for(let n=0;n<3;++n)e[n]=e[n]>1?e[n]-1:1;r=e[0]*e[1]*e[2]}}function cl(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];e=e<=0?1:e;let a=0,s=[0,0,0],i=-1,o=0,f=Vn(t),c=f[0]+f[1]+f[2],g=c*(.001/3);for(let h=0;h<3;++h)f[h]>o&&(i=h,o=f[h]),f[h]>g?(s[h]=1,a++):s[h]=0;let u=ba(t),l=za(t);if(a<1)return r[0]=1,r[1]=1,r[2]=1,n[0]=u[0]-.5,n[1]=l[0]+.5,n[2]=u[1]-.5,n[3]=l[1]+.5,n[4]=u[2]-.5,n[5]=l[2]+.5,1;let p=e;p/=s[0]?f[0]/c:1,p/=s[1]?f[1]/c:1,p/=s[2]?f[2]/c:1,p**=1/a;for(let h=0;h<3;++h)r[h]=s[h]?Math.floor(p*f[h]/c):1,r[h]=r[h]<1?1:r[h];fl(e,r);let d=.5*f[i]/r[i];for(let h=0;h<3;++h)s[h]?(n[2*h]=u[h],n[2*h+1]=l[h]):(n[2*h]=u[h]-d,n[2*h+1]=l[h]+d);return r[0]*r[1]*r[2]}function ul(t,e){if(t[0]>=e[0]&&t[0]<=e[1]&&t[1]>=e[2]&&t[1]<=e[3]&&t[2]>=e[4]&&t[2]<=e[5])return 0;let r=[0,0,0];return t[0]<e[0]?r[0]=e[0]-t[0]:t[0]>e[1]&&(r[0]=t[0]-e[1]),t[1]<e[2]?r[1]=e[2]-t[1]:t[1]>e[3]&&(r[1]=t[1]-e[3]),t[2]<e[4]?r[2]=e[4]-t[2]:t[2]>e[5]&&(r[2]=t[2]-e[5]),$(r,r)}var Ji=class{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(_a))}getBounds(){return this.bounds}equals(e){return Kg(this.bounds,e)}isValid(){return Wt(this.bounds)}setBounds(e){return eo(this.bounds,e)}reset(){return to(this.bounds)}addPoint(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ua(this.bounds,...r)}addPoints(e){return ro(this.bounds,e)}addBounds(e,r,n,a,s,i){return Pg(this.bounds,e,r,n,a,s,i)}setMinPoint(e,r,n){return Xg(this.bounds,e,r,n)}setMaxPoint(e,r,n){return Yg(this.bounds,e,r,n)}inflate(e){return no(this.bounds,e)}scale(e,r,n){return ao(this.bounds,e,r,n)}getCenter(){return so(this.bounds)}getLength(e){return Ln(this.bounds,e)}getLengths(){return Vn(this.bounds)}getMaxLength(){return Qg(this.bounds)}getDiagonalLength(){return Jg(this.bounds)}getDiagonalLength2(){return io(this.bounds)}getMinPoint(){return ba(this.bounds)}getMaxPoint(){return za(this.bounds)}getXRange(){return Ig(this.bounds)}getYRange(){return qg(this.bounds)}getZRange(){return Zg(this.bounds)}getCorners(e){return oo(this.bounds,e)}computeCornerPoints(e,r){return el(this.bounds,e,r)}computeLocalBounds(e,r,n){return nl(this.bounds,e,r,n)}transformBounds(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return tl(this.bounds,e,r)}computeScale3(e){return rl(this.bounds,e)}cutWithPlane(e,r){return ol(this.bounds,e,r)}intersectBox(e,r,n,a){return al(this.bounds,e,r,n,a)}intersectPlane(e,r){return sl(this.bounds,e,r)}intersect(e){return il(this.bounds,e)}intersects(e){return Na(this.bounds,e)}containsPoint(e,r,n){return Ga(this.bounds,e,r,n)}contains(e){return Na(this.bounds,e)}computeDivisions(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return cl(this.bounds,e,r,n)}distance2ToBounds(e){return ul(e,this.bounds)}};function z2(t){let e=t&&t.bounds;return new Ji(e)}var W2={equals:Kg,isValid:Wt,setBounds:eo,reset:to,addPoint:Ua,addPoints:ro,addBounds:Pg,setMinPoint:Xg,setMaxPoint:Yg,inflate:no,scale:ao,scaleAboutCenter:_2,getCenter:so,getLength:Ln,getLengths:Vn,getMaxLength:Qg,getDiagonalLength:Jg,getDiagonalLength2:io,getMinPoint:ba,getMaxPoint:za,getXRange:Ig,getYRange:qg,getZRange:Zg,getCorners:oo,computeCornerPoints:el,computeLocalBounds:nl,transformBounds:tl,computeScale3:rl,cutWithPlane:ol,intersectBox:al,intersectPlane:sl,intersect:il,intersects:Na,containsPoint:Ga,contains:b2,computeDivisions:cl,clampDivisions:fl,distance2ToBounds:ul,INIT_BOUNDS:_a},Z={newInstance:z2,...W2};var{vtkDebugMacro:Bn,vtkErrorMacro:rr,vtkWarningMacro:H2}=Ee;function gl(t){return()=>rr(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function A2(t,e){e.classHierarchy.push("vtkRenderer");let r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Bn("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{let s=t.getActiveCameraAndResetIfCreated();e.lights.forEach(i=>{i.lightTypeIsSceneLight()||(i.lightTypeIsHeadLight()?(i.setPositionFrom(s.getPositionByReference()),i.setFocalPointFrom(s.getFocalPointByReference()),i.modified(s.getMTime())):i.lightTypeIsCameraLight()?i.setTransformMatrix(s.getCameraLightTransformMatrix(O.create())):rr("light has unknown light type",i.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=gl("allocateTime"),t.updateGeometry=gl("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=s=>{Bn(t.getClassName(),t,"setting Layer to ",s),e.layer!==s&&(e.layer=s,t.modified()),t.setPreserveColorBuffer(!!s)},t.setActiveCamera=s=>e.activeCamera===s?!1:(e.activeCamera=s,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:s}),!0),t.makeCamera=()=>{let s=Lg.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:s}),s},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(s=>{e.actors=e.actors.concat(s.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=s=>{e.actors=e.actors.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(i=>{t.removeViewProp(i)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(s=>{e.volumes=e.volumes.concat(s.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=s=>{e.volumes=e.volumes.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(i=>{t.removeViewProp(i)}),e.volumes=[],t.modified()},t.hasLight=s=>e.lights.includes(s),t.addLight=s=>{s&&!t.hasLight(s)&&(e.lights.push(s),t.modified())},t.removeLight=s=>{e.lights=e.lights.filter(i=>i!==s),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=s=>{e.lights=s,t.modified()},t.makeLight=Bg.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(s,i,o,f)=>{let c=t.normalizedDisplayToProjection(s,i,o);return c=t.projectionToView(c[0],c[1],c[2],f),t.viewToWorld(c[0],c[1],c[2])},t.worldToNormalizedDisplay=(s,i,o,f)=>{let c=t.worldToView(s,i,o);return c=t.viewToProjection(c[0],c[1],c[2],f),t.projectionToNormalizedDisplay(c[0],c[1],c[2])},t.viewToWorld=(s,i,o)=>{if(e.activeCamera===null)return rr("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];let f=e.activeCamera.getViewMatrix();O.invert(f,f),O.transpose(f,f);let c=new Float64Array([s,i,o]);return N.transformMat4(c,c,f),c},t.projectionToView=(s,i,o,f)=>{if(e.activeCamera===null)return rr("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];let c=e.activeCamera.getProjectionMatrix(f,-1,1);O.invert(c,c),O.transpose(c,c);let g=new Float64Array([s,i,o]);return N.transformMat4(g,g,c),g},t.worldToView=(s,i,o)=>{if(e.activeCamera===null)return rr("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];let f=e.activeCamera.getViewMatrix();O.transpose(f,f);let c=new Float64Array([s,i,o]);return N.transformMat4(c,c,f),c},t.viewToProjection=(s,i,o,f)=>{if(e.activeCamera===null)return rr("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];let c=e.activeCamera.getProjectionMatrix(f,-1,1);O.transpose(c,c);let g=new Float64Array([s,i,o]);return N.transformMat4(g,g,c),g},t.computeVisiblePropBounds=()=>{e.allBounds[0]=Z.INIT_BOUNDS[0],e.allBounds[1]=Z.INIT_BOUNDS[1],e.allBounds[2]=Z.INIT_BOUNDS[2],e.allBounds[3]=Z.INIT_BOUNDS[3],e.allBounds[4]=Z.INIT_BOUNDS[4],e.allBounds[5]=Z.INIT_BOUNDS[5];let s=!0;t.invokeEvent(r);for(let i=0;i<e.props.length;++i){let o=e.props[i];if(o.getVisibility()&&o.getUseBounds()){let f=o.getBounds();f&&Dn(f)&&(s=!1,f[0]<e.allBounds[0]&&(e.allBounds[0]=f[0]),f[1]>e.allBounds[1]&&(e.allBounds[1]=f[1]),f[2]<e.allBounds[2]&&(e.allBounds[2]=f[2]),f[3]>e.allBounds[3]&&(e.allBounds[3]=f[3]),f[4]<e.allBounds[4]&&(e.allBounds[4]=f[4]),f[5]>e.allBounds[5]&&(e.allBounds[5]=f[5]))}}return s&&(On(e.allBounds),Bn("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){let i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!Dn(i))return Bn("Cannot reset camera!"),!1;let f=null;if(t.getActiveCamera())f=e.activeCamera.getViewPlaneNormal();else return rr("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(i[0]+i[1])/2,o[1]=(i[2]+i[3])/2,o[2]=(i[4]+i[5])/2;let c=i[1]-i[0],g=i[3]-i[2],u=i[5]-i[4];c*=c,g*=g,u*=u;let l=c+g+u;l=l===0?1:l,l=Math.sqrt(l)*.5;let p=oe(e.activeCamera.getViewAngle()),d=l,h=l/Math.sin(p*.5),v=e.activeCamera.getViewUp();return Math.abs($(v,f))>.999&&(H2("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-v[2],v[0],v[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+h*f[0],o[1]+h*f[1],o[2]+h*f[2]),t.resetCameraClippingRange(i),e.activeCamera.setParallelScale(d),e.activeCamera.setPhysicalScale(l),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){let i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Dn(i))return Bn("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return rr("Trying to reset clipping range of non-existent camera"),!1;let o=e.activeCamera.computeClippingRange(i),f=0;if(e.activeCamera.getParallelProjection())f=.2*e.activeCamera.getParallelScale();else{let c=oe(e.activeCamera.getViewAngle());f=.2*Math.tan(c/2)*o[1]}return o[1]-o[0]<f&&(f=f-o[1]+o[0],o[1]+=f/2,o[0]-=f/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(n),!1},t.setRenderWindow=s=>{s!==e._renderWindow&&(e._vtkWindow=s,e._renderWindow=s)},t.visibleActorCount=()=>e.props.filter(s=>s.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let s=e.mtime,i=e.activeCamera?e.activeCamera.getMTime():0;i>s&&(s=i);let o=e._createdLight?e._createdLight.getMTime():0;return o>s&&(s=o),s},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}var $2={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Er(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function ll(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,$2,r),kg.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),pe(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),re(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Ut(t,e,["actors","volumes","lights"]),la(t,e,["background"],4,1),Jt(t,e,["renderWindow"]),A2(t,e)}var j2=j(ll,"vtkRenderer"),Wa={newInstance:j2,extend:ll};var K2="WebGL",Ha=Object.create(null);function Fn(t,e){Ha[t]=e}function P2(){return Object.keys(Ha)}function pl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ha[t]&&Ha[t](e)}function X2(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=r=>{t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=r=>{e.renderers=e.renderers.filter(n=>n!==r),t.modified()},t.hasRenderer=r=>e.renderers.indexOf(r)!==-1,t.newAPISpecificView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return pl(r||e.defaultViewAPI,n)},t.addView=r=>{t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=r=>{e._views=e._views.filter(n=>n!==r),t.modified()},t.hasView=r=>e._views.indexOf(r)!==-1,t.preRender=()=>{e.renderers.forEach(r=>{r.isActiveCameraCreated()||r.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(r=>r.traverseAllPasses())},t.getStatistics=()=>{let r={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(n=>{n.getGraphicsMemoryInfo&&(r.gpuMemoryMB+=n.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(n=>{let a=n.getViewProps(),s=e._views[0].getViewNodeFor(n);a.forEach(i=>{if(i.getVisibility()){r.propCount+=1;let o=i.getMapper&&i.getMapper();if(o&&o.getPrimitiveCount){let f=s.getViewNodeFor(o);if(f){f.getAllocatedGPUMemoryInBytes&&(r.gpuMemoryMB+=f.getAllocatedGPUMemoryInBytes()/1e6);let c=o.getPrimitiveCount();Object.keys(c).forEach(g=>{r[g]||(r[g]=0),r[g]+=c[g]})}}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`
`),r},t.captureImages=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return m.setImmediate(t.render),e._views.map(a=>a.captureNextImage?a.captureNextImage(r,n):void 0).filter(a=>!!a)},t.addRenderWindow=r=>e.childRenderWindows.includes(r)?!1:(e.childRenderWindows.push(r),t.modified(),!0),t.removeRenderWindow=r=>{let n=e.childRenderWindows.findIndex(a=>a===r);return n<0?!1:(e.childRenderWindows.splice(n,1),t.modified(),!0)}}var Y2={defaultViewAPI:K2,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function hl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y2,r),m.obj(t,e),m.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),m.get(t,e,["neverRendered"]),m.getArray(t,e,["renderers","childRenderWindows"]),m.moveToProtected(t,e,["views"]),m.event(t,e,"completion"),X2(t,e)}var I2=m.newInstance(hl,"vtkRenderWindow"),vl={newInstance:I2,extend:hl,registerViewConstructor:Fn,listViewAPIs:P2,newAPISpecificView:pl};var Aa={Unknown:0,LeftController:1,RightController:2},en={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},q2={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Z2={LeftButton:1,MiddleButton:2,RightButton:3},fo={Device:Aa,Input:en,Axis:q2,MouseButton:Z2};var{Device:$a,Input:Mr}=fo,{vtkWarningMacro:ja,vtkErrorMacro:Ka,normalizeWheel:Q2,vtkOnceErrorMacro:J2}=m,tn={ctrlKey:!1,altKey:!1,shiftKey:!1},co={"xr-standard":[Mr.Trigger,Mr.Grip,Mr.TrackPad,Mr.Thumbstick,Mr.A,Mr.B]},uo=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function kn(t){t.cancelable&&t.preventDefault()}function Pa(t){let e=Object.create(null);return t.forEach(r=>{let{pointerId:n,position:a}=r;e[n]=a}),e}function eS(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");let r={...t},n=new Set,a=new Map,s=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=h=>{Ka("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=h=>{e.interactorStyle!==h&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=h,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>ja("empty event loop");function i(h,v){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(h,v))}t.getCurrentRenderer=()=>(e.currentRenderer||i(0,0),e.currentRenderer);function o(h){let v=e._view.getCanvas(),y=v.getBoundingClientRect(),C=v.width/y.width,x=v.height/y.height,T={x:C*(h.clientX-y.left),y:x*(y.height-h.clientY+y.top),z:0,movementX:C*h.movementX,movementY:x*h.movementY};return(a.size<=1||!e.currentRenderer)&&i(T.x,T.y),T}let f=e._getScreenEventPositionFor||o;function c(h){return{controlKey:h.ctrlKey,altKey:h.altKey,shiftKey:h.shiftKey}}function g(h){let v=c(h);return{key:h.key,keyCode:h.charCode,...v}}function u(h){return h.pointerType||""}let l=()=>{if(e.container===null)return;let{container:h}=e;h.addEventListener("contextmenu",kn),h.addEventListener("wheel",t.handleWheel),h.addEventListener("DOMMouseScroll",t.handleWheel),h.addEventListener("pointerenter",t.handlePointerEnter),h.addEventListener("pointerleave",t.handlePointerLeave),h.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.addEventListener("pointerup",t.handlePointerUp),h.addEventListener("pointercancel",t.handlePointerCancel),h.addEventListener("keypress",t.handleKeyPress),h.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),h.tabIndex=0,h.style.touchAction="none",h.style.userSelect="none",h.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=h=>{if(h===null)return;r.setContainer(h)&&l()};let p=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,s=1;let{container:h}=e;h&&(h.removeEventListener("contextmenu",kn),h.removeEventListener("wheel",t.handleWheel),h.removeEventListener("DOMMouseScroll",t.handleWheel),h.removeEventListener("pointerenter",t.handlePointerEnter),h.removeEventListener("pointerleave",t.handlePointerLeave),h.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.removeEventListener("pointerup",t.handlePointerUp),h.removeEventListener("pointercancel",t.handlePointerCancel),h.removeEventListener("keypress",t.handleKeyPress),h.removeEventListener("keydown",t.handleKeyDown)),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),a.clear()};t.unbindEvents=()=>{p(),r.setContainer(null)},t.handleKeyPress=h=>{let v=g(h);t.keyPressEvent(v)},t.handleKeyDown=h=>{let v=g(h);t.keyDownEvent(v)},t.handleKeyUp=h=>{let v=g(h);t.keyUpEvent(v)},t.handlePointerEnter=h=>{let v={...c(h),position:f(h),deviceType:u(h)};t.pointerEnterEvent(v),v.deviceType==="mouse"&&t.mouseEnterEvent(v)},t.handlePointerLeave=h=>{let v={...c(h),position:f(h),deviceType:u(h)};t.pointerLeaveEvent(v),v.deviceType==="mouse"&&t.mouseLeaveEvent(v)},t.handlePointerDown=h=>{if(!(h.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&kn(h),h.target.hasPointerCapture(h.pointerId)&&h.target.releasePointerCapture(h.pointerId),e.container.setPointerCapture(h.pointerId),a.has(h.pointerId)&&ja("[RenderWindowInteractor] duplicate pointerId detected"),a.set(h.pointerId,{pointerId:h.pointerId,position:f(h)}),h.pointerType){case"pen":case"touch":t.handleTouchStart(h);break;case"mouse":default:t.handleMouseDown(h);break}},t.handlePointerUp=h=>{if(a.has(h.pointerId))switch(e.preventDefaultOnPointerUp&&kn(h),a.delete(h.pointerId),e.container.releasePointerCapture(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerCancel=h=>{if(a.has(h.pointerId))switch(a.delete(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerMove=h=>{if(a.has(h.pointerId)){let v=a.get(h.pointerId);v.position=f(h)}switch(h.pointerType){case"pen":case"touch":t.handleTouchMove(h);break;case"mouse":default:t.handleMouseMove(h);break}},t.handleMouseDown=h=>{let v={...c(h),position:f(h),deviceType:u(h)};switch(h.button){case 0:t.leftButtonPressEvent(v);break;case 1:t.middleButtonPressEvent(v);break;case 2:t.rightButtonPressEvent(v);break;default:Ka(`Unknown mouse button pressed: ${h.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>document.exitPointerLock?.(),t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function d(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=h=>{if(h===void 0){Ka("undefined requester, can not start animating");return}if(n.has(h)){ja("requester is already registered for animating");return}n.add(h),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=h=>{let v=Date.now()+h;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,v),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(h){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(h)){if(!v){let y=h&&h.getClassName?h.getClassName():h;ja(`${y} did not request an animation`)}return}n.delete(h),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(h,v,y)=>{h.inputSources.forEach(C=>{let x=C.gripSpace==null?null:v.getPose(C.gripSpace,y),T=C.gripSpace==null?null:v.getPose(C.targetRaySpace,y),w=C.gamepad,S=C.handedness;if(w){w.index in e.lastGamepadValues||(e.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let M=0;M<w.buttons.length;++M)M in e.lastGamepadValues[w.index][S].buttons||(e.lastGamepadValues[w.index][S].buttons[M]=!1),e.lastGamepadValues[w.index][S].buttons[M]!==w.buttons[M].pressed&&x!=null&&(t.button3DEvent({gamepad:w,position:x.transform.position,orientation:x.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,pressed:w.buttons[M].pressed,device:C.handedness==="left"?$a.LeftController:$a.RightController,input:co[w.mapping]&&co[w.mapping][M]?co[w.mapping][M]:Mr.Trigger}),e.lastGamepadValues[w.index][S].buttons[M]=w.buttons[M].pressed),e.lastGamepadValues[w.index][S].buttons[M]&&x!=null&&t.move3DEvent({gamepad:w,position:x.transform.position,orientation:x.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,device:C.handedness==="left"?$a.LeftController:$a.RightController})}})},t.handleMouseMove=h=>{let v={...c(h),position:f(h),deviceType:u(h)};e.moveTimeoutID===0?t.startMouseMoveEvent(v):(t.mouseMoveEvent(v),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{let h=Date.now();e._animationFrameCount++,h-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(h-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=h,e._animationFrameCount=1),t.animationEvent(),d(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=h=>{kn(h);let v={...Q2(h),...c(h),position:f(h),deviceType:u(h)};e.wheelTimeoutID===0&&(Math.abs(v.spinY)>=.3?s=Math.abs(v.spinY):s=1),v.spinY/=s,e.wheelTimeoutID===0?(t.startMouseWheelEvent(v),t.mouseWheelEvent(v)):(t.mouseWheelEvent(v),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=h=>{let v={...c(h),position:f(h),deviceType:u(h)};switch(h.button){case 0:t.leftButtonReleaseEvent(v);break;case 1:t.middleButtonReleaseEvent(v);break;case 2:t.rightButtonReleaseEvent(v);break;default:Ka(`Unknown mouse button released: ${h.button}`);break}},t.handleTouchStart=h=>{let v=[...a.values()];if(e.recognizeGestures&&v.length>1){let y=Pa(a);if(v.length===2){let C={...c(tn),position:v[0].position,deviceType:u(h)};t.leftButtonReleaseEvent(C)}t.recognizeGesture("TouchStart",y)}else if(v.length===1){let y={...c(tn),position:f(h),deviceType:u(h)};t.leftButtonPressEvent(y)}},t.handleTouchMove=h=>{let v=[...a.values()];if(e.recognizeGestures&&v.length>1){let y=Pa(a);t.recognizeGesture("TouchMove",y)}else if(v.length===1){let y={...c(tn),position:v[0].position,deviceType:u(h)};t.mouseMoveEvent(y)}},t.handleTouchEnd=h=>{let v=[...a.values()];if(e.recognizeGestures)if(v.length===0){let y={...c(tn),position:f(h),deviceType:u(h)};t.leftButtonReleaseEvent(y)}else if(v.length===1){let y=Pa(a);t.recognizeGesture("TouchEnd",y);let C={...c(tn),position:v[0].position,deviceType:u(h)};t.leftButtonPressEvent(C)}else{let y=Pa(a);t.recognizeGesture("TouchMove",y)}else if(v.length===1){let y={...c(tn),position:v[0].position,deviceType:u(h)};t.leftButtonReleaseEvent(y)}},t.setView=h=>{e._view!==h&&(e._view=h,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>e._view?.getRenderable()?.getRenderersByReference()?.[0],t.findPokedRenderer=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;let y=e._view?.getRenderable()?.getRenderers();if(!y||y.length===0)return null;y.sort((S,M)=>S.getLayer()-M.getLayer());let C=null,x=null,T=null,w=y.length;for(;w--;){let S=y[w];if(e._view.isInViewport(h,v,S)&&S.getInteractive()){T=S;break}C===null&&S.getInteractive()&&(C=S),x===null&&e._view.isInViewport(h,v,S)&&(x=S)}return T===null&&(T=C),T===null&&(T=x),T==null&&(T=y[0]),T},t.render=()=>{!t.isAnimating()&&!e.inRender&&d()},uo.forEach(h=>{let v=h.charAt(0).toLowerCase()+h.slice(1);t[`${v}Event`]=y=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){J2(`
          Can not forward events without a current renderer on the interactor.
        `);return}let x={type:h,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...y};t[`invoke${h}`](x)}}),t.recognizeGesture=(h,v)=>{if(Object.keys(v).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),h==="TouchStart"){Object.keys(v).forEach(D=>{e.startingEventPositions[D]=v[D]}),e.currentGesture="Start";return}if(h==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let y=0,C=[],x=[];Object.keys(v).forEach(D=>{C[y]=v[D],x[y]=e.startingEventPositions[D],y++});let T=Math.sqrt((x[0].x-x[1].x)*(x[0].x-x[1].x)+(x[0].y-x[1].y)*(x[0].y-x[1].y)),w=Math.sqrt((C[0].x-C[1].x)*(C[0].x-C[1].x)+(C[0].y-C[1].y)*(C[0].y-C[1].y)),S=_t(Math.atan2(x[1].y-x[0].y,x[1].x-x[0].x)),M=_t(Math.atan2(C[1].y-C[0].y,C[1].x-C[0].x)),E=M-S;M=M+180>=360?M-180:M+180,S=S+180>=360?S-180:S+180,Math.abs(M-S)<Math.abs(E)&&(E=M-S);let R=[];if(R[0]=(C[0].x-x[0].x+C[1].x-x[1].x)/2,R[1]=(C[0].y-x[0].y+C[1].y-x[1].y)/2,h==="TouchMove")if(e.currentGesture==="Start"){let D=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);D<15&&(D=15);let L=Math.abs(w-T),V=w*3.1415926*Math.abs(E)/360,B=Math.sqrt(R[0]*R[0]+R[1]*R[1]);if(L>D&&L>V&&L>B){e.currentGesture="Pinch";let F={scale:1,touches:v};t.startPinchEvent(F)}else if(V>D&&V>B){e.currentGesture="Rotate";let F={rotation:0,touches:v};t.startRotateEvent(F)}else if(B>D){e.currentGesture="Pan";let F={translation:[0,0],touches:v};t.startPanEvent(F)}}else{if(e.currentGesture==="Rotate"){let D={rotation:E,touches:v};t.rotateEvent(D)}if(e.currentGesture==="Pinch"){let D={scale:w/T,touches:v};t.pinchEvent(D)}if(e.currentGesture==="Pan"){let D={translation:R,touches:v};t.panEvent(D)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=h=>{e._forcedRenderer=!!h,e.currentRenderer=h},t.setContainer=h=>{p();let v=r.setContainer(h??null);return v&&l(),v},t.delete=()=>{for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),r.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}var tS={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function dl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tS,r),m.obj(t,e),e._animationExtendedEnd=0,m.event(t,e,"RenderEvent"),uo.forEach(n=>m.event(t,e,n)),m.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),m.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),m.moveToProtected(t,e,["view"]),eS(t,e)}var rS=m.newInstance(dl,"vtkRenderWindowInteractor"),Xa={newInstance:rS,extend:dl,handledEvents:uo,...fo};var{vtkErrorMacro:nS,VOID:aS}=m;function sS(t,e,r,n){return t.getRenderWindow().getViews()[0].worldToDisplay(e,r,n,t)}function iS(t,e,r,n){return t.getRenderWindow().getViews()[0].displayToWorld(e,r,n,t)}var oS={computeWorldToDisplay:sS,computeDisplayToWorld:iS};function fS(t,e){e.classHierarchy.push("vtkInteractorObserver");let r={...t};function n(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function a(){Xa.handledEvents.forEach(s=>{t[`handle${s}`]&&e.subscribedEvents.push(e._interactor[`on${s}`](i=>e.processEvents?t[`handle${s}`](i):aS,e.priority))})}t.setInteractor=s=>{s!==e._interactor&&(n(),e._interactor=s,s&&e.enabled&&a(),t.modified())},t.setEnabled=s=>{s!==e.enabled&&(n(),s&&(e._interactor?a():nS(`
          The interactor must be set before subscribing to events
        `)),e.enabled=s,t.modified())},t.computeDisplayToWorld=(s,i,o,f)=>s?e._interactor.getView().displayToWorld(i,o,f,s):null,t.computeWorldToDisplay=(s,i,o,f)=>s?e._interactor.getView().worldToDisplay(i,o,f,s):null,t.setPriority=s=>{r.setPriority(s)&&e._interactor&&(n(),a())}}var cS={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function yl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cS,r),m.obj(t,e),m.event(t,e,"InteractionEvent"),m.event(t,e,"StartInteractionEvent"),m.event(t,e,"EndInteractionEvent"),m.get(t,e,["_interactor","enabled"]),m.setGet(t,e,["priority","processEvents"]),m.moveToProtected(t,e,["interactor"]),fS(t,e)}var uS=m.newInstance(yl,"vtkInteractorObserver"),xl={newInstance:uS,extend:yl,...oS};var gS={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025},Un={States:gS};var{States:wt}=Un,go={Rotate:wt.IS_ROTATE,Pan:wt.IS_PAN,Spin:wt.IS_SPIN,Dolly:wt.IS_DOLLY,CameraPose:wt.IS_CAMERA_POSE,WindowLevel:wt.IS_WINDOW_LEVEL,Slice:wt.IS_SLICE};function lS(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys(go).forEach(r=>{m.event(t,e,`Start${r}Event`),t[`start${r}`]=()=>{e.state===wt.IS_NONE&&(e.state=go[r],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t[`invokeStart${r}Event`]({type:`Start${r}Event`}))},m.event(t,e,`End${r}Event`),t[`end${r}`]=()=>{e.state===go[r]&&(e.state=wt.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t[`invokeEnd${r}Event`]({type:`End${r}Event`}),e._interactor.render())}}),e.getRenderer=r=>e.focusedRenderer||r.pokedRenderer,t.handleKeyPress=r=>{let n=e._interactor,a=null;switch(r.key){case"r":case"R":e.getRenderer(r).resetCamera(),n.render();break;case"w":case"W":a=e.getRenderer(r).getActors(),a.forEach(s=>{let i=s.getProperty();i.setRepresentationToWireframe&&i.setRepresentationToWireframe()}),n.render();break;case"s":case"S":a=e.getRenderer(r).getActors(),a.forEach(s=>{let i=s.getProperty();i.setRepresentationToSurface&&i.setRepresentationToSurface()}),n.render();break;case"v":case"V":a=e.getRenderer(r).getActors(),a.forEach(s=>{let i=s.getProperty();i.setRepresentationToPoints&&i.setRepresentationToPoints()}),n.render();break}}}var pS={state:wt.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function Tl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pS,r),xl.extend(t,e,r),m.setGet(t,e,["focusedRenderer"]),lS(t,e)}var hS=m.newInstance(Tl,"vtkInteractorStyle"),Sl={newInstance:hS,extend:Tl,...Un};var{States:Et}=Un;function vS(t,e){e.classHierarchy.push("vtkInteractorStyleTrackballCamera"),t.handleMouseMove=r=>{let n=r.position,a=e.getRenderer(r);switch(e.state){case Et.IS_ROTATE:t.handleMouseRotate(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case Et.IS_PAN:t.handleMousePan(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case Et.IS_DOLLY:t.handleMouseDolly(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case Et.IS_SPIN:t.handleMouseSpin(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break}e.previousPosition=n},t.handleButton3D=r=>{if(r&&r.pressed&&r.device===Aa.RightController&&(r.input===en.Trigger||r.input===en.TrackPad)){t.startCameraPose();return}r&&!r.pressed&&r.device===Aa.RightController&&(r.input===en.Trigger||r.input===en.TrackPad)&&e.state===Et.IS_CAMERA_POSE&&t.endCameraPose()},t.handleMove3D=r=>{switch(e.state){case Et.IS_CAMERA_POSE:t.updateCameraPose(r);break}},t.updateCameraPose=r=>{let n=e.getRenderer(r).getActiveCamera(),a=n.getPhysicalTranslation(),i=.5*.05*n.getPhysicalScale(),o=n.physicalOrientationToWorldDirection([r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w]);n.setPhysicalTranslation(a[0]+o[0]*i,a[1]+o[1]*i,a[2]+o[2]*i)},t.handleLeftButtonPress=r=>{let n=r.position;e.previousPosition=n,r.shiftKey?r.controlKey||r.altKey?t.startDolly():t.startPan():r.controlKey||r.altKey?t.startSpin():t.startRotate()},t.handleLeftButtonRelease=()=>{switch(e.state){case Et.IS_DOLLY:t.endDolly();break;case Et.IS_PAN:t.endPan();break;case Et.IS_SPIN:t.endSpin();break;case Et.IS_ROTATE:t.endRotate();break}},t.handleStartMouseWheel=()=>{t.startDolly()},t.handleEndMouseWheel=()=>{t.endDolly()},t.handleStartPinch=r=>{e.previousScale=r.scale,t.startDolly()},t.handleEndPinch=()=>{t.endDolly()},t.handleStartRotate=r=>{e.previousRotation=r.rotation,t.startRotate()},t.handleEndRotate=()=>{t.endRotate()},t.handleStartPan=r=>{e.previousTranslation=r.translation,t.startPan()},t.handleEndPan=()=>{t.endPan()},t.handlePinch=r=>{t.dollyByFactor(e.getRenderer(r),r.scale/e.previousScale),e.previousScale=r.scale},t.handlePan=r=>{let n=e.getRenderer(r).getActiveCamera(),a=n.getFocalPoint();a=t.computeWorldToDisplay(e.getRenderer(r),a[0],a[1],a[2]);let s=a[2],i=r.translation,o=e.previousTranslation,f=t.computeDisplayToWorld(e.getRenderer(r),a[0]+i[0]-o[0],a[1]+i[1]-o[1],s),c=t.computeDisplayToWorld(e.getRenderer(r),a[0],a[1],s),g=[];g[0]=c[0]-f[0],g[1]=c[1]-f[1],g[2]=c[2]-f[2],a=n.getFocalPoint();let u=n.getPosition();n.setFocalPoint(g[0]+a[0],g[1]+a[1],g[2]+a[2]),n.setPosition(g[0]+u[0],g[1]+u[1],g[2]+u[2]),e._interactor.getLightFollowCamera()&&e.getRenderer(r).updateLightsGeometryToFollowCamera(),n.orthogonalizeViewUp(),e.previousTranslation=r.translation},t.handleRotate=r=>{let n=e.getRenderer(r).getActiveCamera();n.roll(r.rotation-e.previousRotation),n.orthogonalizeViewUp(),e.previousRotation=r.rotation},t.handleMouseRotate=(r,n)=>{if(!e.previousPosition)return;let a=e._interactor,s=n.x-e.previousPosition.x,i=n.y-e.previousPosition.y,o=a.getView().getViewportSize(r),f=-.1,c=-.1;o[0]&&o[1]&&(f=-20/o[1],c=-20/o[0]);let g=s*c*e.motionFactor,u=i*f*e.motionFactor,l=r.getActiveCamera();!Number.isNaN(g)&&!Number.isNaN(u)&&(l.azimuth(g),l.elevation(u),l.orthogonalizeViewUp()),e.autoAdjustCameraClippingRange&&r.resetCameraClippingRange(),a.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()},t.handleMouseSpin=(r,n)=>{if(!e.previousPosition)return;let a=e._interactor,s=r.getActiveCamera(),i=a.getView().getViewportCenter(r),o=_t(Math.atan2(e.previousPosition.y-i[1],e.previousPosition.x-i[0])),f=_t(Math.atan2(n.y-i[1],n.x-i[0]))-o;Number.isNaN(f)||(s.roll(f),s.orthogonalizeViewUp())},t.handleMousePan=(r,n)=>{if(!e.previousPosition)return;let a=r.getActiveCamera(),s=a.getFocalPoint();s=t.computeWorldToDisplay(r,s[0],s[1],s[2]);let i=s[2],o=t.computeDisplayToWorld(r,n.x,n.y,i),f=t.computeDisplayToWorld(r,e.previousPosition.x,e.previousPosition.y,i),c=[];c[0]=f[0]-o[0],c[1]=f[1]-o[1],c[2]=f[2]-o[2],s=a.getFocalPoint();let g=a.getPosition();a.setFocalPoint(c[0]+s[0],c[1]+s[1],c[2]+s[2]),a.setPosition(c[0]+g[0],c[1]+g[1],c[2]+g[2]),e._interactor.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()},t.handleMouseDolly=(r,n)=>{if(!e.previousPosition)return;let a=n.y-e.previousPosition.y,i=e._interactor.getView().getViewportCenter(r),o=e.motionFactor*a/i[1];t.dollyByFactor(r,1.1**o)},t.handleMouseWheel=r=>{let n=1-r.spinY/e.zoomFactor;t.dollyByFactor(e.getRenderer(r),n)},t.dollyByFactor=(r,n)=>{if(Number.isNaN(n))return;let a=r.getActiveCamera();a.getParallelProjection()?a.setParallelScale(a.getParallelScale()/n):(a.dolly(n),e.autoAdjustCameraClippingRange&&r.resetCameraClippingRange()),e._interactor.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()}}var dS={motionFactor:10,zoomFactor:10};function Cl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dS,r),Sl.extend(t,e,r),m.setGet(t,e,["motionFactor","zoomFactor"]),vS(t,e)}var yS=m.newInstance(Cl,"vtkInteractorStyleTrackballCamera"),ml={newInstance:yS,extend:Cl};function xS(t){return t}function lo(t){if(t===null||t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;if(!(t===void 0||t==="undefined"))return t[0]==="["&&t[t.length-1]==="]"?t.substring(1,t.length-1).split(",").map(e=>lo(e.trim())):t===""||Number.isNaN(Number(t))?t:Number(t)}function TS(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:window.location.search,r={},n=t?lo:xS;return new URLSearchParams(e).forEach((s,i)=>{i&&(r[i]=s?n(s):!0)}),r}var wl={toNativeType:lo,extractURLParameters:TS};var SS={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ge={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},CS=ge.FLOAT,po={DefaultDataType:CS,DataTypeByteSize:SS,VtkDataTypes:ge};var{vtkErrorMacro:mS}=Ee,{DefaultDataType:wS}=po,ES=1e-6;function ho(t,e,r){let n=t.length,a=Number.MAX_VALUE,s=-Number.MAX_VALUE,i,o;for(o=e;o<n;o+=r)if(!Number.isNaN(t[o])){a=t[o],s=a;break}for(;o<n;o+=r)i=t[o],i<a?a=i:i>s&&(s=i);return{min:a,max:s}}function MS(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add(a){t>a&&(t=a),e<a&&(e=a),r++,n+=a},get(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange(){return{min:t,max:e}}}}function Ml(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){let a=t.length/r,s=new Float64Array(a);for(let i=0,o=0;i<a;++i){for(let f=o+r;o<f;++o)s[i]+=t[o]*t[o];s[i]**=.5}return ho(s,0,1)}return ho(t,e<0?0:e,r)}function El(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=t||[];for(;r.length<=e;)r.push(null);return r}function vo(t){return Object.prototype.toString.call(t).slice(8,-1)}function RS(t){let e=t.getNumberOfComponents(),r=0,n=new Array(e);for(let a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,n);let s=Ae(n,e);s>r&&(r=s)}return r}var OS={computeRange:Ml,createRangeHelper:MS,fastComputeRange:ho,getDataType:vo,getMaxNorm:RS};function DS(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;let a=t.getNumberOfComponents(),s=e.values.length/(a>0?a:1);if(n===s)return!0;if(n>s){let i=e.values;return e.values=kt(e.dataType,(n+s)*a),e.values.set(i),!0}return e.size>n*a&&(e.size=n*a,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.allocate=n=>{r(t.getNumberOfTuples()+n)},t.resize=n=>{r(n);let a=n*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=()=>(t.resize(0),t),t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+a]},t.setComponent=(n,a,s)=>{s!==e.values[n*e.numberOfComponents+a]&&(e.values[n*e.numberOfComponents+a]=s,t.dataChange())},t.getValue=n=>{let a=n/e.numberOfComponents,s=n%e.numberOfComponents;return t.getComponent(a,s)},t.setValue=(n,a)=>{let s=n/e.numberOfComponents,i=n%e.numberOfComponents;t.setComponent(s,i,a)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=n;a<0&&(a=e.numberOfComponents===1?0:e.numberOfComponents);let s=null;return e.ranges||(e.ranges=El(e.ranges,e.numberOfComponents)),s=e.ranges[a],s?(e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple):(s=Ml(t.getData(),n,e.numberOfComponents),e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple)},t.setRange=(n,a)=>{e.ranges||(e.ranges=El(e.ranges,e.numberOfComponents));let s={min:n.min,max:n.max};return e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);let a=[];for(let s=0;s<e.numberOfComponents;s++){let[i,o]=t.getRange(s),f={min:i,max:o};a.push(f)}if(e.numberOfComponents>1){let[s,i]=t.getRange(-1),o={min:s,max:i};a.push(o)}return a},t.setTuple=(n,a)=>{let s=n*e.numberOfComponents;for(let i=0;i<e.numberOfComponents;i++)e.values[s+i]=a[i]},t.setTuples=(n,a)=>{let s=n*e.numberOfComponents,i=Math.min(a.length,e.size-s);for(let o=0;o<i;)e.values[s++]=a[o++]},t.insertTuple=(n,a)=>(e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,a),n),t.insertTuples=(n,a)=>{let s=n+a.length/e.numberOfComponents;return e.size<s*e.numberOfComponents&&(e.size=s*e.numberOfComponents,r(s)),t.setTuples(n,a),s},t.insertNextTuple=n=>{let a=e.size/e.numberOfComponents;return t.insertTuple(a,n)},t.insertNextTuples=n=>{let a=e.size/e.numberOfComponents;return t.insertTuples(a,n)},t.findTuple=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ES;for(let s=0;s<e.size;s+=e.numberOfComponents)if(Math.abs(n[0]-e.values[s])<=a){let i=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(n[o]-e.values[s+o])>a){i=!1;break}if(i)return s/e.numberOfComponents}return-1},t.getTuple=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=e.numberOfComponents||1,i=n*s;switch(s){case 4:a[3]=e.values[i+3];case 3:a[2]=e.values[i+2];case 2:a[1]=e.values[i+1];case 1:a[0]=e.values[i];break;default:for(let o=s-1;o>=0;--o)a[o]=e.values[i+o]}return a},t.getTuples=(n,a)=>{let s=(n??0)*e.numberOfComponents,i=(a??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(s,i);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>Ol({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(n,a)=>{e.values=n,e.size=n.length,e.dataType=vo(n),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;let n={...e,vtkClass:t.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(s=>{n[s]||delete n[s]});let a={};return Object.keys(n).sort().forEach(s=>{a[s]=n[s]}),a.mtime&&delete a.mtime,a},t.deepCopy=n=>{let a=t.getDataType(),s=e.values;t.shallowCopy(n),e.ranges=structuredClone(n.getRanges()),s?.length>=n.getNumberOfValues()&&a===n.getDataType()?(s.set(n.getData()),e.values=s,t.dataChange()):t.setData(n.getData().slice())},t.interpolateTuple=(n,a,s,i,o,f)=>{let c=e.numberOfComponents||1;(c!==a.getNumberOfComponents()||c!==i.getNumberOfComponents())&&mS("numberOfComponents must match");let g=a.getTuple(s),u=i.getTuple(o),l=[];switch(l.length=c,c){case 4:l[3]=g[3]+(u[3]-g[3])*f;case 3:l[2]=g[2]+(u[2]-g[2])*f;case 2:l[1]=g[1]+(u[1]-g[1])*f;case 1:l[0]=g[0]+(u[0]-g[0])*f;break;default:for(let p=0;p<c;p++)l[p]=g[p]+(u[p]-g[p])*f}return t.insertTuple(n,l)}}var LS={name:"",numberOfComponents:1,dataType:wS,rangeTuple:[0,0]};function Rl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,LS,r),Array.isArray(r.values)&&r.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=ua(e.dataType,e.values)):e.values=kt(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=vo(e.values)),ne(t,e),Sr(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");DS(t,e)}var Ol=j(Rl,"vtkDataArray"),P={newInstance:Ol,extend:Rl,...OS,...po};var{vtkErrorMacro:VS}=m;function BS(t,e){let r=0;e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==s&&(e.size=s*i,e.values=m.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(i),t.modified())},t.setPoint=function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),f=1;f<i;f++)o[f-1]=arguments[f];t.setTuple(s,o)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(s,i,o)=>t.insertNextTuple([s,i,o]),t.insertPoint=(s,i)=>t.insertTuple(s,i);let n=t.getBounds;t.getBounds=()=>(r<e.mtime&&t.computeBounds(),n());let a=t.getBoundsByReference;t.getBoundsByReference=()=>(r<e.mtime&&t.computeBounds(),a()),t.computeBounds=()=>{if(t.getNumberOfComponents()===3){let s=t.getRange(0);e.bounds[0]=s[0],e.bounds[1]=s[1];let i=t.getRange(1);e.bounds[2]=i[0],e.bounds[3]=i[1];let o=t.getRange(2);e.bounds[4]=o[0],e.bounds[5]=o[1]}else if(t.getNumberOfComponents()===2){let s=t.getRange(0);e.bounds[0]=s[0],e.bounds[1]=s[1];let i=t.getRange(1);e.bounds[2]=i[0],e.bounds[3]=i[1],e.bounds[4]=0,e.bounds[5]=0}else VS(`getBounds called on an array with components of ${t.getNumberOfComponents()}`),On(e.bounds);r=m.getCurrentGlobalMTime()},t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}var FS={empty:!0,numberOfComponents:3,dataType:ge.FLOAT,bounds:[1,-1,1,-1,1,-1]};function Dl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FS,r),P.extend(t,e,r),m.getArray(t,e,["bounds"],6),BS(t,e)}var kS=m.newInstance(Dl,"vtkPoints"),nt={newInstance:kS,extend:Dl};var{isVtkObject:US}=m;function Ll(t){let e=0;return t.filter((r,n)=>n===e?(e+=r+1,!0):!1)}function Vl(t){let e=0;for(let r=0;r<t.length;)r+=t[r]+1,e++;return e}var NS={extractCellSizes:Ll,getNumberOfCells:Vl};function GS(t,e){e.classHierarchy.push("vtkCellArray");let r={...t};t.getNumberOfCells=n=>(e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=Vl(t.getData())),e.numberOfCells),t.getCellSizes=n=>(e.cellSizes!==void 0&&!n||(e.cellSizes=Ll(t.getData())),e.cellSizes),t.resize=n=>{let a=t.getNumberOfTuples();r.resize(n);let s=t.getNumberOfTuples();s<a&&(s===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=n=>{r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=n=>{let a=n,s=e.values[a++];return e.values.subarray(a,a+s)},t.insertNextCell=n=>{let a;US(n)?a=n.getPointsIds():a=n;let s=t.getNumberOfCells();return t.insertNextTuples([a.length,...a]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(a.length),s},t.getMaxCellSize=()=>t.getCellSizes().reduce((n,a)=>Math.max(n,a),0)}function _S(t){return{empty:!0,numberOfComponents:1,dataType:ge.UNSIGNED_INT,...t}}function Bl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};P.extend(t,e,_S(r)),GS(t,e)}var bS=m.newInstance(Bl,"vtkCellArray"),Nn={newInstance:bS,extend:Bl,...NS};function zS(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;let a=e.points.getData();a.length!==3*e.pointsIds.length&&(a=m.newTypedArray(r.getDataType(),3*e.pointsIds.length));let s=r.getData();e.pointsIds.forEach((i,o)=>{let f=3*i,c=3*o;a[c]=s[f],a[++c]=s[++f],a[++c]=s[++f]}),e.points.setData(a)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(let a=r.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=()=>e.points.getBounds(),t.getLength2=()=>{let r=Z.getLengths(t.getBounds());return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]},t.getParametricDistance=r=>{let n,a=0;for(let s=0;s<3;s++)r[s]<0?n=-r[s]:r[s]>1?n=r[s]-1:n=0,n>a&&(a=n);return a},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=r=>{r.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(r,n,a,s,i,o,f)=>{},t.evaluatePosition=(r,n,a,s,i,o)=>{m.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}var WS={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Fl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WS,r),m.obj(t,e),e.points||(e.points=nt.newInstance()),m.get(t,e,["points","pointsIds"]),zS(t,e)}var HS=m.newInstance(Fl,"vtkCell"),at={newInstance:HS,extend:Fl};function AS(t,e){let r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function $S(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=r=>{let n=r.getPoints().getNumberOfPoints(),a=r.getNumberOfCells(),s=new Uint32Array(n);if(r.isA("vtkPolyData")){for(let i=0;i<a;++i){let{cellPointIds:o}=r.getCellPoints(i);o.forEach(f=>{t.incrementLinkCount(f)})}t.allocateLinks(n),e.maxId=n-1;for(let i=0;i<a;++i){let{cellPointIds:o}=r.getCellPoints(i);o.forEach(f=>{t.insertCellReference(f,s[f]++,i)})}}else{for(let i=0;i<a;i++)at.newInstance().getPointsIds().forEach(f=>{t.incrementLinkCount(f)});t.allocateLinks(n),e.maxId=n-1;for(let i=0;i<a;++i)at.newInstance().getPointsIds().forEach(f=>{t.insertCellReference(f,s[f]++,i)})}},t.allocate=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(()=>({ncells:0,cells:null})),e.extend=n,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=r=>e.array[r],t.getNcells=r=>e.array[r].ncells,t.getCells=r=>e.array[r].cells,t.insertNextPoint=r=>{e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=(r,n)=>{e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=r=>{e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=(r,n)=>{e.array[n].cells=e.array[n].cells.filter(a=>a!==r),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=(r,n)=>{e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=(r,n)=>{e.array[r].cells.length=n},t.squeeze=()=>{AS(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{e.array=[...r.array],e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=r=>{++e.array[r].ncells},t.allocateLinks=r=>{for(let n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=(r,n,a)=>{e.array[r].cells[n]=a}}var jS={array:null,maxId:0,extend:0};function kl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jS,r),m.obj(t,e),$S(t,e)}var KS=m.newInstance(kl,"vtkCellLinks"),Ul={newInstance:KS,extend:kl};var te={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},Ya=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function PS(t){return t<Ya.length?Ya[t]:"UnknownClass"}function XS(t){return Ya.findIndex(t)}function YS(t){return t<te.VTK_QUADRATIC_EDGE||t===te.VTK_CONVEX_POINT_SET||t===te.VTK_POLYHEDRON}function IS(t){return t===te.VTK_TRIANGLE_STRIP||t===te.VTK_POLY_LINE||t===te.VTK_POLY_VERTEX}var qS={getClassNameFromTypeId:PS,getTypeIdFromClassName:XS,isLinear:YS,hasSubCells:IS};function ZS(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=(r,n,a)=>{e.typeArray[r]=n,e.locationArray[r]=a,r>e.maxId&&(e.maxId=r)},t.insertNextCell=(r,n)=>(t.insertCell(++e.maxId,r,n),e.maxId),t.setCellTypes=(r,n,a)=>{e.size=r,e.typeArray=n,e.locationArray=a,e.maxId=r-1},t.getCellLocation=r=>e.locationArray[r],t.deleteCell=r=>{e.typeArray[r]=te.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=r=>{let n=t.getNumberOfTypes();for(let a=0;a<n;++a)if(r===t.getCellType(a))return!0;return!1},t.insertNextType=r=>t.insertNextCell(r,-1),t.getCellType=r=>e.typeArray[r],t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}var QS={size:0,maxId:-1,extend:1e3};function Nl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QS,r),m.obj(t,e),m.get(t,e,["size","maxId","extend"]),m.getArray(t,e,["typeArray","locationArray"]),ZS(t,e)}var JS=m.newInstance(Nl,"vtkCellTypes"),Gl={newInstance:JS,extend:Nl,...qS};var yo={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2},xo={IntersectionState:yo};var{IntersectionState:Ia}=xo;function rn(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a={t:Number.MIN_VALUE,distance:0},s=[],i;s[0]=r[0]-e[0],s[1]=r[1]-e[1],s[2]=r[2]-e[2];let o=s[0]*(t[0]-e[0])+s[1]*(t[1]-e[1])+s[2]*(t[2]-e[2]),f=$(s,s),c=1e-5*o;return f!==0&&(a.t=o/f),c<0&&(c=-c),-c<f&&f<c||f<=0||a.t<0?i=e:a.t>1?i=r:(i=s,s[0]=e[0]+a.t*s[0],s[1]=e[1]+a.t*s[1],s[2]=e[2]+a.t*s[2]),n&&(n[0]=i[0],n[1]=i[1],n[2]=i[2]),a.distance=Le(i,t),a}function _l(t,e,r,n,a,s){let i=[],o=[],f=[];a[0]=0,s[0]=0,xe(e,t,i),xe(n,r,o),xe(r,t,f);let c=[$(i,i),-$(i,o),-$(i,o),$(o,o)],g=[];if(g[0]=$(i,f),g[1]=-$(o,f),Ii(c,g,2)===0){let u=Number.MAX_VALUE,l=[t,e,r,n],p=[r,r,t,t],d=[n,n,e,e];s[0],s[0],a[0],a[0],a[0],a[0],s[0],s[0];let h;for(let v=0;v<4;v++)h=rn(l[v],p[v],d[v]),h.distance<u&&(u=h.distance,h.t);return Ia.ON_LINE}return a[0]=g[0],s[0]=g[1],a[0]>=0&&a[0]<=1&&s[0]>=0&&s[0]<=1?Ia.YES_INTERSECTION:Ia.NO_INTERSECTION}var eC={distanceToLine:rn,intersection:_l};function tC(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=()=>1,t.intersectWithLine=(n,a,s,i,o)=>{let f={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;let c=[],g=[],u=[];e.points.getPoint(0,g),e.points.getPoint(1,u);let l=[],p=[],d=_l(n,a,g,u,l,p);if(f.t=l[0],f.betweenPoints=r(f.t),o[0]=p[0],d===Ia.YES_INTERSECTION){for(let h=0;h<3;h++)i[h]=g[h]+o[0]*(u[h]-g[h]),c[h]=n[h]+f.t*(a[h]-n[h]);if(Le(i,c)<=s*s)return f.intersect=1,f}else{let h;if(f.t<0)return h=rn(n,g,u,i),h.distance<=s*s&&(f.t=0,f.intersect=1,f.betweenPoints=!0),f;if(f.t>1)return h=rn(a,g,u,i),h.distance<=s*s&&(f.t=1,f.intersect=1,f.betweenPoints=!0),f;if(o[0]<0)return o[0]=0,h=rn(g,n,a,i),f.t=h.t,h.distance<=s*s&&(f.intersect=1),f;if(o[0]>1)return o[0]=1,h=rn(u,n,a,i),f.t=h.t,h.distance<=s*s&&(f.intersect=1),f}return f},t.evaluateLocation=(n,a,s)=>{let i=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,o);for(let f=0;f<3;f++)a[f]=i[f]+n[0]*(o[f]-i[f]);s[0]=1-n[0],s[1]=n[0]},t.evaluateOrientation=(n,a,s)=>e.orientations?(Me.slerp(a,e.orientations[0],e.orientations[1],n[0]),s[0]=1-n[0],s[1]=n[0],!0):!1}var rC={orientations:null};function bl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rC,r),at.extend(t,e,r),m.setGet(t,e,["orientations"]),tC(t,e)}var nC=m.newInstance(bl,"vtkLine"),me={newInstance:nC,extend:bl,...eC,...xo};var{vtkErrorMacro:zl,vtkWarningMacro:aC}=m;function sC(t,e){e.classHierarchy.push("vtkFieldData");let r=t.getState;e.arrays&&(e.arrays=e.arrays.map(n=>({data:ze(n.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=n=>{t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(a=>a),e.arrays=n.getArrays().map(a=>({data:a}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=n=>{let a=n.getName(),{array:s,index:i}=t.getArrayWithIndex(a);return s!=null?(e.arrays[i]={data:n},i):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=n=>{let a=e.arrays.findIndex(s=>s.data.getName()===n);return t.removeArrayByIndex(a)},t.removeArrayByIndex=n=>n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1,t.getArrays=()=>e.arrays.map(n=>n.data),t.getArray=n=>typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n),t.getArrayByName=n=>e.arrays.reduce((a,s,i)=>s.data.getName()===n?s.data:a,null),t.getArrayWithIndex=n=>{let a=e.arrays.findIndex(s=>s.data.getName()===n);return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=n=>n>=0&&n<e.arrays.length?e.arrays[n].data:null,t.hasArray=n=>t.getArrayWithIndex(n).index>=0,t.getArrayName=n=>{let a=e.arrays[n];return a?a.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=n=>e.copyFieldFlags[n],t.passData=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(i=>{let o=t.getFlag(i.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&i){let f=t.getArrayByName(i.getName());if(f)if(i.getNumberOfComponents()===f.getNumberOfComponents())if(a>-1&&a<i.getNumberOfTuples()){let c=s>-1?s:a;f.insertTuple(c,i.getTuple(a))}else f.insertTuples(0,i.getTuples());else zl("Unhandled case in passData");else if(a<0||a>i.getNumberOfTuples())t.addArray(i),n.getAttributes(i).forEach(c=>{t.setAttribute(i,c)});else{let c=i.getNumberOfComponents(),g=i.getNumberOfValues(),u=s>-1?s:a;g<=u*c&&(g=(u+1)*c),f=P.newInstance({name:i.getName(),dataType:i.getDataType(),numberOfComponents:c,values:m.newTypedArray(i.getDataType(),g),size:0}),f.insertTuple(u,i.getTuple(a)),t.addArray(f),n.getAttributes(i).forEach(l=>{t.setAttribute(f,l)})}}})},t.interpolateData=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(f=>{let c=t.getFlag(f.getName());if(c!==!1&&!(e.doCopyAllOff&&c!==!0)&&f){let g=t.getArrayByName(f.getName());if(g)if(f.getNumberOfComponents()===g.getNumberOfComponents())if(a>-1&&a<f.getNumberOfTuples()){let u=i>-1?i:a;g.interpolateTuple(u,f,a,f,s,o),aC("Unexpected case in interpolateData")}else g.insertTuples(f.getTuples());else zl("Unhandled case in interpolateData");else if(a<0||s<0||a>f.getNumberOfTuples())t.addArray(f),n.getAttributes(f).forEach(u=>{t.setAttribute(f,u)});else{let u=f.getNumberOfComponents(),l=f.getNumberOfValues(),p=i>-1?i:a;l<=p*u&&(l=(p+1)*u),g=P.newInstance({name:f.getName(),dataType:f.getDataType(),numberOfComponents:u,values:m.newTypedArray(f.getDataType(),l),size:0}),g.interpolateTuple(p,f,a,f,s,o),t.addArray(g),n.getAttributes(f).forEach(d=>{t.setAttribute(g,d)})}}})},t.copyFieldOn=n=>{e.copyFieldFlags[n]=!0},t.copyFieldOff=n=>{e.copyFieldFlags[n]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=n=>{e.arrays=n.getArrays().map(a=>{let s=a.newClone();return s.deepCopy(a),{data:s}})},t.copyFlags=n=>n.getCopyFieldFlags().map(a=>a),t.reset=()=>e.arrays.forEach(n=>n.data.reset()),t.getMTime=()=>e.arrays.reduce((n,a)=>a.data.getMTime()>n?a.data.getMTime():n,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((n,a)=>n+a.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{let n=r();return n&&(n.arrays=e.arrays.map(a=>({data:a.data.getState()}))),n}}var iC={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function Wl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iC,r),m.obj(t,e),sC(t,e)}var oC=m.newInstance(Wl,"vtkFieldData"),Hl={newInstance:oC,extend:Wl};var fC={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},cC={MAX:0,EXACT:1,NOLIMIT:2},uC={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},gC={DUPLICATEPOINT:1,HIDDENPOINT:2},lC={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},pC="vtkGhostType",Gn={DEFAULT:0,SINGLE:1,DOUBLE:2},To={AttributeCopyOperations:lC,AttributeLimitTypes:cC,AttributeTypes:fC,CellGhostTypes:uC,DesiredOutputPrecision:Gn,PointGhostTypes:gC,ghostArrayName:pC};var{AttributeTypes:nr,AttributeCopyOperations:Rr}=To,{vtkWarningMacro:qa}=m;function hC(t,e){let r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(i){let o=r.find(f=>nr[f.toUpperCase()]===i||typeof i!="number"&&f.toLowerCase()===i.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");let a={...t};t.checkNumberOfComponents=i=>!0,t.setAttribute=(i,o)=>{let f=n(o);if(i&&f.toUpperCase()==="PEDIGREEIDS"&&!i.isA("vtkDataArray"))return qa(`Cannot set attribute ${f}. The attribute must be a vtkDataArray.`),-1;if(i&&!t.checkNumberOfComponents(i,f))return qa(`Cannot set attribute ${f}. Incorrect number of components.`),-1;let c=e[`active${f}`];if(c>=0&&c<e.arrays.length){if(e.arrays[c]===i)return c;t.removeArrayByIndex(c)}return i?(c=t.addArray(i),e[`active${f}`]=c):e[`active${f}`]=-1,t.modified(),e[`active${f}`]},t.getAttributes=i=>r.filter(o=>t[`get${o}`]()===i),t.setActiveAttributeByName=(i,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(i).index,o),t.setActiveAttributeByIndex=(i,o)=>{let f=n(o);if(i>=0&&i<e.arrays.length){if(f.toUpperCase()!=="PEDIGREEIDS"){let c=t.getArrayByIndex(i);if(!c.isA("vtkDataArray"))return qa(`Cannot set attribute ${f}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(c,f))return qa(`Cannot set attribute ${f}. Incorrect number of components.`),-1}return e[`active${f}`]=i,t.modified(),i}return i===-1&&(e[`active${f}`]=i,t.modified()),-1},t.getActiveAttribute=i=>{let o=n(i);return t[`get${o}`]()},t.removeAllArrays=()=>{r.forEach(i=>{e[`active${i}`]=-1}),a.removeAllArrays()},t.removeArrayByIndex=i=>(i!==-1&&r.forEach(o=>{i===e[`active${o}`]?e[`active${o}`]=-1:i<e[`active${o}`]&&(e[`active${o}`]-=1)}),a.removeArrayByIndex(i)),r.forEach(i=>{let o=`active${i}`;t[`get${i}`]=()=>t.getArrayByIndex(e[o]),t[`set${i}`]=f=>t.setAttribute(f,i),t[`setActive${i}`]=f=>t.setActiveAttributeByIndex(t.getArrayWithIndex(f).index,i),t[`copy${i}Off`]=()=>{let f=i.toUpperCase();e.copyAttributeFlags[Rr.PASSDATA][nr[f]]=!1},t[`copy${i}On`]=()=>{let f=i.toUpperCase();e.copyAttributeFlags[Rr.PASSDATA][nr[f]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Rr).filter(i=>i!=="ALLCOPY").forEach(i=>{e.copyAttributeFlags[Rr[i]]=Object.keys(nr).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,f)=>(o[nr[f]]=!0,o),[])}),e.copyAttributeFlags[Rr.COPYTUPLE][nr.GLOBALIDS]=!1,e.copyAttributeFlags[Rr.INTERPOLATE][nr.GLOBALIDS]=!1,e.copyAttributeFlags[Rr.COPYTUPLE][nr.PEDIGREEIDS]=!1},t.initialize=m.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(i=>{!e.dataArrays[i].ref&&e.dataArrays[i].type==="vtkDataArray"&&t.addArray(P.newInstance(e.dataArrays[i]))});let s=t.shallowCopy;t.shallowCopy=(i,o)=>{s(i,o),e.arrays=i.getArrays().map(f=>{let c=f.newClone();return c.shallowCopy(f,o),{data:c}})},t.initializeAttributeCopyFlags()}var vC={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Al(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vC,r),Hl.extend(t,e,r),m.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),hC(t,e)}var dC=m.newInstance(Al,"vtkDataSetAttributes"),So={newInstance:dC,extend:Al,...To};var yC={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},xC={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7},$l={FieldDataTypes:yC,FieldAssociations:xC};var _n=["pointData","cellData","fieldData"];function TC(t,e){e.classHierarchy.push("vtkDataSet"),_n.forEach(a=>{e[a]?e[a]=ze(e[a]):e[a]=So.newInstance()}),t.computeBounds=()=>{if(e.modifiedTime&&e.computeTime&&e.modifiedTime>e.computeTime||!e.computeTime){let a=t.getPoints();a?.getNumberOfPoints()?Z.setBounds(e.bounds,a.getBoundsByReference()):e.bounds=Zi.createUninitializedBounds(),e.computeTime=m.getCurrentGlobalMTime()}},t.getLength2=()=>{let a=t.getBoundsByReference();return!a||a.length!==6?0:Z.getDiagonalLength2(a)},t.getLength=()=>Math.sqrt(t.getLength2()),t.getCenter=()=>{let a=t.getBoundsByReference();return!a||a.length!==6?[0,0,0]:Z.getCenter(a)},t.getCellBounds=a=>{let s=t.getCell(a);return s?s.getBounds():Zi.createUninitializedBounds()},t.getBounds=m.chain(()=>t.computeBounds,t.getBounds),t.getBoundsByReference=m.chain(()=>t.computeBounds,t.getBoundsByReference);let r=t.shallowCopy;t.shallowCopy=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(a,s),_n.forEach(i=>{e[i]=So.newInstance(),e[i].shallowCopy(a.getReferenceByName(i))})};let n=t.getMTime;t.getMTime=()=>_n.reduce((a,s)=>Math.max(a,e[s]?.getMTime()??a),n()),t.initialize=()=>(_n.forEach(a=>e[a]?.initialize()),t)}var SC={};function jl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SC,r),m.obj(t,e),m.setGet(t,e,_n),m.getArray(t,e,["bounds"],6),TC(t,e)}var CC=m.newInstance(jl,"vtkDataSet"),Ie={newInstance:CC,extend:jl,...$l};function mC(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=ze(e.points):e.points=nt.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};let r=t.shallowCopy;t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(s,i),e.points=nt.newInstance(),e.points.shallowCopy(s.getPoints())};let n=t.getMTime;t.getMTime=()=>{let s=n();return Math.max(s,e.points?.getMTime()??s)};let a=t.initialize;t.initialize=()=>(e.points?.initialize(),a())}var wC={};function Kl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wC,r),Ie.extend(t,e,r),m.setGet(t,e,["points"]),mC(t,e)}var EC=m.newInstance(Kl,"vtkPointSet"),Pl={newInstance:EC,extend:Kl};function MC(t,e){e.classHierarchy.push("vtkPolyLine");let r=me.newInstance();r.getPoints().setNumberOfPoints(2),t.getCellDimension=()=>1,t.intersectWithLine=(n,a,s,i,o,f,c)=>{let g={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null},u=t.getNumberOfPoints()-1,l=Number.MAX_VALUE;for(let p=0;p<u;p++){let d=[0,0,0];r.getPoints().getData().set(e.points.getData().subarray(3*p,3*(p+2)));let h=r.intersectWithLine(s,i,o,f,c);if(h.intersect===1&&h.t<=g.t+o&&h.t>=n&&h.t<=a){g.intersect=1;let v=r.getParametricDistance(d);if(v<l||v===l&&h.t<g.t){g.subId=p,g.t=h.t,l=v;for(let y=0;y<3;y++)f[y],d[y]}}}return g},t.evaluateLocation=(n,a,s,i)=>(r.getPoints().getData().set(e.points.getData().subarray(3*n,3*(n+2))),r.evaluateLocation(a,s,i)),t.evaluateOrientation=(n,a,s,i)=>(e.orientations?r.setOrientations([e.orientations[n],e.orientations[n+1]]):r.setOrientations(null),r.evaluateOrientation(a,s,i)),t.getDistancesToFirstPoint=()=>{let n=e.distancesTime.getMTime();if(n<e.points.getMTime()||n<t.getMTime()){let a=t.getNumberOfPoints();if(e.distances?e.distances.length=a:e.distances=new Array(a),a>0){let s=new Array(3),i=new Array(3),o=0;e.distances[0]=o,e.points.getPoint(0,s);for(let f=1;f<a;++f)e.points.getPoint(f,i),o+=e.distanceFunction(s,i),e.distances[f]=o,N.copy(s,i)}e.distancesTime.modified()}return e.distances},t.findPointIdAtDistanceFromFirstPoint=n=>{let a=t.getDistancesToFirstPoint();if(a.length<2)return-1;let s=0,i=a.length-1;if(n<a[s]||n>a[i]||a[i]===0)return-1;for(;i-s>1;){let o=Math.floor((s+i)/2);a[o]<=n?s=o:i=o}return s}}var RC={orientations:null,distanceFunction:N.dist};function Xl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RC,r),at.extend(t,e,r),m.setGet(t,e,["orientations","distanceFunction"]),e.distancesTime={},m.obj(e.distancesTime,{mtime:0}),MC(t,e)}var OC=m.newInstance(Xl,"vtkPolyLine"),Yl={newInstance:OC,extend:Xl};function DC(t,e){e.classHierarchy.push("vtkPriorityQueue"),t.push=(r,n)=>{let a=e.elements.findIndex(s=>s.priority>r);e.elements.splice(a,0,{priority:r,element:n})},t.pop=()=>e.elements.length>0?e.elements.shift().element:null,t.deleteById=r=>{e.elements=e.elements.filter(n=>{let{element:a}=n;return a.id!==r})},t.length=()=>e.elements.length}var LC={elements:[]};function Il(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LC,r),m.obj(t,e),DC(t,e)}var VC=m.newInstance(Il,"vtkPriorityQueue"),ql={newInstance:VC,extend:Il};var Co=11920929e-14,Zl=1e-8,ar={FAILURE:-1,OUTSIDE:0,INSIDE:1,INTERSECTION:2,ON_LINE:3};function Ql(t,e,r,n,a){return(n[t]-r[t])*(a[e]-r[e])-(a[t]-r[t])*(n[e]-r[e])}function BC(t,e,r,n){if(t[0]<r[0]||t[0]>r[1]||t[1]<r[2]||t[1]>r[3]||t[2]<r[4]||t[2]>r[5])return ar.OUTSIDE;if(ke(n)<=Co)return ar.FAILURE;let a=Zl*((r[1]-r[0])*(r[1]-r[0])+(r[3]-r[2])*(r[3]-r[2])+(r[5]-r[4])*(r[5]-r[4]));a*=a,a=a===0?Co:a;let s=[],i=[];for(let g=0;g<e.length;){if(s[0]=e[g++],s[1]=e[g++],s[2]=e[g++],Le(t,s)<=a)return ar.INSIDE;let{distance:u,t:l}=me.distanceToLine(t,s,i);if(u<=a&&l>0&&l<1)return ar.INSIDE}let o,f;Math.abs(n[0])>Math.abs(n[1])?Math.abs(n[0])>Math.abs(n[2])?(o=1,f=2):(o=0,f=1):Math.abs(n[1])>Math.abs(n[2])?(o=0,f=2):(o=0,f=1);let c=0;for(let g=0;g<e.length;)s[0]=e[g++],s[1]=e[g++],s[2]=e[g++],g<e.length?(i[0]=e[g],i[1]=e[g+1],i[2]=e[g+2]):(i[0]=e[0],i[1]=e[1],i[2]=e[2]),s[f]<=t[f]?i[f]>t[f]&&Ql(o,f,s,i,t)>0&&++c:i[f]<=t[f]&&Ql(o,f,s,i,t)<0&&--c;return c===0?ar.OUTSIDE:ar.INSIDE}function FC(t,e,r){let n=t.length,a=[];e.getPoint(t[0],a),r[0]=a[0],r[1]=a[0],r[2]=a[1],r[3]=a[1],r[4]=a[2],r[5]=a[2];for(let i=1;i<n;i++)e.getPoint(t[i],a),Z.addPoint(r,...a);let s=Z.getLengths(r);return $(s,s)}function kC(t,e,r){r.length=3,r[0]=0,r[1]=0,r[2]=0;let n=[],a=[],s=[],i=[],o=[];e.getPoint(t[0],n),e.getPoint(t[1],a);for(let f=2;f<t.length;f++){e.getPoint(t[f],s),xe(s,a,i),xe(n,a,o);let c=[0,0,0];Re(i,o,c),bt(r,c,r),[a,s]=[s,a]}return ke(r)}function UC(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];r[0]=0,r[1]=0,r[2]=0;let n=t.length,a=[];for(let s=0;s<n;s++)e.getPoint(t[s],a),r[0]+=a[0],r[1]+=a[1],r[2]+=a[2];return r[0]/=n,r[1]/=n,r[2]/=n,r}var NC={PolygonWithPointIntersectionState:ar,pointInPolygon:BC,getBounds:FC,getNormal:kC,computeCentroid:UC};function GC(t,e){e.classHierarchy.push("vtkPolygon");function r(){let o=[0,0,0],f=[0,0,0];e.normal=[0,0,0];let c=[...e.firstPoint.point],g=e.firstPoint;for(let u=0;u<e.pointCount;u++){xe(g.point,c,o),xe(g.next.point,c,f);let l=[0,0,0];Re(o,f,l),bt(e.normal,l,e.normal),g=g.next}return ke(e.normal)}function n(o){let f=[0,0,0],c=[0,0,0],g=[0,0,0],u=[0,0,0];xe(o.point,o.previous.point,f),xe(o.next.point,o.point,c),xe(o.previous.point,o.next.point,g),Re(f,c,u);let l=$(u,e.normal);if(l<=0)return-1;let p=Ae(f)+Ae(c)+Ae(g);return p*p/l}function a(o){if(e.pointCount<=3)return!0;let f=o.previous,c=o.next,g=[0,0,0];xe(c.point,f.point,g);let u=[0,0,0];if(Re(g,e.normal,u),ke(u),Ae(u)===0)return!1;let l=dt.evaluate(u,f.point,c.next.point),p=l>1e-6?1:l<-1e-6?-1:0,d=p<0?1:0;for(let h=c.next.next;h.id!==f.id;h=h.next){let v=h.previous;l=dt.evaluate(u,f.point,h.point);let y=l>1e-6?1:l<-1e-6?-1:0;if(y!==p){if(d||(d=y<=0?1:0),me.intersection(f.point,c.point,h.point,v.point,[0],[0])===yo.YES_INTERSECTION)return!1;p=y}}return d===1}function s(o,f){e.pointCount-=1;let c=o.previous,g=o.next;e.tris=e.tris.concat(o.point),e.tris=e.tris.concat(g.point),e.tris=e.tris.concat(c.point),c.next=g,g.previous=c,f.deleteById(c.id),f.deleteById(g.id);let u=n(c);u>0&&f.push(u,c);let l=n(g);l>0&&f.push(l,g),o.id===e.firstPoint.id&&(e.firstPoint=g)}function i(){r();let o=ql.newInstance(),f=e.firstPoint;for(let c=0;c<e.pointCount;c++){let g=n(f);g>0&&o.push(g,f),f=f.next}for(;e.pointCount>2&&o.length()>0;)if(e.pointCount===o.length()){let c=o.pop();s(c,o)}else{let c=o.pop();a(c)&&s(c,o)}return e.pointCount<=2}t.triangulate=()=>e.firstPoint?i():null,t.setPoints=o=>{e.pointCount=o.length,e.firstPoint={id:0,point:o[0],next:null,previous:null};let f=e.firstPoint;for(let c=1;c<e.pointCount;c++)f.next={id:c,point:o[c],next:null,previous:f},f=f.next;e.firstPoint.previous=f,f.next=e.firstPoint},t.getPointArray=()=>e.tris}var _C={firstPoint:null,pointCount:0,tris:[]};function Jl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_C,r),m.obj(t,e),GC(t,e)}var bC=m.newInstance(Jl,"vtkPolygon"),e0={newInstance:bC,extend:Jl,...NC};function mo(t,e,r,n){let a=r[0]-e[0],s=r[1]-e[1],i=r[2]-e[2],o=t[0]-e[0],f=t[1]-e[1],c=t[2]-e[2];n[0]=s*c-i*f,n[1]=i*o-a*c,n[2]=a*f-s*o}function bn(t,e,r,n){mo(t,e,r,n);let a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);a!==0&&(n[0]/=a,n[1]/=a,n[2]/=a)}function t0(t){t[0]=-1,t[1]=1,t[2]=0,t[3]=-1,t[4]=0,t[5]=1}function zC(t,e,r,n,a,s){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1,f=[],c=[],g=[],u=[],l=[];bn(t,e,r,u),bn(n,a,s,l);let p=-$(u,t),d=-$(l,n),h=[$(l,t)+d,$(l,e)+d,$(l,r)+d];if(h[0]*h[1]>i&&h[0]*h[2]>i)return{intersect:!1,coplanar:o,pt1:f,pt2:c,surfaceId:g};let v=[$(u,n)+p,$(u,a)+p,$(u,s)+p];if(v[0]*v[1]>i&&v[0]*v[2]>i)return{intersect:!1,coplanar:o,pt1:f,pt2:c,surfaceId:g};if(Math.abs(u[0]-l[0])<1e-9&&Math.abs(u[1]-l[1])<1e-9&&Math.abs(u[2]-l[2])<1e-9&&Math.abs(p-d)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:f,pt2:c,surfaceId:g};let y=[t,e,r],C=[n,a,s],x=$(u,l),T=(p-d*x)/(x*x-1),w=(d-p*x)/(x*x-1),S=[T*u[0]+w*l[0],T*u[1]+w*l[1],T*u[2]+w*l[2]],M=Re(u,l,[]);ke(M);let E=0,R=0,D=[],L=[],V=50,B=50;for(let b=0;b<3;b++){let W=b,G=(b+1)%3,k=dt.intersectWithLine(y[W],y[G],n,l);k.intersection&&k.t>0-i&&k.t<1+i&&(k.t<1+i&&k.t>1-i&&(V=E),D[E++]=$(k.x,M)-$(S,M));let _=dt.intersectWithLine(C[W],C[G],t,u);_.intersection&&_.t>0-i&&_.t<1+i&&(_.t<1+i&&_.t>1-i&&(B=R),L[R++]=$(_.x,M)-$(S,M))}if(E>2){E--;let b=D[2];D[2]=D[V],D[V]=b}if(R>2){R--;let b=L[2];L[2]=L[B],L[B]=b}if(E!==2||R!==2)return{intersect:!1,coplanar:o,pt1:f,pt2:c,surfaceId:g};if(Number.isNaN(D[0])||Number.isNaN(D[1])||Number.isNaN(L[0])||Number.isNaN(L[1]))return{intersect:!1,coplanar:o,pt1:f,pt2:c,surfaceId:g};if(D[0]>D[1]){let b=D[1];D[1]=D[0],D[0]=b}if(L[0]>L[1]){let b=L[1];L[1]=L[0],L[0]=b}let F,z;return D[1]<L[0]||L[1]<D[0]?{intersect:!1,coplanar:o,pt1:f,pt2:c,surfaceId:g}:(D[0]<L[0]?D[1]<L[1]?(g[0]=2,g[1]=1,F=L[0],z=D[1]):(g[0]=2,g[1]=2,F=L[0],z=L[1]):D[1]<L[1]?(g[0]=1,g[1]=1,F=D[0],z=D[1]):(g[0]=1,g[1]=2,F=D[0],z=L[1]),Ra(S,M,F,f),Ra(S,M,z,c),{intersect:!0,coplanar:o,pt1:f,pt2:c,surfaceId:g})}var WC={computeNormalDirection:mo,computeNormal:bn,interpolationDerivs:t0,intersectWithTriangle:zC};function HC(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(r,n,a,s,i)=>{let o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};i[2]=0;let f=[],c=a*a,g=[],u=[],l=[];e.points.getPoint(0,g),e.points.getPoint(1,u),e.points.getPoint(2,l);let p=[],d=[];if(bn(g,u,l,p),p[0]!==0||p[1]!==0||p[2]!==0){let x=dt.intersectWithLine(r,n,g,p);if(o.betweenPoints=x.betweenPoints,o.t=x.t,s[0]=x.x[0],s[1]=x.x[1],s[2]=x.x[2],!x.intersection)return i[0]=0,i[1]=0,o.intersect=0,o;let T=t.evaluatePosition(s,f,i,d);if(T.evaluation>=0)return T.dist2<=c?(o.intersect=1,o):(o.intersect=T.evaluation,o)}let h=Le(g,u),v=Le(u,l),y=Le(l,g);e.line||(e.line=me.newInstance()),h>v&&h>y?(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,u)):v>y&&v>h?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,l)):(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,g));let C=e.line.intersectWithLine(r,n,a,s,i);if(o.betweenPoints=C.betweenPoints,o.t=C.t,C.intersect){let x=[],T=[],w=[];for(let S=0;S<3;S++)x[S]=g[S]-l[S],T[S]=u[S]-l[S],w[S]=s[S]-l[S];return i[0]=$(w,x)/y,i[1]=$(w,T)/v,o.intersect=1,o}return i[0]=0,i[1]=0,o.intersect=0,o},t.evaluatePosition=(r,n,a,s)=>{let i={subId:0,dist2:0,evaluation:-1},o,f,c=[],g=[],u=[],l=[],p,d=[],h=[],v=[],y=0,C=0,x=[],T,w,S,M=[],E=[],R=[],D=[];i.subId=0,a[2]=0,e.points.getPoint(1,c),e.points.getPoint(2,g),e.points.getPoint(0,u),mo(c,g,u,l),dt.generalizedProjectPoint(r,c,l,D);let L=0;for(o=0;o<3;o++)l[o]<0?p=-l[o]:p=l[o],p>L&&(L=p,C=o);for(f=0,o=0;o<3;o++)o!==C&&(x[f++]=o);for(o=0;o<2;o++)d[o]=D[x[o]]-u[x[o]],h[o]=c[x[o]]-u[x[o]],v[o]=g[x[o]]-u[x[o]];if(y=ve(h,v),y===0)return a[0]=0,a[1]=0,i.evaluation=-1,i;if(a[0]=ve(d,v)/y,a[1]=ve(h,d)/y,s[0]=1-(a[0]+a[1]),s[1]=a[0],s[2]=a[1],s[0]>=0&&s[0]<=1&&s[1]>=0&&s[1]<=1&&s[2]>=0&&s[2]<=1)n&&(i.dist2=Le(D,r),n[0]=D[0],n[1]=D[1],n[2]=D[2]),i.evaluation=1;else{let V;if(n){if(s[1]<0&&s[2]<0)for(T=Le(r,u),w=me.distanceToLine(r,c,u,V,E),S=me.distanceToLine(r,u,g,V,R),T<w?(i.dist2=T,M=u):(i.dist2=w,M=E),S<i.dist2&&(i.dist2=S,M=R),o=0;o<3;o++)n[o]=M[o];else if(s[2]<0&&s[0]<0)for(T=Le(r,c),w=me.distanceToLine(r,c,u,V,E),S=me.distanceToLine(r,c,g,V,R),T<w?(i.dist2=T,M=c):(i.dist2=w,M=E),S<i.dist2&&(i.dist2=S,M=R),o=0;o<3;o++)n[o]=M[o];else if(s[1]<0&&s[0]<0)for(T=Le(r,g),w=me.distanceToLine(r,g,u,V,E),S=me.distanceToLine(r,c,g,V,R),T<w?(i.dist2=T,M=g):(i.dist2=w,M=E),S<i.dist2&&(i.dist2=S,M=R),o=0;o<3;o++)n[o]=M[o];else if(s[0]<0){let B=me.distanceToLine(r,c,g,n);i.dist2=B.distance}else if(s[1]<0){let B=me.distanceToLine(r,g,u,n);i.dist2=B.distance}else if(s[2]<0){let B=me.distanceToLine(r,c,u,n);i.dist2=B.distance}}i.evaluation=0}return i},t.evaluateLocation=(r,n,a)=>{let s=[],i=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,i),e.points.getPoint(2,o);let f=1-r[0]-r[1];for(let c=0;c<3;c++)n[c]=s[c]*f+i[c]*r[0]+o[c]*r[1];a[0]=f,a[1]=r[0],a[2]=r[1]},t.getParametricDistance=r=>{let n,a=0,s=[];s[0]=r[0],s[1]=r[1],s[2]=1-r[0]-r[1];for(let i=0;i<3;i++)s[i]<0?n=-s[i]:s[i]>1?n=s[i]-1:n=0,n>a&&(a=n);return a},t.derivatives=(r,n,a,s,i)=>{let o=e.points.getPoint(0),f=e.points.getPoint(1),c=e.points.getPoint(2),g=[],u=[],l=[],p=[];bn(o,f,c,g),xe(f,o,u),xe(c,o,p),Re(g,u,l);let d=ke(u);if(d<=0||ke(l)<=0){for(let w=0;w<s;w++)for(let S=0;S<3;S++)i[w*s+S]=0;return}let h=[0,0],v=[d,0],y=[$(p,u),$(p,l)],C=new Array(6);t0(C);let x=[v[0]-h[0],v[1]-h[1],y[0]-h[0],y[1]-h[1]],T=m.newTypedArray(Fe.Float64Array,4);La(x,T,2);for(let w=0;w<s;w++){let S=0,M=0;for(let D=0;D<3;D++)S+=C[D]*a[s*D+w],M+=C[3+D]*a[s*D+w];let E=S*T[0]+M*T[1],R=S*T[2]+M*T[3];i[3*w]=E*u[0]+R*l[0],i[3*w+1]=E*u[1]+R*l[1],i[3*w+2]=E*u[2]+R*l[2]}},t.cellBoundary=(r,n,a)=>{let s=n[0]-n[1],i=.5*(1-n[0])-n[1],o=2*n[0]+n[1]-1;return s>=0&&i>=0?(a[0]=e.pointsIds[0],a[1]=e.pointsIds[1]):i<0&&o>=0?(a[0]=e.pointsIds[1],a[1]=e.pointsIds[2]):(a[0]=e.pointsIds[2],a[1]=e.pointsIds[0]),!(n[0]<0||n[1]<0||n[0]>1||n[1]>1||1-n[0]-n[1]<0)}}var AC={};function r0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AC,r),at.extend(t,e,r),HC(t,e)}var $C=m.newInstance(r0,"vtkTriangle"),nn={newInstance:$C,extend:r0,...WC};function n0(){return{intersected:!1,subId:-1,x:[0,0,0],pCoords:[0,0,0],t:-1}}function jC(t,e){e.classHierarchy.push("vtkQuad"),t.getCellDimension=()=>2,t.getCellType=()=>te.VTK_QUAD,t.getNumberOfEdges=()=>4,t.getNumberOfFaces=()=>0,t.intersectWithLine=(r,n,a,s,i)=>{let o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1},f,c=e.points.getPoint(0,[]),g=e.points.getPoint(1,[]),u=e.points.getPoint(2,[]),l=e.points.getPoint(3,[]),p=Le(c,u),d=Le(g,l);if(p===d){let S,M=0,E=0;for(let R=0;R<4;R++)S=e.pointsIds[R],S>M&&(M=S,E=R);E===0||E===2?f=0:f=1}else p<d?f=0:f=1;let h=null;e.triangle?h=e.triangle.getPoints():(e.triangle=nn.newInstance(),h=nt.newInstance(),h.setNumberOfPoints(3),e.triangle.initialize(h));let v,y=n0(),C,x=n0(),T,w;switch(f){case 0:h.setPoint(0,...c),h.setPoint(1,...g),h.setPoint(2,...u),v=e.triangle.intersectWithLine(r,n,a,y.x,y.pCoords),h.setPoint(0,...u),h.setPoint(1,...l),h.setPoint(2,...c),C=e.triangle.intersectWithLine(r,n,a,x.x,x.pCoords),T=v.intersect&&C.intersect?v.t<=C.t:v.intersect,w=v.intersect&&C.intersect?C.t<v.t:C.intersect,T?(o=v,s[0]=y.x[0],s[1]=y.x[1],s[2]=y.x[2],i[0]=y.pCoords[0]+y.pCoords[1],i[1]=y.pCoords[1],i[2]=y.pCoords[2]):w&&(o=C,s[0]=x.x[0],s[1]=x.x[1],s[2]=x.x[2],i[0]=1-(x.pCoords[0]+x.pCoords[1]),i[1]=1-x.pCoords[1],i[2]=x.pCoords[2]);break;case 1:h.setPoint(0,...c),h.setPoint(1,...g),h.setPoint(2,...l),v=e.triangle.intersectWithLine(r,n,a,y.x,y.pCoords),h.setPoint(0,...u),h.setPoint(1,...l),h.setPoint(2,...g),C=e.triangle.intersectWithLine(r,n,a,x.x,x.pCoords),T=v.intersect&&C.intersect?v.t<=C.t:v.intersect,w=v.intersect&&C.intersect?C.t<v.t:C.intersect,T?(o=v,s[0]=y.x[0],s[1]=y.x[1],s[2]=y.x[2],i[0]=y.pCoords[0],i[1]=y.pCoords[1],i[2]=y.pCoords[2]):w&&(o=C,s[0]=x.x[0],s[1]=x.x[1],s[2]=x.x[2],i[0]=1-x.pCoords[0],i[1]=1-x.pCoords[1],i[2]=x.pCoords[2]);break}return o},t.interpolationFunctions=(r,n)=>{let a=1-r[0],s=1-r[1];n[0]=a*s,n[1]=r[0]*s,n[2]=r[0]*r[1],n[3]=a*r[1]},t.evaluateLocation=(r,n,a)=>{let s=[];t.interpolationFunctions(r,a),n[0]=0,n[1]=0,n[2]=0;for(let i=0;i<4;i++){e.points.getPoint(i,s);for(let o=0;o<3;o++)n[o]+=s[o]*a[i]}}}var KC={};function a0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KC,r),at.extend(t,e,r),jC(t,e)}var PC=m.newInstance(a0,"vtkQuad"),s0={newInstance:PC,extend:a0};var{vtkErrorMacro:o0}=m;function i0(t){return()=>o0(`vtkTriangleStrip.${t} - NOT IMPLEMENTED`)}function XC(t,e){if(!Array.isArray(t)||t.length<3){o0("decomposeStrip - Invalid points array");return}let r=t[0],n=t[1];for(let a=0;a<t.length-2;a++){let s=t[a+2];a%2?e.insertNextCell([n,r,s]):e.insertNextCell([r,n,s]),r=n,n=s}}var YC={decomposeStrip:XC};function IC(t,e){e.classHierarchy.push("vtkTriangleStrip");let r=t.initialize;t.initialize=(n,a)=>{e.triangle.initialize(n,a),r(n,a)},t.getCellType=()=>te.VTK_TRIANGLE_STRIP,t.getCellDimension=()=>2,t.getNumberOfEdges=()=>e.pointsIds.length,t.getNumberOfFaces=()=>0,t.evaluatePosition=(n,a,s,i,o)=>{let f=[0,0,0],c=Number.MAX_VALUE,g=0,u=[],l=[],p=[];s[2]=0,l[0]=0,l[1]=0,l[2]=0;let d=e.triangle.getPoints();d.setNumberOfPoints(3);let v=e.triangle.getPointsIds().length;for(let y=0;y<v;y++)o[y]=0;for(let y=0;y<v-2;y++){let C=[];d.getPoint(y,C);let x=[];d.getPoint(y+1,x);let T=[];d.getPoint(y+2,T),d.setData(Float32Array.from([...C,...x,...T]),3);let w=e.triangle.evaluatePosition(n,p,f,u),S=w.dist2;w.evaluation>=0&&(S<c||S===c&&g===0)&&(g=w,a&&(a[0]=p[0],a[1]=p[1],a[2]=p[2]),s[0]=f[0],s[1]=f[1],c=S,l[0]=u[0],l[1]=u[1],l[2]=u[2])}return i[0]=c,o[0]=l[0],o[1]=l[1],o[2]=l[2],g},t.evaluateLocation=(n,a,s,i)=>{let o=[[0,1,2],[1,0,2]],f=n%2,c=e.pointsIds.length;for(let d=0;d<c;d++)i[d]=0;let g=1-a[0]-a[1];i[n]=g,i[n+1]=a[0],i[n+2]=a[1];let u=[];e.points.getPoint(n+o[f][0],u);let l=[];e.points.getPoint(n+o[f][1],l);let p=[];e.points.getPoint(n+o[f][2],p);for(let d=0;d<3;d++)s[d]=u[d]*i[n]+l[d]*i[n+1]+p[d]*i[n+2]},t.cellBoundary=(n,a,s)=>{let i=[[0,1,2],[1,0,2]],o=n%2,f=e.triangle.getPointsIds();return f[0]=e.pointsIds[i[o][0]],f[1]=e.pointsIds[i[o][1]],f[2]=e.pointsIds[i[o][2]],e.triangle.cellBoundary(0,a,s)},t.getEdge=n=>{let a,s,i=e.pointsIds.length;return n===0?(a=0,s=1):n===i-1?(a=n-1,s=n):(a=n-1,s=n+1),e.line.getPointsIds()[0]=e.pointsIds[a],e.line.getPointsIds()[1]=e.pointsIds[s],e.line.getPoints().setPoint(0,e.points.getPoint(a)),e.line.getPoints().setPoint(1,e.points.getPoint(s)),e.line},t.intersectWithLine=(n,a,s,i,o)=>{let f=e.pointsIds.length-2,c=e.triangle.getPoints();c.setNumberOfPoints(3);for(let g=0;g<f;g++){let u=[];e.points.getPoint(e.pointsIds[g],u);let l=[];e.points.getPoint(e.pointsIds[g+1],l);let p=[];e.points.getPoint(e.pointsIds[g+2],p),c.setData(Float32Array.from([...u,...l,...p]),3);let d=e.triangle.intersectWithLine(n,a,s,i,o);if(d.intersect)return d}return!1},t.triangulate=()=>{let n=e.points.getNumberOfPoints()-2;e.tris=new Array(3*n);let a=[[0,1,2],[1,0,2]];for(let s=0;s<n;s++){let i=s%2;for(let o=0;o<3;o++)e.tris[s*3+o]=s+a[i][o]}return!0},t.getPointArray=()=>e.tris,t.derivatives=(n,a,s,i,o)=>{let f=[];e.points.getPoint(n,f);let c=[];e.points.getPoint(n+1,c);let g=[];e.points.getPoint(n+2,g);let u=e.triangle.getPoints();u.setPoint(0,...f),u.setPoint(1,...c),u.setPoint(2,...g),e.triangle.derivatives(0,a,s,i,o)},t.getParametricCenter=n=>(n[0]=.333333,n[1]=.333333,n[2]=0,Math.floor((e.pointsIds.length-2)/2)),t.contour=(n,a,s,i,o,f,c,g,u,l,p)=>i0("contour")(),t.clip=(n,a,s,i,o,f,c,g,u,l)=>i0("clip")()}var qC={line:null,triangle:null,tris:null};function f0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qC,r),at.extend(t,e,r),e.line||(e.line=me.newInstance()),e.triangle||(e.triangle=nn.newInstance()),IC(t,e)}var ZC=m.newInstance(f0,"vtkTriangleStrip"),c0={newInstance:ZC,extend:f0,...YC};var Or=["verts","lines","polys","strips"];var{vtkWarningMacro:u0}=m,QC={[te.VTK_LINE]:me,[te.VTK_QUAD]:s0,[te.VTK_POLY_LINE]:me,[te.VTK_TRIANGLE]:nn,[te.VTK_TRIANGLE_STRIP]:c0,[te.VTK_POLY_LINE]:Yl,[te.VTK_POLYGON]:e0};function JC(t,e){e.classHierarchy.push("vtkPolyData");function r(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,o=>o.toUpperCase()).replace(/\s+/g,"")}Or.forEach(i=>{t[`getNumberOf${r(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=ze(e[i]):e[i]=Nn.newInstance()}),t.getNumberOfCells=()=>Or.reduce((i,o)=>i+e[o].getNumberOfCells(),0);let n=t.shallowCopy;t.shallowCopy=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(i,o),Or.forEach(f=>{e[f]=Nn.newInstance(),e[f].shallowCopy(i.getReferenceByName(f))})};let a=t.getMTime;t.getMTime=()=>Or.reduce((i,o)=>Math.max(i,e[o]?.getMTime()??i),a());let s=t.initialize;t.initialize=()=>(Or.forEach(i=>e[i]?.initialize()),s()),t.buildCells=()=>{let i=t.getNumberOfVerts(),o=t.getNumberOfLines(),f=t.getNumberOfPolys(),c=t.getNumberOfStrips(),g=i+o+f+c,u=new Uint8Array(g),l=u,p=new Uint32Array(g),d=p;if(i){let h=0;e.verts.getCellSizes().forEach((v,y)=>{d[y]=h,l[y]=v>1?te.VTK_POLY_VERTEX:te.VTK_VERTEX,h+=v+1}),d=d.subarray(i),l=l.subarray(i)}if(o){let h=0;e.lines.getCellSizes().forEach((v,y)=>{d[y]=h,l[y]=v>2?te.VTK_POLY_LINE:te.VTK_LINE,v===1&&u0("Building VTK_LINE ",y," with only one point, but VTK_LINE needs at least two points. Check the input."),h+=v+1}),d=d.subarray(o),l=l.subarray(o)}if(f){let h=0;e.polys.getCellSizes().forEach((v,y)=>{switch(d[y]=h,v){case 3:l[y]=te.VTK_TRIANGLE;break;case 4:l[y]=te.VTK_QUAD;break;default:l[y]=te.VTK_POLYGON;break}v<3&&u0("Building VTK_TRIANGLE ",y," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),h+=v+1}),d+=d.subarray(f),l+=l.subarray(f)}if(c){let h=0;l.fill(te.VTK_TRIANGLE_STRIP,0,c),e.strips.getCellSizes().forEach((v,y)=>{d[y]=h,h+=v+1})}e.cells=Gl.newInstance(),e.cells.setCellTypes(g,u,p)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=Ul.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{let o=t.getCellType(i),f=null;switch(o){case te.VTK_VERTEX:case te.VTK_POLY_VERTEX:f=e.verts;break;case te.VTK_LINE:case te.VTK_POLY_LINE:f=e.lines;break;case te.VTK_TRIANGLE:case te.VTK_QUAD:case te.VTK_POLYGON:f=e.polys;break;case te.VTK_TRIANGLE_STRIP:f=e.strips;break;default:return f=null,{type:0,cellPointIds:null}}let c=e.cells.getCellLocation(i),g=f.getCell(c);return{cellType:o,cellPointIds:g}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,o,f)=>{let c=e.links.getLink(o),g=e.links.getLink(f);return c.cells.filter(u=>u!==i&&g.cells.indexOf(u)!==-1)},t.getCell=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,f=t.getCellPoints(i),c=o||QC[f.cellType].newInstance();return c.initialize(t.getPoints(),f.cellPointIds),c},t.getMaxCellSize=()=>Or.reduce((i,o)=>Math.max(i,e[o]?.getMaxCellSize?.()??0),0)}var em={};function g0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,em,r),Pl.extend(t,e,r),m.get(t,e,["cells","links"]),m.setGet(t,e,["verts","lines","polys","strips"]),JC(t,e)}var tm=m.newInstance(g0,"vtkPolyData"),Ge={newInstance:tm,extend:g0};var rm={DISPLAY:0,WORLD:1},wo={CoordinateSystem:rm};var{CoordinateSystem:Eo}=wo;function l0(t){return()=>m.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function nm(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let r=e.mtime;for(let n=0;n<e.textures.length;++n){let a=e.textures[n].getMTime();a>r&&(r=a)}return r},t.processSelectorPixelBuffers=(r,n)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=l0("pick"),t.hasKey=l0("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=r=>{e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=r=>{e.estimatedRenderTime+=r},t.setAllocatedRenderTime=r=>{e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=r=>e.textures.indexOf(r)!==-1,t.addTexture=r=>{r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=r=>{let n=e.textures.filter(a=>a!==r);e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(Eo.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(Eo.DISPLAY)}var am={allocatedRenderTime:10,coordinateSystem:Eo.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function p0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,am,r),m.obj(t,e),m.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),m.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),m.moveToProtected(t,e,["parentProp"]),nm(t,e)}var sm=m.newInstance(p0,"vtkProp"),Mt={newInstance:sm,extend:p0,...wo};var im=1e-6;function om(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=n=>{e.position=e.position.map((a,s)=>a+n[s]),t.modified()},t.getOrientationWXYZ=()=>{let n=Me.create();O.getRotation(n,e.rotation);let a=new Float64Array(3),s=Me.getAxisAngle(a,n);return[_t(s),a[0],a[1],a[2]]},t.getOrientationQuaternion=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return O.getRotation(n,e.rotation)},t.rotateX=n=>{n!==0&&(O.rotateX(e.rotation,e.rotation,oe(n)),t.modified())},t.rotateY=n=>{n!==0&&(O.rotateY(e.rotation,e.rotation,oe(n)),t.modified())},t.rotateZ=n=>{n!==0&&(O.rotateZ(e.rotation,e.rotation,oe(n)),t.modified())},t.rotateWXYZ=(n,a,s,i)=>{if(n===0||a===0&&s===0&&i===0)return;let o=oe(n),f=Me.create();Me.setAxisAngle(f,[a,s,i],o);let c=new Float64Array(16);O.fromQuat(c,f),O.multiply(e.rotation,e.rotation,c),t.modified()},t.rotateQuaternion=n=>{if(Math.abs(n[3])>=1-im)return;let a=O.fromQuat(new Float64Array(16),n);O.multiply(e.rotation,e.rotation,a),t.modified()},t.setOrientation=(n,a,s)=>n===e.orientation[0]&&a===e.orientation[1]&&s===e.orientation[2]?!1:(e.orientation=[n,a,s],O.identity(e.rotation),t.rotateZ(s),t.rotateX(n),t.rotateY(a),t.modified(),!0),t.setOrientationFromQuaternion=n=>{let a=O.create();return O.fromQuat(a,n),er(a,e.rotation)?!1:(e.rotation=a,t.modified(),!0)},t.setUserMatrix=n=>er(e.userMatrix,n)?!1:(O.copy(e.userMatrix,n),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){O.identity(e.matrix),e.userMatrix&&O.multiply(e.matrix,e.matrix,e.userMatrix),O.translate(e.matrix,e.matrix,e.origin),O.translate(e.matrix,e.matrix,e.position),O.multiply(e.matrix,e.matrix,e.rotation),O.scale(e.matrix,e.matrix,e.scale),O.translate(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),O.transpose(e.matrix,e.matrix),e.isIdentity=!0;for(let n=0;n<4;++n)for(let a=0;a<4;++a)(n===a?1:0)!==e.matrix[n+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getBoundsByReference=()=>{if(e.mapper===null)return e.bounds;let n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n,e.bounds=[...Z.INIT_BOUNDS],e.boundsMTime.modified(),n;if(!e.mapperBounds||!n.every((a,s)=>n[s]===e.mapperBounds[s])||t.getMTime()>e.boundsMTime.getMTime()){m.vtkDebugMacro("Recomputing bounds..."),e.mapperBounds=n,t.computeMatrix();let a=new Float64Array(16);O.transpose(a,e.matrix),Z.transformBounds(n,a,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBounds=()=>{let n=t.getBoundsByReference();try{return[...n]}catch{return n}},t.getCenter=()=>Z.getCenter(e.bounds),t.getLength=()=>Z.getLength(e.bounds),t.getXRange=()=>Z.getXRange(e.bounds),t.getYRange=()=>Z.getYRange(e.bounds),t.getZRange=()=>Z.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function r(){t.computeMatrix()}t.onModified(r),t.getProperty=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.properties[n]==null&&(e.properties[n]=t.makeProperty?.()),e.properties[n]},t.getProperties=()=>(e.properties.length===0&&(e.properties[0]=t.makeProperty?.()),e.properties),t.setProperty=(n,a)=>{let s=Number.isInteger(n),[i,o]=s?[n,a]:[0,n];return e.properties[i]===o?!1:(e.properties[i]=o,!0)},t.getMTime=()=>{let n=e.mtime;return e.properties.forEach(a=>{if(a!==null){let s=a.getMTime();n=s>n?s:n}}),n}}var fm={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[...Z.INIT_BOUNDS],properties:[],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function h0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fm,r),Mt.extend(t,e,r),e.matrixMTime={},m.obj(e.matrixMTime),m.get(t,e,["isIdentity"]),m.getArray(t,e,["orientation"]),m.setGetArray(t,e,["origin","position","scale"],3),m.setGet(t,e,["properties"]),e.matrix=O.identity(new Float64Array(16)),e.rotation=O.identity(new Float64Array(16)),e.userMatrix=O.identity(new Float64Array(16)),e.transform=null,om(t,e)}var cm=m.newInstance(h0,"vtkProp3D"),v0={newInstance:cm,extend:h0};var d0={FLAT:0,GOURAUD:1,PHONG:2},We={POINTS:0,WIREFRAME:1,SURFACE:2},um=d0,Mo={Shading:d0,Representation:We,Interpolation:um};var{Representation:zn,Interpolation:Wn}=Mo;function y0(t){return()=>m.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function gm(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(r,n,a)=>{Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==a)&&(e.color[0]=r,e.color[1]=n,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=y0("ComputeCompositeColor"),t.getColor=()=>{let r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(let n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=r=>{let n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=y0("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Wn.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Wn.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Wn.PHONG),t.getInterpolationAsString=()=>m.enumToString(Wn,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(zn.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(zn.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(zn.POINTS),t.getRepresentationAsString=()=>m.enumToString(zn,e.representation)}var lm={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Wn.GOURAUD,representation:zn.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function x0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lm,r),m.obj(t,e),m.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),m.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),gm(t,e)}var pm=m.newInstance(x0,"vtkProperty"),ft={newInstance:pm,extend:x0,...Mo};function hm(t,e){e.classHierarchy.push("vtkActor");let r={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let n=e.properties[0].getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.properties[0]||t.getProperty(),!t.getIsOpaque()),t.makeProperty=ft.newInstance,t.getMTime=()=>{let n=r.getMTime();if(e.backfaceProperty!==null){let a=e.backfaceProperty.getMTime();n=a>n?a:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let a=e.mapper.getMTime();n=a>n?a:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),n=a>n?a:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(n,a)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,a)}}var vm={mapper:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1};function T0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vm,r),v0.extend(t,e,r),e.boundsMTime={},m.obj(e.boundsMTime),m.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),hm(t,e)}var dm=m.newInstance(T0,"vtkActor"),ct={newInstance:dm,extend:T0};function ym(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=r=>r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=r=>{let n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=r=>{if(r)if(!Array.isArray(r))t.addClippingPlane(r);else{let n=r.length;for(let a=0;a<n&&a<6;a++)t.addClippingPlane(r[a])}},t.getClippingPlaneInDataCoords=(r,n,a)=>{let s=e.clippingPlanes,i=r;if(s){let o=s.length;if(n>=0&&n<o){let f=s[n],c=f.getNormal(),g=f.getOrigin(),u=c[0],l=c[1],p=c[2],d=-(u*g[0]+l*g[1]+p*g[2]);a[0]=u*i[0]+l*i[4]+p*i[8]+d*i[12],a[1]=u*i[1]+l*i[5]+p*i[9]+d*i[13],a[2]=u*i[2]+l*i[6]+p*i[10]+d*i[14],a[3]=u*i[3]+l*i[7]+p*i[11]+d*i[15];return}}m.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}var xm={clippingPlanes:[]};function Tm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xm,r),m.obj(t,e),m.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),ym(t,e)}var S0={extend:Tm};function Sm(t,e){t.getBounds=()=>(m.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Er()),t.getCenter=()=>{let r=t.getBounds();return e.center=Z.isValid(r)?Z.getCenter(r):null,e.center?.slice()},t.getLength=()=>{let r=t.getBounds();return Z.getDiagonalLength(r)}}var Cm=t=>({bounds:[...Z.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function mm(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cm(r)),S0.extend(t,e,r),m.setGet(t,e,["viewSpecificProperties"]),Sm(t,e)}var C0={extend:mm};var st={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9},Ro={StructuredType:st};var{StructuredType:Ht}=Ro;function wm(t){let e=0;for(let r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?Ht.EMPTY:e===3?Ht.XYZ_GRID:e===2?t[0]===t[1]?Ht.YZ_PLANE:t[2]===t[3]?Ht.XZ_PLANE:Ht.XY_PLANE:e===1?t[0]<t[1]?Ht.X_LINE:t[2]<t[3]?Ht.Y_LINE:Ht.Z_LINE:Ht.SINGLE_POINT}var m0={getDataDescriptionFromExtent:wm,...Ro};var{vtkErrorMacro:Dr}=m;function Em(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Dr("instance deleted - cannot call any method"),!1;for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];let i=a.length===1?a[0]:a;if(i.length!==6)return!1;let o=e.extent.some((f,c)=>f!==i[c]);return o&&(e.extent=i.slice(),e.dataDescription=m0.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let n,a,s;if(e.deleted){Dr("instance deleted - cannot call any method");return}if(arguments.length===1){let i=arguments.length<=0?void 0:arguments[0];n=i[0],a=i[1],s=i[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],a=arguments.length<=1?void 0:arguments[1],s=arguments.length<=2?void 0:arguments[2];else{Dr("Bad dimension specification");return}t.setExtent(0,n-1,0,a-1,0,s-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{let n=t.getDimensions(),a=1;for(let s=0;s<3;s++){if(n[s]===0)return 0;n[s]>1&&(a*=n[s]-1)}return a},t.getNumberOfPoints=()=>{let n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{let a=t.getDimensions();if(a[0]===0||a[1]===0||a[2]===0)return Dr("Requesting a point from an empty image."),null;let s=new Float64Array(3);switch(e.dataDescription){case st.EMPTY:return null;case st.SINGLE_POINT:break;case st.X_LINE:s[0]=n;break;case st.Y_LINE:s[1]=n;break;case st.Z_LINE:s[2]=n;break;case st.XY_PLANE:s[0]=n%a[0],s[1]=n/a[0];break;case st.YZ_PLANE:s[1]=n%a[1],s[2]=n/a[1];break;case st.XZ_PLANE:s[0]=n%a[0],s[2]=n/a[0];break;case st.XYZ_GRID:s[0]=n%a[0],s[1]=n/a[0]%a[1],s[2]=n/(a[0]*a[1]);break;default:Dr("Invalid dataDescription");break}let i=[0,0,0];return t.indexToWorld(s,i),i},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>Z.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>Z.inflate([...e.extent],.5),t.computeTransforms=()=>{O.fromTranslation(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],O.scale(e.indexToWorld,e.indexToWorld,e.spacing),O.invert(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return N.transformMat4(a,n,e.indexToWorld),a},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return N.transformMat4(a,n,e.worldToIndex),a},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Z.transformBounds(n,e.indexToWorld,a)},t.worldToIndexBounds=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Z.transformBounds(n,e.worldToIndex,a)},e._onOriginChanged=t.computeTransforms,e._onDirectionChanged=t.computeTransforms,e._onSpacingChanged=t.computeTransforms,t.computeTransforms(),t.getCenter=()=>Z.getCenter(t.getBounds()),t.computeHistogram=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=[0,0,0,0,0,0];t.worldToIndexBounds(n,s);let i=[0,0,0],o=[0,0,0];Z.computeCornerPoints(s,i,o),Da(i,i),Da(o,o);let f=t.getDimensions();Va(i,[0,0,0],[f[0]-1,f[1]-1,f[2]-1],i),Va(o,[0,0,0],[f[0]-1,f[1]-1,f[2]-1],o);let c=f[0],g=f[0]*f[1],u=t.getPointData().getScalars().getData(),l=-1/0,p=1/0,d=0,h=0,v=0;for(let T=i[2];T<=o[2];T++)for(let w=i[1];w<=o[1];w++){let S=i[0]+w*c+T*g;for(let M=i[0];M<=o[0];M++){if(!a||a([M,w,T],s)){let E=u[S];E>l&&(l=E),E<p&&(p=E),d+=E*E,h+=E,v+=1}++S}}let y=v>0?h/v:0,C=v?Math.abs(d/v-y*y):0,x=Math.sqrt(C);return{minimum:p,maximum:l,average:y,variance:C,sigma:x,count:v}},t.computeIncrements=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=[],i=a;for(let o=0;o<3;++o)s[o]=i,i*=n[o*2+1]-n[o*2]+1;return s},t.computeOffsetIndex=n=>{let[a,s,i]=n,o=t.getExtent(),f=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(o,f);return Math.floor((Math.round(a)-o[0])*c[0]+(Math.round(s)-o[2])*c[1]+(Math.round(i)-o[4])*c[2])},t.getOffsetIndexFromWorld=n=>{let a=t.getExtent(),s=t.worldToIndex(n);for(let i=0;i<3;++i)if(s[i]<a[i*2]||s[i]>a[i*2+1])return Dr(`GetScalarPointer: Pixel ${s} is not in memory. Current extent = ${a}`),NaN;return t.computeOffsetIndex(s)},t.getScalarValueFromWorld=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=t.getPointData().getScalars().getNumberOfComponents();if(a<0||a>=s)return Dr(`GetScalarPointer: Scalar Component ${a} is not within bounds. Current Scalar numberOfComponents: ${s}`),NaN;let i=t.getOffsetIndexFromWorld(n);return Number.isNaN(i)?i:t.getPointData().getScalars().getComponent(i,a)};let r=t.initialize;t.initialize=()=>(t.set({direction:Se.identity(e.direction),spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:st.EMPTY}),r())}var Mm={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:st.EMPTY};function w0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mm,r),Ie.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Se.identity(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),m.get(t,e,["indexToWorld","worldToIndex"]),m.setGetArray(t,e,["origin","spacing"],3),m.setGetArray(t,e,["direction"],9),m.getArray(t,e,["extent"],6),Em(t,e)}var Rm=m.newInstance(w0,"vtkImageData"),E0={newInstance:Rm,extend:w0};var Om={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},Qa={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},Dm={LINEAR:0,LOG10:1},Hn={VectorMode:Om,ScalarMappingTarget:Qa,Scale:Dm};var Lm={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},Vm={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},Bm={BY_ID:0,BY_NAME:1},An={ColorMode:Lm,GetArray:Bm,ScalarMode:Vm};var{ScalarMappingTarget:M0,Scale:Fm,VectorMode:Rt}=Hn,{VtkDataTypes:sr}=P,{ColorMode:Ja}=An,{vtkErrorMacro:R0}=m;function km(t){return t}function O0(t){return Math.floor(t*255+.5)}function Um(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(Rt.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(Rt.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(Rt.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(r,n)=>{if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){R0("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r){let a=n.length;for(let s=0;s<a;s++)e.annotationArray.push({value:r[s],annotation:String(n[s])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(r,n)=>{let a=t.checkForAnnotatedValue(r),s=!1;return a>=0?e.annotationArray[a].annotation!==n&&(e.annotationArray[a].annotation=n,s=!0):(e.annotationArray.push({value:r,annotation:n}),a=e.annotationArray.length-1,s=!0),s&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=r=>r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value,t.getAnnotation=r=>e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation,t.getAnnotatedValueIndex=r=>e.annotationArray.length?t.checkForAnnotatedValue(r):-1,t.removeAnnotation=r=>{let n=t.checkForAnnotatedValue(r),a=n>=0;return a&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(r,n)=>{if(e.indexedLookup){let a=t.getAnnotatedValueIndex(r);t.getIndexedColor(a,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=r=>t.getAnnotatedValueIndexInternal(r),t.getAnnotatedValueIndexInternal=r=>{if(e.annotatedValueMap[r]!==void 0){let n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=(r,n)=>{n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];let r=e.annotationArray.length;for(let n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=(r,n,a)=>{let s=r.getNumberOfComponents(),i=null;if(n===Ja.DEFAULT&&(r.getDataType()===sr.UNSIGNED_CHAR||r.getDataType()===sr.UNSIGNED_CHAR_CLAMPED)||n===Ja.DIRECT_SCALARS&&r)i=t.convertToRGBA(r,s,r.getNumberOfTuples());else{let o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:sr.UNSIGNED_CHAR},f=m.newTypedArray(o.dataType,4*r.getNumberOfTuples());o.values=f,o.size=f.length,i=P.newInstance(o);let c=a;c<0&&s>1?t.mapVectorsThroughTable(r,i,M0.RGBA,-1,-1):(c<0&&(c=0),c>=s&&(c=s-1),t.mapScalarsThroughTable(r,i,M0.RGBA,c))}return i},t.mapVectorsToMagnitude=(r,n,a)=>{let s=r.getNumberOfTuples(),i=r.getNumberOfComponents(),o=n.getData(),f=r.getData();for(let c=0;c<s;c++){let g=0;for(let u=0;u<a;u++)g+=f[c*i+u]*f[c*i+u];o[c]=Math.sqrt(g)}},t.mapVectorsThroughTable=(r,n,a,s,i)=>{let o=t.getVectorMode(),f=i,c=s,g=r.getNumberOfComponents();o===Rt.COMPONENT?(c===-1&&(c=t.getVectorComponent()),c<0&&(c=0),c>=g&&(c=g-1)):(f===-1&&(f=t.getVectorSize()),f<=0?(c=0,f=g):(c<0&&(c=0),c>=g&&(c=g-1),c+f>g&&(f=g-c)),o===Rt.MAGNITUDE&&(g===1||f===1)&&(o=Rt.COMPONENT));let u=0;switch(c>0&&(u=c),o){case Rt.COMPONENT:{t.mapScalarsThroughTable(r,n,a,u);break}case Rt.RGBCOLORS:break;case Rt.MAGNITUDE:default:{let l=P.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,l,f),t.mapScalarsThroughTable(l,n,a,0);break}}},t.luminanceToRGBA=(r,n,a,s)=>{let i=s(a),o=n.getData(),f=r.getData(),c=o.length,g=0,u=1,l=0;for(let p=g;p<c;p+=u){let d=s(o[p]);f[l*4]=d,f[l*4+1]=d,f[l*4+2]=d,f[l*4+3]=i,l++}},t.luminanceAlphaToRGBA=(r,n,a,s)=>{let i=n.getData(),o=r.getData(),f=i.length,c=0,g=2,u=0;for(let l=c;l<f;l+=g){let p=s(i[l]);o[u]=p,o[u+1]=p,o[u+2]=p,o[u+3]=s(i[l+1])*a,u+=4}},t.rGBToRGBA=(r,n,a,s)=>{let i=O0(a),o=n.getData(),f=r.getData(),c=o.length,g=0,u=3,l=0;for(let p=g;p<c;p+=u)f[l*4]=s(o[p]),f[l*4+1]=s(o[p+1]),f[l*4+2]=s(o[p+2]),f[l*4+3]=i,l++},t.rGBAToRGBA=(r,n,a,s)=>{let i=n.getData(),o=r.getData(),f=i.length,c=0,g=4,u=0;for(let l=c;l<f;l+=g)o[u*4]=s(i[l]),o[u*4+1]=s(i[l+1]),o[u*4+2]=s(i[l+2]),o[u*4+3]=s(i[l+3])*a,u++},t.convertToRGBA=(r,n,a)=>{let{alpha:s}=e;if(n===4&&s>=1&&r.getDataType()===sr.UNSIGNED_CHAR)return r;let i=P.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:sr.UNSIGNED_CHAR});if(a<=0)return i;s=s>0?s:0,s=s<1?s:1;let o=km;switch((r.getDataType()===sr.FLOAT||r.getDataType()===sr.DOUBLE)&&(o=O0),n){case 1:t.luminanceToRGBA(i,r,s,o);break;case 2:t.luminanceAlphaToRGBA(i,r,o);break;case 3:t.rGBToRGBA(i,r,s,o);break;case 4:t.rGBAToRGBA(i,r,s,o);break;default:return R0("Cannot convert colors"),null}return i},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(r,n)=>t.setMappingRange(r,n),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(r,n,a)=>{if(!r)return t.isOpaque();let s=r.getNumberOfComponents();return n===Ja.DEFAULT&&r.getDataType()===sr.UNSIGNED_CHAR||n===Ja.DIRECT_SCALARS?s===3||s===1?e.alpha>=1:r.getRange(s-1)[0]===255:!0}}var Nm={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Rt.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:Fm.LINEAR};function D0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nm,r),m.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],m.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),m.setArray(t,e,["mappingRange"],2),m.getArray(t,e,["mappingRange"]),Um(t,e)}var Gm=m.newInstance(D0,"vtkScalarsToColors"),Lr={newInstance:Gm,extend:D0,...Hn};var{vtkErrorMacro:L0}=m,V0=0,B0=1,Oo=2;function _m(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(let n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(r,n)=>{let a=0,s=Number(r);return s<n.range[0]?a=n.maxIndex+V0+1.5:s>n.range[1]?a=n.maxIndex+B0+1.5:(a=(s+n.shift)*n.scale,a=a<n.maxIndex?a:n.maxIndex),Math.floor(a)},t.linearLookup=(r,n,a)=>{let s=0;wr(r)?s=Math.floor(a.maxIndex+1.5+Oo):s=t.linearIndexLookup(r,a);let i=4*s;return n.slice(i,i+4)},t.indexedLookupFunction=(r,n,a)=>{let s=t.getAnnotatedValueIndexInternal(r);s===-1&&(s=e.numberOfColors+Oo);let i=4*s;return[n[i],n[i+1],n[i+2],n[i+3]]},t.lookupShiftAndScale=(r,n)=>{n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=(r,n,a,s)=>{let i=t.linearLookup;e.indexedLookup&&(i=t.indexedLookupFunction);let o=t.getMappingRange(),f={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,f);let c=t.getAlpha(),g=r.getNumberOfTuples(),u=r.getNumberOfComponents(),l=n.getData(),p=r.getData();if(c>=1){if(a===Qa.RGBA)for(let d=0;d<g;d++){let h=i(p[d*u+s],e.table,f);l[d*4]=h[0],l[d*4+1]=h[1],l[d*4+2]=h[2],l[d*4+3]=h[3]}}else if(a===Qa.RGBA)for(let d=0;d<g;d++){let h=i(p[d*u+s],e.table,f);l[d*4]=h[0],l[d*4+1]=h[1],l[d*4+2]=h[2],l[d*4+3]=Math.floor(h[3]*c+.5)}},t.forceBuild=()=>{let r=0,n=0,a=0,s=0,i=e.numberOfColors-1;i&&(r=(e.hueRange[1]-e.hueRange[0])/i,n=(e.saturationRange[1]-e.saturationRange[0])/i,a=(e.valueRange[1]-e.valueRange[0])/i,s=(e.alphaRange[1]-e.alphaRange[0])/i),e.table.length=4*i+16;let o=[],f=[];for(let c=0;c<=i;c++)o[0]=e.hueRange[0]+c*r,o[1]=e.saturationRange[0]+c*n,o[2]=e.valueRange[0]+c*a,zt(o,f),f[3]=e.alphaRange[0]+c*s,e.table[c*4]=f[0]*255+.5,e.table[c*4+1]=f[1]*255+.5,e.table[c*4+2]=f[2]*255+.5,e.table[c*4+3]=f[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=r=>{if(Array.isArray(r)){let a=r[0].length;e.numberOfColors=r.length;let s=4-a,i=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<r.length;o++){let f=r[o];for(let c=0;c<a;c++)e.table[i++]=f[c];i+=s}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(r.getNumberOfComponents()!==4)return L0("Expected 4 components for RGBA colors"),!1;if(r.getDataType()!==ge.UNSIGNED_CHAR)return L0("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=r.getNumberOfTuples();let n=r.getData();e.table.length=n.length;for(let a=0;a<n.length;a++)e.table[a]=n[a];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{let{numberOfColors:r}=e,n=e.table,a=(r+V0)*4;e.useBelowRangeColor||r===0?(n[a]=e.belowRangeColor[0]*255+.5,n[a+1]=e.belowRangeColor[1]*255+.5,n[a+2]=e.belowRangeColor[2]*255+.5,n[a+3]=e.belowRangeColor[3]*255+.5):(n[a]=n[0],n[a+1]=n[1],n[a+2]=n[2],n[a+3]=n[3]),a=(r+B0)*4,e.useAboveRangeColor||r===0?(n[a]=e.aboveRangeColor[0]*255+.5,n[a+1]=e.aboveRangeColor[1]*255+.5,n[a+2]=e.aboveRangeColor[2]*255+.5,n[a+3]=e.aboveRangeColor[3]*255+.5):(n[a]=n[4*(r-1)+0],n[a+1]=n[4*(r-1)+1],n[a+2]=n[4*(r-1)+2],n[a+3]=n[4*(r-1)+3]),a=(r+Oo)*4,n[a]=e.nanColor[0]*255+.5,n[a+1]=e.nanColor[1]*255+.5,n[a+2]=e.nanColor[2]*255+.5,n[a+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}var bm={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function F0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bm,r),Lr.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},m.obj(e.buildTime),e.opaqueFlagBuildTime={},m.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},m.obj(e.insertTime,{mtime:0}),m.get(t,e,["buildTime"]),m.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),m.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),m.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),m.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),_m(t,e)}var zm=m.newInstance(F0,"vtkLookupTable"),k0={newInstance:zm,extend:F0};var yt={Off:0,PolygonOffset:1},Do=yt.PolygonOffset,es=yt.Off,Wm=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function Hm(){return Do}function Am(t){let e=Do===t;return Do=t,e}function $m(){return es}function ts(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=es===t;return es=t,e}function jm(){return ts(yt.Off)}function Km(){return ts(yt.Off)}function Pm(){return ts(yt.PolygonOffset)}function Xm(){return Wm[es]}var rs={Resolve:yt,getResolveCoincidentTopologyAsString:Xm,getResolveCoincidentTopologyPolygonOffsetFaces:Hm,getResolveCoincidentTopology:$m,setResolveCoincidentTopology:ts,setResolveCoincidentTopologyPolygonOffsetFaces:Am,setResolveCoincidentTopologyToDefault:jm,setResolveCoincidentTopologyToOff:Km,setResolveCoincidentTopologyToPolygonOffset:Pm};function U0(t,e,r){r.forEach(n=>{t[`get${n.method}`]=()=>e[n.key],t[`set${n.method}`]=m.objectSetterMap.object(t,e,{name:n.key,params:["factor","offset"]})})}var Lo=["Polygon","Line","Point"],Ym={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},Im=()=>{},Vr={modified:Im};U0(Vr,Ym,Lo.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function qm(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),m.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(rs).forEach(r=>{t[r]=rs[r]}),Object.keys(Vr).filter(r=>r!=="modified").forEach(r=>{t[r]=Vr[r]}),U0(t,e.topologyOffset,Lo.map(r=>({key:r,method:`RelativeCoincidentTopology${r}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{let r=Vr.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{let r=Vr.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{let r=Vr.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var Vo={implementCoincidentTopologyMethods:qm,staticOffsetAPI:Vr,otherStaticMethods:rs,CATEGORIES:Lo,Resolve:yt};var _e={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3},Bo={PassTypes:_e};var{FieldAssociations:N0}=Ie,{staticOffsetAPI:Zm,otherStaticMethods:Qm}=Vo,{ColorMode:ns,ScalarMode:Br,GetArray:Fo}=An,{VectorMode:Jm}=Hn,{VtkDataTypes:ew}=P;function $n(t){return()=>m.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function tw(t,e){let r=t[1]%2===0?1:-1;if(t[0]+=r,t[0]>=e[0]||t[0]<0){let n=t[2]%2===0?1:-1;t[0]-=r,t[1]+=n,(t[1]>=e[1]||t[1]<0)&&(t[1]-=n,t[2]++)}}function rw(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function G0(t,e,r){let n=Math.floor(e),a=n%(2*r[0]),s,i;a<r[0]?(t[0]=a,s=1,i=t[0]===r[0]-1):(t[0]=2*r[0]-1-a,s=-1,i=t[0]===0);let o=Math.floor(n/r[0]),f=o%(2*r[1]),c,g;f<r[1]?(t[1]=f,c=1,g=t[1]===r[1]-1):(t[1]=2*r[1]-1-f,c=-1,g=t[1]===0),t[2]=Math.floor(o/r[1]);let u=e-n;i?g?t[2]+=u:t[1]+=c*u:t[0]+=s*u,t[0]=(t[0]+.5)/r[0],t[1]=(t[1]+.5)/r[1],t[2]=(t[2]+.5)/r[2]}var _0=new WeakMap;function nw(t,e,r,n,a,s,i){let o=new Array(arguments.length);for(let V=0;V<arguments.length;++V){let B=arguments[V];o[V]=B.getMTime?.()??B}let f=o.join("/"),c=_0.get(t);if(c&&c.stringHash===f)return c.textureCoordinates;let g=(r[1]-r[0])/(a-1),[u,l]=[r[0]-g,r[1]+g],p=u-.5*g,d=1/(l-u+g),h=u,v=(a+1)/(l-u),y=t.getData(),C=t.getNumberOfTuples(),x=t.getNumberOfComponents(),T=e<0||e>=x,w=s[2]<=1?2:3,S=P.newInstance({numberOfComponents:w,values:new Float32Array(C*w)}),M=S.getData(),E=[0,0,0];G0(E,a+2,s);let R=0,D=0,L=[.5,.5,.5];for(let V=0;V<C;++V){let B;if(T){let F=0;for(let z=0;z<x;++z){let b=Number(y[R+z]);F+=b*b}B=Math.sqrt(F)}else B=Number(y[R+e]);if(n&&(B=Math.log10(B)),R+=x,wr(B))L[0]=E[0],L[1]=E[1],L[2]=E[2];else if(i){let F=(B-h)*v;F<1?F=0:F>a&&(F=a+1),G0(L,F,s)}else{L[1]=.49;let F=(B-p)*d;F>1e3?L[0]=1e3:F<-1e3?L[0]=-1e3:L[0]=F}for(let F=0;F<w;++F)M[D++]=L[F]}return _0.set(t,{stringHash:f,textureCoordinates:S}),S}function aw(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{let r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=Er(),e.bounds},t.setForceCompileOnly=r=>{e.forceCompileOnly=r},t.setSelectionWebGLIdsToVTKIds=r=>{e.selectionWebGLIdsToVTKIds=r},t.createDefaultLookupTable=()=>{e.lookupTable=k0.newInstance()},t.getColorModeAsString=()=>m.enumToString(ns,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>m.enumToString(Br,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,a,s,i)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,f=!1;if(n===Br.DEFAULT)o=r.getPointData().getScalars(),o||(o=r.getCellData().getScalars(),f=!0);else if(n===Br.USE_POINT_DATA)o=r.getPointData().getScalars();else if(n===Br.USE_CELL_DATA)o=r.getCellData().getScalars(),f=!0;else if(n===Br.USE_POINT_FIELD_DATA){let c=r.getPointData();a===Fo.BY_ID?o=c.getArrayByIndex(s):o=c.getArrayByName(i)}else if(n===Br.USE_CELL_FIELD_DATA){let c=r.getCellData();f=!0,a===Fo.BY_ID?o=c.getArrayByIndex(s):o=c.getArrayByName(i)}else if(n===Br.USE_FIELD_DATA){let c=r.getFieldData();a===Fo.BY_ID?o=c.getArrayByIndex(s):o=c.getArrayByName(i)}return{scalars:o,cellFlag:f}},t.mapScalars=(r,n)=>{let{scalars:a,cellFlag:s}=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=s,!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}let i=`${t.getMTime()}${a.getMTime()}${n}`;if(e.colorBuildString!==i){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(a,s))e.mapScalarsToTexture(a,s,n);else{e.colorCoordinates=null,e.colorTextureMap=null;let o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${a.getMTime()}${n}`}},e.mapScalarsToTexture=(r,n,a)=>{let s=e.lookupTable.getRange(),i=e.lookupTable.usingLogScale(),o=e.lookupTable.getAlpha(),f=i?[Math.log10(s[0]),Math.log10(s[1])]:s;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==a){e.lookupTable.setAlpha(a),e.colorTextureMap=null,e.lookupTable.build();let g=e.lookupTable.getNumberOfAvailableColors(),u=2048,l=u**3-3,d=4096-2,h=2,v=n?l:d;e.numberOfColorsInRange=Math.min(Math.max(g,h),v);let y=e.numberOfColorsInRange+3,C=e.numberOfColorsInRange+2,x=n?[Math.min(Math.ceil(y/u**0),u),Math.min(Math.ceil(y/u**1),u),Math.min(Math.ceil(y/u**2),u)]:[C,2,1],T=x[0]*x[1]*x[2],w=new Float64Array(T);w.fill(NaN);let S=e.numberOfColorsInRange,M=S+2,E=[0,0,0],R=f[0],D=f[1]-f[0];for(let B=0;B<M;++B){let F=rw(E,x),z=R+D*(B-1)/(S-1),b=i?10**z:z;w[F]=b,tw(E,x)}let L=P.newInstance({numberOfComponents:1,values:w}),V=e.lookupTable.mapScalars(L,e.colorMode,0);e.colorTextureMap=E0.newInstance(),e.colorTextureMap.setDimensions(x),e.colorTextureMap.getPointData().setScalars(V),e.lookupTable.setAlpha(o)}let c=e.lookupTable.getVectorMode()===Jm.MAGNITUDE&&r.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=nw(r,c,f,i,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),n)},t.getIsOpaque=()=>{let r=t.getInputData(),a=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||a==null)return!0;let s=t.getLookupTable();return s?(s.build(),s.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(r,n)=>n&&e.colorMode!==ns.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!r||e.colorMode===ns.DEFAULT&&r.getDataType()===ew.UNSIGNED_CHAR||e.colorMode===ns.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){let n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=()=>{let r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=$n("AcquireInvertibleLookupTable"),t.valueToColor=$n("ValueToColor"),t.colorToValue=$n("ColorToValue"),t.useInvertibleColorFor=$n("UseInvertibleColorFor"),t.clearInvertibleColor=$n("ClearInvertibleColor"),t.processSelectorPixelBuffers=(r,n)=>{if(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;let a=r.getRawPixelBuffer(_e.ID_LOW24),s=r.getRawPixelBuffer(_e.ID_HIGH24),i=r.getCurrentPass(),o=r.getFieldAssociation(),f=null;o===N0.FIELD_ASSOCIATION_POINTS?f=e.selectionWebGLIdsToVTKIds.points:o===N0.FIELD_ASSOCIATION_CELLS&&(f=e.selectionWebGLIdsToVTKIds.cells),f&&n.forEach(c=>{if(i===_e.ID_LOW24){let g=0;s&&(g+=s[c],g*=256),g+=a[c+2],g*=256,g+=a[c+1],g*=256,g+=a[c];let u=f[g],l=r.getPixelBuffer(_e.ID_LOW24);l[c]=u&255,l[c+1]=(u&65280)>>8,l[c+2]=(u&16711680)>>16}else if(i===_e.ID_HIGH24&&s){let g=0;g+=s[c],g*=256,g+=a[c+2],g*=256,g+=a[c+1],g*=256,g+=a[c];let u=f[g],l=r.getPixelBuffer(_e.ID_HIGH24);l[c]=(u&4278190080)>>24}})}}var sw={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function b0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sw,r),C0.extend(t,e,r),m.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),m.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),m.setGetArray(t,e,["scalarRange"],2),Vo.implementCoincidentTopologyMethods(t,e),aw(t,e)}var iw=m.newInstance(b0,"vtkMapper"),qe={newInstance:iw,extend:b0,...Zm,...Qm,...An};var X0=xn(ai(),1);var ow={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},as={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},ko={Wrap:ow,Filter:as};var z0=new Float32Array(1),fw=new Int32Array(z0.buffer);function cw(t){z0[0]=t;let e=fw[0],r=e>>16&32768,n=e>>12&2047,a=e>>23&255;return a<103?r:a>142?(r|=31744,r|=(a===255?0:1)&&e&8388607,r):a<113?(n|=2048,r|=(n>>114-a)+(n>>113-a&1),r):(r|=a-112<<10|n>>1,r+=n&1,r)}function uw(t){let e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*2**-14*(n/2**10):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(r-15)*(1+n/2**10)}var Ze={fromHalf:uw,toHalf:cw};var{vtkErrorMacro:gw}=m,lw=["Build","Render"];function pw(t,e){e.classHierarchy.push("vtkViewNode"),t.build=n=>{},t.render=n=>{},t.traverse=n=>{let a=n.getTraverseOperation(),s=t[a];if(s){s(n);return}t.apply(n,!0);for(let i=0;i<e.children.length;i++)e.children[i].traverse(n);t.apply(n,!1)},t.apply=(n,a)=>{let s=t[n.getOperation()];s&&s(a,n)},t.getViewNodeFor=n=>{if(e.renderable===n)return t;for(let a=0;a<e.children.length;++a){let i=e.children[a].getViewNodeFor(n);if(i)return i}},t.getFirstAncestorOfType=n=>e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null,t.getLastAncestorOfType=n=>{if(!e._parent)return null;let a=e._parent.getLastAncestorOfType(n);return a||(e._parent.isA(n)?e._parent:null)},t.addMissingNode=n=>{if(!n)return;let a=e._renderableChildMap.get(n);if(a!==void 0)return a.setVisited(!0),a;let s=t.createViewNode(n);if(s)return s.setParent(t),s.setVisited(!0),e._renderableChildMap.set(n,s),e.children.push(s),s},t.addMissingNodes=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!n||!n.length))for(let s=0;s<n.length;++s){let i=n[s],o=t.addMissingNode(i);if(a&&o!==void 0&&e.children[s]!==o){for(let f=s+1;f<e.children.length;++f)if(e.children[f]===o){e.children.splice(f,1),e.children.splice(s,0,o);break}}}},t.addMissingChildren=n=>{if(!(!n||!n.length))for(let a=0;a<n.length;++a){let s=n[a];if(e.children.indexOf(s)===-1){s.setParent(t),e.children.push(s);let o=s.getRenderable();o&&e._renderableChildMap.set(o,s)}s.setVisited(!0)}},t.removeNode=n=>{let a=e.children.findIndex(i=>i===n);if(a<0)return!1;let s=n.getRenderable();return s&&e._renderableChildMap.delete(s),n.delete(),e.children.splice(a,1),!0},t.prepareNodes=()=>{for(let n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=n=>{e.visited=n},t.removeUnusedNodes=()=>{let n=0;for(let a=0;a<e.children.length;++a){let s=e.children[a];if(s.getVisited())e.children[n++]=s,s.setVisited(!1);else{let o=s.getRenderable();o&&e._renderableChildMap.delete(o),s.delete()}}e.children.length=n},t.createViewNode=n=>{if(!e.myFactory)return gw("Cannot create view nodes without my own factory"),null;let a=e.myFactory.createNode(n);return a&&a.setRenderable(n),a};let r=t.delete;t.delete=()=>{for(let n=0;n<e.children.length;n++)e.children[n].delete();r()}}var hw={renderable:null,myFactory:null,children:[],visited:!1};function W0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hw,r),m.obj(t,e),m.event(t,e,"event"),e._renderableChildMap=new Map,m.get(t,e,["visited"]),m.setGet(t,e,["_parent","renderable","myFactory"]),m.getArray(t,e,["children"]),m.moveToProtected(t,e,["parent"]),pw(t,e)}var vw=m.newInstance(W0,"vtkViewNode"),I={newInstance:vw,extend:W0,PASS_TYPES:lw};function dw(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,a=r.getClassName(n++),s=!1,i=Object.keys(e.overrides);for(;a&&!s;)i.indexOf(a)!==-1?s=!0:a=r.getClassName(n++);if(!s)return null;let o=e.overrides[a]();return o.setMyFactory(t),o}}var yw={};function H0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yw,r),m.obj(t,e),dw(t,e)}var xw=m.newInstance(H0,"vtkViewNodeFactory"),ss={newInstance:xw,extend:H0};var A0=Object.create(null);function de(t,e){A0[t]=e}function Tw(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}var Sw={};function $0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sw,r),e.overrides=A0,ss.extend(t,e,r),Tw(t,e)}var Cw=m.newInstance($0,"vtkOpenGLViewNodeFactory"),j0={newInstance:Cw,extend:$0};function mw(){try{let n=new Int16Array([0,32767]),a=[1,1],s=document.createElement("canvas");s.width=4,s.height=4;let i=s.getContext("webgl2");if(!i)return!1;let o=i.getExtension("EXT_texture_norm16");if(!o)return!1;let f=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,c=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,g=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(g,f),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS))return!1;let u=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(u,c),i.compileShader(u),!i.getShaderParameter(u,i.COMPILE_STATUS))return!1;let l=i.createProgram();if(i.attachShader(l,g),i.attachShader(l,u),i.linkProgram(l),!i.getProgramParameter(l,i.LINK_STATUS))return!1;let p=i.createTexture();i.bindTexture(i.TEXTURE_2D,p),i.texImage2D(i.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,i.RED,i.SHORT,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.useProgram(l),i.drawArrays(i.POINTS,0,1);let d=new Uint8Array(4);i.readPixels(a[0],a[1],1,1,i.RGBA,i.UNSIGNED_BYTE,d);let[h,v,y]=d,C=i.getExtension("WEBGL_lose_context");return C&&C.loseContext(),h===v&&v===y&&h!==0}catch{return!1}}var Uo;function K0(){return Uo===void 0&&(Uo=mw()),Uo}var{Wrap:At,Filter:Oe}=ko,{VtkDataTypes:J}=P,{vtkDebugMacro:No,vtkErrorMacro:Fr,vtkWarningMacro:P0,requiredParam:ee}=Ee,{toHalf:ww}=Ze;function Ew(t,e){e.classHierarchy.push("vtkOpenGLTexture");function r(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(d?e._openGLRenderWindow=d:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Oe.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Oe.LINEAR),t.setMagnificationFilter(Oe.LINEAR)):(t.setMinificationFilter(Oe.NEAREST),t.setMagnificationFilter(Oe.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(At.REPEAT),t.setWrapS(At.REPEAT),t.setWrapT(At.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImageBitmap()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Oe.LINEAR_MIPMAP_LINEAR)),e.renderable.getImageBitmap()&&e.renderable.getImageLoaded()&&(t.create2DFromImageBitmap(e.renderable.getImageBitmap()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Oe.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Oe.LINEAR_MIPMAP_LINEAR));let v=e.renderable.getCanvas();t.create2DFromRaw({width:v.width,height:v.height,numComps:4,dataType:J.UNSIGNED_CHAR,data:v,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){let v=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Oe.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw({width:v.width,height:v.height,numComps:4,dataType:J.UNSIGNED_CHAR,data:v.data,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}let h=e.renderable.getInputData(0);if(h&&h.getPointData().getScalars()){let v=h.getExtent(),y=h.getPointData().getScalars(),C=[];for(let x=0;x<e.renderable.getNumberOfInputPorts();++x){let T=e.renderable.getInputData(x),w=T?T.getPointData().getScalars().getData():null;w&&C.push(w)}e.renderable.getInterpolate()&&y.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Oe.LINEAR_MIPMAP_LINEAR)),C.length%6===0?t.createCubeFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:y.getNumberOfComponents(),dataType:y.getDataType(),data:C}):t.create2DFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:y.getNumberOfComponents(),dataType:y.getDataType(),data:y.getData()}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};let n=()=>{if(!((e.minificationFilter===Oe.LINEAR||e.magnificationFilter===Oe.LINEAR)&&!K0()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=d=>{d&&e.handle&&(d.activateTexture(t),d.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(d),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let d=!1;if(e.context&&e.handle){let h=0;switch(e.target){case e.context.TEXTURE_2D:h=e.context.TEXTURE_BINDING_2D;break;default:P0("impossible case");break}d=e.context.getIntegerv(h)===e.handle}return d},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(d,h)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(d,h)),e.internalFormat||No(`Unable to find suitable internal format for T=${d} NC= ${h}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&P0("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(d,h)=>{let v=0;return v=e._openGLRenderWindow.getDefaultTextureInternalFormat(d,h,n(),t.useHalfFloat()),v||(v||(No("Unsupported internal texture type!"),No(`Unable to find suitable internal format for T=${d} NC= ${h}`)),v)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=d=>{e._forceInternalFormat=!0,d!==e.internalFormat&&(e.internalFormat=d,t.modified())},t.getFormat=(d,h)=>(e.format=t.getDefaultFormat(d,h),e.format),t.getDefaultFormat=(d,h)=>{if(e._openGLRenderWindow.getWebgl2())switch(h){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(h){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=d=>{let h=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(d){case J.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!h&&J.SHORT):return e.context.SHORT;case(n()&&!h&&J.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(h&&J.SHORT):return e.context.HALF_FLOAT;case(h&&J.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case J.FLOAT:case J.VOID:default:return e.context.FLOAT}switch(d){case J.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case J.FLOAT:case J.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{let v=e.context.getExtension("OES_texture_half_float");if(v&&e.context.getExtension("OES_texture_half_float_linear"))return v.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(d){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||h)&&(e.openGLDataType=t.getDefaultDataType(d)),e.openGLDataType},t.getShiftAndScale=()=>{let d=0,h=1;switch(e.openGLDataType){case e.context.BYTE:h=127.5,d=h-128;break;case e.context.UNSIGNED_BYTE:h=255,d=0;break;case e.context.SHORT:h=32767.5,d=h-32768;break;case e.context.UNSIGNED_SHORT:h=65536,d=0;break;case e.context.INT:h=21474836475e-1,d=h-2147483648;break;case e.context.UNSIGNED_INT:h=4294967295,d=0;break;case e.context.FLOAT:}return{shift:d,scale:h}},t.getOpenGLFilterMode=d=>{switch(d){case Oe.NEAREST:return e.context.NEAREST;case Oe.LINEAR:return e.context.LINEAR;case Oe.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Oe.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Oe.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Oe.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=d=>{switch(d){case At.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case At.REPEAT:return e.context.REPEAT;case At.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function a(d){let[h,v,y,C,x,T]=d;return[v-h+1,C-y+1,T-x+1]}function s(d){let[h,v,y]=a(d);return h*v*y}function i(d,h,v,y,C){let[x,T,w,S,M,E]=v,[R,D]=h,L=R*D,V=C;for(let B=M;B<=E;B++){let F=B*L;for(let z=w;z<=S;z++){let b=F+z*R;for(let W=b+x,G=b+T;W<=G;W++,V++)y[V]=d[W]}}}function o(d,h){let y=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||d.constructor,C=h.reduce((S,M)=>S+s(M),0),x=new y(C),T=[e.width,e.height,e.depth],w=0;return h.forEach(S=>{i(d,T,S,x,w),w+=s(S)}),x}t.updateArrayDataTypeForGL=function(d,h){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],C=[],x=e.width*e.height*e.components;v&&(x*=e.depth);let T=!!y.length;if(d!==J.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let S=0;S<h.length;S++)if(h[S])if(T)C.push(o(h[S],y,Float32Array));else{let M=h[S].length>x?h[S].subarray(0,x):h[S];C.push(new Float32Array(M))}else C.push(null);if(d!==J.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let S=0;S<h.length;S++)if(h[S])if(T)C.push(o(h[S],y,Uint8Array));else{let M=h[S].length>x?h[S].subarray(0,x):h[S];C.push(new Uint8Array(M))}else C.push(null);let w=!1;if(e._openGLRenderWindow.getWebgl2())w=e.openGLDataType===e.context.HALF_FLOAT;else{let S=e.context.getExtension("OES_texture_half_float");w=S&&e.openGLDataType===S.HALF_FLOAT_OES}if(w)for(let S=0;S<h.length;S++)if(h[S]){let M=T?o(h[S],y):h[S],E=new Uint16Array(T?M.length:x),R=E.length;for(let D=0;D<R;D++)E[D]=ww(M[D]);C.push(E)}else C.push(null);if(C.length===0)for(let S=0;S<h.length;S++)C.push(T&&h[S]?o(h[S],y):h[S]);return C};function f(d){if(e._openGLRenderWindow.getWebgl2())return d;let h=[],v=e.width,y=e.height,C=e.components;if(d&&(!Qr(v)||!Qr(y))){let x=e.context.getExtension("OES_texture_half_float"),T=$e(v),w=$e(y),S=T*w*e.components;for(let M=0;M<d.length;M++)if(d[M]!==null){let E=null,R=y/w,D=v/T,L=!1;e.openGLDataType===e.context.FLOAT?E=new Float32Array(S):x&&e.openGLDataType===x.HALF_FLOAT_OES?(E=new Uint16Array(S),L=!0):E=new Uint8Array(S);for(let V=0;V<w;V++){let B=V*T*C,F=V*R,z=Math.floor(F),b=Math.ceil(F);b>=y&&(b=y-1);let W=F-z,G=1-W;z=z*v*C,b=b*v*C;for(let k=0;k<T;k++){let _=k*C,H=k*D,Q=Math.floor(H),A=Math.ceil(H);A>=v&&(A=v-1);let He=H-Q;Q*=C,A*=C;for(let he=0;he<C;he++)L?E[B+_+he]=Ze.toHalf(Ze.fromHalf(d[M][z+Q+he])*G*(1-He)+Ze.fromHalf(d[M][z+A+he])*G*He+Ze.fromHalf(d[M][b+Q+he])*W*(1-He)+Ze.fromHalf(d[M][b+A+he])*W*He):E[B+_+he]=d[M][z+Q+he]*G*(1-He)+d[M][z+A+he]*G*He+d[M][b+Q+he]*W*(1-He)+d[M][b+A+he]*W*He}}h.push(E),e.width=T,e.height=w}else h.push(null)}if(h.length===0)for(let x=0;x<d.length;x++)h.push(d[x]);return h}function c(d){return e._openGLRenderWindow?e.resizable||e.renderable?.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(d===J.UNSIGNED_SHORT||d===J.SHORT)):!1:!1}t.create2DFromRaw=function(){let{width:d=ee("width"),height:h=ee("height"),numComps:v=ee("numComps"),dataType:y=ee("dataType"),data:C=ee("data"),flip:x=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(y,!0),t.getInternalFormat(y,v),t.getFormat(y,v),!e.internalFormat||!e.format||!e.openGLDataType)return Fr("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=v,e.width=d,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let T=[C],w=t.updateArrayDataTypeForGL(y,T),S=f(w);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,x),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),c(y)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),S[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,S[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,S[0]),e.generateMipmap&&e.context.generateMipmap(e.target),x&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*v*e._openGLRenderWindow.getDefaultTextureByteSize(y,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=function(){let{width:d=ee("width"),height:h=ee("height"),numComps:v=ee("numComps"),dataType:y=ee("dataType"),data:C=ee("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(y),t.getInternalFormat(y,v),t.getFormat(y,v),!e.internalFormat||!e.format||!e.openGLDataType)return Fr("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=v,e.width=d,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=C.length/6-1,t.createTexture(),t.bind();let x=t.updateArrayDataTypeForGL(y,C),T=f(x),w=[],S=e.width,M=e.height;for(let E=0;E<T.length;E++){E%6===0&&E!==0&&(S/=2,M/=2),w[E]=kt(y,M*S*e.components);for(let R=0;R<M;++R){let D=R*S*e.components,L=(M-R-1)*S*e.components;w[E].set(T[E].slice(L,L+S*e.components),D)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),c(y)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let E=0;E<6;E++){let R=0,D=e.width,L=e.height;for(;D>=1&&L>=1;){let V=null;R<=e.maxLevel&&(V=w[6*R+E]),c(y)?V!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+E,R,0,0,D,L,e.format,e.openGLDataType,V):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+E,R,e.internalFormat,D,L,0,e.format,e.openGLDataType,V),R++,D/=2,L/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*v*e._openGLRenderWindow.getDefaultTextureByteSize(y,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=function(){let{width:d=ee("width"),height:h=ee("height"),dataType:v=ee("dataType"),data:y=ee("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.getOpenGLDataType(v),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?v===J.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Fr("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=d,e.height=h,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),c(v)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),y!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,y)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,y),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(v,n(),t.useHalfFloat()),t.deactivate(),!0)},t.create2DFromImage=d=>{if(t.getOpenGLDataType(J.UNSIGNED_CHAR),t.getInternalFormat(J.UNSIGNED_CHAR,4),t.getFormat(J.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Fr("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let h=!e._openGLRenderWindow.getWebgl2()&&(!Qr(d.width)||!Qr(d.height)),v=d,y=d.width,C=d.height,x=!0,T=window.chrome;if(h||T){let w=new OffscreenCanvas($e(d.width),$e(d.height));y=w.width,C=w.height;let S=w.getContext("2d");S.translate(0,w.height),S.scale(1,-1),S.drawImage(d,0,0,d.width,d.height,0,0,w.width,w.height),v=w,x=!1}return e.width=y,e.height=C,e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,x),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),c(J.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(J.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0},t.create2DFromImageBitmap=d=>(t.getOpenGLDataType(J.UNSIGNED_CHAR),t.getInternalFormat(J.UNSIGNED_CHAR,4),t.getFormat(J.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType?(Fr("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.width=d.width,e.height=d.height,c(J.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,d)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,d),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(J.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0));function g(d,h,v){let y=new Array(v),C=new Array(v);for(let x=0;x<v;++x)y[x]=d[x],C[x]=h[x]-d[x]||1;return{scale:C,offset:y}}function u(d,h){for(let v=0;v<d.length;v++){let y=d[v],C=h[v]+y;if(y<-2048||y>2048||C<-2048||C>2048)return!1}return!0}function l(d,h,v,y){t.getOpenGLDataType(d);let C=u(h,v)||y,x=!1;if(e._openGLRenderWindow.getWebgl2())x=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&C||e.openGLDataType===e.context.HALF_FLOAT;else{let T=e.context.getExtension("OES_texture_half_float");x=T&&e.openGLDataType===T.HALF_FLOAT_OES}e.canUseHalfFloat=x&&C}function p(d,h){let v=d.getNumberOfComponents(),y=d.getDataType(),C=d.getData(),x=new Array(v),T=new Array(v);for(let S=0;S<v;++S){let[M,E]=d.getRange(S);x[S]=M,T[S]=E}let w=g(x,T,v);return l(y,w.offset,w.scale,h),t.useHalfFloat()||t.getOpenGLDataType(y,!0),{numComps:v,dataType:y,data:C,scaleOffsets:w}}t.create2DFilterableFromRaw=function(){let{width:d=ee("width"),height:h=ee("height"),numComps:v=ee("numComps"),dataType:y=ee("dataType"),data:C=ee("data"),preferSizeOverAccuracy:x=!1,ranges:T=void 0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create2DFilterableFromDataArray({width:d,height:h,dataArray:P.newInstance({numComps:v,dataType:y,values:C,ranges:T}),preferSizeOverAccuracy:x})},t.create2DFilterableFromDataArray=function(){let{width:d=ee("width"),height:h=ee("height"),dataArray:v=ee("dataArray"),preferSizeOverAccuracy:y=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{numComps:C,dataType:x,data:T}=p(v,y);t.create2DFromRaw({width:d,height:h,numComps:C,dataType:x,data:T})},t.updateVolumeInfoForGL=(d,h)=>{let v=!1,y=t.useHalfFloat();(!e.volumeInfo?.scale||!e.volumeInfo?.offset)&&(e.volumeInfo={scale:new Array(h),offset:new Array(h)});for(let C=0;C<h;++C)e.volumeInfo.scale[C]=1,e.volumeInfo.offset[C]=0;if(n()&&!y&&d===J.SHORT){for(let C=0;C<h;++C)e.volumeInfo.scale[C]=32767;v=!0}if(n()&&!y&&d===J.UNSIGNED_SHORT){for(let C=0;C<h;++C)e.volumeInfo.scale[C]=65535;v=!0}if(d===J.UNSIGNED_CHAR){for(let C=0;C<h;++C)e.volumeInfo.scale[C]=255;v=!0}return(d===J.FLOAT||y&&(d===J.SHORT||d===J.UNSIGNED_SHORT))&&(v=!0),v},t.create3DFromRaw=function(){let{width:d=ee("width"),height:h=ee("height"),depth:v=ee("depth"),numComps:y=ee("numComps"),dataType:C=ee("dataType"),data:x=ee("data"),updatedExtents:T=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},w=C,S=x;if(!t.updateVolumeInfoForGL(w,y)&&S){let B=d*h*v,F=structuredClone(e.volumeInfo),z=new Float32Array(B*y);e.volumeInfo.offset=F.offset,e.volumeInfo.scale=F.scale;let b=0,W=F.scale.map(G=>1/G);for(let G=0;G<B;G++)for(let k=0;k<y;k++)z[b]=(S[b]-F.offset[k])*W[k],b++;w=J.FLOAT,S=z}if(t.getOpenGLDataType(w),t.getInternalFormat(w,y),t.getFormat(w,y),!e.internalFormat||!e.format||!e.openGLDataType)return Fr("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=y,e.width=d,e.height=h,e.depth=v,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();let M=T.length>0,E=!M||!(0,X0.default)(e._prevTexParams,r()),R=[S],L=t.updateArrayDataTypeForGL(w,R,!0,E?[]:T),V=f(L);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),E)c(w)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),V[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,V[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,V[0]),e._prevTexParams=r();else if(M){let B=V[0],F=0;for(let z=0;z<T.length;z++){let b=T[z],W=a(b),G=s(b),k=new B.constructor(B.buffer,F,G);F+=k.byteLength,e.context.texSubImage3D(e.target,0,b[0],b[2],b[4],W[0],W[1],W[2],e.format,e.openGLDataType,k)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(w,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(){let{width:d=ee("width"),height:h=ee("height"),depth:v=ee("depth"),numComps:y=ee("numComps"),dataType:C=ee("dataType"),data:x=ee("data"),preferSizeOverAccuracy:T=!1,ranges:w=void 0,updatedExtents:S=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create3DFilterableFromDataArray({width:d,height:h,depth:v,dataArray:P.newInstance({numComps:y,dataType:C,values:x,ranges:w}),preferSizeOverAccuracy:T,updatedExtents:S})},t.create3DFilterableFromDataArray=function(){let{width:d=ee("width"),height:h=ee("height"),depth:v=ee("depth"),dataArray:y=ee("dataArray"),preferSizeOverAccuracy:C=!1,updatedExtents:x=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{numComps:T,dataType:w,data:S,scaleOffsets:M}=p(y,C),E=[],R=[];for(let se=0;se<T;++se)E[se]=0,R[se]=1;if(e.volumeInfo={scale:R,offset:E,dataComputedScale:M.scale,dataComputedOffset:M.offset,width:d,height:h,depth:v},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw({width:d,height:h,depth:v,numComps:T,dataType:w,data:S,updatedExtents:x});let D=d*h*v,L=structuredClone(M),V=(se,Ce,Ye,Be,be)=>{se[Ce]=Ye},B=J.UNSIGNED_CHAR;if(w===J.UNSIGNED_CHAR)for(let se=0;se<T;++se)L.offset[se]=0,L.scale[se]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(B=J.FLOAT,V=(se,Ce,Ye,Be,be)=>{se[Ce]=(Ye-Be)/be}):(B=J.UNSIGNED_CHAR,V=(se,Ce,Ye,Be,be)=>{se[Ce]=255*(Ye-Be)/be});if(t.getOpenGLDataType(B),t.getInternalFormat(B,T),t.getFormat(B,T),!e.internalFormat||!e.format||!e.openGLDataType)return Fr("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=T,e.depth=1,e.numberOfDimensions=2;let F=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);F>4096&&(B===J.FLOAT||T>=3)&&(F=4096);let z=1,b=1;D>F*F&&(z=Math.ceil(Math.sqrt(D/(F*F))),b=z);let W=Math.sqrt(D)/z;W=$e(W);let G=Math.floor(W*z/d),k=Math.ceil(v/G),_=$e(h*k/b);e.width=W,e.height=_,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=G,e.volumeInfo.yreps=k,e.volumeInfo.xstride=z,e.volumeInfo.ystride=b,e.volumeInfo.offset=L.offset,e.volumeInfo.scale=L.scale;let H,Q=W*_*T;B===J.FLOAT?H=new Float32Array(Q):H=new Uint8Array(Q);let A=0,He=Math.floor(d/z),he=Math.floor(h/b);for(let se=0;se<k;se++){let Ce=Math.min(G,v-se*G),Ye=T*(e.width-Ce*Math.floor(d/z));for(let Be=0;Be<he;Be++){for(let be=0;be<Ce;be++){let vt=T*((se*G+be)*d*h+b*Be*d);for(let Yt=0;Yt<He;Yt++)for(let mt=0;mt<T;mt++)V(H,A,S[vt+z*Yt*T+mt],L.offset[mt],L.scale[mt]),A++}A+=Ye}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),c(B)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),H!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,H)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,H),t.deactivate(),!0},t.setOpenGLRenderWindow=d=>{e._openGLRenderWindow!==d&&(t.releaseGraphicsResources(),e._openGLRenderWindow=d,e.context=null,d&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=d=>d&&d.isCurrent()?d.getIntegerv(d.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=d=>{e.enableUseHalfFloat=d}}var Mw={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:At.CLAMP_TO_EDGE,wrapT:At.CLAMP_TO_EDGE,wrapR:At.CLAMP_TO_EDGE,minificationFilter:Oe.NEAREST,magnificationFilter:Oe.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function Y0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mw,r),I.extend(t,e,r),e.sendParametersTime={},ne(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},ne(e.textureBuildTime,{mtime:0}),Sr(t,e,["format","openGLDataType"]),re(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),pe(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),Jt(t,e,["openGLRenderWindow"]),Ew(t,e)}var I0=j(Y0,"vtkOpenGLTexture"),Qe={newInstance:I0,extend:Y0,...ko};de("vtkTexture",I0);function Rw(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=r=>{let n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=r=>{if(!e.context){q("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}let n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=r=>{},t.restorePreviousBindingsAndBuffers=r=>{let n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=r=>{if(!e.context){q("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}let n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=r=>{},t.bind=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(let a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(r,n)=>{if(!e.context){q("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=e.context;if(!a){q("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let s=a.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())s+=n;else{q("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,a.framebufferTexture2D(a.FRAMEBUFFER,s,a.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=e.context;if(!n){q("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let a=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{q("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,a,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=r=>{if(!e.context){q("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){let n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else q("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){q("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){let r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else q("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){q("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();let r=e.context,n=Qe.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(as.LINEAR),n.setMagnificationFilter(as.LINEAR),n.create2DFromRaw({width:e.glFramebuffer.width,height:e.glFramebuffer.height,numComps:4,dataType:ge.UNSIGNED_CHAR,data:null}),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}var Ow={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function q0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ow,r),ne(t,e),e.colorBuffers&&q("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Ut(t,e,["colorBuffers"]),Rw(t,e)}var Dw=j(q0,"vtkFramebuffer"),an={newInstance:Dw,extend:q0};function Lw(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=r=>{e.currentOperation=r,e.currentTraverseOperation=`traverse${m.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(a=>{t.setCurrentOperation(a),r.traverse(t)}),e.delegates.forEach(a=>{a.traverse(r,t)}),e.postDelegateOperations.forEach(a=>{t.setCurrentOperation(a),r.traverse(t)}))}}var Vw={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function Z0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vw,r),m.obj(t,e),m.get(t,e,["currentOperation"]),m.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),m.moveToProtected(t,e,["currentParent"]),Lw(t,e)}var Bw=m.newInstance(Z0,"vtkRenderPass"),Ue={newInstance:Bw,extend:Z0};var kr={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2},Go={ObjectType:kr};var{ObjectType:is}=Go,Fw={};function kw(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(o){switch(o){case is.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case is.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case is.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let n=null,a=null,s=!0,i="";t.getType=()=>n,t.setType=o=>{n=o},t.getHandle=()=>a,t.isReady=()=>s===!1,t.generateBuffer=o=>{let f=r(o);return a===null&&(a=e.context.createBuffer(),n=o),r(n)===f},t.upload=(o,f)=>t.generateBuffer(f)?(e.context.bindBuffer(r(n),a),e.context.bufferData(r(n),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,s=!1,!0):(i="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>a?(e.context.bindBuffer(r(n),a),!0):!1,t.release=()=>a?(e.context.bindBuffer(r(n),null),!0):!1,t.releaseGraphicsResources=()=>{a!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(a),a=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>i}var Uw={objectType:is.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function Q0(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Uw,r),m.obj(t,e),m.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),m.moveToProtected(t,e,["openGLRenderWindow"]),kw(t,e)}var Nw=m.newInstance(Q0),_o={newInstance:Nw,extend:Q0,...Fw,...Go};function J0(t){let e=0,r=0;for(let a=0;a<3;++a){let s=t.getRange(a),i=s[1]-s[0];e+=i*i;let o=.5*(s[1]+s[0]);r+=o*o}let n=e>0&&(Math.abs(r)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&r>1e6);if(n){let a=new Float64Array(3),s=new Float64Array(3);for(let i=0;i<3;++i){let o=t.getRange(i),f=o[1]-o[0];a[i]=.5*(o[1]+o[0]),s[i]=f>0?1/f:1}return{useShiftAndScale:n,coordShift:a,coordScale:s}}return{useShiftAndScale:n,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}var{vtkErrorMacro:ep}=m;function Gw(t,e){let r=new Float64Array(3);N.inverse(r,e);let n=new Float64Array(16);return O.fromRotationTranslationScale(n,Me.create(),t,r),n}function _w(t,e){return t===null||e===null?!1:!(N.exactEquals(t,[0,0,0])&&N.exactEquals(e,[1,1,1]))}function bw(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(kr.ARRAY_BUFFER),t.createVBO=function(r,n,a,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];let o=s.points.getData(),f=null,c=null,g=null,u=s.colors?s.colors.getNumberOfComponents():0,l=s.tcoords?s.tcoords.getNumberOfComponents():0;s.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,f=s.normals.getData()),s.customAttributes&&s.customAttributes.forEach(k=>{k&&(e.customData.push({data:k.getData(),offset:4*e.blockSize,components:k.getNumberOfComponents(),name:k.getName()}),e.blockSize+=k.getNumberOfComponents())}),s.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=l,e.blockSize+=l,c=s.tcoords.getData()),s.colors?(e.colorComponents=s.colors.getNumberOfComponents(),e.colorOffset=0,g=s.colors.getData(),e.colorBO||(e.colorBO=_o.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let p=0,d=0,h=0,v=0,y=0,C=0,x,T={anythingToPoints(k,_,H,Q){for(let A=0;A<k;++A)x(_[H+A],Q)},linesToWireframe(k,_,H,Q){for(let A=0;A<k-1;++A)x(_[H+A],Q),x(_[H+A+1],Q)},polysToWireframe(k,_,H,Q){if(k>2)for(let A=0;A<k;++A)x(_[H+A],Q),x(_[H+(A+1)%k],Q)},stripsToWireframe(k,_,H,Q){if(k>2){for(let A=0;A<k-1;++A)x(_[H+A],Q),x(_[H+A+1],Q);for(let A=0;A<k-2;A++)x(_[H+A],Q),x(_[H+A+2],Q)}},polysToSurface(k,_,H,Q){for(let A=0;A<k-2;A++)x(_[H+0],Q),x(_[H+A+1],Q),x(_[H+A+2],Q)},stripsToSurface(k,_,H,Q){for(let A=0;A<k-2;A++)x(_[H+A],Q),x(_[H+A+1+A%2],Q),x(_[H+A+1+(A+1)%2],Q)}},w={anythingToPoints(k,_){return k},linesToWireframe(k,_){return k>1?(k-1)*2:0},polysToWireframe(k,_){return k>2?k*2:0},stripsToWireframe(k,_){return k>2?k*4-6:0},polysToSurface(k,_){return k>2?(k-2)*3:0},stripsToSurface(k,_,H){return k>2?(k-2)*3:0}},S=null,M=null;a===We.POINTS||n==="verts"?(S=T.anythingToPoints,M=w.anythingToPoints):a===We.WIREFRAME||n==="lines"?(S=T[`${n}ToWireframe`],M=w[`${n}ToWireframe`]):(S=T[`${n}ToSurface`],M=w[`${n}ToSurface`]);let E=r.getData(),R=E.length,D=0;for(let k=0;k<R;)D+=M(E[k],E),k+=E[k]+1;let L=null,V=new Float32Array(D*e.blockSize);g&&(L=new Uint8Array(D*4));let B=0,F=0,{useShiftAndScale:z,coordShift:b,coordScale:W}=J0(s.points);if(z?t.setCoordShiftAndScale(b,W):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),i)if(!i.points&&!i.cells)i.points=new Int32Array(D),i.cells=new Int32Array(D);else{let k=new Int32Array(D+i.points.length);k.set(i.points),i.points=k;let _=new Int32Array(D+i.cells.length);_.set(i.cells),i.cells=_}let G=s.vertexOffset;x=function(_,H){if(i&&(i.points[G]=_,i.cells[G]=C+s.cellOffset),++G,p=_*3,e.coordShiftAndScaleEnabled?(V[B++]=(o[p++]-e.coordShift[0])*e.coordScale[0],V[B++]=(o[p++]-e.coordShift[1])*e.coordScale[1],V[B++]=(o[p++]-e.coordShift[2])*e.coordScale[2]):(V[B++]=o[p++],V[B++]=o[p++],V[B++]=o[p++]),f!==null&&(s.haveCellNormals?d=(C+s.cellOffset)*3:d=_*3,V[B++]=f[d++],V[B++]=f[d++],V[B++]=f[d++]),e.customData.forEach(Q=>{y=_*Q.components;for(let A=0;A<Q.components;++A)V[B++]=Q.data[y++]}),c!==null){s.useTCoordsPerCell?h=H*l:h=_*l;for(let Q=0;Q<l;++Q)V[B++]=c[h++]}g!==null&&(s.haveCellScalars?v=(C+s.cellOffset)*u:v=_*u,L[F++]=g[v++],L[F++]=g[v++],L[F++]=g[v++],L[F++]=u===4?g[v++]:255)};for(let k=0;k<R;k+=E[k]+1,C++)S(E[k],E,k+1,C+s.cellOffset);return e.elementCount=D,t.upload(V,kr.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(L,kr.ARRAY_BUFFER)),C},t.setCoordShiftAndScale=(r,n)=>{if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){ep("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){ep("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!N.equals(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!N.equals(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=_w(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=Gw(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}var zw={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function tp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zw,r),_o.extend(t,e,r),m.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),m.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),bw(t,e)}var Ww=m.newInstance(tp),rp={newInstance:Ww,extend:tp};var{vtkErrorMacro:Hw}=m;function Aw(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){let a=e.context.getShaderInfoLog(e.handle);return Hw(`Error compiling shader '${e.source}': ${a}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}var $w={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function np(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$w,r),m.obj(t,e),m.setGet(t,e,["shaderType","source","error","handle","context"]),Aw(t,e)}var jw=m.newInstance(np,"vtkShader"),os={newInstance:jw,extend:np};var{vtkErrorMacro:Ot}=m;function Kw(t,e,r,n){let a=typeof r=="string"?r:r.join(`
`),s=n===!1?e:new RegExp(e,"g"),i=t.replace(s,a);return{replace:i!==a,result:i}}function Pw(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Ot(e.error),0):t.link()?(t.setCompiled(!0),1):(Ot(`Links failed: ${e.error}`),0):(Ot(e.fragmentShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),Ot(e.fragmentShader.getError()),0):(Ot(e.vertexShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),Ot(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=r=>{e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){let n=e.context.getProgramInfoLog(e.handle);return Ot(`Error linking shader ${n}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(r,n)=>{let a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;let s=new Float32Array(n);return e.context.uniformMatrix4fv(a,!1,s),!0},t.setUniformMatrix3x3=(r,n)=>{let a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;let s=new Float32Array(n);return e.context.uniformMatrix3fv(a,!1,s),!0},t.setUniformf=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1f(a,n),!0)},t.setUniformfv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1fv(a,n),!0)},t.setUniformi=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1i(a,n),!0)},t.setUniformiv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1iv(a,n),!0)},t.setUniform2f=(r,n,a)=>{let s=t.findUniform(r);if(s===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(s,n,a),!0},t.setUniform2fv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2fv(a,n),!0)},t.setUniform2i=(r,n,a)=>{let s=t.findUniform(r);if(s===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(s,n,a),!0},t.setUniform2iv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2iv(a,n),!0)},t.setUniform3f=(r,n,a,s)=>{let i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(s===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,n,a,s),!0},t.setUniform3fArray=(r,n)=>{let a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n[0],n[1],n[2]),!0},t.setUniform3fv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3fv(a,n),!0)},t.setUniform3i=function(r){let n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,o[0],o[1],o[2]),!0},t.setUniform3iv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3iv(a,n),!0)},t.setUniform4f=function(r){let n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4fv(a,n),!0)},t.setUniform4i=function(r){let n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(r,n)=>{let a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4iv(a,n),!0)},t.findUniform=r=>{if(!r||!e.linked)return-1;let n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error=`Uniform ${r} not found in current shader program.`,e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=r=>{if(!r)return!1;let n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):(Ot("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=r=>{if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return Ot("attempt to find uniform when the shader program is not linked"),!1;let n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=r=>{if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){let n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=r=>{if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=r=>{e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=r=>{e.lastCameraMTime=r}}var Xw={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function ap(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xw,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=os.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=os.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=os.newInstance(),e.geometryShader.setShaderType("Geometry"),m.obj(t,e),m.get(t,e,["lastCameraMTime"]),m.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Pw(t,e)}var Yw=m.newInstance(ap,"vtkShaderProgram"),U={newInstance:Yw,extend:ap,substitute:Kw};function Iw(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){let r=e.context;for(let n=0;n<e.buffers.length;++n){let a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){let i=a.attributes[s],o=i.isMatrix?i.size:1;for(let f=0;f<o;++f)r.enableVertexAttribArray(i.index+f),r.vertexAttribPointer(i.index+f,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*f/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+f,1):r.vertexAttribDivisor(i.index+f,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){let r=e.context;for(let n=0;n<e.buffers.length;++n){let a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){let i=a.attributes[s],o=i.isMatrix?i.size:1;for(let f=0;f<o;++f)r.enableVertexAttribArray(i.index+f),r.vertexAttribPointer(i.index+f,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*f/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+f,0):r.vertexAttribDivisor(i.index+f,0)),r.disableVertexAttribArray(i.index+f)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(r,n,a,s,i,o,f,c)=>t.addAttributeArrayWithDivisor(r,n,a,s,i,o,f,c,0,!1),t.addAttributeArrayWithDivisor=(r,n,a,s,i,o,f,c,g,u)=>{if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==kr.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;let l=e.context,p={};if(p.name=a,p.index=l.getAttribLocation(e.handleProgram,a),p.offset=s,p.stride=i,p.type=o,p.size=f,p.normalize=c,p.isMatrix=u,p.divisor=g,p.Index===-1)return!1;if(n.bind(),l.enableVertexAttribArray(p.index),l.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):l.vertexAttribDivisor(p.index,1)),p.buffer=n.getHandle(),!e.supported){let d=!1;for(let h=0;h<e.buffers.length;++h){let v=e.buffers[h];if(v.buffer===p.buffer){d=!0;let y=!1;for(let C=0;C<v.attributes.length;++C)v.attributes[C].name===a&&(y=!0,v.attributes[C]=p);y||v.attributes.push(p)}}d||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=(r,n,a,s,i,o,f,c,g)=>{let u=t.addAttributeArrayWithDivisor(r,n,a,s,i,o,f,c,g,!0);if(!u)return u;let l=e.context,p=l.getAttribLocation(e.handleProgram,a);for(let d=1;d<f;d++)l.enableVertexAttribArray(p+d),l.vertexAttribPointer(p+d,f,o,c,i,s+i*d/f),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+d,1):l.vertexAttribDivisor(p+d,1));return!0},t.removeAttributeArray=r=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let n=0;n<e.buffers.length;++n){let a=e.buffers[n];for(let s=0;s<a.attributes.length;++s)if(a.attributes[s].name===r)return a.attributes.splice(s,1),a.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}var qw={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function sp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qw,r),e.buffers=[],m.obj(t,e),m.get(t,e,["supported"]),m.setGet(t,e,["forceEmulation"]),Iw(t,e)}var Zw=m.newInstance(sp,"vtkOpenGLVertexArrayObject"),fs={newInstance:Zw,extend:sp};var ir={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function Qw(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=r=>{e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=r=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(r,n,a,s)=>{if(e.CABO.getElementCount()){let i=t.getOpenGLMode(a),o=t.haveWideLines(r,n),f=e.context,c=f.getParameter(f.DEPTH_WRITEMASK);e.pointPicking&&f.depthMask(!1),i===f.LINES&&o?(t.updateShaders(r,n,s),f.drawArraysInstanced(i,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(f.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,s),f.drawArrays(i,0,e.CABO.getElementCount()),f.lineWidth(1));let u=(i===f.POINTS?1:0)||(i===f.LINES?2:3);return e.pointPicking&&f.depthMask(c),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=r=>{if(e.pointPicking)return e.context.POINTS;let n=e.primitiveType;return r===We.POINTS||n===ir.Points?e.context.POINTS:r===We.WIREFRAME||n===ir.Lines||n===ir.TrisEdges||n===ir.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(r,n)=>n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(r,n,a)=>!!(a.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime()),t.updateShaders=(r,n,a)=>{if(t.getNeedToRebuildShaders(r,n,a)){let s={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(s,r,n);let i=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);i!==t.getProgram()&&(t.setProgram(i),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,r,n),a.setPropertyShaderParameters(t,r,n),a.setCameraShaderParameters(t,r,n),a.setLightingShaderParameters(t,r,n),a.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=(r,n,a)=>{if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);let s=parseFloat(n.getProperty().getLineWidth()),i=s/2;t.getProgram().setUniformf("lineWidthStepSize",s/Math.ceil(s)),t.getProgram().setUniformf("halfLineWidth",i)}e.primitiveType===ir.Points||n.getProperty().getRepresentation()===We.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(r,n,a)=>{let s=r.Vertex;s=U.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,s=U.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,a)&&(s=U.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,s=U.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=s},t.getPointPickingPrimitiveSize=()=>e.primitiveType===ir.Points?2:e.primitiveType===ir.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}var Jw={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function ip(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jw,r),m.obj(t,e),e.shaderSourceTime={},m.obj(e.shaderSourceTime),e.attributeUpdateTime={},m.obj(e.attributeUpdateTime),m.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=U.newInstance(),e.VAO=fs.newInstance(),e.CABO=rp.newInstance(),Qw(t,e)}var eE=m.newInstance(ip),Dt={newInstance:eE,extend:ip,primTypes:ir};var{Representation:tE}=ft,{vtkErrorMacro:op}=m;function rE(t){let e=U.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}var nE=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function aE(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{let r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),s=P.newInstance({numberOfComponents:3,values:r});s.setName("points");let i=P.newInstance({numberOfComponents:2,values:n});i.setName("tcoords");let o=P.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",tE.SURFACE,{points:s,tcoords:i,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=r=>{let n=r.getSize(),a=r.getContext();e.framebuffer=an.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.create(...n),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Qe.newInstance(),e.translucentRGBATexture.setInternalFormat(a.RGBA16F),e.translucentRGBATexture.setFormat(a.RGBA),e.translucentRGBATexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw({width:n[0],height:n[1],numComps:4,dataType:"Float32Array",data:null}),e.translucentRTexture=Qe.newInstance(),e.translucentRTexture.setInternalFormat(a.R16F),e.translucentRTexture.setFormat(a.RED),e.translucentRTexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw({width:n[0],height:n[1],numComps:1,dataType:"Float32Array",data:null}),e.translucentZTexture=Qe.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw({width:n[0],height:n[1],dataType:"Float32Array",data:null}),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=r=>{e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),nE,"")},t.createVBO=r=>{let n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();let a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||op("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||op("Error setting vertexDC in copy shader VAO.")},t.traverse=(r,n,a)=>{if(e.deleted)return;let s=r.getSize(),i=r.getContext();if(e._supported=!1,n.getSelector()||!i||!r.getWebgl2()||!i.getExtension("EXT_color_buffer_half_float")&&!i.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{let f=e.framebuffer.getSize();f===null||f[0]!==s[0]||f[1]!==s[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}i.drawBuffers([i.COLOR_ATTACHMENT0]),i.clearBufferfv(i.COLOR,0,[0,0,0,0]),i.clearBufferfv(i.DEPTH,0,[1]),i.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),n.traverse(a)),i.colorMask(!0,!0,!0,!0),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),i.clearBufferfv(i.COLOR,0,[0,0,0,1]),i.clearBufferfv(i.COLOR,1,[0,0,0,0]),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE,i.ZERO,i.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),i.drawBuffers([i.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=fs.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),i.depthFunc(i.ALWAYS),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),i.depthMask(!0),i.depthFunc(i.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();let o=n.getTiledSizeAndOrigin();i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?rE:null,t.releaseGraphicsResources=r=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}var sE={framebuffer:null,copyShader:null,tris:null};function fp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sE,r),Ue.extend(t,e,r),e.VBOBuildTime={},m.obj(e.VBOBuildTime,{mtime:0}),e.tris=Dt.newInstance(),m.get(t,e,["framebuffer"]),aE(t,e)}var iE=m.newInstance(fp,"vtkOpenGLOrderIndependentTranslucentPass"),cp={newInstance:iE,extend:fp};function oE(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);let a=r.getRenderable().getNumberOfLayers(),s=r.getRenderable().getRenderersByReference();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){let f=s[o],c=r.getViewNodeFor(f);if(f.getDraw()&&f.getLayer()===i){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),c.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){let g=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=an.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();let u=e.framebuffer.getSize();(u===null||u[0]!==g[0]||u[1]!==g[1])&&(e.framebuffer.create(g[0],g[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),c.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),c.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=cp.newInstance()),e.translucentPass.traverse(r,c,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),c.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),c.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}var fE={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function up(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fE,r),Ue.extend(t,e,r),m.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),oE(t,e)}var cE=m.newInstance(up,"vtkForwardPass"),gp={newInstance:cE,extend:up};var{FieldAssociations:uE}=Ie;function gE(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(r,n,a,s,i)=>{},t.selectAsync=async(r,n,a,s,i)=>{let o=await t.getSourceDataAsync(r,n,a,s,i);return o?o.generateSelection(n,a,s,i):[]}}var lE={fieldAssociation:uE.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function lp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lE,r),m.obj(t,e),m.setGet(t,e,["fieldAssociation","captureZValues"]),gE(t,e)}var pE=m.newInstance(lp,"vtkHardwareSelector"),cs={newInstance:pE,extend:lp};var hE={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},vE={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5},pp={SelectionContent:hE,SelectionField:vE};function dE(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}var yE={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function hp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yE,r),m.obj(t,e),e.properties={},m.setGet(t,e,["contentType","fieldType","properties","selectionList"]),dE(t,e)}var xE=m.newInstance(hp,"vtkSelectionNode"),sn={newInstance:xE,extend:hp,...pp};var{PassTypes:we}=Bo,{SelectionContent:TE,SelectionField:vp}=sn,{FieldAssociations:jn}=Ie,{vtkErrorMacro:dp}=m,or=1;function yp(t){return`${t.propID} ${t.compositeID}`}function xp(t,e,r,n){if(!r)return 0;let a=(e*(n[2]-n[0]+1)+t)*4;return r[a+3]}function $t(t,e,r,n){if(!r)return 0;let a=(e*(n[2]-n[0]+1)+t)*4,s=r[a],i=r[a+1];return(r[a+2]*256+i)*256+s}function Tp(t,e){let r=e;return r<<=24,r|=t,r}function on(t,e,r,n){let a=r<0?0:r;if(a===0){if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;let f=[e[0]-t.area[0],e[1]-t.area[1]],c=$t(f[0],f[1],t.pixBuffer[we.ACTOR_PASS],t.area);if(c<=0||c-or>=t.props.length)return null;let g={};g.valid=!0,g.propID=c-or,g.prop=t.props[g.propID];let u=$t(f[0],f[1],t.pixBuffer[we.COMPOSITE_INDEX_PASS],t.area);if((u<0||u>16777215)&&(u=0),g.compositeID=u-or,t.captureZValues){let d=(f[1]*(t.area[2]-t.area[0]+1)+f[0])*4;g.zValue=(256*t.zBuffer[d]+t.zBuffer[d+1])/65535,g.displayPosition=e}if(t.pixBuffer[we.ID_LOW24]&&xp(f[0],f[1],t.pixBuffer[we.ID_LOW24],t.area)===0)return g;let l=$t(f[0],f[1],t.pixBuffer[we.ID_LOW24],t.area),p=$t(f[0],f[1],t.pixBuffer[we.ID_HIGH24],t.area);return g.attributeID=Tp(l,p),g}let s=[e[0],e[1]],i=[0,0],o=on(t,e,0,n);if(o&&o.valid)return o;for(let f=1;f<a;++f){for(let c=s[1]>f?s[1]-f:0;c<=s[1]+f;++c)if(i[1]=c,s[0]>=f&&(i[0]=s[0]-f,o=on(t,i,0,n),o&&o.valid)||(i[0]=s[0]+f,o=on(t,i,0,n),o&&o.valid))return o;for(let c=s[0]>=f?s[0]-(f-1):0;c<=s[0]+(f-1);++c)if(i[0]=c,s[1]>=f&&(i[1]=s[1]-f,o=on(t,i,0,n),o&&o.valid)||(i[1]=s[1]+f,o=on(t,i,0,n),o&&o.valid))return o}return n[0]=e[0],n[1]=e[1],null}function Sp(t,e,r,n,a){let s=[],i=0;return e.forEach((o,f)=>{let c=sn.newInstance();switch(c.setContentType(TE.INDICES),t){case jn.FIELD_ASSOCIATION_CELLS:c.setFieldType(vp.CELL);break;case jn.FIELD_ASSOCIATION_POINTS:c.setFieldType(vp.POINT);break;default:dp("Unknown field association")}c.getProperties().propID=o.info.propID,c.getProperties().prop=o.info.prop,c.getProperties().compositeID=o.info.compositeID,c.getProperties().attributeID=o.info.attributeID,c.getProperties().pixelCount=o.pixelCount,r&&(c.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],c.getProperties().worldPosition=a.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,n)),c.setSelectionList(o.attributeIDs),s[i]=c,i++}),s}function SE(t,e,r,n,a){let s=Math.floor(e),i=Math.floor(r),o=Math.floor(n),f=Math.floor(a),c=new Map,g=[0,0];for(let u=i;u<=f;u++)for(let l=s;l<=o;l++){let d=on(t,[l,u],0,g);if(d&&d.valid){let h=yp(d);if(!c.has(h))c.set(h,{info:d,pixelCount:1,attributeIDs:[d.attributeID]});else{let v=c.get(h);v.pixelCount++,t.captureZValues&&d.zValue<v.info.zValue&&(v.info=d),v.attributeIDs.indexOf(d.attributeID)===-1&&v.attributeIDs.push(d.attributeID)}}}return Sp(t.fieldAssociation,c,t.captureZValues,t.renderer,t.openGLRenderWindow)}function CE(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;let n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=an.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();let a=e.framebuffer.getSize();!a||a[0]!==n[0]||a[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===jn.FIELD_ASSOCIATION_POINTS){let a=e._openGLRenderWindow.getContext(),s=a.isEnabled(a.BLEND);a.disable(a.BLEND),e._openGLRenderWindow.traverseAllPasses(),s&&a.enable(a.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{let n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=()=>{let n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=()=>{let n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=async(n,a,s,i,o)=>{if(e._renderer=n,a===void 0){let c=e._openGLRenderWindow.getSize();t.setArea(0,0,c[0]-1,c[1]-1)}else t.setArea(a,s,i,o);if(!t.captureBuffers())return!1;let f={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:n,openGLRenderWindow:e._openGLRenderWindow};return f.generateSelection=function(){for(var c=arguments.length,g=new Array(c),u=0;u<c;u++)g[u]=arguments[u];return SE(f,...g)},f},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return dp("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);let n=e._openGLRenderWindow.getRenderPasses();t.beginSelection();let a=[];for(e.currentPass=we.MIN_KNOWN_PASS;e.currentPass<=we.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===we.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),a.push(e.currentPass));return a.forEach(s=>{e.currentPass=s,t.processPixelBuffers()}),e.currentPass=we.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((n,a)=>{t.isPropHit(a)&&n.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=n=>{if(n===we.ID_HIGH24){if(e.fieldAssociation===jn.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===jn.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=n=>{if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){let a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(a),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===we.ACTOR_PASS){if(e.captureZValues){let a=e._openGLRenderWindow.getRenderPasses();if(typeof a[0].requestDepth=="function"&&typeof a[0].getFramebuffer=="function"){let s=a[0].getFramebuffer();s.saveCurrentBindingsAndBuffers(),s.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),s.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=n=>{let a=0;for(let s=0;s<=e.area[3]-e.area[1];s++)for(let i=0;i<=e.area[2]-e.area[0];i++){let o=$t(i,s,n,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(a*4)),++a}},t.renderProp=n=>{e.currentPass===we.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+or),e.props.push(n))},t.renderCompositeIndex=n=>{e.currentPass===we.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+or)},t.renderAttributeId=n=>{n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=n=>m.enumToString(we,n),t.isPropHit=n=>!!e.hitProps[n],t.setPropColorValueFromInt=n=>{e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=(n,a,s)=>{let i=a<0?0:a;if(i===0){if(s[0]=n[0],s[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;let g=[n[0]-e.area[0],n[1]-e.area[1]],u=$t(g[0],g[1],e.pixBuffer[we.ACTOR_PASS],e.area);if(u<=0||u-or>=e.props.length)return null;let l={};l.valid=!0,l.propID=u-or,l.prop=e.props[l.propID];let p=$t(g[0],g[1],e.pixBuffer[we.COMPOSITE_INDEX_PASS],e.area);if((p<0||p>16777215)&&(p=0),l.compositeID=p-or,e.captureZValues){let v=(g[1]*(e.area[2]-e.area[0]+1)+g[0])*4;l.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,l.displayPosition=n}if(e.pixBuffer[we.ID_LOW24]&&xp(g[0],g[1],e.pixBuffer[we.ID_LOW24],e.area)===0)return l;let d=$t(g[0],g[1],e.pixBuffer[we.ID_LOW24],e.area),h=$t(g[0],g[1],e.pixBuffer[we.ID_HIGH24],e.area);return l.attributeID=Tp(d,h),l}let o=[n[0],n[1]],f=[0,0],c=t.getPixelInformation(n,0,s);if(c&&c.valid)return c;for(let g=1;g<i;++g){for(let u=o[1]>g?o[1]-g:0;u<=o[1]+g;++u)if(f[1]=u,o[0]>=g&&(f[0]=o[0]-g,c=t.getPixelInformation(f,0,s),c&&c.valid)||(f[0]=o[0]+g,c=t.getPixelInformation(f,0,s),c&&c.valid))return c;for(let u=o[0]>=g?o[0]-(g-1):0;u<=o[0]+(g-1);++u)if(f[0]=u,o[1]>=g&&(f[1]=o[1]-g,c=t.getPixelInformation(f,0,s),c&&c.valid)||(f[1]=o[1]+g,c=t.getPixelInformation(f,0,s),c&&c.valid))return c}return s[0]=n[0],s[1]=n[1],null},t.generateSelection=(n,a,s,i)=>{let o=Math.floor(n),f=Math.floor(a),c=Math.floor(s),g=Math.floor(i),u=new Map,l=[0,0];for(let p=f;p<=g;p++)for(let d=o;d<=c;d++){let h=[d,p],v=t.getPixelInformation(h,0,l);if(v&&v.valid){let y=yp(v);if(!u.has(y))u.set(y,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{let C=u.get(y);C.pixelCount++,e.captureZValues&&v.zValue<C.info.zValue&&(C.info=v),C.attributeIDs.indexOf(v.attributeID)===-1&&C.attributeIDs.push(v.attributeID)}}}return Sp(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=n=>e.rawPixBuffer[n],t.getPixelBuffer=n=>e.pixBuffer[n],t.attach=(n,a)=>{e._openGLRenderWindow=n,e._renderer=a};let r=t.setArea;t.setArea=function(){return r(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}var mE={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function Cp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mE,r),cs.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),m.setGetArray(t,e,["area"],4),m.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),m.setGetArray(t,e,["propColorValue"],3),m.moveToProtected(t,e,["renderer","openGLRenderWindow"]),m.event(t,e,"event"),CE(t,e)}var wE=m.newInstance(Cp,"vtkOpenGLHardwareSelector"),bo={newInstance:wE,extend:Cp,...Bo};var Mp=xn(Ep(),1);var EE=["lastShaderProgramBound","context","_openGLRenderWindow"];function ME(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(r,n,a)=>{let s=n;a.length>0&&(s=U.substitute(s,"VSOut","GSOut").result);let i=e._openGLRenderWindow.getWebgl2(),o=`
`,f=`#version 100
`;i?f=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),s=U.substitute(s,"//VTK::System::Dec",[`${f}
`,i?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let c=U.substitute(r,"//VTK::System::Dec",[`${f}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(i){c=U.substitute(c,"varying","out").result,s=U.substitute(s,"varying","in").result;let u="",l=0;for(;s.includes(`gl_FragData[${l}]`);)s=U.substitute(s,`gl_FragData\\[${l}\\]`,`fragOutput${l}`).result,u+=`layout(location = ${l}) out vec4 fragOutput${l};
`,l++;s=U.substitute(s,"//VTK::Output::Dec",u).result}let g=U.substitute(a,"//VTK::System::Dec",f).result;return{VSSource:c,FSSource:s,GSSource:g}},t.readyShaderProgramArray=(r,n,a)=>{let s=t.replaceShaderValues(r,n,a),i=t.getShaderProgram(s.VSSource,s.FSSource,s.GSSource);return t.readyShaderProgram(i)},t.readyShaderProgram=r=>!r||!r.getCompiled()&&!r.compileShader()||!t.bindShaderProgram(r)?null:r,t.getShaderProgram=(r,n,a)=>{let s=`${r}${n}${a}`,i=Mp.default.hash(s);if(!(i in e.shaderPrograms)){let o=U.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(r),o.getFragmentShader().setSource(n),a&&o.getGeometryShader().setSource(a),o.setMd5Hash(i),e.shaderPrograms[i]=o,o}return e.shaderPrograms[i]},t.releaseGraphicsResources=r=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(n=>e.shaderPrograms[n]).forEach(n=>n.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=r=>(e.lastShaderProgramBound===r||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),r.bind(),e.lastShaderProgramBound=r),1)}var RE={lastShaderProgramBound:null,shaderPrograms:null,context:null};function Rp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RE,r),e.shaderPrograms={},m.obj(t,e),m.setGet(t,e,EE),m.moveToProtected(t,e,["openGLRenderWindow"]),ME(t,e)}var OE=m.newInstance(Rp,"vtkShaderCache"),Op={newInstance:OE,extend:Rp};var{vtkErrorMacro:DE}=m;function LE(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&DE("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=r=>{if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=()=>{for(let r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=r=>t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r),t.isAllocated=r=>e.textureUnits[r],t.free=r=>{e.textureUnits[r]=!1},t.freeAll=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}}var VE={context:null,numberOfTextureUnits:0,textureUnits:0};function Dp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VE,r),m.obj(t,e),e.textureUnits=[],m.get(t,e,["numberOfTextureUnits"]),m.setGet(t,e,["context"]),LE(t,e)}var BE=m.newInstance(Dp,"vtkOpenGLTextureUnitManager"),Lp={newInstance:BE,extend:Dp};function FE(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=r=>{let n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=(r,n,a)=>{let s=a.getViewportByReference(),i=t.getFramebufferSize();return s[0]*i[0]<=r&&s[2]*i[0]>=r&&s[1]*i[1]<=n&&s[3]*i[1]>=n},t.getViewportSize=r=>{let n=r.getViewportByReference(),a=t.getFramebufferSize();return[(n[2]-n[0])*a[0],(n[3]-n[1])*a[1]]},t.getViewportCenter=r=>{let n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=(r,n,a)=>{let s=t.getFramebufferSize();return[r/s[0],n/s[1],a]},t.normalizedDisplayToDisplay=(r,n,a)=>{let s=t.getFramebufferSize();return[r*s[0],n*s[1],a]},t.worldToView=(r,n,a,s)=>s.worldToView(r,n,a),t.viewToWorld=(r,n,a,s)=>s.viewToWorld(r,n,a),t.worldToDisplay=(r,n,a,s)=>{let i=s.worldToView(r,n,a),o=t.getViewportSize(s),f=s.viewToProjection(i[0],i[1],i[2],o[0]/o[1]),c=s.projectionToNormalizedDisplay(f[0],f[1],f[2]);return t.normalizedDisplayToDisplay(c[0],c[1],c[2])},t.displayToWorld=(r,n,a,s)=>{let i=t.displayToNormalizedDisplay(r,n,a),o=s.normalizedDisplayToProjection(i[0],i[1],i[2]),f=t.getViewportSize(s),c=s.projectionToView(o[0],o[1],o[2],f[0]/f[1]);return s.viewToWorld(c[0],c[1],c[2])},t.normalizedDisplayToViewport=(r,n,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);let o=t.normalizedDisplayToDisplay(r,n,a);return[o[0]-i[0]-.5,o[1]-i[1]-.5,a]},t.viewportToNormalizedViewport=(r,n,a,s)=>{let i=t.getViewportSize(s);return i&&i[0]!==0&&i[1]!==0?[r/(i[0]-1),n/(i[1]-1),a]:[r,n,a]},t.normalizedViewportToViewport=(r,n,a,s)=>{let i=t.getViewportSize(s);return[r*(i[0]-1),n*(i[1]-1),a]},t.displayToLocalDisplay=(r,n,a)=>{let s=t.getFramebufferSize();return[r,s[1]-n-1,a]},t.viewportToNormalizedDisplay=(r,n,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);let o=r+i[0]+.5,f=n+i[1]+.5;return t.displayToNormalizedDisplay(o,f,a)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{m.vtkErrorMacro("not implemented")},t.getPixelData=(r,n,a,s)=>{m.vtkErrorMacro("not implemented")},t.createSelector=()=>{m.vtkErrorMacro("not implemented")}}var kE={size:void 0,selector:void 0};function Vp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kE,r),e.size||(e.size=[300,300]),m.getArray(t,e,["size"],2),m.get(t,e,["selector"]),I.extend(t,e,r),FE(t,e)}var UE=m.newInstance(Vp,"vtkRenderWindowViewNode"),us={newInstance:UE,extend:Vp};var NE="__getUnderlyingContext";function Bp(){let t=new Map,e={apply(a,s,i){return t.has(i[0])?t.get(i[0]):a.apply(s,i)}};function r(a){return{apply(s,i,o){return t.set(a,o[0]),s.apply(i,o)}}}let n=Object.create(null);return n.getParameter=(a,s,i,o)=>new Proxy(o.bind(a),e),n.depthMask=(a,s,i,o)=>new Proxy(o.bind(a),r(a.DEPTH_WRITEMASK)),{get(a,s,i){if(s===NE)return()=>a;let o=Reflect.get(a,s,a);o instanceof Function&&(o=o.bind(a));let f=n[s];return f?f(a,s,i,o):o}}}var{vtkDebugMacro:Fp,vtkErrorMacro:kp}=m,GE={position:"absolute",top:0,left:0,width:"100%",height:"100%"},_E=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function je(t,e,r){let n=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),s===t.FRAMEBUFFER_COMPLETE}var gs=0,Np=[];function bE(){gs++,Np.forEach(t=>t(gs))}function zE(){gs--,Np.forEach(t=>t(gs))}function Up(t){t.preventDefault()}function WE(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let r;function n(){return r||(r=Bp()),r}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Up,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);let a=[0,0];function s(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(s),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(l=>{l.setOpenGLRenderWindow?.(t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&bE(),e.textureUnitManager=Lp.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);let u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&kp("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){let{width:u,height:l}=e.el.getBoundingClientRect();e.containerSize=[u,l]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.activeFramebuffer?.getSize()||e.size,t.getPixelData=(u,l,p,d)=>{let h=new Uint8Array((p-u+1)*(d-l+1)*4);return e.context.readPixels(u,l,p-u+1,d-l+1,e.context.RGBA,e.context.UNSIGNED_BYTE,h),h},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},l=null,p=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&p&&(l=e.canvas.getContext("webgl2",u),l&&(e.webgl2=!0,Fp("using webgl2"))),l||(Fp("using webgl1"),l=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(l,n())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{let u=Ue.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{let l=e._textureResourceIds.get(u);if(l!==void 0){e.context.activeTexture(e.context.TEXTURE0+l);return}let p=t.getTextureUnitManager().allocate();if(p<0){kp("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,p),e.context.activeTexture(e.context.TEXTURE0+p)},t.deactivateTexture=u=>{let l=e._textureResourceIds.get(u);l!==void 0&&(t.getTextureUnitManager().free(l),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{let l=e._textureResourceIds.get(u);return l!==void 0?l:-1},t.getDefaultTextureByteSize=function(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case ge.CHAR:case ge.SIGNED_CHAR:case ge.UNSIGNED_CHAR:return 1;case l:case p:case ge.UNSIGNED_SHORT:case ge.SHORT:case ge.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case ge.UNSIGNED_CHAR:switch(l){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(p&&!d&&ge.UNSIGNED_SHORT):switch(l){case 1:return p.R16_EXT;case 2:return p.RG16_EXT;case 3:return p.RGB16_EXT;case 4:default:return p.RGBA16_EXT}case(p&&!d&&ge.SHORT):switch(l){case 1:return p.R16_SNORM_EXT;case 2:return p.RG16_SNORM_EXT;case 3:return p.RGB16_SNORM_EXT;case 4:default:return p.RGBA16_SNORM_EXT}case ge.UNSIGNED_SHORT:case ge.SHORT:case ge.FLOAT:default:switch(l){case 1:return d?e.context.R16F:e.context.R32F;case 2:return d?e.context.RG16F:e.context.RG32F;case 3:return d?e.context.RGB16F:e.context.RGB32F;case 4:default:return d?e.context.RGBA16F:e.context.RGBA32F}}switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function i(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat,l=document.createElement("canvas"),p=l.getContext("2d");l.width=e.canvas.width,l.height=e.canvas.height,p.drawImage(e.canvas,0,0);let d=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(C=>{C.getViewProps().forEach(T=>{if(T.getContainer){let S=T.getContainer().getElementsByTagName("canvas");for(let M=0;M<S.length;M++){let E=S[M],R=E.getBoundingClientRect(),D=R.x-d.x,L=R.y-d.y;p.drawImage(E,D,L)}}})});let y=l.toDataURL(u);l.remove(),t.invokeImageReady(y)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:l=!1,size:p=null,scale:d=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;let h=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:p||d!==1?p||e.size.map(v=>v*d):null},new Promise((v,y)=>{let C=t.onImageReady(x=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=h,C.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(T=>{let{restoreParamsFn:w,arg:S}=T;return w(S)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),v(x);else{let T=document.createElement("img");if(T.style=GE,T.src=x,e._screenshot.placeHolder=e.el.appendChild(T),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e.rootOpenGLRenderWindow?.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),l){let w=l!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(S=>{let M=S.getActiveCamera(),E=M.get("focalPoint","position","parallelScale");return{resetCameraArgs:w?{renderer:S}:void 0,resetCameraFn:w?l:S.resetCamera,restoreParamsFn:M.set,arg:JSON.parse(JSON.stringify(E))}}),e._screenshot.cameras.forEach(S=>{let{resetCameraFn:M,resetCameraArgs:E}=S;return M(E)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;let u=t.get3DContext(),l=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return o=l[1],l[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;let u=t.get3DContext(),l=u.getExtension("OES_texture_float"),p=u.getExtension("OES_texture_half_float"),d=u.getExtension("WEBGL_debug_renderer_info"),h=u.getExtension("WEBGL_draw_buffers"),v=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),y=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",v&&u.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[l&&je(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",l&&je(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",l&&je(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",l&&je(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",l&&je(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[p&&je(u,u.RGBA,p.HALF_FLOAT_OES)?"RGBA":"",p&&je(u,u.RGB,p.HALF_FLOAT_OES)?"RGB":"",p&&je(u,u.LUMINANCE,p.HALF_FLOAT_OES)?"LUMINANCE":"",p&&je(u,u.ALPHA,p.HALF_FLOAT_OES)?"ALPHA":"",p&&je(u,u.LUMINANCE_ALPHA,p.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[l&&je(u,u.RGBA,u.FLOAT)?"RGBA":"",l&&je(u,u.RGB,u.FLOAT)?"RGB":"",l&&je(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",l&&je(u,u.ALPHA,u.FLOAT)?"ALPHA":"",l&&je(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",h?u.getParameter(h.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",d&&u.getParameter(d.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",d&&u.getParameter(d.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],C={};for(;y.length;){let[x,T,w]=y.pop();T&&(C[T]={label:x,value:w})}return e._glInformation=C,C},t.traverseAllPasses=()=>{if(e.renderPasses)for(let l=0;l<e.renderPasses.length;++l)e.renderPasses[l].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&i();let u=e.renderable.getChildRenderWindowsByReference();for(let l=0;l<u.length;++l)t.getViewNodeFor(u[l])?.traverseAllPasses()},t.copyParentContent=()=>{let u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(d=>!!d.getSelector?.()))return;let l=u.getCanvas(),p=e.canvas;e.context2D.drawImage(l,0,l.height-p.height,p.width,p.height,0,0,p.width,p.height)},t.resizeFromChildRenderWindows=()=>{let u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){let l=[0,0];for(let p=0;p<u.length;++p){let d=t.getViewNodeFor(u[p])?.getSize();d&&(l[0]=d[0]>l[0]?d[0]:l[0],l[1]=d[1]>l[1]?d[1]:l[1])}t.setSize(...l)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){let l=e.renderable.getRenderers()[0];l.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(p=>t.setBackgroundImage(p.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{let u=bo.newInstance();return u.setOpenGLRenderWindow(t),u};function f(){e.canvas.removeEventListener("webglcontextlost",Up),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=m.chain(()=>{e.context&&zE(),t.setContainer(),t.setViewStream()},f,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};let c=t.setSize;t.setSize=(u,l)=>{let p=c(u,l);return p&&t.invokeWindowResizeEvent({width:u,height:l}),p},t.registerGraphicsResourceUser=(u,l)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null),e._graphicsResources.get(u)?.users.add(l)},t.unregisterGraphicsResourceUser=(u,l)=>{let p=e._graphicsResources.get(u);p&&(p.users.delete(l),p.users.size||(p.oglObject?.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,l,p)=>{if(!u)return;let d=e._graphicsResources.get(u);d?.oglObject?.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:l,hash:p,users:d?.users??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(l=>{let{oglObject:p}=l;u+=p.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:l}=u;l.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{t.getViewNodeFor(u)?.releaseGraphicsResources()})};let g={...t};_E.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):g[u](...arguments)}})}var HE={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function AE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HE,r),us.extend(t,e,r),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=bo.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=j0.newInstance(),e.shaderCache=Op.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=gp.newInstance(),m.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),m.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),m.setGetArray(t,e,["size"],2),m.event(t,e,"imageReady"),m.event(t,e,"windowResizeEvent"),WE(t,e)}var Gp=m.newInstance(AE,"vtkOpenGLRenderWindow");Fn("WebGL",Gp);de("vtkRenderWindow",Gp);function $E(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(r,n)=>{e.device=r,e.handle=e.device.getHandle().createShaderModule({code:n.getCode()})}}var jE={device:null,handle:null};function _p(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jE,r),m.obj(t,e),m.get(t,e,["lastCameraMTime"]),m.setGet(t,e,["device","handle"]),$E(t,e)}var KE=m.newInstance(_p,"vtkWebGPUShaderModule"),bp={newInstance:KE,extend:_p};function PE(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Array.isArray(r)?r.join(`
`):r,s=!1;t.search(e)!==-1&&(s=!0);let i="";n&&(i="g");let o=new RegExp(e,i),f=t.replace(o,a);return{replace:s,result:f}}function XE(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=r=>{let n=r.getType(),a=r.getHash(),s=e._shaderModules.keys();for(let o=0;o<s.length;o++){let f=s[o];if(f.getHash()===a&&f.getType()===n)return e._shaderModules.get(f)}let i=bp.newInstance();return i.initialize(e.device,r),e._shaderModules.set(r,i),i}}var YE={shaderModules:null,device:null,window:null};function zp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YE,r),e._shaderModules=new Map,m.obj(t,e),m.setGet(t,e,["device","window"]),XE(t,e)}var IE=m.newInstance(zp,"vtkWebGPUShaderCache"),K={newInstance:IE,extend:zp,substitute:PE};function qE(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=r=>{if(e.bindables.length===r.length){let n=!0;for(let a=0;a<e.bindables.length;a++)e.bindables[a]!==r[a]&&(n=!1);if(n)return}e.bindables=r,t.modified()},t.getBindGroupLayout=r=>{let n=[];for(let a=0;a<e.bindables.length;a++){let s=e.bindables[a].getBindGroupLayoutEntry();s.binding=a,n.push(s)}return r.getBindGroupLayout({entries:n})},t.getBindGroup=r=>{let n=t.getMTime();for(let s=0;s<e.bindables.length;s++){let i=e.bindables[s].getBindGroupTime().getMTime();n=i>n?i:n}if(n<e.bindGroupTime.getMTime())return e.bindGroup;let a=[];for(let s=0;s<e.bindables.length;s++){let i=e.bindables[s].getBindGroupEntry();i.binding=s,a.push(i)}return e.bindGroup=r.getHandle().createBindGroup({layout:t.getBindGroupLayout(r),entries:a,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=r=>{let n=[],a=r.getBindGroupLayoutCount(e.label);for(let s=0;s<e.bindables.length;s++)n.push(e.bindables[s].getShaderCode(s,a));return n.join(`
`)}}var ZE={device:null,handle:null,label:null};function Wp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZE,r),m.obj(t,e),e.bindables=[],e.bindGroupTime={},m.obj(e.bindGroupTime,{mtime:0}),m.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),m.setGet(t,e,["label","device","arrayInformation"]),qE(t,e)}var QE=m.newInstance(Wp),ls={newInstance:QE,extend:Wp};function JE(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(r,n)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=n;let a=[];for(let s=0;s<e.layouts.length;s++)a.push(e.layouts[s].layout);e.pipelineLayout=r.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(let s=0;s<e.shaderDescriptions.length;s++){let i=e.shaderDescriptions[s],o=r.getShaderModule(i);i.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),i.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=r.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=r=>{for(let n=0;n<e.shaderDescriptions.length;n++)if(e.shaderDescriptions[n].getType()===r)return e.shaderDescriptions[n];return null},t.addBindGroupLayout=r=>{r&&e.layouts.push({layout:r.getBindGroupLayout(e.device),label:r.getLabel()})},t.getBindGroupLayout=r=>e.layouts[r].layout,t.getBindGroupLayoutCount=r=>{for(let n=0;n<e.layouts.length;n++)if(e.layouts[n].label===r)return n;return 0},t.bindVertexInput=(r,n)=>{n.bindBuffers(r)}}var eM={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function Hp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eM,r),ne(t,e),e.layouts=[],e.shaderDescriptions=[],pe(t,e,["handle","pipelineDescription"]),re(t,e,["device","renderEncoder","topology","vertexState"]),JE(t,e)}var tM=j(Hp,"vtkWebGPUPipeline"),Ap={newInstance:tM,extend:Hp};function rM(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=r=>e.outputNames.includes(r),t.addOutput=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(r),e.outputNames.push(n),e.outputInterpolations.push(a)},t.addBuiltinOutput=(r,n)=>{e.builtinOutputTypes.push(r),e.builtinOutputNames.push(n)},t.addBuiltinInput=(r,n)=>{e.builtinInputTypes.push(r),e.builtinInputNames.push(n)},t.replaceShaderCode=(r,n)=>{let a=[],s=[];if(n&&a.push(n.getShaderCode()),r||e.builtinInputNames.length){let i=[];if(i.push(`struct ${e.type}Input
{`),r){let o=r.getOutputNamesByReference(),f=r.getOutputTypesByReference(),c=r.getOutputInterpolationsByReference();for(let g=0;g<o.length;g++)c[g]!==void 0?i.push(`  @location(${g}) @interpolate(${c[g]}) ${o[g]} : ${f[g]},`):i.push(`  @location(${g}) ${o[g]} : ${f[g]},`)}for(let o=0;o<e.builtinInputNames.length;o++)i.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);i.length>1&&(i.push("};"),s=i,a[a.length-1]+=",",a.push(`input: ${e.type}Input`))}if(a.length&&(e.code=K.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){let i=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?i.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):i.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)i.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);i.push("};"),s=s.concat(i),e.code=K.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=K.substitute(e.code,"//VTK::IOStructs::Dec",s).result}}var nM={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function $p(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nM,r),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],m.obj(t,e),m.setGet(t,e,["type","hash","code"]),m.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),rM(t,e)}var aM=m.newInstance($p,"vtkWebGPUShaderDescription"),zo={newInstance:aM,extend:$p};var jp={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function sM(t){return!t||t.length<6?0:t in jp?jp[t]:(q(`unknown format ${t}`),null)}function iM(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));let r=e===1?t.length-1:t.length-3,n=Number(t[r]);if(Number.isNaN(n))return q(`unknown format ${t}`),0;let a=5-n/2;return e*a}function oM(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function fM(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{q(`unknown format ${t}`);return}let r=t.split("x")[0],n=Number(r[r.length-1]);if(Number.isNaN(n)){q(`unknown format ${t}`);return}return e+=8*(5-n/2),e+="Array",e}function cM(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{q(`unknown format ${t}`);return}let r=1;return t[t.length-2]==="x"&&(r=Number(t[t.length-1])),r===4?`vec4<${e}>`:r===3?`vec3<${e}>`:r===2?`vec2<${e}>`:e}function uM(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function gM(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";q(`unknown format ${t}`)}}var le={getDetailsFromTextureFormat:sM,getByteStrideFromBufferFormat:iM,getNumberOfComponentsFromBufferFormat:oM,getNativeTypeFromBufferFormat:fM,getShaderTypeFromBufferFormat:cM,getByteStrideFromShaderFormat:uM,getNativeTypeFromShaderFormat:gM};function lM(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!e.includes(t[r]))return!1;return!0}function pM(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",s=n;Array.isArray(s)||(s=[s]);for(let i=0;i<e.inputs.length;i++)if(lM(e.inputs[i].names,s)){if(e.inputs[i].buffer===r)return;e.inputs[i].buffer=r;return}e.inputs.push({buffer:r,stepMode:a,names:s}),e.inputs=e.inputs.sort((i,o)=>i.names[0]<o.names[0]?-1:i.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=r=>{for(let n=0;n<e.inputs.length;n++)e.inputs[n].names.includes(r)&&e.inputs.splice(n,1)},t.getBuffer=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer;return null},t.hasAttribute=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return!0;return!1},t.getAttributeTime=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let r="",n=0;for(let a=0;a<e.inputs.length;a++)for(let s=0;s<e.inputs[a].names.length;s++){let i=e.inputs[a].buffer.getArrayInformation()[s],o=le.getShaderTypeFromBufferFormat(i.format);n>0&&(r+=`,
`),r=`${r}  @location(${n}) ${e.inputs[a].names[s]} : ${o}`,n++}return r},t.getVertexInputInformation=()=>{let r={};if(e.inputs.length){let n=[],a=0;for(let s=0;s<e.inputs.length;s++){let i=e.inputs[s].buffer,o={arrayStride:i.getStrideInBytes(),stepMode:e.inputs[s].stepMode,attributes:[]},f=i.getArrayInformation();for(let c=0;c<e.inputs[s].names.length;c++)o.attributes.push({shaderLocation:a,offset:f[c].offset,format:f[c].format}),a++;n.push(o)}r.buffers=n}return r},t.bindBuffers=r=>{for(let n=0;n<e.inputs.length;n++)r.setVertexBuffer(n,e.inputs[n].buffer.getHandle());e.indexBuffer&&r.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}var hM={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function Kp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hM,r),ne(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],re(t,e,["created","device","handle","indexBuffer"]),pM(t,e)}var vM=j(Kp,"vtkWebGPUVertexInput"),Pp={newInstance:vM,extend:Kp};var dM=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,yM=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function xM(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(r,n,a)=>{let s=zo.newInstance({type:"vertex",hash:r,code:e.vertexShaderTemplate}),i=zo.newInstance({type:"fragment",hash:r,code:e.fragmentShaderTemplate}),o=n.getShaderDescriptions();o.push(s),o.push(i);let f=e.vertexShaderTemplate+e.fragmentShaderTemplate,c=new RegExp("//VTK::[^:]*::","g"),u=f.match(c).filter((l,p,d)=>d.indexOf(l)===p).map(l=>`replaceShader${l.substring(7,l.length-2)}`);for(let l=0;l<u.length;l++){let p=u[l];p!=="replaceShaderIOStructs"&&e.shaderReplacements.has(p)&&e.shaderReplacements.get(p)(r,n,a)}t.replaceShaderIOStructs(r,n,a)},t.replaceShaderIOStructs=(r,n,a)=>{let s=n.getShaderDescription("vertex");s.replaceShaderCode(null,a),n.getShaderDescription("fragment").replaceShaderCode(s)},t.replaceShaderRenderEncoder=(r,n,a)=>{e.renderEncoder.replaceShaderCode(n)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(r,n,a)=>{if(!e.WebGPURenderer)return;let s=e.WebGPURenderer.getBindGroup().getShaderCode(n),i=n.getShaderDescription("vertex"),o=i.getCode();o=K.substitute(o,"//VTK::Renderer::Dec",[s]).result,i.setCode(o);let f=n.getShaderDescription("fragment");o=f.getCode(),o=K.substitute(o,"//VTK::Renderer::Dec",[s]).result,f.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(r,n,a)=>{let s=e.bindGroup.getShaderCode(n),i=n.getShaderDescription("vertex"),o=i.getCode();o=K.substitute(o,"//VTK::Mapper::Dec",[s]).result,i.setCode(o);let f=n.getShaderDescription("fragment");f.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=f.getCode(),o=K.substitute(o,"//VTK::Mapper::Dec",[s]).result,f.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(r,n,a)=>{let s=n.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let i=s.getCode();i=K.substitute(i,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(r,n,a)=>{n.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=r=>{e.textureViews.includes(r)||e.textureViews.push(r)},t.prepareToDraw=r=>{e.renderEncoder=r,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=r=>{r.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=r=>{t.prepareToDraw(r),r.setPipeline(e.pipeline),t.draw(r)},t.draw=r=>{let n=r.getBoundPipeline();r.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(r),n.bindVertexInput(r,e.vertexInput);let a=e.vertexInput.getIndexBuffer();a?r.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):r.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{let r=[...e.additionalBindables];e.UBO&&r.push(e.UBO),e.SSBO&&r.push(e.SSBO);for(let n=0;n<e.textureViews.length;n++){r.push(e.textureViews[n]);let a=e.textureViews[n].getSampler();a&&r.push(a)}return r},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Ap.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}var TM={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function Xp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TM,r),I.extend(t,e,r),e.textureViews=[],e.vertexInput=Pp.newInstance(),e.bindGroup=ls.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||yM,e.vertexShaderTemplate=e.vertexShaderTemplate||dM,e.shaderReplacements=new Map,m.get(t,e,["pipeline","vertexInput"]),m.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),xM(t,e)}var SM=m.newInstance(Xp,"vtkWebGPUSimpleMapper"),fn={newInstance:SM,extend:Xp};function CM(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(r,n,a)=>{let s=n.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();i=K.substitute(i,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{let r=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(r,["vertexBC"]),e.numberOfVertices=6}}var mM={};function Yp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mM,r),fn.extend(t,e,r),CM(t,e)}var wM=m.newInstance(Yp,"vtkWebGPUFullScreenQuad"),xt={newInstance:wM,extend:Yp};var Wo=["setBindGroup","setIndexBuffer","setVertexBuffer","draw","drawIndexed"];function EM(t,e){e.classHierarchy.push("vtkWebGPURenderEncoder"),t.begin=r=>{e.drawCallbacks=[],e.handle=r.beginRenderPass(e.description),e.label&&e.handle.pushDebugGroup(e.label)},t.end=()=>{for(let r=0;r<e.drawCallbacks.length;r++){let n=e.drawCallbacks[r],a=n.pipeline;t.setPipeline(a);for(let s=0;s<n.callbacks.length;s++)n.callbacks[s](t)}e.label&&e.handle.popDebugGroup(),e.handle.end(),e.boundPipeline=null},t.setPipeline=r=>{if(e.boundPipeline===r)return;e.handle.setPipeline(r.getHandle());let n=r.getPipelineDescription();if(e.colorTextureViews.length!==n.fragment.targets.length)console.log(`mismatched attachment counts on pipeline ${n.fragment.targets.length} while encoder has ${e.colorTextureViews.length}`),console.trace();else for(let a=0;a<e.colorTextureViews.length;a++){let s=e.colorTextureViews[a].getTexture()?.getFormat();s&&s!==n.fragment.targets[a].format&&(console.log(`mismatched attachments for attachment ${a} on pipeline ${n.fragment.targets[a].format} while encoder has ${s}`),console.trace())}if(!e.depthTextureView!=!("depthStencil"in n))console.log("mismatched depth attachments"),console.trace();else if(e.depthTextureView){let a=e.depthTextureView.getTexture()?.getFormat();a&&a!==n.depthStencil.format&&(console.log(`mismatched depth attachments on pipeline ${n.depthStencil.format} while encoder has ${a}`),console.trace())}e.boundPipeline=r},t.replaceShaderCode=r=>{e.replaceShaderCodeFunction(r)},t.setColorTextureView=(r,n)=>{e.colorTextureViews[r]!==n&&(e.colorTextureViews[r]=n)},t.activateBindGroup=r=>{let n=e.boundPipeline.getDevice(),a=e.boundPipeline.getBindGroupLayoutCount(r.getLabel());e.handle.setBindGroup(a,r.getBindGroup(n));let s=n.getBindGroupLayoutDescription(r.getBindGroupLayout(n)),i=n.getBindGroupLayoutDescription(e.boundPipeline.getBindGroupLayout(a));s!==i&&(console.log(`renderEncoder ${e.pipelineHash} mismatched bind group layouts bind group has
${s}
 versus pipeline
${i}
`),console.trace())},t.attachTextureViews=()=>{for(let r=0;r<e.colorTextureViews.length;r++)e.description.colorAttachments[r]?e.description.colorAttachments[r].view=e.colorTextureViews[r].getHandle():e.description.colorAttachments[r]={view:e.colorTextureViews[r].getHandle()};e.depthTextureView&&(e.description.depthStencilAttachment.view=e.depthTextureView.getHandle())},t.registerDrawCallback=(r,n)=>{for(let a=0;a<e.drawCallbacks.length;a++)if(e.drawCallbacks[a].pipeline===r){e.drawCallbacks[a].callbacks.push(n);return}e.drawCallbacks.push({pipeline:r,callbacks:[n]})};for(let r=0;r<Wo.length;r++)t[Wo[r]]=function(){return e.handle[Wo[r]](...arguments)}}var MM={description:null,handle:null,boundPipeline:null,pipelineHash:null,pipelineSettings:null,replaceShaderCodeFunction:null,depthTextureView:null,label:null};function Ip(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MM,r),ne(t,e),e.description={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:void 0,depthLoadOp:"clear",depthClearValue:0,depthStoreOp:"store"}},e.replaceShaderCodeFunction=n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = computedColor;"]).result,a.setCode(s)},e.pipelineSettings={primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater-equal",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},e.colorTextureViews=[],pe(t,e,["boundPipeline","colorTextureViews"]),re(t,e,["depthTextureView","description","handle","label","pipelineHash","pipelineSettings","replaceShaderCodeFunction"]),EM(t,e)}var RM=j(Ip,"vtkWebGPURenderEncoder"),Je={newInstance:RM,extend:Ip};function OM(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=r,e.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",e.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",e.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",e.options.magFilter=n.magFilter?n.magFilter:"nearest",e.options.minFilter=n.minFilter?n.minFilter:"nearest",e.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(r,n)=>`@binding(${r}) @group(${n}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}var DM={device:null,handle:null,label:null,options:null};function qp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DM,r),m.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},m.obj(e.bindGroupTime,{mtime:0}),m.get(t,e,["bindGroupTime","handle","options"]),m.setGet(t,e,["bindGroupLayoutEntry","device","label"]),OM(t,e)}var LM=m.newInstance(qp),cn={newInstance:LM,extend:qp};function VM(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(r,n)=>{e.texture=r,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;let a=le.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=a.sampleType},t.createFromTextureHandle=(r,n)=>{e.texture=null,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;let a=le.getDetailsFromTextureFormat(n.format);e.bindGroupLayoutEntry.texture.sampleType=a.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(r,n)=>{let a="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?a="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(a="u32");let s=`@binding(${r}) @group(${n}) var ${e.label}: texture_${e.options.dimension}<${a}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(s=`@binding(${r}) @group(${n}) var ${e.label}: texture_depth_${e.options.dimension};`),s},t.addSampler=(r,n)=>{let a=cn.newInstance({label:`${e.label}Sampler`});a.create(r,n),t.setSampler(a)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}var BM={texture:null,handle:null,sampler:null,label:null};function Zp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BM,r),m.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},m.obj(e.bindGroupTime,{mtime:0}),m.get(t,e,["bindGroupTime","texture"]),m.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),VM(t,e)}var FM=m.newInstance(Zp),ps={newInstance:FM,extend:Zp};function kM(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=r=>{e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.imageBitmap=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setImageBitmap=r=>{e.imageBitmap!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.jsImageData=null),e.imageBitmap=r,e.imageLoaded=!0,t.modified())},t.setCanvas=r=>{e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.imageBitmap=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=r=>{e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null,e.imageBitmap=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let r=0,n=0,a=1;if(t.getInputData()){let i=t.getInputData();r=i.getDimensions()[0],n=i.getDimensions()[1],a=i.getDimensions()[2]}return e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height),e.imageBitmap&&(r=e.imageBitmap.width,n=e.imageBitmap.height),(r>1)+(n>1)+(a>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData;if(e.imageBitmap)return e.imageBitmap;if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){let r=e.image.width,n=e.image.height,s=new OffscreenCanvas(r,n).getContext("2d");return s.translate(0,n),s.scale(1,-1),s.drawImage(e.image,0,0,r,n),s.getImageData(0,0,r,n)}return null}}var UM=(t,e,r)=>{let a=t.createShaderModule({code:`
    @group(0) @binding(0) var inputTexture: texture_2d<f32>;
    @group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;

    @compute @workgroup_size(8, 8)
    fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
      let texelCoord = vec2<i32>(global_id.xy);
      let outputSize = textureDimensions(outputTexture);

      if (texelCoord.x >= i32(outputSize.x) || texelCoord.y >= i32(outputSize.y)) {
        return;
      }

      let inputSize = textureDimensions(inputTexture);
      let scale = vec2<f32>(inputSize) / vec2<f32>(outputSize);

      // Compute the floating-point source coordinate
      let srcCoord = (vec2<f32>(texelCoord) + 0.5) * scale - 0.5;

      // Get integer coordinates for the four surrounding texels
      let x0 = i32(floor(srcCoord.x));
      let x1 = min(x0 + 1, i32(inputSize.x) - 1);
      let y0 = i32(floor(srcCoord.y));
      let y1 = min(y0 + 1, i32(inputSize.y) - 1);

      // Compute the weights
      let wx = srcCoord.x - f32(x0);
      let wy = srcCoord.y - f32(y0);

      // Fetch the four texels
      let c00 = textureLoad(inputTexture, vec2<i32>(x0, y0), 0);
      let c10 = textureLoad(inputTexture, vec2<i32>(x1, y0), 0);
      let c01 = textureLoad(inputTexture, vec2<i32>(x0, y1), 0);
      let c11 = textureLoad(inputTexture, vec2<i32>(x1, y1), 0);

      // Bilinear interpolation
      let color = mix(
        mix(c00, c10, wx),
        mix(c01, c11, wx),
        wy
      );

      textureStore(outputTexture, texelCoord, color);
    }
  `}),s=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm",access:"write-only"}},{binding:2,visibility:GPUShaderStage.COMPUTE,sampler:{type:"filtering"}}]}),i=t.createPipelineLayout({bindGroupLayouts:[s]}),o=t.createComputePipeline({label:"ComputeMipmapPipeline",layout:i,compute:{module:a,entryPoint:"main"}}),f=t.createSampler({magFilter:"linear",minFilter:"linear"});for(let c=1;c<r;c++){let g=e.createView({baseMipLevel:c-1,mipLevelCount:1}),u=e.createView({baseMipLevel:c,mipLevelCount:1}),l=t.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:g},{binding:1,resource:u},{binding:2,resource:f}]}),p=t.createCommandEncoder({label:"MipmapGenerateCommandEncoder"}),d=p.beginComputePass();d.setPipeline(o),d.setBindGroup(0,l);let h=Math.max(1,e.width>>c),v=Math.max(1,e.height>>c),y=Math.ceil(h/8),C=Math.ceil(v/8);d.dispatchWorkgroups(y,C),d.end(),t.queue.submit([p.finish()])}},NM={image:null,canvas:null,jsImageData:null,imageBitmap:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function Qp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NM,r),m.obj(t,e),m.algo(t,e,6,0),m.get(t,e,["canvas","image","jsImageData","imageBitmap","imageLoaded","resizable"]),m.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),kM(t,e)}var GM=m.newInstance(Qp,"vtkTexture"),_M={generateMipmaps:UM},jt={newInstance:GM,extend:Qp,..._M};function bM(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(r,n)=>{e.device=r,e.width=n.width,e.height=n.height,e.depth=n.depth?n.depth:1;let a=e.depth===1?"2d":"3d";e.format=n.format?n.format:"rgba8unorm",e.mipLevel=n.mipLevel?n.mipLevel:0,e.usage=n.usage?n.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:a,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(r,n,a)=>{e.device=r,e.handle=n,e.width=a.width,e.height=a.height,e.depth=a.depth?a.depth:1,e.format=a.format?a.format:"rgba8unorm",e.usage=a.usage?a.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=r=>{let n=[],a=u=>{e.device.getHandle().queue.copyExternalImageToTexture({source:u,flipY:r.flip},{texture:e.handle,premultipliedAlpha:!0,mipLevel:0,origin:{x:0,y:0,z:0}},[u.width,u.height,e.depth]),t.getDimensionality()!==3&&e.mipLevel>0&&jt.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0};if(r.canvas){a(r.canvas);return}if(r.imageBitmap){r.width=r.imageBitmap.width,r.height=r.imageBitmap.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,a(r.imageBitmap);return}if(r.jsImageData){r.width=r.jsImageData.width,r.height=r.jsImageData.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,a(r.jsImageData);return}if(r.image){r.width=r.image.width,r.height=r.image.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,a(r.image);return}let s=le.getDetailsFromTextureFormat(e.format),i=e.width*s.stride,o=(u,l,p)=>{let d=s.elementSize===2&&s.sampleType==="float",h=u.BYTES_PER_ELEMENT,v=u.length/(l*p)*h;if(!d&&v%256===0)return[u,v];let y=v/h,C=s.elementSize,x=256*Math.floor((y*C+255)/256),T=x/C,w=m.newTypedArray(d?"Uint16Array":u.constructor.name,T*l*p),S=l*p;if(d)for(let M=0;M<S;M++){let E=M*y,R=M*T;for(let D=0;D<y;D++)w[R+D]=Ze.toHalf(u[E+D])}else if(T===y)w.set(u);else for(let M=0;M<S;M++)w.set(u.subarray(M*y,(M+1)*y),M*T);return[w,x]};r.nativeArray&&(n=r.nativeArray);let f=t.getDimensionality()===3,c=o(n,e.height,f?e.depth:1);i=c[1];let g=c[0];e.device.getHandle().queue.writeTexture({texture:e.handle,mipLevel:0,origin:{x:0,y:0,z:0}},g,{offset:0,bytesPerRow:i,rowsPerImage:e.height},{width:e.width,height:e.height,depthOrArrayLayers:f?e.depth:1}),!f&&e.mipLevel>0&&jt.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0},t.getScale=()=>{let r=le.getDetailsFromTextureFormat(e.format);return r.elementSize===2&&r.sampleType==="float"?1:255},t.getNumberOfComponents=()=>le.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let r=0;return e.width>1&&r++,e.height>1&&r++,e.depth>1&&r++,r},t.resizeToMatch=r=>{(r.getWidth()!==e.width||r.getHeight()!==e.height||r.getDepth()!==e.depth)&&(e.width=r.getWidth(),e.height=r.getHeight(),e.depth=r.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(r!==e.width||n!==e.height||a!==e.depth)&&(e.width=r,e.height=n,e.depth=a,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n.dimension||(n.dimension=e.depth===1?"2d":"3d");let a=ps.newInstance({label:r});return a.create(t,n),a}}var zM={device:null,handle:null,buffer:null,ready:!1,label:null};function Jp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zM,r),m.obj(t,e),m.get(t,e,["handle","ready","width","height","depth","format","usage"]),m.setGet(t,e,["device","label"]),bM(t,e)}var WM=m.newInstance(Jp),Ke={newInstance:WM,extend:Jp};function HM(t,e){e.classHierarchy.push("vtkWebGPUOpaquePass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n;let a=n.getDevice();if(e.renderEncoder)e.colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e.depthTexture.resize(n.getCanvas().width,n.getCanvas().height);else{t.createRenderEncoder(),e.colorTexture=Ke.newInstance({label:"opaquePassColor"}),e.colorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});let s=e.colorTexture.createView("opaquePassColorTexture");e.renderEncoder.setColorTextureView(0,s),e.depthFormat="depth32float",e.depthTexture=Ke.newInstance({label:"opaquePassDepth"}),e.depthTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:e.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});let i=e.depthTexture.createView("opaquePassDepthTexture");e.renderEncoder.setDepthTextureView(i)}e.renderEncoder.attachTextureViews(),t.setCurrentOperation("opaquePass"),r.setRenderEncoder(e.renderEncoder),r.traverse(t)},t.getColorTextureView=()=>e.renderEncoder.getColorTextureViews()[0],t.getDepthTextureView=()=>e.renderEncoder.getDepthTextureView(),t.createRenderEncoder=()=>{e.renderEncoder=Je.newInstance({label:"OpaquePass"}),e.renderEncoder.setPipelineHash("op")}}var AM={renderEncoder:null,colorTexture:null,depthTexture:null};function eh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AM,r),Ue.extend(t,e,r),m.get(t,e,["colorTexture","depthTexture"]),HM(t,e)}var $M=m.newInstance(eh,"vtkWebGPUOpaquePass"),th={newInstance:$M,extend:eh};var jM=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec2<i32> = vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y));
  var reveal: f32 = textureLoad(oitpAccumTexture, tcoord, 0).r;
  if (reveal == 1.0) { discard; }
  var tcolor: vec4<f32> = textureLoad(oitpColorTexture, tcoord, 0);
  var total: f32 = max(tcolor.a, 0.01);
  var computedColor: vec4<f32> = vec4<f32>(tcolor.r/total, tcolor.g/total, tcolor.b/total, 1.0 - reveal);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function KM(t,e){e.classHierarchy.push("vtkWebGPUOrderIndependentTranslucentPass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n;let a=n.getDevice();if(e.translucentRenderEncoder)e.translucentColorTexture.resizeToMatch(e.colorTextureView.getTexture()),e.translucentAccumulateTexture.resizeToMatch(e.colorTextureView.getTexture());else{t.createRenderEncoder(),t.createFinalEncoder(),e.translucentColorTexture=Ke.newInstance({label:"translucentPassColor"}),e.translucentColorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let s=e.translucentColorTexture.createView("oitpColorTexture");e.translucentRenderEncoder.setColorTextureView(0,s),e.translucentAccumulateTexture=Ke.newInstance({label:"translucentPassAccumulate"}),e.translucentAccumulateTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let i=e.translucentAccumulateTexture.createView("oitpAccumTexture");e.translucentRenderEncoder.setColorTextureView(1,i),e.fullScreenQuad=xt.newInstance(),e.fullScreenQuad.setDevice(n.getDevice()),e.fullScreenQuad.setPipelineHash("oitpfsq"),e.fullScreenQuad.setTextureViews(e.translucentRenderEncoder.getColorTextureViews()),e.fullScreenQuad.setFragmentShaderTemplate(jM)}e.translucentRenderEncoder.setDepthTextureView(e.depthTextureView),e.translucentRenderEncoder.attachTextureViews(),t.setCurrentOperation("translucentPass"),r.setRenderEncoder(e.translucentRenderEncoder),r.traverse(t),t.finalPass(n,r)},t.finalPass=(r,n)=>{e.translucentFinalEncoder.setColorTextureView(0,e.colorTextureView),e.translucentFinalEncoder.attachTextureViews(),e.translucentFinalEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e.translucentFinalEncoder),e.fullScreenQuad.prepareAndDraw(e.translucentFinalEncoder),e.translucentFinalEncoder.end()},t.getTextures=()=>[e.translucentColorTexture,e.translucentAccumulateTexture],t.createRenderEncoder=()=>{e.translucentRenderEncoder=Je.newInstance({label:"translucentRender"});let r=e.translucentRenderEncoder.getDescription();r.colorAttachments=[{view:void 0,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:void 0,clearValue:[1,0,0,0],loadOp:"clear",storeOp:"store"}],r.depthStencilAttachment={view:void 0,depthLoadOp:"load",depthStoreOp:"store"},e.translucentRenderEncoder.setReplaceShaderCodeFunction(n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor"),a.addOutput("f32","outAccum"),a.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["var w: f32 = computedColor.a * pow(0.1 + input.fragPos.z, 2.0);","output.outColor = vec4<f32>(computedColor.rgb*w, w);","output.outAccum = computedColor.a;"]).result,a.setCode(s)}),e.translucentRenderEncoder.setPipelineHash("oitpr"),e.translucentRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!1,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one"},alpha:{srcFactor:"one",dstFactor:"one"}}},{format:"r16float",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createFinalEncoder=()=>{e.translucentFinalEncoder=Je.newInstance({label:"translucentFinal"}),e.translucentFinalEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e.translucentFinalEncoder.setReplaceShaderCodeFunction(r=>{let n=r.getShaderDescription("fragment");n.addOutput("vec4<f32>","outColor"),n.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let a=n.getCode();a=K.substitute(a,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,n.setCode(a)}),e.translucentFinalEncoder.setPipelineHash("oitpf"),e.translucentFinalEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})}}var PM={colorTextureView:null,depthTextureView:null};function rh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PM,r),Ue.extend(t,e,r),m.setGet(t,e,["colorTextureView","depthTextureView"]),KM(t,e)}var XM=m.newInstance(rh,"vtkWebGPUOrderIndependentTranslucentPass"),nh={newInstance:XM,extend:rh};var YM={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},IM={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6},fr={BufferUsage:YM,PrimitiveTypes:IM};var Ho=["getMappedRange","mapAsync","unmap"];function qM(t,e,r,n){let a=n.byteLength,s=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),i=s.getMappedRange(0,a);new Uint8Array(i).set(new Uint8Array(n)),s.unmap();let o=t.createCommandEncoder();o.copyBufferToBuffer(s,0,e,r,a);let f=o.finish();t.queue.submit([f]),s.destroy()}function ZM(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r,usage:n,label:e.label}),e.sizeInBytes=r,e.usage=n},t.write=r=>{qM(e.device.getHandle(),e.handle,0,r.buffer)},t.createAndWrite=(r,n)=>{let a=Math.ceil(r.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:a,usage:n,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=a,e.usage=n,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(r.buffer)),e.handle.unmap()};for(let r=0;r<Ho.length;r++)t[Ho[r]]=function(){return e.handle[Ho[r]](...arguments)}}var QM={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function ah(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QM,r),m.obj(t,e),m.get(t,e,["handle","sizeInBytes","usage"]),m.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),ZM(t,e)}var JM=m.newInstance(ah),Lt={newInstance:JM,extend:ah,...fr};var{Representation:sh}=ft,{PrimitiveTypes:ur}=fr,$o=class{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return!0}get(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return this.values[r]}set(e,r){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=r)}};function eR(t){switch(t){case ur.Points:return"points";case ur.Lines:return"lines";case ur.Triangles:case ur.TriangleEdges:return"polys";case ur.TriangleStripEdges:case ur.TriangleStrips:return"strips";default:return""}}function hs(t,e,r){let n=t.pointIdToFlatId[e];return n<0&&(n=t.flatId,t.pointIdToFlatId[e]=n,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=r,t.flatId++),n}function tR(t,e,r){let n=t.length;for(let i=0;i<n;i++){let o=t[i];if(r.cellProvokedMap.has(o)){r.ibo[r.iboId++]=r.cellProvokedMap.get(o);for(let f=i+1;f<i+n;f++){o=t[f%n];let c=hs(r,o,e);r.ibo[r.iboId++]=c}return}}for(let i=0;i<n;i++){let o=t[i];if(!r.provokedPointIds[o]){let f=hs(r,o,e);r.provokedPointIds[o]=1,r.cellProvokedMap.set(o,f),r.flatIdToCellId[f]=e,r.ibo[r.iboId++]=f;for(let c=i+1;c<i+n;c++)o=t[c%n],f=hs(r,o,e),r.ibo[r.iboId++]=f;return}}let a=t[0],s=r.flatId;r.cellProvokedMap.set(a,s),r.flatIdToPointId[r.flatId]=a,r.flatIdToCellId[r.flatId]=e,r.flatId++,r.ibo[r.iboId++]=s;for(let i=1;i<n;i++)a=t[i],s=hs(r,a,e),r.ibo[r.iboId++]=s}function rR(t,e,r){let n=t.length;r.iboSize+=n;for(let a=0;a<n;a++){let s=t[a];if(r.cellProvokedMap.has(s))return}for(let a=0;a<n;a++){let s=t[a];if(!r.provokedPointIds[s]){r.provokedPointIds[s]=1,r.cellProvokedMap.set(s,1);return}}r.cellProvokedMap.set(t[0],1),r.extraPoints++}var Kt,ih=new Uint32Array(1),ut=new Uint32Array(2),cr=new Uint32Array(3),Ao={anythingToPoints(t,e,r,n,a){for(let s=0;s<t;++s)ih[0]=e[r+s],Kt(ih,n,a)},linesToWireframe(t,e,r,n,a){for(let s=0;s<t-1;++s)ut[0]=e[r+s],ut[1]=e[r+s+1],Kt(ut,n,a)},polysToWireframe(t,e,r,n,a){if(t>2)for(let s=0;s<t;++s)ut[0]=e[r+s],ut[1]=e[r+(s+1)%t],Kt(ut,n,a)},stripsToWireframe(t,e,r,n,a){if(t>2){for(let s=0;s<t-1;++s)ut[0]=e[r+s],ut[1]=e[r+s+1],Kt(ut,n,a);for(let s=0;s<t-2;s++)ut[0]=e[r+s],ut[1]=e[r+s+2],Kt(ut,n,a)}},polysToSurface(t,e,r,n,a){for(let s=0;s<t-2;s++)cr[0]=e[r],cr[1]=e[r+s+1],cr[2]=e[r+s+2],Kt(cr,n,a)},stripsToSurface(t,e,r,n,a){for(let s=0;s<t-2;s++)cr[0]=e[r+s],cr[1]=e[r+s+1+s%2],cr[2]=e[r+s+1+(s+1)%2],Kt(cr,n,a)}};function nR(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=r=>{let n=r.cells,a=r.primitiveType,s=r.representation,i=r.cellOffset,o=n.getData(),f=o.length,c=eR(a),g=r.numberOfPoints,u={provokedPointIds:new Uint8Array(g),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new $o},l=null;s===sh.POINTS||a===ur.Points?l=Ao.anythingToPoints:s===sh.WIREFRAME||a===ur.Lines?l=Ao[`${c}ToWireframe`]:l=Ao[`${c}ToSurface`],Kt=rR;let p=i||0;for(let d=0;d<f;)u.cellProvokedMap.clear(),l(o[d],o,d+1,p,u),d+=o[d]+1,p++;g<=65535?u.flatIdToPointId=new Uint16Array(g+u.extraPoints):u.flatIdToPointId=new Uint32Array(g+u.extraPoints),g+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(g):u.pointIdToFlatId=new Int32Array(g),g+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),r.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),r.format="uint32"),p<=65535?u.flatIdToCellId=new Uint16Array(g+u.extraPoints):u.flatIdToCellId=new Uint32Array(g+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),Kt=tR,p=i||0;for(let d=0;d<f;)u.cellProvokedMap.clear(),l(o[d],o,d+1,p,u),d+=o[d]+1,p++;delete u.provokedPointIds,delete u.pointIdToFlatId,r.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}var aR={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function oh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aR,r),Lt.extend(t,e,r),m.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),nR(t,e)}var sR=m.newInstance(oh),fh={newInstance:sR,extend:oh,...fr};var{BufferUsage:gr}=fr,{vtkErrorMacro:iR}=Ee,{VtkDataTypes:Ur}=P,oR={};function fR(t){let e;switch(t.getDataType()){case Ur.UNSIGNED_CHAR:e="uint8";break;case Ur.FLOAT:e="float32";break;case Ur.UNSIGNED_INT:e="uint32";break;case Ur.INT:e="sint32";break;case Ur.DOUBLE:e="float32";break;case Ur.UNSIGNED_SHORT:e="uint16";break;case Ur.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||iR(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function ch(t,e,r,n,a){let s={},i=t.getFlatSize();if(!i)return s;let o=[0,0,0,0];a.shift&&(a.shift.length?o=a.shift:o.fill(a.shift));let f=[1,1,1,1];a.scale&&(a.scale.length?f=a.scale:f.fill(a.scale));let c=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1,g,u=0,l=r+(c?1:0),p=kt(n,i*l),d=t.getFlatIdToPointId();a.cellData&&(d=t.getFlatIdToCellId()),r===1?g=function(v){p[u++]=f[0]*e[v]+o[0]}:r===2?g=function(v){p[u++]=f[0]*e[v]+o[0],p[u++]=f[1]*e[v+1]+o[1]}:r===3&&!c?g=function(v){p[u++]=f[0]*e[v]+o[0],p[u++]=f[1]*e[v+1]+o[1],p[u++]=f[2]*e[v+2]+o[2]}:r===3&&c?g=function(v){p[u++]=f[0]*e[v]+o[0],p[u++]=f[1]*e[v+1]+o[1],p[u++]=f[2]*e[v+2]+o[2],p[u++]=f[3]*1+o[3]}:r===4&&(g=function(v){p[u++]=f[0]*e[v]+o[0],p[u++]=f[1]*e[v+1]+o[1],p[u++]=f[2]*e[v+2]+o[2],p[u++]=f[3]*e[v+3]+o[3]});for(let h=0;h<i;h++){let v=r*d[h];g(v)}return s.nativeArray=p,s}function cR(t,e,r,n){let a=[t[n*3]-t[r*3],t[n*3+1]-t[r*3+1],t[n*3+2]-t[r*3+2]],s=[t[e*3]-t[r*3],t[e*3+1]-t[r*3+1],t[e*3+2]-t[r*3+2]],i=[];return Re(a,s,i),ke(i),i}function uR(t,e){let r=e.getData(),n=t.getData();if(!n||!r)return null;let a=new Int8Array(t.getNumberOfCells()*4),s=n.length,i=0;for(let o=0;o<s;){let f=cR(r,n[o+1],n[o+2],n[o+3]);a[i++]=127*f[0],a[i++]=127*f[1],a[i++]=127*f[2],a[i++]=127,o+=n[o]+1}return a}function gR(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function r(n){n.dataArray&&!n.nativeArray&&(n.nativeArray=n.dataArray.getData());let a,s;if(n.usage===gr.Index&&(a=fh.newInstance({label:n.label}),a.setDevice(e.device),s=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(n),a.createAndWrite(n.nativeArray,s),a.setArrayInformation([{format:n.format}])),a||(a=Lt.newInstance({label:n.label}),a.setDevice(e.device)),n.usage===gr.UniformArray&&(s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(n.nativeArray,s)),n.usage===gr.Storage&&(s=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(n.nativeArray,s)),n.usage===gr.Texture&&(s=GPUBufferUsage.COPY_SRC,a.createAndWrite(n.nativeArray,s)),n.usage===gr.PointArray){s=GPUBufferUsage.VERTEX;let i=le.getNativeTypeFromBufferFormat(n.format),o=ch(n.indexBuffer,n.dataArray.getData(),n.dataArray.getNumberOfComponents(),i,{packExtra:n.packExtra,shift:n.shift,scale:n.scale,cellData:n.cellData,cellOffset:n.cellOffset});a.createAndWrite(o.nativeArray,s),a.setStrideInBytes(le.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format,interpolation:n.cellData?"flat":"perspective"}])}if(n.usage===gr.NormalsFromPoints){s=GPUBufferUsage.VERTEX;let i=le.getNativeTypeFromBufferFormat(n.format),o=uR(n.cells,n.dataArray),f=ch(n.indexBuffer,o,4,i,{cellData:!0});a.createAndWrite(f.nativeArray,s),a.setStrideInBytes(le.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format,interpolation:"flat"}])}return n.usage===gr.RawVertex&&(s=GPUBufferUsage.VERTEX,a.createAndWrite(n.nativeArray,s),a.setStrideInBytes(le.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format}])),a.setSourceTime(n.time),a}t.hasBuffer=n=>e.device.hasCachedObject(n),t.getBuffer=n=>n.hash?e.device.getCachedObject(n.hash,r,n):r(n),t.getBufferForPointArray=(n,a)=>{let s=fR(n),i={hash:`${n.getMTime()}I${a.getMTime()}${s}`,usage:gr.PointArray,format:s,dataArray:n,indexBuffer:a};return t.getBuffer(i)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=Lt.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);let n=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(n,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}var lR={device:null,fullScreenQuadBuffer:null};function uh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lR,r),ne(t,e),re(t,e,["device"]),gR(t,e)}var pR=j(uh),et={newInstance:pR,extend:uh,...oR,...fr};var{BufferUsage:hR}=et,{vtkErrorMacro:jo}=m;function vR(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){jo(`entry named ${r} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(r,e.bufferEntries.length),e.bufferEntries.push({name:r,type:n,sizeInBytes:le.getByteStrideFromShaderFormat(n),offset:-1,nativeType:le.getNativeTypeFromShaderFormat(n),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let r=0,n=[],a=4;for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];i.sizeInBytes%16===0&&(a=Math.max(16,a)),i.sizeInBytes%8===0&&(a=Math.max(8,a))}for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];i.packed===!1&&i.sizeInBytes%16===0&&(i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];if(i.packed===!1&&i.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){let f=e.bufferEntries[o];if(f.packed===!1&&f.sizeInBytes===4){i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes,f.packed=!0,f.offset=r,n.push(f),r+=f.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0)for(let o=s+1;o<e.bufferEntries.length;o++){let f=e.bufferEntries[o];if(!f.packed&&f.sizeInBytes%8===0){i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes,f.packed=!0,f.offset=r,n.push(f),r+=f.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0){let o=!1;for(let f=0;!o&&f<e.bufferEntries.length;f++){let c=e.bufferEntries[f];if(!c.packed&&c.sizeInBytes===4)for(let g=f+1;g<e.bufferEntries.length;g++){let u=e.bufferEntries[g];if(!u.packed&&u.sizeInBytes===4){i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes,u.packed=!0,u.offset=r,n.push(u),r+=u.sizeInBytes,o=!0;break}}}}}for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];!i.packed&&i.sizeInBytes>4&&(i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];i.packed||(i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes)}e.bufferEntries=n,e._bufferEntryNames.clear();for(let s=0;s<e.bufferEntries.length;s++)e._bufferEntryNames.set(e.bufferEntries[s].name,s);e.sizeInBytes=r,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1},t.sendIfNeeded=r=>{if(!e.UBO){let n={nativeArray:e.Float32Array,usage:hR.UniformArray,label:e.label};e.UBO=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(r.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[r]=m.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n)=>{t.sortBufferEntries();let a=e._bufferEntryNames.get(r);if(a===void 0){jo(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[a];t.createView(s.nativeType);let i=e[s.nativeType];s.lastValue!==n&&(i[s.offset/i.BYTES_PER_ELEMENT]=n,e.sendDirty=!0),s.lastValue=n},t.setArray=(r,n)=>{t.sortBufferEntries();let a=e._bufferEntryNames.get(r);if(a===void 0){jo(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[a];t.createView(s.nativeType);let i=e[s.nativeType],o=!1;for(let f=0;f<n.length;f++)(!s.lastValue||s.lastValue[f]!==n[f])&&(i[s.offset/i.BYTES_PER_ELEMENT+f]=n[f],o=!0);o&&(e.sendDirty=!0,s.lastValue=[...n])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(r,n)=>{t.sortBufferEntries();let a=[`struct ${e.label}Struct
{`];for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`};
@binding(${r}) @group(${n}) var<uniform> ${e.label}: ${e.label}Struct;`),a.join(`
`)}}var dR={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function gh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dR,r),m.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},m.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},m.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,m.get(t,e,["binding","bindGroupTime"]),m.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),vR(t,e)}var yR=m.newInstance(gh,"vtkWebGPUUniformBuffer"),Tt={newInstance:yR,extend:gh};var{BufferUsage:xR}=et,{vtkErrorMacro:un}=m;function TR(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){un(`entry named ${r} already exists`);return}e._bufferEntryNames.set(r,e.bufferEntries.length);let a=le.getByteStrideFromShaderFormat(n);e.bufferEntries.push({name:r,type:n,sizeInBytes:a,offset:e.sizeInBytes,nativeType:le.getNativeTypeFromShaderFormat(n)}),e.sizeInBytes+=a},t.send=r=>{if(!e._buffer){let n={nativeArray:e.Float32Array,usage:xR.Storage,label:e.label};e._buffer=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e._sendTime.modified();return}r.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[r]=m.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n,a)=>{let s=e._bufferEntryNames.get(r);if(s===void 0){un(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[s];t.createView(i.nativeType);let o=e[i.nativeType];o[(i.offset+n*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=a},t.setArray=(r,n,a)=>{let s=e._bufferEntryNames.get(r);if(s===void 0){un(`entry named ${r} not found in UBO`);return}let i=e.bufferEntries[s];t.createView(i.nativeType);let o=e[i.nativeType],f=(i.offset+n*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let c=0;c<a.length;c++)o[f+c]=a[c]},t.setAllInstancesFromArray=(r,n)=>{let a=e._bufferEntryNames.get(r);if(a===void 0){un(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[a];t.createView(s.nativeType);let i=e[s.nativeType],o=n.length/e.numberOfInstances;for(let f=0;f<e.numberOfInstances;f++){let c=(s.offset+f*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[c+g]=n[f*o+g]}},t.setAllInstancesFromArrayColorToFloat=(r,n)=>{let a=e._bufferEntryNames.get(r);if(a===void 0){un(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[a];t.createView(s.nativeType);let i=e[s.nativeType],o=n.length/e.numberOfInstances;for(let f=0;f<e.numberOfInstances;f++){let c=(s.offset+f*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[c+g]=n[f*o+g]/255}},t.setAllInstancesFromArray3x3To4x4=(r,n)=>{let a=e._bufferEntryNames.get(r);if(a===void 0){un(`entry named ${r} not found in UBO`);return}let s=e.bufferEntries[a];t.createView(s.nativeType);let i=e[s.nativeType],o=9;for(let f=0;f<e.numberOfInstances;f++){let c=(s.offset+f*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<3;g++)for(let u=0;u<3;u++)i[c+g*4+u]=n[f*o+g*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(r,n)=>{let a=[`struct ${e.label}StructEntry
{`];for(let s=0;s<e.bufferEntries.length;s++){let i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${r}) @group(${n}) var<storage, read> ${e.label}: ${e.label}Struct;
`),a.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}var SR={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function lh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SR,r),m.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},m.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},m.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},m.get(t,e,["bindGroupTime"]),m.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),TR(t,e)}var CR=m.newInstance(lh,"vtkWebGPUStorageBuffer"),Kn={newInstance:CR,extend:lh};var Nr={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6};var mR=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Volume::TraverseDec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

fn getTextureValue(vTex: texture_3d<f32>, tpos: vec4<f32>) -> f32
{
  // todo multicomponent support
  return textureSampleLevel(vTex, clampSampler, tpos.xyz, 0.0).r;
}

fn getGradient(vTex: texture_3d<f32>, tpos: vec4<f32>, vNum: i32, scalar: f32) -> vec4<f32>
{
  var result: vec4<f32>;

  var tstep: vec4<f32> = volumeSSBO.values[vNum].tstep;
  result.x = getTextureValue(vTex, tpos + vec4<f32>(tstep.x, 0.0, 0.0, 1.0)) - scalar;
  result.y = getTextureValue(vTex, tpos + vec4<f32>(0.0, tstep.y, 0.0, 1.0)) - scalar;
  result.z = getTextureValue(vTex, tpos + vec4<f32>(0.0, 0.0, tstep.z, 1.0)) - scalar;
  result.w = 0.0;

  // divide by spacing as that is our delta
  result = result / volumeSSBO.values[vNum].spacing;
  // now we have a gradient in unit tcoords

  var grad: f32 = length(result.xyz);
  if (grad > 0.0)
  {
    // rotate to View Coords, needed for lighting and shading
    var nMat: mat4x4<f32> = rendererUBO.SCVCMatrix * volumeSSBO.values[vNum].planeNormals;
    result = nMat * result;
    result = result / length(result);
  }

  // store gradient magnitude in .w
  result.w = grad;

  return result;
}

fn processVolume(vTex: texture_3d<f32>, vNum: i32, cNum: i32, posSC: vec4<f32>, tfunRows: f32) -> vec4<f32>
{
  var outColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);

  // convert to tcoords and reject if outside the volume
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*posSC;
  if (tpos.x < 0.0 || tpos.y < 0.0 || tpos.z < 0.0 ||
      tpos.x > 1.0 || tpos.y > 1.0 || tpos.z > 1.0) { return outColor; }

  var scalar: f32 = getTextureValue(vTex, tpos);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);

  var gofactor: f32 = 1.0;
  var normal: vec4<f32> = vec4<f32>(0.0,0.0,0.0,0.0);
  if (componentSSBO.values[cNum].gomin <  1.0 || volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    normal = getGradient(vTex, tpos, vNum, scalar);
    if (componentSSBO.values[cNum].gomin <  1.0)
    {
      gofactor = clamp(normal.a*componentSSBO.values[cNum].goScale + componentSSBO.values[cNum].goShift,
      componentSSBO.values[cNum].gomin, componentSSBO.values[cNum].gomax);
    }
  }

  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;

  if (volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    color = color*abs(normal.z);
  }

  outColor = vec4<f32>(color.rgb, gofactor * opacity);

  return outColor;
}

// adjust the start and end point of a raycast such that it intersects the unit cube.
// This function is used to take a raycast starting point and step vector
// and numSteps and return the startijng and ending steps for intersecting the
// unit cube. Recall for a 3D texture, the unit cube is the range of texture coordsinates
// that have valid values. So this funtion can be used to take a ray in texture coordinates
// and bound it to intersecting the texture.
//
fn adjustBounds(tpos: vec4<f32>, tstep: vec4<f32>, numSteps: f32) -> vec2<f32>
{
  var result: vec2<f32> = vec2<f32>(0.0, numSteps);
  var tpos2: vec4<f32> = tpos + tstep*numSteps;

  // move tpos to the start of the volume
  var adjust: f32 =
    min(
      max(tpos.x/tstep.x, (tpos.x - 1.0)/tstep.x),
      min(
        max((tpos.y - 1.0)/tstep.y, tpos.y/tstep.y),
        max((tpos.z - 1.0)/tstep.z, tpos.z/tstep.z)));
  if (adjust < 0.0)
  {
    result.x = result.x - adjust;
  }

  // adjust length to the end
  adjust =
    max(
      min(tpos2.x/tstep.x, (tpos2.x - 1.0)/tstep.x),
      max(
        min((tpos2.y - 1.0)/tstep.y, tpos2.y/tstep.y),
        min((tpos2.z - 1.0)/tstep.z, tpos2.z/tstep.z)));
  if (adjust > 0.0)
  {
    result.y = result.y - adjust;
  }

  return result;
}

fn getSimpleColor(scalar: f32, vNum: i32, cNum: i32) -> vec4<f32>
{
  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);
  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;
  return vec4<f32>(color.rgb, opacity);
}

fn traverseMax(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var maxVal: f32 = -1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar > maxVal)
    {
      maxVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(maxVal, vNum, cNum);
}

fn traverseMin(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var minVal: f32 = 1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar < minVal)
    {
      minVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(minVal, vNum, cNum);
}

fn traverseAverage(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var avgVal: f32 = 0.0;
  var sampleCount: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      avgVal = avgVal + sample;
      sampleCount = sampleCount + 1.0;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  if (sampleCount <= 0.0)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(avgVal/sampleCount, vNum, cNum);
}

fn traverseAdditive(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var sumVal: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      sumVal = sumVal + sample;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(sumVal, vNum, cNum);
}

fn composite(rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>) -> vec4<f32>
{
  // initial ray position is at the beginning
  var rayPosSC: vec4<f32> = minPosSC;

  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var curDist: f32 = 0.0;
  var computedColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);
  var sampleColor: vec4<f32>;
//VTK::Volume::TraverseCalls

  loop
  {
    // for each volume, sample and accumulate color
//VTK::Volume::CompositeCalls

    // increment position
    curDist = curDist + mapperUBO.SampleDistance;
    rayPosSC = rayPosSC + rayStepSC;

    // check if we have reached a terminating condition
    if (curDist > rayLengthSC) { break; }
    if (computedColor.a > 0.98) { break; }
  }
  return computedColor;
}

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var rayMax: f32 = textureSampleLevel(maxTexture, clampSampler, input.tcoordVS, 0.0).r;
  var rayMin: f32 = textureSampleLevel(minTexture, clampSampler, input.tcoordVS, 0.0).r;

  // discard empty rays
  if (rayMax <= rayMin) { discard; }
  else
  {
    // compute start and end ray positions in view coordinates
    var minPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMax, 1.0);
    minPosSC = minPosSC * (1.0 / minPosSC.w);
    var maxPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMin, 1.0);
    maxPosSC = maxPosSC * (1.0 / maxPosSC.w);

    var rayLengthSC: f32 = distance(minPosSC.xyz, maxPosSC.xyz);
    var rayStepSC: vec4<f32> = (maxPosSC - minPosSC)*(mapperUBO.SampleDistance/rayLengthSC);
    rayStepSC.w = 0.0;

    var computedColor: vec4<f32>;

//VTK::Volume::Loop

//VTK::RenderEncoder::Impl
  }

  return output;
}
`,Pe=new Float64Array(16),lr=new Float64Array(16);function wR(t,e){e.classHierarchy.push("vtkWebGPUVolumePassFSQ"),t.replaceShaderPosition=(a,s,i)=>{let o=s.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let f=o.getCode();f=K.substitute(f,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,o.setCode(f),s.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderVolume=(a,s,i)=>{let o=s.getShaderDescription("fragment"),f=o.getCode(),c=[],g=[];for(let l=0;l<e.volumes.length;l++)e.volumes[l].getRenderable().getMapper().getBlendMode()===Nr.COMPOSITE_BLEND?(c.push(`    sampleColor = processVolume(volTexture${l}, ${l}, ${e.rowStarts[l]}, rayPosSC, tfunRows);`),c.push(`    computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`)):(g.push(`  sampleColor = traverseVals[${l}];`),g.push(`  computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`));f=K.substitute(f,"//VTK::Volume::CompositeCalls",c).result,f=K.substitute(f,"//VTK::Volume::TraverseCalls",g).result,f=K.substitute(f,"//VTK::Volume::TraverseDec",[`var<private> traverseVals: array<vec4<f32>,${e.volumes.length}>;`]).result;let u=!1;for(let l=0;l<e.volumes.length;l++){let p=e.volumes[l].getRenderable().getMapper().getBlendMode();p===Nr.COMPOSITE_BLEND?u=!0:p===Nr.MAXIMUM_INTENSITY_BLEND?f=K.substitute(f,"//VTK::Volume::Loop",[`    traverseMax(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===Nr.MINIMUM_INTENSITY_BLEND?f=K.substitute(f,"//VTK::Volume::Loop",[`    traverseMin(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===Nr.AVERAGE_INTENSITY_BLEND?f=K.substitute(f,"//VTK::Volume::Loop",[`    traverseAverage(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===Nr.ADDITIVE_INTENSITY_BLEND&&(f=K.substitute(f,"//VTK::Volume::Loop",[`    traverseAdditive(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result)}u&&(f=K.substitute(f,"//VTK::Volume::Loop",["    computedColor = composite(rayLengthSC, minPosSC, rayStepSC);"]).result),o.setCode(f)},e.shaderReplacements.set("replaceShaderVolume",t.replaceShaderVolume),t.updateLUTImage=a=>{let s=t.getMTime();for(let u=0;u<e.volumes.length;u++){let l=e.volumes[u].getRenderable(),p=l.getMapper().getInputData();s=Math.max(s,l.getMTime(),p.getMTime())}if(s<e.lutBuildTime.getMTime())return;e.numRows=0,e.rowStarts=[];for(let u=0;u<e.volumes.length;u++){e.rowStarts.push(e.numRows);let p=e.volumes[u].getRenderable(),d=p.getMapper(),h=p.getProperty(),v=d.getInputData(),C=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),T=h.getIndependentComponents()?C:1;e.numRows+=T}let i=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),o=new Float32Array(e.numRows*2*e.rowLength),f=0,c=new Float32Array(e.rowLength*3),g=e.rowLength;for(let u=0;u<e.volumes.length;u++){let p=e.volumes[u].getRenderable(),d=p.getMapper(),h=p.getProperty(),v=d.getInputData(),C=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),T=h.getIndependentComponents()?C:1;for(let w=0;w<T;++w){let S=h.getRGBTransferFunction(w),M=S.getRange();S.getTable(M[0],M[1],g,c,1);let E=f*g*4;for(let V=0;V<g;++V){i[E+V*4]=255*c[V*3],i[E+V*4+1]=255*c[V*3+1],i[E+V*4+2]=255*c[V*3+2],i[E+V*4+3]=255;for(let B=0;B<4;B++)i[E+(g+V)*4+B]=i[E+V*4+B]}let R=h.getScalarOpacity(w),D=e.sampleDist/h.getScalarOpacityUnitDistance(w),L=R.getRange();R.getTable(L[0],L[1],g,c,1),E=f*g;for(let V=0;V<g;++V)o[E+V]=1-(1-c[V])**D,o[E+V+g]=o[E+V];f+=2}}{let u={nativeArray:i,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},p=a.getTextureManager().getTexture(u).createView("tfunTexture");e.textureViews[2]=p}{let u={nativeArray:o,width:e.rowLength,height:e.numRows*2,depth:1,format:"r16float"},p=a.getTextureManager().getTexture(u).createView("ofunTexture");e.textureViews[3]=p}e.lutBuildTime.modified()},t.updateSSBO=a=>{let s=Math.max(t.getMTime(),e.WebGPURenderer.getStabilizedTime());for(let S=0;S<e.volumes.length;S++){let M=e.volumes[S].getRenderable(),E=M.getMapper(),R=E.getInputData();s=Math.max(s,M.getMTime(),R.getMTime(),E.getMTime())}if(s<e.SSBO.getSendTime())return;let i=e.WebGPURenderer.getStabilizedCenterByReference();e.SSBO.clearData(),e.SSBO.setNumberOfInstances(e.volumes.length);let o=new Float64Array(e.volumes.length*16),f=new Float64Array(e.volumes.length*16),c=new Float64Array(e.volumes.length*4),g=new Float64Array(e.volumes.length*4),u=new Float64Array(e.volumes.length*4),l=new Float64Array(e.volumes.length*4);for(let S=0;S<e.volumes.length;S++){let E=e.volumes[S].getRenderable(),D=E.getMapper().getInputData();O.identity(Pe),O.translate(Pe,Pe,i);let L=E.getMatrix();O.transpose(lr,L),O.invert(lr,lr),O.multiply(Pe,lr,Pe);let V=D.getWorldToIndex();O.multiply(Pe,V,Pe);let B=D.getDimensions();O.identity(lr),O.scale(lr,lr,[1/B[0],1/B[1],1/B[2]]),O.multiply(Pe,lr,Pe);for(let W=0;W<16;W++)o[S*16+W]=Pe[W];O.invert(Pe,Pe);for(let W=0;W<4;W++)f[S*16+W*4]=Pe[W*4],f[S*16+W*4+1]=Pe[W*4+1],f[S*16+W*4+2]=Pe[W*4+2],f[S*16+W*4+3]=0;c[S*4]=1/B[0],c[S*4+1]=1/B[1],c[S*4+2]=1/B[2],c[S*4+3]=1,g[S*4]=E.getProperty().getShade()?1:0;let F=D.getSpacing();u[S*4]=F[0],u[S*4+1]=F[1],u[S*4+2]=F[2],u[S*4+3]=1;let z=e.textureViews[S+4].getTexture().getScale(),b=E.getProperty().getIpScalarRange();l[S*4]=b[0]/z,l[S*4+1]=b[1]/z,l[S*4+2]=E.getProperty().getFilterMode()}e.SSBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.SSBO.addEntry("planeNormals","mat4x4<f32>"),e.SSBO.addEntry("shade","vec4<f32>"),e.SSBO.addEntry("tstep","vec4<f32>"),e.SSBO.addEntry("spacing","vec4<f32>"),e.SSBO.addEntry("ipScalarRange","vec4<f32>"),e.SSBO.setAllInstancesFromArray("SCTCMatrix",o),e.SSBO.setAllInstancesFromArray("planeNormals",f),e.SSBO.setAllInstancesFromArray("shade",g),e.SSBO.setAllInstancesFromArray("tstep",c),e.SSBO.setAllInstancesFromArray("spacing",u),e.SSBO.setAllInstancesFromArray("ipScalarRange",l),e.SSBO.send(a),e.componentSSBO.clearData(),e.componentSSBO.setNumberOfInstances(e.numRows);let p=new Float64Array(e.numRows),d=new Float64Array(e.numRows),h=new Float64Array(e.numRows),v=new Float64Array(e.numRows),y=new Float64Array(e.numRows),C=new Float64Array(e.numRows),x=new Float64Array(e.numRows),T=new Float64Array(e.numRows),w=0;for(let S=0;S<e.volumes.length;S++){let E=e.volumes[S].getRenderable(),R=E.getMapper(),D=E.getProperty(),L=R.getInputData(),B=(L.getPointData()&&L.getPointData().getScalars()).getNumberOfComponents(),F=D.getIndependentComponents(),z=e.textureViews[S+4].getTexture().getFormat(),b=le.getDetailsFromTextureFormat(z),W=b.elementSize===2&&b.sampleType==="float",G={scale:[255],offset:[0]};W&&(G.scale[0]=1);for(let k=0;k<B;k++){let _=F?k:0,H=G.scale[k],A=D.getScalarOpacity(_).getRange(),He=H/(A[1]-A[0]),he=(G.offset[k]-A[0])/(A[1]-A[0]);v[w]=he,h[w]=He;let Ce=D.getRGBTransferFunction(_).getRange();if(d[w]=(G.offset[k]-Ce[0])/(Ce[1]-Ce[0]),p[w]=H/(Ce[1]-Ce[0]),D.getUseGradientOpacity(_)){let Be=D.getGradientOpacityMinimumOpacity(_),be=D.getGradientOpacityMaximumOpacity(_);y[w]=Be,C[w]=be;let vt=[D.getGradientOpacityMinimumValue(_),D.getGradientOpacityMaximumValue(_)];T[w]=H*(be-Be)/(vt[1]-vt[0]),x[w]=-vt[0]*(be-Be)/(vt[1]-vt[0])+Be}else y[w]=1,C[w]=1,T[w]=0,x[w]=1;w++}}e.componentSSBO.addEntry("cScale","f32"),e.componentSSBO.addEntry("cShift","f32"),e.componentSSBO.addEntry("oScale","f32"),e.componentSSBO.addEntry("oShift","f32"),e.componentSSBO.addEntry("goShift","f32"),e.componentSSBO.addEntry("goScale","f32"),e.componentSSBO.addEntry("gomin","f32"),e.componentSSBO.addEntry("gomax","f32"),e.componentSSBO.setAllInstancesFromArray("cScale",p),e.componentSSBO.setAllInstancesFromArray("cShift",d),e.componentSSBO.setAllInstancesFromArray("oScale",h),e.componentSSBO.setAllInstancesFromArray("oShift",v),e.componentSSBO.setAllInstancesFromArray("goScale",T),e.componentSSBO.setAllInstancesFromArray("goShift",x),e.componentSSBO.setAllInstancesFromArray("gomin",y),e.componentSSBO.setAllInstancesFromArray("gomax",C),e.componentSSBO.send(a)};let r=t.updateBuffers;t.updateBuffers=()=>{r();let a=e.volumes[0].getRenderable().getMapper().getSampleDistance();for(let s=0;s<e.volumes.length;s++){let f=e.volumes[s].getRenderable().getMapper().getSampleDistance();f<a&&(a=f)}e.sampleDist!==a&&(e.sampleDist=a,e.UBO.setValue("SampleDistance",a),e.UBO.sendIfNeeded(e.device));for(let s=0;s<e.volumes.length;s++){let c=e.volumes[s].getRenderable().getMapper().getInputData(),g=e.device.getTextureManager().getTextureForImageData(c);if(!e.textureViews[s+4]||e.textureViews[s+4].getTexture()!==g){let u=g.createView(`volTexture${s}`);e.textureViews[s+4]=u}}if(e.volumes.length<e.lastVolumeLength)for(let s=e.volumes.length;s<e.lastVolumeLength;s++)e.textureViews.pop();e.lastVolumeLength=e.volumes.length,t.updateLUTImage(e.device),t.updateSSBO(e.device),e.clampSampler||(e.clampSampler=cn.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:"linear",magFilter:"linear"}))},t.computePipelineHash=()=>{e.pipelineHash="volfsq";for(let a=0;a<e.volumes.length;a++){let s=e.volumes[a].getRenderable().getMapper().getBlendMode();e.pipelineHash+=`${s}`}},t.setVolumes=a=>{if(!e.volumes||e.volumes.length!==a.length){e.volumes=[...a],t.modified();return}for(let s=0;s<a.length;s++)if(a[s]!==e.volumes[s]){e.volumes=[...a],t.modified();return}};let n=t.getBindables;t.getBindables=()=>{let a=n();return a.push(e.componentSSBO),a.push(e.clampSampler),a}}var ER={volumes:null,rowLength:1024,lastVolumeLength:0};function ph(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ER,r),xt.extend(t,e,r),e.fragmentShaderTemplate=mR,e.UBO=Tt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SampleDistance","f32"),e.SSBO=Kn.newInstance({label:"volumeSSBO"}),e.componentSSBO=Kn.newInstance({label:"componentSSBO"}),e.lutBuildTime={},m.obj(e.lutBuildTime,{mtime:0}),wR(t,e)}var MR=m.newInstance(ph,"vtkWebGPUVolumePassFSQ"),hh={newInstance:MR,extend:ph};var{Representation:RR}=ft,{BufferUsage:vh,PrimitiveTypes:OR}=et,Ko=[[0,4,6],[0,6,2],[1,3,7],[1,7,5],[0,5,4],[0,1,5],[2,6,7],[2,7,3],[0,3,1],[0,2,3],[4,5,7],[4,7,6]],DR=`
//VTK::Renderer::Dec

//VTK::Select::Dec

//VTK::VolumePass::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Select::Impl

  //VTK::TCoord::Impl

  //VTK::VolumePass::Impl

  // use the maximum (closest) of the current value and the zbuffer
  // the blend func will then take the min to find the farthest stop value
  var stopval: f32 = max(input.fragPos.z, textureLoad(opaquePassDepthTexture, vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y)), 0));

  //VTK::RenderEncoder::Impl
  return output;
}
`,LR=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = textureSample(volumePassColorTexture,
    volumePassColorTextureSampler, mapperUBO.tscale*input.tcoordVS);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function VR(t,e){e.classHierarchy.push("vtkWebGPUVolumePass"),t.initialize=r=>{e._clearEncoder||t.createClearEncoder(r),e._mergeEncoder||t.createMergeEncoder(r),e._copyEncoder||t.createCopyEncoder(r),e._depthRangeEncoder||t.createDepthRangeEncoder(r),e.fullScreenQuad||(e.fullScreenQuad=hh.newInstance(),e.fullScreenQuad.setDevice(r.getDevice()),e.fullScreenQuad.setTextureViews([...e._depthRangeEncoder.getColorTextureViews()])),e._volumeCopyQuad||(e._volumeCopyQuad=xt.newInstance(),e._volumeCopyQuad.setPipelineHash("volpassfsq"),e._volumeCopyQuad.setDevice(r.getDevice()),e._volumeCopyQuad.setFragmentShaderTemplate(LR),e._copyUBO=Tt.newInstance({label:"mapperUBO"}),e._copyUBO.addEntry("tscale","vec2<f32>"),e._volumeCopyQuad.setUBO(e._copyUBO),e._volumeCopyQuad.setTextureViews([e._colorTextureView]))},t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n,t.initialize(n),t.computeTiming(n),t.renderDepthBounds(r,n),e._firstGroup=!0;let a=n.getDevice(),s=a.getHandle().limits.maxSampledTexturesPerShaderStage-4;if(e.volumes.length>s){let i=r.getRenderable().getActiveCamera().getPosition(),o=[];for(let u=0;u<e.volumes.length;u++){let l=e.volumes[u].getRenderable().getBounds(),p=[.5*(l[1]+l[0]),.5*(l[3]+l[2]),.5*(l[5]+l[4])];o[u]=Le(p,i)}let f=[...Array(e.volumes.length).keys()];f.sort((u,l)=>o[l]-o[u]);let c=[],g=f.length%s;for(let u=0;u<f.length;u++)c.push(e.volumes[f[u]]),c.length>=g&&(t.rayCastPass(n,r,c),c=[],g=s,e._firstGroup=!1)}else t.rayCastPass(n,r,e.volumes);if(e._volumeCopyQuad.setWebGPURenderer(r),e._useSmallViewport){let i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();e._copyUBO.setArray("tscale",[e._smallViewportWidth/i,e._smallViewportHeight/o])}else e._copyUBO.setArray("tscale",[1,1]);e._copyUBO.sendIfNeeded(a),e._copyEncoder.setColorTextureView(0,e.colorTextureView),e._copyEncoder.attachTextureViews(),e._copyEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e._copyEncoder),e._volumeCopyQuad.prepareAndDraw(e._copyEncoder),e._copyEncoder.end()},t.delete=m.chain(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.computeTiming=r=>{let n=r.getRenderable().getInteractor();if(e._lastScale==null){let a=e.volumes[0].getRenderable().getMapper();e._lastScale=a.getInitialInteractionScale()||1}e._useSmallViewport=!1,n.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e._animationRateSubscription||(e._animationRateSubscription=n.onAnimationFrameRateUpdate(()=>{let a=e.volumes[0].getRenderable().getMapper();if(a.getAutoAdjustSampleDistances()){let s=n.getRecentAnimationFrameRate(),i=e._lastScale*n.getDesiredUpdateRate()/s;e._lastScale=i,e._lastScale>400&&(e._lastScale=400)}else e._lastScale=a.getImageSampleDistance()*a.getImageSampleDistance();e._lastScale<1.5&&(e._lastScale=1.5)}))},t.rayCastPass=(r,n,a)=>{let s=e._firstGroup?e._clearEncoder:e._mergeEncoder;s.attachTextureViews(),s.begin(r.getCommandEncoder());let i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();if(e._useSmallViewport){let f=r.getCanvas(),c=1/Math.sqrt(e._lastScale);e._smallViewportWidth=Math.ceil(c*f.width),e._smallViewportHeight=Math.ceil(c*f.height),i=e._smallViewportWidth,o=e._smallViewportHeight}s.getHandle().setViewport(0,0,i,o,0,1),s.getHandle().setScissorRect(0,0,i,o),e.fullScreenQuad.setWebGPURenderer(n),e.fullScreenQuad.setVolumes(a),e.fullScreenQuad.prepareAndDraw(s),s.end()},t.renderDepthBounds=(r,n)=>{t.updateDepthPolyData(r);let a=e._boundsPoly,s=a.getPoints(),i=a.getPolys(),o={hash:`vp${i.getMTime()}`,usage:vh.Index,cells:i,numberOfPoints:s.getNumberOfPoints(),primitiveType:OR.Triangles,representation:RR.SURFACE},f=n.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().setIndexBuffer(f),o={usage:vh.PointArray,format:"float32x4",hash:`vp${s.getMTime()}${i.getMTime()}`,dataArray:s,indexBuffer:f,packExtra:!0};let c=n.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().addBuffer(c,["vertexBC"]),e._mapper.setNumberOfVertices(c.getSizeInBytes()/c.getStrideInBytes()),t.drawDepthRange(r,n)},t.updateDepthPolyData=r=>{let n=!1;for(let g=0;g<e.volumes.length;g++){let u=e.volumes[g].getMTime();(!e._lastMTimes[g]||u!==e._lastMTimes[g])&&(n=!0,e._lastMTimes[g]=u)}let a=r.getStabilizedTime();if((e._lastMTimes.length<=e.volumes.length||a!==e._lastMTimes[e.volumes.length])&&(n=!0,e._lastMTimes[e.volumes.length]=a),!n)return;let s=r.getStabilizedCenterByReference(),i=e.volumes.length*8,o=new Float64Array(i*3),f=e.volumes.length*12,c=new Uint16Array(f*4);for(let g=0;g<e.volumes.length;g++){e.volumes[g].getBoundingCubePoints(o,g*24);let u=g*12*4,l=g*8;for(let p=0;p<12;p++)c[u++]=3,c[u++]=l+Ko[p][0],c[u++]=l+Ko[p][1],c[u++]=l+Ko[p][2]}for(let g=0;g<o.length;g+=3)o[g]-=s[0],o[g+1]-=s[1],o[g+2]-=s[2];e._boundsPoly.getPoints().setData(o,3),e._boundsPoly.getPoints().modified(),e._boundsPoly.getPolys().setData(c,1),e._boundsPoly.getPolys().modified(),e._boundsPoly.modified()},t.drawDepthRange=(r,n)=>{e._depthRangeTexture.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeTexture2.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeEncoder.attachTextureViews(),t.setCurrentOperation("volumeDepthRangePass"),r.setRenderEncoder(e._depthRangeEncoder),r.volumeDepthRangePass(!0),e._mapper.setWebGPURenderer(r),e._mapper.prepareToDraw(e._depthRangeEncoder),e._mapper.registerDrawCallback(e._depthRangeEncoder),r.volumeDepthRangePass(!1)},t.createDepthRangeEncoder=r=>{let n=r.getDevice();e._depthRangeEncoder=Je.newInstance({label:"VolumePass DepthRange"}),e._depthRangeEncoder.setPipelineHash("volr"),e._depthRangeEncoder.setReplaceShaderCodeFunction(i=>{let o=i.getShaderDescription("fragment");o.addOutput("vec4<f32>","outColor1"),o.addOutput("vec4<f32>","outColor2");let f=o.getCode();f=K.substitute(f,"//VTK::RenderEncoder::Impl",["output.outColor1 = vec4<f32>(input.fragPos.z, 0.0, 0.0, 0.0);","output.outColor2 = vec4<f32>(stopval, 0.0, 0.0, 0.0);"]).result,o.setCode(f)}),e._depthRangeEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:null,clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]}),e._depthRangeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"max"},alpha:{srcFactor:"one",dstFactor:"one",operation:"max"}}},{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"min"},alpha:{srcFactor:"one",dstFactor:"one",operation:"min"}}}]}}),e._depthRangeTexture=Ke.newInstance({label:"volumePassMaxDepth"}),e._depthRangeTexture.create(n,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let a=e._depthRangeTexture.createView("maxTexture");e._depthRangeEncoder.setColorTextureView(0,a),e._depthRangeTexture2=Ke.newInstance({label:"volumePassDepthMin"}),e._depthRangeTexture2.create(n,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});let s=e._depthRangeTexture2.createView("minTexture");e._depthRangeEncoder.setColorTextureView(1,s),e._mapper.setDevice(r.getDevice()),e._mapper.setTextureViews([e.depthTextureView])},t.createClearEncoder=r=>{e._colorTexture=Ke.newInstance({label:"volumePassColor"}),e._colorTexture.create(r.getDevice(),{width:r.getCanvas().width,height:r.getCanvas().height,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),e._colorTextureView=e._colorTexture.createView("volumePassColorTexture"),e._colorTextureView.addSampler(r.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._clearEncoder=Je.newInstance({label:"VolumePass Clear"}),e._clearEncoder.setColorTextureView(0,e._colorTextureView),e._clearEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),e._clearEncoder.setPipelineHash("volpf"),e._clearEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createCopyEncoder=r=>{e._copyEncoder=Je.newInstance({label:"volumePassCopy"}),e._copyEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._copyEncoder.setPipelineHash("volcopypf"),e._copyEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createMergeEncoder=r=>{e._mergeEncoder=Je.newInstance({label:"volumePassMerge"}),e._mergeEncoder.setColorTextureView(0,e._colorTextureView),e._mergeEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._mergeEncoder.setReplaceShaderCodeFunction(n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,a.setCode(s)}),e._mergeEncoder.setPipelineHash("volpf"),e._mergeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.setVolumes=r=>{if(!e.volumes||e.volumes.length!==r.length){e.volumes=[...r],t.modified();return}for(let n=0;n<r.length;n++)if(r[n]!==e.volumes[n]){e.volumes=[...r],t.modified();return}}}var BR={colorTextureView:null,depthTextureView:null,volumes:null};function dh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BR,r),Ue.extend(t,e,r),e._mapper=fn.newInstance(),e._mapper.setFragmentShaderTemplate(DR),e._mapper.getShaderReplacements().set("replaceShaderVolumePass",(n,a,s)=>{a.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")}),e._boundsPoly=Ge.newInstance(),e._lastMTimes=[],m.setGet(t,e,["colorTextureView","depthTextureView"]),VR(t,e)}var FR=m.newInstance(dh,"vtkWebGPUVolumePass"),yh={newInstance:FR,extend:dh};var kR=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = clamp(textureSampleLevel(opaquePassColorTexture, finalPassSampler, input.tcoordVS, 0.0),vec4<f32>(0.0),vec4<f32>(1.0));

  //VTK::RenderEncoder::Impl
  return output;
}
`;function UR(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t),e.opaquePass||(e.opaquePass=th.newInstance());let a=r.getRenderable().getNumberOfLayers(),s=r.getChildren();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){let f=s[o],c=r.getRenderable().getRenderers()[o];c.getDraw()&&c.getLayer()===i&&(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumes=[],t.setCurrentOperation("queryPass"),f.traverse(t),t.setCurrentOperation("cameraPass"),f.traverse(t),e.opaquePass.traverse(f,r),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=nh.newInstance()),e.translucentPass.setColorTextureView(e.opaquePass.getColorTextureView()),e.translucentPass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.translucentPass.traverse(f,r)),e.volumes.length>0&&(e.volumePass||(e.volumePass=yh.newInstance()),e.volumePass.setColorTextureView(e.opaquePass.getColorTextureView()),e.volumePass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.volumePass.setVolumes(e.volumes),e.volumePass.traverse(f,r)),t.finalPass(r,f))}},t.finalPass=(r,n)=>{e._finalBlitEncoder||t.createFinalBlitEncoder(r),e._finalBlitOutputTextureView.createFromTextureHandle(r.getCurrentTexture(),{depth:1,format:r.getPresentationFormat()}),e._finalBlitEncoder.attachTextureViews(),e._finalBlitEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e._finalBlitEncoder),e._fullScreenQuad.prepareAndDraw(e._finalBlitEncoder),e._finalBlitEncoder.end()},t.createFinalBlitEncoder=r=>{e._finalBlitEncoder=Je.newInstance({label:"forwardPassBlit"}),e._finalBlitEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._finalBlitEncoder.setPipelineHash("fpf"),e._finalBlitEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:r.getPresentationFormat(),blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}}),e._fsqSampler=cn.newInstance({label:"finalPassSampler"}),e._fsqSampler.create(r.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._fullScreenQuad=xt.newInstance(),e._fullScreenQuad.setDevice(r.getDevice()),e._fullScreenQuad.setPipelineHash("fpfsq"),e._fullScreenQuad.setTextureViews([e.opaquePass.getColorTextureView()]),e._fullScreenQuad.setAdditionalBindables([e._fsqSampler]),e._fullScreenQuad.setFragmentShaderTemplate(kR),e._finalBlitOutputTextureView=ps.newInstance(),e._finalBlitEncoder.setColorTextureView(0,e._finalBlitOutputTextureView)},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.addVolume=r=>{e.volumes.push(r)}}var NR={opaqueActorCount:0,translucentActorCount:0,volumes:null,opaqueRenderEncoder:null,translucentPass:null,volumePass:null};function xh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NR,r),Ue.extend(t,e,r),m.setGet(t,e,["opaquePass","translucentPass","volumePass"]),UR(t,e)}var GR=m.newInstance(xh,"vtkForwardPass"),Th={newInstance:GR,extend:xh};var{VtkDataTypes:Gr}=P;function _R(t,e){e.classHierarchy.push("vtkWebGPUTextureManager");function r(a){if(a.imageData){a.dataArray=a.imageData.getPointData().getScalars(),a.time=a.dataArray.getMTime(),a.nativeArray=a.dataArray.getData();let s=a.imageData.getDimensions();switch(a.width=s[0],a.height=s[1],a.depth=s[2],a.dataArray.getNumberOfComponents()){case 1:a.format="r";break;case 2:a.format="rg";break;case 3:case 4:default:a.format="rgba";break}switch(a.dataArray.getDataType()){case Gr.UNSIGNED_CHAR:a.format+="8unorm";break;case Gr.FLOAT:case Gr.UNSIGNED_INT:case Gr.INT:case Gr.DOUBLE:case Gr.UNSIGNED_SHORT:case Gr.SHORT:default:a.format+="16float";break}}a.image&&(a.width=a.image.width,a.height=a.image.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.jsImageData&&(a.width=a.jsImageData.width,a.height=a.jsImageData.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.nativeArray=a.jsImageData.data,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.imageBitmap&&(a.width=a.imageBitmap.width,a.height=a.imageBitmap.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.canvas&&(a.width=a.canvas.width,a.height=a.canvas.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT)}function n(a){let s=Ke.newInstance({label:a.label});return s.create(e.device,{width:a.width,height:a.height,depth:a.depth,format:a.format,usage:a.usage,mipLevel:a.mipLevel}),(a.nativeArray||a.image||a.canvas||a.imageBitmap)&&s.writeImageData(a),s}t.getTexture=a=>a.hash?e.device.getCachedObject(a.hash,n,a):n(a),t.getTextureForImageData=a=>{let s={time:a.getMTime()};return s.imageData=a,r(s),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)},t.getTextureForVTKTexture=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i={time:a.getMTime(),label:s};return a.getInputData()?i.imageData=a.getInputData():a.getImage()?i.image=a.getImage():a.getJsImageData()?i.jsImageData=a.getJsImageData():a.getImageBitmap()?i.imageBitmap=a.getImageBitmap():a.getCanvas()&&(i.canvas=a.getCanvas()),r(i),i.mipLevel=a.getMipLevel(),i.hash=i.time+i.format+i.mipLevel,e.device.getTextureManager().getTexture(i)}}var bR={handle:null,device:null};function Sh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bR,r),m.obj(t,e),m.setGet(t,e,["device"]),_R(t,e)}var zR=m.newInstance(Sh),Ch={newInstance:zR,extend:Sh};var Po=class extends Map{constructor(){super(),this.registry=new FinalizationRegistry(e=>{let r=super.get(e);r&&r.deref&&r.deref()===void 0&&super.delete(e)})}getValue(e){let r=super.get(e);if(r){let n=r.deref();if(n!==void 0)return n;super.delete(e)}}setValue(e,r){let n;return r&&typeof r=="object"&&(n=new WeakRef(r),this.registry.register(r,e),super.set(e,n)),n}};function WR(t,e){e.classHierarchy.push("vtkWebGPUDevice"),t.initialize=r=>{e.handle=r},t.createCommandEncoder=()=>e.handle.createCommandEncoder(),t.submitCommandEncoder=r=>{e.handle.queue.submit([r.finish()])},t.getShaderModule=r=>e.shaderCache.getShaderModule(r),t.getBindGroupLayout=r=>{if(!r.entries)return null;for(let s=0;s<r.entries.length;s++){let i=r.entries[s];i.binding=i.binding||0,i.visibility=i.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}let n=JSON.stringify(r);for(let s=0;s<e.bindGroupLayouts.length;s++)if(e.bindGroupLayouts[s].sval===n)return e.bindGroupLayouts[s].layout;let a=e.handle.createBindGroupLayout(r);return e.bindGroupLayouts.push({sval:n,layout:a}),a},t.getBindGroupLayoutDescription=r=>{for(let n=0;n<e.bindGroupLayouts.length;n++)if(e.bindGroupLayouts[n].layout===r)return e.bindGroupLayouts[n].sval;return vtkErrorMacro("layout not found"),console.trace(),null},t.getPipeline=r=>r in e.pipelines?e.pipelines[r]:null,t.createPipeline=(r,n)=>{n.initialize(t,r),e.pipelines[r]=n},t.onSubmittedWorkDone=()=>e.handle.queue.onSubmittedWorkDone(),t.hasCachedObject=r=>e.objectCache.getValue(r),t.getCachedObject=function(r,n){if(!r)return vtkErrorMacro("attempt to cache an object without a hash"),null;let a=e.objectCache.getValue(r);if(a)return a;for(var s=arguments.length,i=new Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];let f=n(...i);return e.objectCache.setValue(r,f),f}}var HR={handle:null,pipelines:null,shaderCache:null,bindGroupLayouts:null,bufferManager:null,textureManager:null};function mh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HR,r),ne(t,e),re(t,e,["handle"]),pe(t,e,["bufferManager","shaderCache","textureManager"]),e.objectCache=new Po,e.shaderCache=K.newInstance(),e.shaderCache.setDevice(t),e.bindGroupLayouts=[],e.bufferManager=et.newInstance(),e.bufferManager.setDevice(t),e.textureManager=Ch.newInstance(),e.textureManager.setDevice(t),e.pipelines={},WR(t,e)}var AR=j(mh,"vtkWebGPUDevice"),wh={newInstance:AR,extend:mh};function $R(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelectionPass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=null,t.setCurrentOperation("buildPass"),r.traverse(t);let a=r.getDevice();if(e.selectionRenderEncoder)e.colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e.depthTexture.resizeToMatch(e.colorTexture);else{t.createRenderEncoder(),e.colorTexture=Ke.newInstance({label:"hardwareSelectorColor"}),e.colorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba32uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});let s=e.colorTexture.createView("hardwareSelectColorTexture");e.selectionRenderEncoder.setColorTextureView(0,s),e.depthTexture=Ke.newInstance({label:"hardwareSelectorDepth"}),e.depthTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});let i=e.depthTexture.createView("hardwareSelectDepthTexture");e.selectionRenderEncoder.setDepthTextureView(i)}e.selectionRenderEncoder.attachTextureViews(),n.setRenderEncoder(e.selectionRenderEncoder),t.setCurrentOperation("cameraPass"),n.traverse(t),t.setCurrentOperation("opaquePass"),n.traverse(t)},t.createRenderEncoder=()=>{e.selectionRenderEncoder=Je.newInstance({label:"HardwareSelectionPass"}),e.selectionRenderEncoder.setPipelineHash("sel"),e.selectionRenderEncoder.setReplaceShaderCodeFunction(n=>{let a=n.getShaderDescription("fragment");a.addOutput("vec4<u32>","outColor");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);"]).result,a.setCode(s)});let r=e.selectionRenderEncoder.getDescription();r.colorAttachments[0].clearValue=[0,0,0,0],e.selectionRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba32uint",blend:void 0}]}})}}var jR={selectionRenderEncoder:null,colorTexture:null,depthTexture:null};function Eh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jR,r),Ue.extend(t,e,r),m.get(t,e,["colorTexture","depthTexture"]),$R(t,e)}var KR=m.newInstance(Eh,"vtkWebGPUHardwareSelectionPass"),Mh={newInstance:KR,extend:Eh};var{SelectionContent:PR,SelectionField:Rh}=sn,{FieldAssociations:Oh}=Ie,{vtkErrorMacro:Lh}=m;function XR(t){return`${t.propID} ${t.compositeID}`}function Dh(t,e,r,n){let a=((r.height-e-1)*r.colorBufferWidth+t)*4+n;return r.colorValues[a]}function gn(t,e,r,n){let a=r<0?0:r;if(a===0){if(n[0]=e[0],n[1]=e[1],e[0]<0||e[0]>=t.width||e[1]<0||e[1]>=t.height)return null;let f=Dh(e[0],e[1],t,0);if(f<=0)return null;let c={};c.propID=f;let g=Dh(e[0],e[1],t,1);if((g<0||g>16777215)&&(g=0),c.compositeID=g,t.captureZValues){let u=(t.height-e[1]-1)*t.zbufferBufferWidth+e[0];c.zValue=t.depthValues[u],c.zValue=t.webGPURenderer.convertToOpenGLDepth(c.zValue),c.displayPosition=e}return c}let s=[e[0],e[1]],i=[0,0],o=gn(t,e,0,n);if(o)return o;for(let f=1;f<a;++f){for(let c=s[1]>f?s[1]-f:0;c<=s[1]+f;++c)if(i[1]=c,s[0]>=f&&(i[0]=s[0]-f,o=gn(t,i,0,n),o)||(i[0]=s[0]+f,o=gn(t,i,0,n),o))return o;for(let c=s[0]>=f?s[0]-(f-1):0;c<=s[0]+(f-1);++c)if(i[0]=c,s[1]>=f&&(i[1]=s[1]-f,o=gn(t,i,0,n),o)||(i[1]=s[1]+f,o=gn(t,i,0,n),o))return o}return n[0]=e[0],n[1]=e[1],null}function YR(t,e,r){let n=[],a=0;return e.forEach((s,i)=>{let o=sn.newInstance();switch(o.setContentType(PR.INDICES),t){case Oh.FIELD_ASSOCIATION_CELLS:o.setFieldType(Rh.CELL);break;case Oh.FIELD_ASSOCIATION_POINTS:o.setFieldType(Rh.POINT);break;default:Lh("Unknown field association")}o.getProperties().propID=s.info.propID;let f=r.webGPURenderer.getPropFromID(s.info.propID);o.getProperties().prop=f.getRenderable(),o.getProperties().compositeID=s.info.compositeID,o.getProperties().pixelCount=s.pixelCount,r.captureZValues&&(o.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],o.getProperties().worldPosition=r.webGPURenderWindow.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r.renderer)),o.setSelectionList(s.attributeIDs),n[a]=o,a++}),n}function IR(t,e,r,n,a){let s=Math.floor(e),i=Math.floor(r),o=Math.floor(n),f=Math.floor(a),c=new Map,g=[0,0];for(let u=i;u<=f;u++)for(let l=s;l<=o;l++){let d=gn(t,[l,u],0,g);if(d){let h=XR(d);if(!c.has(h))c.set(h,{info:d,pixelCount:1,attributeIDs:[d.attributeID]});else{let v=c.get(h);v.pixelCount++,t.captureZValues&&d.zValue<v.info.zValue&&(v.info=d),v.attributeIDs.indexOf(d.attributeID)===-1&&v.attributeIDs.push(d.attributeID)}}}return YR(t.fieldAssociation,c,t)}function qR(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelector"),t.endSelection=()=>{e.WebGPURenderer.setSelector(null)},t.getSourceDataAsync=async r=>{if(!r||!e._WebGPURenderWindow)return Lh("Renderer and view must be set before calling Select."),!1;e._WebGPURenderWindow.getRenderable().preRender(),e._WebGPURenderWindow.getInitialized()||(e._WebGPURenderWindow.initialize(),await new Promise(p=>{e._WebGPURenderWindow.onInitialized(p)}));let n=e._WebGPURenderWindow.getViewNodeFor(r);if(!n)return!1;let a=n.getSuppressClear();n.setSuppressClear(!0),e._selectionPass.traverse(e._WebGPURenderWindow,n),n.setSuppressClear(a);let s=e._WebGPURenderWindow.getDevice(),i=e._selectionPass.getColorTexture(),o=e._selectionPass.getDepthTexture(),f={area:[0,0,i.getWidth()-1,i.getHeight()-1],captureZValues:e.captureZValues,fieldAssociation:e.fieldAssociation,renderer:r,webGPURenderer:n,webGPURenderWindow:e._WebGPURenderWindow,width:i.getWidth(),height:i.getHeight()};f.colorBufferWidth=16*Math.floor((f.width+15)/16),f.colorBufferSizeInBytes=f.colorBufferWidth*f.height*4*4;let c=Lt.newInstance({label:"hardwareSelectColorBuffer"});c.setDevice(s),c.create(f.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);let g=e._WebGPURenderWindow.getCommandEncoder();g.copyTextureToBuffer({texture:i.getHandle()},{buffer:c.getHandle(),bytesPerRow:16*f.colorBufferWidth,rowsPerImage:f.height},{width:f.width,height:f.height,depthOrArrayLayers:1});let u;e.captureZValues&&(f.zbufferBufferWidth=64*Math.floor((f.width+63)/64),u=Lt.newInstance({label:"hardwareSelectDepthBuffer"}),u.setDevice(s),f.zbufferSizeInBytes=f.height*f.zbufferBufferWidth*4,u.create(f.zbufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),g.copyTextureToBuffer({texture:o.getHandle(),aspect:"depth-only"},{buffer:u.getHandle(),bytesPerRow:4*f.zbufferBufferWidth,rowsPerImage:f.height},{width:f.width,height:f.height,depthOrArrayLayers:1})),s.submitCommandEncoder(g);let l=c.mapAsync(GPUMapMode.READ);if(e.captureZValues){let p=u.mapAsync(GPUMapMode.READ);await Promise.all([l,p]),f.depthValues=new Float32Array(u.getMappedRange().slice()),u.unmap()}else await l;return f.colorValues=new Uint32Array(c.getMappedRange().slice()),c.unmap(),f.generateSelection=(p,d,h,v)=>IR(f,p,d,h,v),f}}var ZR={};function Vh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZR,r),cs.extend(t,e,r),e._selectionPass=Mh.newInstance(),m.setGet(t,e,["_WebGPURenderWindow"]),m.moveToProtected(t,e,["WebGPURenderWindow"]),qR(t,e)}var QR=m.newInstance(Vh,"vtkWebGPUHardwareSelector"),Xo={newInstance:QR,extend:Vh};var Bh=Object.create(null);function De(t,e){Bh[t]=e}function JR(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}var eO={};function Fh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eO,r),e.overrides=Bh,ss.extend(t,e,r),JR(t,e)}var tO=m.newInstance(Fh,"vtkWebGPUViewNodeFactory"),kh={newInstance:tO,extend:Fh};var{vtkErrorMacro:Uh}=m,rO={position:"absolute",top:0,left:0,width:"100%",height:"100%"};function nO(t,e){e.classHierarchy.push("vtkWebGPURenderWindow"),t.getViewNodeFactory=()=>e.myFactory;let r=[0,0];function n(){e.renderable&&(e.size[0]!==r[0]||e.size[1]!==r[1])&&(r[0]=e.size[0],r[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1]),t.recreateSwapChain()),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(n),t.recreateSwapChain=()=>{e.context&&(e.context.unconfigure(),e.presentationFormat=navigator.gpu.getPreferredCanvasFormat(e.adapter),e.context.configure({device:e.device.getHandle(),format:e.presentationFormat,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,width:e.size[0],height:e.size[1]}),e._configured=!0)},t.getCurrentTexture=()=>e.context.getCurrentTexture(),t.buildPass=i=>{if(i){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize()}else e.initialized&&(e._configured||t.recreateSwapChain(),e.commandEncoder=e.device.createCommandEncoder())},t.initialize=()=>{if(!e.initializing){if(e.initializing=!0,!navigator.gpu){Uh("WebGPU is not enabled.");return}t.create3DContextAsync().then(()=>{e.initialized=!0,!e.deleted&&t.invokeInitialized()})}},t.setContainer=i=>{e.el&&e.el!==i&&(e.canvas.parentNode!==e.el&&Uh("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==i&&(e.el=i,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){let{width:i,height:o}=e.el.getBoundingClientRect();e.containerSize=[i,o]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.size,t.create3DContextAsync=async()=>{if(e.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!e.deleted){if(e.device=wh.newInstance(),e.device.initialize(await e.adapter.requestDevice()),e.deleted){e.device=null;return}e.context=e.canvas.getContext("webgpu")}},t.releaseGraphicsResources=()=>{let i=Ue.newInstance();i.setCurrentOperation("Release"),i.traverse(t,null),e.adapter=null,e.device=null,e.context=null,e.initialized=!1,e.initializing=!1},t.setBackgroundImage=i=>{e.bgImage.src=i.src},t.setUseBackgroundImage=i=>{e.useBackgroundImage=i,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};async function a(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat,o=document.createElement("canvas"),f=o.getContext("2d");o.width=e.canvas.width,o.height=e.canvas.height;let c=await t.getPixelsAsync(),g=new ImageData(c.colorValues,c.width,c.height);f.putImageData(g,0,0);let u=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(h=>{h.getViewProps().forEach(y=>{if(y.getContainer){let x=y.getContainer().getElementsByTagName("canvas");for(let T=0;T<x.length;T++){let w=x[T],S=w.getBoundingClientRect(),M=S.x-u.x,E=S.y-u.y;f.drawImage(w,M,E)}}})});let d=o.toDataURL(i);o.remove(),t.invokeImageReady(d)}t.captureNextImage=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:o=!1,size:f=null,scale:c=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=i;let g=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:f||c!==1?f||e.size.map(u=>u*c):null},new Promise((u,l)=>{let p=t.onImageReady(d=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=g,p.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(h=>{let{restoreParamsFn:v,arg:y}=h;return v(y)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),u(d);else{let h=document.createElement("img");if(h.style=rO,h.src=d,e._screenshot.placeHolder=e.el.appendChild(h),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),o){let v=o!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(y=>{let C=y.getActiveCamera(),x=C.get("focalPoint","position","parallelScale");return{resetCameraArgs:v?{renderer:y}:void 0,resetCameraFn:v?o:y.resetCamera,restoreParamsFn:C.set,arg:JSON.parse(JSON.stringify(x))}}),e._screenshot.cameras.forEach(y=>{let{resetCameraFn:C,resetCameraArgs:x}=y;return C(x)})}t.traverseAllPasses()}})})},t.traverseAllPasses=()=>{if(!e.deleted)if(e.initialized){if(e.renderPasses)for(let i=0;i<e.renderPasses.length;++i)e.renderPasses[i].traverse(t,null);e.commandEncoder&&(e.device.submitCommandEncoder(e.commandEncoder),e.commandEncoder=null,e.notifyStartCaptureImage&&e.device.onSubmittedWorkDone().then(()=>{a()}))}else{t.initialize();let i=t.onInitialized(()=>{i.unsubscribe(),t.traverseAllPasses()})}},t.setViewStream=i=>{if(e.viewStream===i)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=i,e.viewStream){let o=e.renderable.getRenderers()[0];o.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(f=>t.setBackgroundImage(f.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.getUniquePropID=()=>e.nextPropID++,t.getPropFromID=i=>{for(let o=0;o<e.children.length;o++){let f=e.children[o].getPropFromID(i);if(f!==null)return f}return null},t.getPixelsAsync=async()=>{let i=e.device,o=e.renderPasses[0].getOpaquePass().getColorTexture(),f={width:o.getWidth(),height:o.getHeight()};f.colorBufferWidth=32*Math.floor((f.width+31)/32),f.colorBufferSizeInBytes=f.colorBufferWidth*f.height*8;let c=Lt.newInstance();c.setDevice(i),c.create(f.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);let g=e.device.createCommandEncoder();g.copyTextureToBuffer({texture:o.getHandle()},{buffer:c.getHandle(),bytesPerRow:8*f.colorBufferWidth,rowsPerImage:f.height},{width:f.width,height:f.height,depthOrArrayLayers:1}),i.submitCommandEncoder(g),await c.mapAsync(GPUMapMode.READ),f.colorValues=new Uint16Array(c.getMappedRange().slice()),c.unmap();let l=new Uint8ClampedArray(f.height*f.width*4);for(let p=0;p<f.height;p++)for(let d=0;d<f.width;d++){let h=(p*f.width+d)*4,v=(p*f.colorBufferWidth+d)*4;l[h]=255*Ze.fromHalf(f.colorValues[v]),l[h+1]=255*Ze.fromHalf(f.colorValues[v+1]),l[h+2]=255*Ze.fromHalf(f.colorValues[v+2]),l[h+3]=255*Ze.fromHalf(f.colorValues[v+3])}return f.colorValues=l,f},t.createSelector=()=>{let i=Xo.newInstance();return i.setWebGPURenderWindow(t),i};let s=t.setSize;t.setSize=(i,o)=>{let f=s(i,o);return f&&t.invokeWindowResizeEvent({width:i,height:o}),f},t.delete=m.chain(t.delete,t.setViewStream)}var aO={initialized:!1,context:null,adapter:null,device:null,canvas:null,cursorVisibility:!0,cursor:"pointer",containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1,nextPropID:1,xrSupported:!1,presentationFormat:null};function sO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aO,r),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",us.extend(t,e,r),e.myFactory=kh.newInstance(),e.renderPasses[0]=Th.newInstance(),e.selector||(e.selector=Xo.newInstance(),e.selector.setWebGPURenderWindow(t)),m.event(t,e,"imageReady"),m.event(t,e,"initialized"),m.get(t,e,["commandEncoder","device","presentationFormat","useBackgroundImage","xrSupported"]),m.setGet(t,e,["initialized","context","canvas","device","renderPasses","notifyStartCaptureImage","cursor","useOffScreen"]),m.setGetArray(t,e,["size"],2),m.event(t,e,"windowResizeEvent"),nO(t,e)}var Nh=m.newInstance(sO,"vtkWebGPURenderWindow");Fn("WebGPU",Nh);De("vtkRenderWindow",Nh);var iO=wl.extractURLParameters(),oO={margin:"0",padding:"0",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"},fO={position:"absolute",left:"25px",top:"25px",backgroundColor:"white",borderRadius:"5px",listStyle:"none",padding:"5px 10px",margin:"0",display:"block",border:"solid 1px black",maxWidth:"calc(100% - 70px)",maxHeight:"calc(100% - 60px)",overflow:"auto"};function Gh(t,e){Object.keys(e).forEach(r=>{t.style[r]=e[r]})}function cO(t,e){e.classHierarchy.push("vtkFullScreenRenderWindow");let r=document.querySelector("body");e.rootContainer||(e.rootContainer=r),e.container||(e.container=document.createElement("div"),Gh(e.container,e.containerStyle||oO),e.rootContainer.appendChild(e.container)),e.rootContainer===r&&(document.documentElement.style.height="100%",r.style.height="100%",r.style.padding="0",r.style.margin="0"),e.renderWindow=vl.newInstance(),e.renderer=Wa.newInstance(),e.renderWindow.addRenderer(e.renderer),e.apiSpecificRenderWindow=e.renderWindow.newAPISpecificView(iO.viewAPI??e.defaultViewAPI),e.apiSpecificRenderWindow.setContainer(e.container),e.renderWindow.addView(e.apiSpecificRenderWindow),e.interactor=Xa.newInstance(),e.interactor.setInteractorStyle(ml.newInstance()),e.interactor.setView(e.apiSpecificRenderWindow),e.interactor.initialize(),e.interactor.bindEvents(e.container),t.setBackground=e.renderer.setBackground,t.removeController=()=>{let a=e.controlContainer;a&&a.parentNode.removeChild(a)},t.setControllerVisibility=a=>{e.controllerVisibility=a,e.controlContainer&&(a?e.controlContainer.style.display="block":e.controlContainer.style.display="none")},t.toggleControllerVisibility=()=>{t.setControllerVisibility(!e.controllerVisibility)};function n(a){String.fromCharCode(a.charCode)==="c"&&t.toggleControllerVisibility()}t.addController=a=>{e.controlContainer=document.createElement("div"),Gh(e.controlContainer,e.controlPanelStyle||fO),e.rootContainer.appendChild(e.controlContainer),e.controlContainer.innerHTML=a,t.setControllerVisibility(e.controllerVisibility),e.rootContainer.addEventListener("keypress",n)},t.setBackground(...e.background),t.addRepresentation=a=>{a.getActors().forEach(s=>{e.renderer.addActor(s)})},t.removeRepresentation=a=>{a.getActors().forEach(s=>e.renderer.removeActor(s))},t.delete=m.chain(t.setContainer,e.apiSpecificRenderWindow.delete,()=>{e.rootContainer?.removeEventListener("keypress",n),window.removeEventListener("resize",t.resize)},t.delete),t.resize=()=>{let a=e.container.getBoundingClientRect(),s=window.devicePixelRatio||1;e.apiSpecificRenderWindow.setSize(Math.floor(a.width*s),Math.floor(a.height*s)),e.resizeCallback&&e.resizeCallback(a),e.renderWindow.render()},t.setResizeCallback=a=>{e.resizeCallback=a,t.resize()},e.listenWindowResize&&window.addEventListener("resize",t.resize),t.resize()}var uO={background:[.32,.34,.43],containerStyle:null,controlPanelStyle:null,listenWindowResize:!0,resizeCallback:null,controllerVisibility:!0};function _h(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uO,r),m.obj(t,e),m.get(t,e,["renderWindow","renderer","apiSpecificRenderWindow","interactor","rootContainer","container","controlContainer"]),cO(t,e)}var gO=m.newInstance(_h),bh={newInstance:gO,extend:_h};function lO(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=r=>{if(r){let n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=r=>{if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){O.copy(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),Se.fromMat4(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),Se.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),O.transpose(e.keyMatrices.wcvc,e.keyMatrices.wcvc);let n=e._openGLRenderer.getAspectRatio();O.copy(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),O.transpose(e.keyMatrices.vcpc,e.keyMatrices.vcpc),O.multiply(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}var pO={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function hO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pO,r),I.extend(t,e,r),e.keyMatrixTime={},ne(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},re(t,e,["context","keyMatrixTime"]),lO(t,e)}var vO=j(hO);de("vtkCamera",vO);var{vtkDebugMacro:dO}=Ee;function yO(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let r=0,n=e.renderable.getLightsByReference();for(let a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(dO("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=r=>{if(r){let n=0,a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),n|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));let s=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.colorMask(!0,!0,!0,!0),n&&a.clear(n),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.cameraPass=r=>{r&&t.clear()},t.getAspectRatio=()=>{let r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=()=>{let r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],s=r[1]-n[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),f=Math.round(i[1]),c=r[2]-n[0],g=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(c,g),l=Math.round(u[0])-o,p=Math.round(u[1])-f;return l<0&&(l=0),p<0&&(p=0),{usize:l,vsize:p,lowerLeftU:o,lowerLeftV:f}},t.clear=()=>{let r=0,n=e.context;if(!e.renderable.getTransparent()){let s=e.renderable.getBackgroundByReference();n.clearColor(s[0],s[1],s[2],s[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,n.depthMask(!0)),n.colorMask(!0,!0,!0,!0);let a=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),n.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(r=>{r.modified()})},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}var xO={context:null,_openGLRenderWindow:null,selector:null};function TO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xO,r),I.extend(t,e,r),pe(t,e,["shaderCache"]),re(t,e,["selector"]),Jt(t,e,["openGLRenderWindow"]),yO(t,e)}var SO=j(TO,"vtkOpenGLRenderer");de("vtkRenderer",SO);function CO(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=r=>{if(r){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){let a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){let n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),O.copy(e.keyMatrices.mcwc,e.renderable.getMatrix()),O.transpose(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Se.identity(e.keyMatrices.normalMatrix):(Se.fromMat4(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),Se.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Se.transpose(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}var mO={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function wO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mO,r),I.extend(t,e,r),e.keyMatrixTime={},ne(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Se.identity(new Float64Array(9)),mcwc:O.identity(new Float64Array(16))},re(t,e,["context"]),pe(t,e,["activeTextures"]),CO(t,e)}var EO=j(wO);de("vtkActor",EO);function MO(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=r=>{if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){let a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){let n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}var RO={context:null,activeTextures:null};function OO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RO,r),I.extend(t,e,r),re(t,e,["context"]),pe(t,e,["activeTextures"]),MO(t,e)}var DO=j(OO);de("vtkActor2D",DO);function _r(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Yo(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function vs(t){let e,r,n;t.length!==2?(e=_r,r=(o,f)=>_r(t(o),f),n=(o,f)=>t(o)-f):(e=t===_r||t===Yo?t:LO,r=t,n=t);function a(o,f,c=0,g=o.length){if(c<g){if(e(f,f)!==0)return g;do{let u=c+g>>>1;r(o[u],f)<0?c=u+1:g=u}while(c<g)}return c}function s(o,f,c=0,g=o.length){if(c<g){if(e(f,f)!==0)return g;do{let u=c+g>>>1;r(o[u],f)<=0?c=u+1:g=u}while(c<g)}return c}function i(o,f,c=0,g=o.length){let u=a(o,f,c,g-1);return u>c&&n(o[u-1],f)>-n(o[u],f)?u-1:u}return{left:a,center:i,right:s}}function LO(){return 0}function Io(t){return t===null?NaN:+t}var zh=vs(_r),Wh=zh.right,VO=zh.left,BO=vs(Io).center,qo=Wh;var FO=Math.sqrt(50),kO=Math.sqrt(10),UO=Math.sqrt(2);function ds(t,e,r){let n=(e-t)/Math.max(0,r),a=Math.floor(Math.log10(n)),s=n/Math.pow(10,a),i=s>=FO?10:s>=kO?5:s>=UO?2:1,o,f,c;return a<0?(c=Math.pow(10,-a)/i,o=Math.round(t*c),f=Math.round(e*c),o/c<t&&++o,f/c>e&&--f,c=-c):(c=Math.pow(10,a)*i,o=Math.round(t/c),f=Math.round(e/c),o*c<t&&++o,f*c>e&&--f),f<o&&.5<=r&&r<2?ds(t,e,r*2):[o,f,c]}function ys(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];let n=e<t,[a,s,i]=n?ds(e,t,r):ds(t,e,r);if(!(s>=a))return[];let o=s-a+1,f=new Array(o);if(n)if(i<0)for(let c=0;c<o;++c)f[c]=(s-c)/-i;else for(let c=0;c<o;++c)f[c]=(s-c)*i;else if(i<0)for(let c=0;c<o;++c)f[c]=(a+c)/-i;else for(let c=0;c<o;++c)f[c]=(a+c)*i;return f}function Pn(t,e,r){return e=+e,t=+t,r=+r,ds(t,e,r)[2]}function Zo(t,e,r){e=+e,t=+t,r=+r;let n=e<t,a=n?Pn(e,t,r):Pn(t,e,r);return(n?-1:1)*(a<0?1/-a:a)}function Hh(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function xs(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Qo(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function In(){}var Xn=.7,Cs=1/Xn,ln="\\s*([+-]?\\d+)\\s*",Yn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",NO=/^#([0-9a-f]{3,8})$/,GO=new RegExp(`^rgb\\(${ln},${ln},${ln}\\)$`),_O=new RegExp(`^rgb\\(${Vt},${Vt},${Vt}\\)$`),bO=new RegExp(`^rgba\\(${ln},${ln},${ln},${Yn}\\)$`),zO=new RegExp(`^rgba\\(${Vt},${Vt},${Vt},${Yn}\\)$`),WO=new RegExp(`^hsl\\(${Yn},${Vt},${Vt}\\)$`),HO=new RegExp(`^hsla\\(${Yn},${Vt},${Vt},${Yn}\\)$`),Ah={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};xs(In,pr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:$h,formatHex:$h,formatHex8:AO,formatHsl:$O,formatRgb:jh,toString:jh});function $h(){return this.rgb().formatHex()}function AO(){return this.rgb().formatHex8()}function $O(){return qh(this).formatHsl()}function jh(){return this.rgb().formatRgb()}function pr(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=NO.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?Kh(e):r===3?new tt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Ts(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Ts(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=GO.exec(t))?new tt(e[1],e[2],e[3],1):(e=_O.exec(t))?new tt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=bO.exec(t))?Ts(e[1],e[2],e[3],e[4]):(e=zO.exec(t))?Ts(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=WO.exec(t))?Yh(e[1],e[2]/100,e[3]/100,1):(e=HO.exec(t))?Yh(e[1],e[2]/100,e[3]/100,e[4]):Ah.hasOwnProperty(t)?Kh(Ah[t]):t==="transparent"?new tt(NaN,NaN,NaN,0):null}function Kh(t){return new tt(t>>16&255,t>>8&255,t&255,1)}function Ts(t,e,r,n){return n<=0&&(t=e=r=NaN),new tt(t,e,r,n)}function jO(t){return t instanceof In||(t=pr(t)),t?(t=t.rgb(),new tt(t.r,t.g,t.b,t.opacity)):new tt}function pn(t,e,r,n){return arguments.length===1?jO(t):new tt(t,e,r,n??1)}function tt(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}xs(tt,pn,Qo(In,{brighter(t){return t=t==null?Cs:Math.pow(Cs,t),new tt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Xn:Math.pow(Xn,t),new tt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new tt(zr(this.r),zr(this.g),zr(this.b),ms(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ph,formatHex:Ph,formatHex8:KO,formatRgb:Xh,toString:Xh}));function Ph(){return`#${br(this.r)}${br(this.g)}${br(this.b)}`}function KO(){return`#${br(this.r)}${br(this.g)}${br(this.b)}${br((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xh(){let t=ms(this.opacity);return`${t===1?"rgb(":"rgba("}${zr(this.r)}, ${zr(this.g)}, ${zr(this.b)}${t===1?")":`, ${t})`}`}function ms(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function zr(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function br(t){return t=zr(t),(t<16?"0":"")+t.toString(16)}function Yh(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new St(t,e,r,n)}function qh(t){if(t instanceof St)return new St(t.h,t.s,t.l,t.opacity);if(t instanceof In||(t=pr(t)),!t)return new St;if(t instanceof St)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,a=Math.min(e,r,n),s=Math.max(e,r,n),i=NaN,o=s-a,f=(s+a)/2;return o?(e===s?i=(r-n)/o+(r<n)*6:r===s?i=(n-e)/o+2:i=(e-r)/o+4,o/=f<.5?s+a:2-s-a,i*=60):o=f>0&&f<1?0:i,new St(i,o,f,t.opacity)}function Zh(t,e,r,n){return arguments.length===1?qh(t):new St(t,e,r,n??1)}function St(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}xs(St,Zh,Qo(In,{brighter(t){return t=t==null?Cs:Math.pow(Cs,t),new St(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Xn:Math.pow(Xn,t),new St(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,a=2*r-n;return new tt(Jo(t>=240?t-240:t+120,a,n),Jo(t,a,n),Jo(t<120?t+240:t-120,a,n),this.opacity)},clamp(){return new St(Ih(this.h),Ss(this.s),Ss(this.l),ms(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=ms(this.opacity);return`${t===1?"hsl(":"hsla("}${Ih(this.h)}, ${Ss(this.s)*100}%, ${Ss(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Ih(t){return t=(t||0)%360,t<0?t+360:t}function Ss(t){return Math.max(0,Math.min(1,t||0))}function Jo(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}function ef(t,e,r,n,a){var s=t*t,i=s*t;return((1-3*t+3*s-i)*e+(4-6*s+3*i)*r+(1+3*t+3*s-3*i)*n+i*a)/6}function Qh(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),a=t[n],s=t[n+1],i=n>0?t[n-1]:2*a-s,o=n<e-1?t[n+2]:2*s-a;return ef((r-n/e)*e,i,a,s,o)}}function Jh(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),a=t[(n+e-1)%e],s=t[n%e],i=t[(n+1)%e],o=t[(n+2)%e];return ef((r-n/e)*e,a,s,i,o)}}var qn=t=>()=>t;function PO(t,e){return function(r){return t+r*e}}function XO(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function e1(t){return(t=+t)==1?ws:function(e,r){return r-e?XO(e,r,t):qn(isNaN(e)?r:e)}}function ws(t,e){var r=e-t;return r?PO(t,r):qn(isNaN(t)?e:t)}var tf=(function t(e){var r=e1(e);function n(a,s){var i=r((a=pn(a)).r,(s=pn(s)).r),o=r(a.g,s.g),f=r(a.b,s.b),c=ws(a.opacity,s.opacity);return function(g){return a.r=i(g),a.g=o(g),a.b=f(g),a.opacity=c(g),a+""}}return n.gamma=t,n})(1);function t1(t){return function(e){var r=e.length,n=new Array(r),a=new Array(r),s=new Array(r),i,o;for(i=0;i<r;++i)o=pn(e[i]),n[i]=o.r||0,a[i]=o.g||0,s[i]=o.b||0;return n=t(n),a=t(a),s=t(s),o.opacity=1,function(f){return o.r=n(f),o.g=a(f),o.b=s(f),o+""}}}var cz=t1(Qh),uz=t1(Jh);function r1(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),a;return function(s){for(a=0;a<r;++a)n[a]=t[a]*(1-s)+e[a]*s;return n}}function n1(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function a1(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,a=new Array(n),s=new Array(r),i;for(i=0;i<n;++i)a[i]=Wr(t[i],e[i]);for(;i<r;++i)s[i]=e[i];return function(o){for(i=0;i<n;++i)s[i]=a[i](o);return s}}function s1(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function hr(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function i1(t,e){var r={},n={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?r[a]=Wr(t[a],e[a]):n[a]=e[a];return function(s){for(a in r)n[a]=r[a](s);return n}}var nf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rf=new RegExp(nf.source,"g");function YO(t){return function(){return t}}function IO(t){return function(e){return t(e)+""}}function o1(t,e){var r=nf.lastIndex=rf.lastIndex=0,n,a,s,i=-1,o=[],f=[];for(t=t+"",e=e+"";(n=nf.exec(t))&&(a=rf.exec(e));)(s=a.index)>r&&(s=e.slice(r,s),o[i]?o[i]+=s:o[++i]=s),(n=n[0])===(a=a[0])?o[i]?o[i]+=a:o[++i]=a:(o[++i]=null,f.push({i,x:hr(n,a)})),r=rf.lastIndex;return r<e.length&&(s=e.slice(r),o[i]?o[i]+=s:o[++i]=s),o.length<2?f[0]?IO(f[0].x):YO(e):(e=f.length,function(c){for(var g=0,u;g<e;++g)o[(u=f[g]).i]=u.x(c);return o.join("")})}function Wr(t,e){var r=typeof e,n;return e==null||r==="boolean"?qn(e):(r==="number"?hr:r==="string"?(n=pr(e))?(e=n,tf):o1:e instanceof pr?tf:e instanceof Date?s1:n1(e)?r1:Array.isArray(e)?a1:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?i1:hr)(t,e)}function af(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function sf(t){return function(){return t}}function of(t){return+t}var f1=[0,1];function hn(t){return t}function ff(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:sf(isNaN(e)?NaN:.5)}function qO(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function ZO(t,e,r){var n=t[0],a=t[1],s=e[0],i=e[1];return a<n?(n=ff(a,n),s=r(i,s)):(n=ff(n,a),s=r(s,i)),function(o){return s(n(o))}}function QO(t,e,r){var n=Math.min(t.length,e.length)-1,a=new Array(n),s=new Array(n),i=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++i<n;)a[i]=ff(t[i],t[i+1]),s[i]=r(e[i],e[i+1]);return function(o){var f=qo(t,o,1,n)-1;return s[f](a[f](o))}}function c1(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function JO(){var t=f1,e=f1,r=Wr,n,a,s,i=hn,o,f,c;function g(){var l=Math.min(t.length,e.length);return i!==hn&&(i=qO(t[0],t[l-1])),o=l>2?QO:ZO,f=c=null,u}function u(l){return l==null||isNaN(l=+l)?s:(f||(f=o(t.map(n),e,r)))(n(i(l)))}return u.invert=function(l){return i(a((c||(c=o(e,t.map(n),hr)))(l)))},u.domain=function(l){return arguments.length?(t=Array.from(l,of),g()):t.slice()},u.range=function(l){return arguments.length?(e=Array.from(l),g()):e.slice()},u.rangeRound=function(l){return e=Array.from(l),r=af,g()},u.clamp=function(l){return arguments.length?(i=l?!0:hn,g()):i!==hn},u.interpolate=function(l){return arguments.length?(r=l,g()):r},u.unknown=function(l){return arguments.length?(s=l,u):s},function(l,p){return n=l,a=p,g()}}function cf(){return JO()(hn,hn)}function u1(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Hr(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function Bt(t){return t=Hr(Math.abs(t)),t?t[1]:NaN}function g1(t,e){return function(r,n){for(var a=r.length,s=[],i=0,o=t[0],f=0;a>0&&o>0&&(f+o+1>n&&(o=Math.max(1,n-f)),s.push(r.substring(a-=o,a+o)),!((f+=o+1)>n));)o=t[i=(i+1)%t.length];return s.reverse().join(e)}}function l1(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var eD=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function vr(t){if(!(e=eD.exec(t)))throw new Error("invalid format: "+t);var e;return new Es({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}vr.prototype=Es.prototype;function Es(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Es.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function p1(t){e:for(var e=t.length,r=1,n=-1,a;r<e;++r)switch(t[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(a+1):t}var uf;function h1(t,e){var r=Hr(t,e);if(!r)return t+"";var n=r[0],a=r[1],s=a-(uf=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,i=n.length;return s===i?n:s>i?n+new Array(s-i+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Hr(t,Math.max(0,e+s-1))[0]}function gf(t,e){var r=Hr(t,e);if(!r)return t+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var lf={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:u1,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>gf(t*100,e),r:gf,s:h1,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function pf(t){return t}var v1=Array.prototype.map,d1=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function y1(t){var e=t.grouping===void 0||t.thousands===void 0?pf:g1(v1.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?pf:l1(v1.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"\u2212":t.minus+"",f=t.nan===void 0?"NaN":t.nan+"";function c(u){u=vr(u);var l=u.fill,p=u.align,d=u.sign,h=u.symbol,v=u.zero,y=u.width,C=u.comma,x=u.precision,T=u.trim,w=u.type;w==="n"?(C=!0,w="g"):lf[w]||(x===void 0&&(x=12),T=!0,w="g"),(v||l==="0"&&p==="=")&&(v=!0,l="0",p="=");var S=h==="$"?r:h==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",M=h==="$"?n:/[%p]/.test(w)?i:"",E=lf[w],R=/[defgprs%]/.test(w);x=x===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function D(L){var V=S,B=M,F,z,b;if(w==="c")B=E(L)+B,L="";else{L=+L;var W=L<0||1/L<0;if(L=isNaN(L)?f:E(Math.abs(L),x),T&&(L=p1(L)),W&&+L==0&&d!=="+"&&(W=!1),V=(W?d==="("?d:o:d==="-"||d==="("?"":d)+V,B=(w==="s"?d1[8+uf/3]:"")+B+(W&&d==="("?")":""),R){for(F=-1,z=L.length;++F<z;)if(b=L.charCodeAt(F),48>b||b>57){B=(b===46?a+L.slice(F+1):L.slice(F))+B,L=L.slice(0,F);break}}}C&&!v&&(L=e(L,1/0));var G=V.length+L.length+B.length,k=G<y?new Array(y-G+1).join(l):"";switch(C&&v&&(L=e(k+L,k.length?y-B.length:1/0),k=""),p){case"<":L=V+L+B+k;break;case"=":L=V+k+L+B;break;case"^":L=k.slice(0,G=k.length>>1)+V+L+B+k.slice(G);break;default:L=k+V+L+B;break}return s(L)}return D.toString=function(){return u+""},D}function g(u,l){var p=c((u=vr(u),u.type="f",u)),d=Math.max(-8,Math.min(8,Math.floor(Bt(l)/3)))*3,h=Math.pow(10,-d),v=d1[8+d/3];return function(y){return p(h*y)+v}}return{format:c,formatPrefix:g}}var Ms,Rs,Os;hf({thousands:",",grouping:[3],currency:["$",""]});function hf(t){return Ms=y1(t),Rs=Ms.format,Os=Ms.formatPrefix,Ms}function vf(t){return Math.max(0,-Bt(Math.abs(t)))}function df(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Bt(e)/3)))*3-Bt(Math.abs(t)))}function yf(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Bt(e)-Bt(t))+1}function xf(t,e,r,n){var a=Zo(t,e,r),s;switch(n=vr(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(s=df(a,i))&&(n.precision=s),Os(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=yf(a,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=vf(a))&&(n.precision=s-(n.type==="%")*2);break}}return Rs(n)}function tD(t){var e=t.domain;return t.ticks=function(r){var n=e();return ys(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var a=e();return xf(a[0],a[a.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),a=0,s=n.length-1,i=n[a],o=n[s],f,c,g=10;for(o<i&&(c=i,i=o,o=c,c=a,a=s,s=c);g-- >0;){if(c=Pn(i,o,r),c===f)return n[a]=i,n[s]=o,e(n);if(c>0)i=Math.floor(i/c)*c,o=Math.ceil(o/c)*c;else if(c<0)i=Math.ceil(i*c)/c,o=Math.floor(o*c)/c;else break;f=c}return t},t}function Ar(){var t=cf();return t.copy=function(){return c1(t,Ar())},Hh.apply(t,arguments),tD(t)}var rD=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],T1=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],Ds=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],S1=[0,1,0,1,0,1,0,1,2,2,2,2],ye=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],Y=new Float64Array(3),Ls=new Float64Array(3),ae=new Float64Array(3),jr=new Float64Array(3),$r=new Float64Array(3),Vs=new Float64Array(3),Tf=new Float64Array(16);function Sf(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function C1(t){let e=[],r=[];for(let n=0;n<3;n++){let a=Ar().domain([t[n*2],t[n*2+1]]);e[n]=a.ticks(5);let s=a.tickFormat(5);r[n]=e[n].map(s)}return{ticks:e,tickStrings:r}}function nD(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=r=>{e.renderable!==r&&(e.renderable=r,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(r.getProperty()),e.tmActor.setParentProp(r),t.modified())},t.createPolyDataForOneLabel=(r,n,a,s,i,o,f)=>{let c=e.renderable.get_tmAtlas().get(r);if(!c)return;let g=e.renderable.getTextPolyData().getPoints().getData(),u=e.lastSize;Y[0]=g[n*3],Y[1]=g[n*3+1],Y[2]=g[n*3+2],N.transformMat4(ae,Y,a),ae[0]+=.1,N.transformMat4(Ls,ae,s),N.subtract($r,Ls,Y),ae[0]-=.1,ae[1]+=.1,N.transformMat4(Ls,ae,s),N.subtract(Vs,Ls,Y);for(let d=0;d<3;d++)$r[d]/=.5*.1*u[0],Vs[d]/=.5*.1*u[1];let l=f.ptIdx,p=f.cellIdx;Y[0]=g[n*3],Y[1]=g[n*3+1],Y[2]=g[n*3+2],i[0]<-.5?N.scale(ae,$r,i[0]*o-c.width):i[0]>.5?N.scale(ae,$r,i[0]*o):N.scale(ae,$r,i[0]*o-c.width/2),N.add(Y,Y,ae),N.scale(ae,Vs,i[1]*o-c.height/2),N.add(Y,Y,ae),f.points[l*3]=Y[0],f.points[l*3+1]=Y[1],f.points[l*3+2]=Y[2],f.tcoords[l*2]=c.tcoords[0],f.tcoords[l*2+1]=c.tcoords[1],l++,N.scale(ae,$r,c.width),N.add(Y,Y,ae),f.points[l*3]=Y[0],f.points[l*3+1]=Y[1],f.points[l*3+2]=Y[2],f.tcoords[l*2]=c.tcoords[2],f.tcoords[l*2+1]=c.tcoords[3],l++,N.scale(ae,Vs,c.height),N.add(Y,Y,ae),f.points[l*3]=Y[0],f.points[l*3+1]=Y[1],f.points[l*3+2]=Y[2],f.tcoords[l*2]=c.tcoords[4],f.tcoords[l*2+1]=c.tcoords[5],l++,N.scale(ae,$r,c.width),N.subtract(Y,Y,ae),f.points[l*3]=Y[0],f.points[l*3+1]=Y[1],f.points[l*3+2]=Y[2],f.tcoords[l*2]=c.tcoords[6],f.tcoords[l*2+1]=c.tcoords[7],l++,f.polys[p*4]=3,f.polys[p*4+1]=l-4,f.polys[p*4+2]=l-3,f.polys[p*4+3]=l-2,p++,f.polys[p*4]=3,f.polys[p*4+1]=l-4,f.polys[p*4+2]=l-2,f.polys[p*4+3]=l-1,f.ptIdx+=4,f.cellIdx+=2},t.updateTexturePolyData=()=>{let r=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);O.transpose(r,r);let n=e.renderable.getTextValues().length,a=n*4,s=n*2,i=new Float64Array(a*3),o=new Uint16Array(s*4),f=new Float32Array(a*2);O.invert(Tf,r);let c={ptIdx:0,cellIdx:0,polys:o,points:i,tcoords:f},g=0,u=0,l=0,p=e.renderable.getTextPolyData().getPoints().getData(),d=e.renderable.getTextValues();for(;g<p.length/3;){Y[0]=p[g*3],Y[1]=p[g*3+1],Y[2]=p[g*3+2],N.transformMat4(ae,Y,r),Y[0]=p[g*3+3],Y[1]=p[g*3+4],Y[2]=p[g*3+5],N.transformMat4(jr,Y,r),N.subtract(ae,ae,jr);let v=[ae[0],ae[1]];Pi(v),t.createPolyDataForOneLabel(d[u],g,r,Tf,v,e.renderable.getAxisTitlePixelOffset(),c),g+=2,u++;for(let y=0;y<e.renderable.getTickCounts()[l];y++)t.createPolyDataForOneLabel(d[u],g,r,Tf,v,e.renderable.getTickLabelPixelOffset(),c),g++,u++;l++}let h=P.newInstance({numberOfComponents:2,values:f,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(h),e.tmPolyData.getPoints().setData(i,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(o,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(r,n,a)=>{(e.lastSize[0]!==r[0]||e.lastSize[1]!==r[1])&&(e.lastSize[0]=r[0],e.lastSize[1]=r[1],e.lastAspectRatio=r[0]/r[1],e.forceUpdate=!0),e.camera=n,t.updateTexturePolyData()}}var aD=m.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),m.obj(t,e),e.tmPolyData=Ge.newInstance(),e.tmMapper=qe.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=ct.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),m.setGet(t,e,["renderable"]),m.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},m.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},m.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],nD(t,e)},"vtkCubeAxesActorHelper");function sD(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=n=>{e.camera!==n&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=n,n&&(e.cameraModifiedSub=n.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{let n=e.camera.getViewMatrix();O.transpose(n,n);let a=!1,s=Z.getDiagonalLength(e.dataBounds),i=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let f=!1,c=Math.floor(o/2),g=(c+1)%3,u=(c+2)%3;e.dataBounds[g*2]!==e.dataBounds[g*2+1]&&e.dataBounds[u*2]!==e.dataBounds[u*2+1]&&(Y[c]=e.dataBounds[o]-.1*s*rD[o][c],Y[g]=.5*(e.dataBounds[g*2]+e.dataBounds[g*2+1]),Y[u]=.5*(e.dataBounds[u*2]+e.dataBounds[u*2+1]),N.transformMat4(ae,Y,n),Y[c]=e.dataBounds[o],N.transformMat4(jr,Y,n),N.subtract(ae,jr,ae),N.normalize(ae,ae),f=ae[2]>i,e.camera.getParallelProjection()||(N.normalize(jr,jr),f=N.dot(jr,ae)>i)),f!==e.lastFacesToDraw[o]&&(e.lastFacesToDraw[o]=f,a=!0)}return a},t.updatePolyData=(n,a,s)=>{let i=0,o=0;i+=8;let f=0;for(let p=0;p<12;p++)a[p]>0&&f++;if(o+=f,e.gridLines)for(let p=0;p<6;p++)n[p]&&(i+=s[ye[p][0]].length*2+s[ye[p][1]].length*2,o+=s[ye[p][0]].length+s[ye[p][1]].length);let c=new Float64Array(i*3),g=new Uint32Array(o*3),u=0,l=0;for(let p=0;p<2;p++)for(let d=0;d<2;d++)for(let h=0;h<2;h++)c[u*3]=e.dataBounds[h],c[u*3+1]=e.dataBounds[2+d],c[u*3+2]=e.dataBounds[4+p],u++;for(let p=0;p<12;p++)a[p]>0&&(g[l*3]=2,g[l*3+1]=Ds[p][0],g[l*3+2]=Ds[p][1],l++);if(e.gridLines){for(let p=0;p<6;p++)if(n[p]){let d=Math.floor(p/2),h=s[ye[p][0]];for(let v=0;v<h.length;v++)c[u*3+d]=e.dataBounds[p],c[u*3+ye[p][0]]=h[v],c[u*3+ye[p][1]]=e.dataBounds[ye[p][1]*2],u++,c[u*3+d]=e.dataBounds[p],c[u*3+ye[p][0]]=h[v],c[u*3+ye[p][1]]=e.dataBounds[ye[p][1]*2+1],u++,g[l*3]=2,g[l*3+1]=u-2,g[l*3+2]=u-1,l++;h=s[ye[p][1]];for(let v=0;v<h.length;v++)c[u*3+d]=e.dataBounds[p],c[u*3+ye[p][1]]=h[v],c[u*3+ye[p][0]]=e.dataBounds[ye[p][0]*2],u++,c[u*3+d]=e.dataBounds[p],c[u*3+ye[p][1]]=h[v],c[u*3+ye[p][0]]=e.dataBounds[ye[p][0]*2+1],u++,g[l*3]=2,g[l*3+1]=u-2,g[l*3+2]=u-1,l++}}e.polyData.getPoints().setData(c,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(g,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(n,a,s,i)=>{let o=0;for(let p=0;p<12;p++)a[p]===1&&(o+=2,o+=s[S1[p]].length);let f=e.polyData.getPoints().getData(),c=new Float64Array(o*3),g=0,u=0,l=0;for(let p=0;p<6;p++)if(n[p])for(let d=0;d<4;d++){let h=T1[p][d];if(a[h]===1){let v=S1[h],y=Ds[h][0]*3,C=Ds[h][1]*3;c[g*3]=.5*(f[y]+f[C]),c[g*3+1]=.5*(f[y+1]+f[C+1]),c[g*3+2]=.5*(f[y+2]+f[C+2]),g++;let x=Math.floor(p/2);c[g*3+x]=e.dataBounds[p],c[g*3+ye[p][0]]=.5*(e.dataBounds[ye[p][0]*2]+e.dataBounds[ye[p][0]*2+1]),c[g*3+ye[p][1]]=.5*(e.dataBounds[ye[p][1]*2]+e.dataBounds[ye[p][1]*2+1]),g++,e.textValues[u]=e.axisLabels[v],u++;let T=(v+1)%3,w=(v+2)%3,S=s[v],M=i[v];e.tickCounts[l]=S.length;for(let E=0;E<S.length;E++)c[g*3+v]=S[E],c[g*3+T]=f[y+T],c[g*3+w]=f[y+w],g++,e.textValues[u]=M[E],u++;l++}}e.textPolyData.getPoints().setData(c,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;let n=t.computeFacesToDraw(),a=e.lastFacesToDraw,s=!1;for(let i=0;i<6;i++)e.dataBounds[i]!==e.lastTickBounds[i]&&(s=!0,e.lastTickBounds[i]=e.dataBounds[i]);if(n||s||e.forceUpdate){let i=new Array(12).fill(0);for(let f=0;f<6;f++)if(a[f])for(let c=0;c<4;c++)i[T1[f][c]]++;let o=e.generateTicks(e.dataBounds);t.updatePolyData(a,i,o.ticks),t.updateTextData(a,i,o.ticks,o.tickStrings),(s||e.forceUpdate)&&t.updateTextureAtlas(o.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=n=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let a=0,s=1;for(let i=0;i<3;i++){if(!e._tmAtlas.has(e.axisLabels[i])){Sf(e.tmContext,e.axisTextStyle);let o=e.tmContext.measureText(e.axisLabels[i]),f={height:o.actualBoundingBoxAscent+2,startingHeight:s,width:o.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[i],f),s+=f.height,a<f.width&&(a=f.width)}Sf(e.tmContext,e.tickTextStyle);for(let o=0;o<n[i].length;o++)if(!e._tmAtlas.has(n[i][o])){let f=e.tmContext.measureText(n[i][o]),c={height:f.actualBoundingBoxAscent+2,startingHeight:s,width:f.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(n[i][o],c),s+=c.height,a<c.width&&(a=c.width)}}a=$e(a),s=$e(s),e._tmAtlas.forEach(i=>{i.tcoords=[0,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight)/s,0,(s-i.startingHeight)/s]}),e.tmCanvas.width=a,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,s),e._tmAtlas.forEach((i,o)=>{Sf(e.tmContext,i.textStyle),e.tmContext.fillText(o,1,i.startingHeight+i.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),Z.setBounds(e.bounds,e.gridActor.getBounds()),Z.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);let r=m.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=n=>r(n)[0]}function iD(t,e,r){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...Z.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:C1,...r,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...r?.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...r?.tickTextStyle}}}function m1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ct.extend(t,e,iD(t,e,r)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=jt.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=qe.newInstance(),e.polyData=Ge.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=ct.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=Ge.newInstance(),m.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),m.setGetArray(t,e,["dataBounds"],6),m.setGetArray(t,e,["axisLabels"],3),m.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),sD(t,e)}var oD=m.newInstance(m1,"vtkCubeAxesActor"),Bs={newInstance:oD,extend:m1,newCubeAxesActorHelper:aD,defaultGenerateTicks:C1};function fD(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}var cD={};function uD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cD,r),I.extend(t,e,r),e.CubeAxesActorHelper=Bs.newCubeAxesActorHelper(),fD(t,e)}var gD=j(uD,"vtkOpenGLCubeAxesActor");de("vtkCubeAxesActor",gD);var w1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`;var E1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function lD(t,e){t.replaceShaderCoincidentOffset=(r,n,a)=>{let s=t.getCoincidentParameters(n,a);if(s&&(s.factor!==0||s.offset!==0)){let i=r.Fragment;i=U.substitute(i,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(s.factor!==0?(i=U.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=U.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=U.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(s.factor!==0?(i=U.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=U.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=U.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=i}}}function pD(t,e){t.applyShaderReplacements=(r,n,a)=>{let s=null;if(n&&(s=n.ShaderReplacements),s)for(let i=0;i<s.length;i++){let o=s[i];if(a&&o.replaceFirst||!a&&!o.replaceFirst){let f=o.shaderType,c=r[f],g=U.substitute(c,o.originalValue,o.replacementValue,o.replaceAll);r[f]=g.result}}},t.buildShaders=(r,n,a)=>{t.getReplacedShaderTemplate(r,n,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);let s=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,s,!0),t.replaceShaderValues(r,n,a),t.applyShaderReplacements(r,s)},t.getReplacedShaderTemplate=(r,n,a)=>{let s=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,a);let i=r.Vertex;if(s){let c=s.VertexShaderCode;c!==void 0&&c!==""&&(i=c)}r.Vertex=i;let o=r.Fragment;if(s){let c=s.FragmentShaderCode;c!==void 0&&c!==""&&(o=c)}r.Fragment=o;let f=r.Geometry;if(s){let c=s.GeometryShaderCode;c!==void 0&&(f=c)}r.Geometry=f}}var vn={implementReplaceShaderCoincidentOffset:lD,implementBuildShadersWithReplacements:pD};var{FieldAssociations:Cf}=Ie,{primTypes:Ve}=Dt,{Representation:dn,Shading:M1}=ft,{ScalarMode:Fs}=qe,{Filter:R1,Wrap:O1}=Qe,{vtkErrorMacro:Kr}=Ee,hD={type:"StartEvent"},vD={type:"EndEvent"},{CoordinateSystem:dD}=Mt;function yD(t){let e=t.getSelector();return e?e.getCurrentPass():_e.MIN_KNOWN_PASS-1}function xD(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(n,a)=>{n&&(e.currentRenderPass=a,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.render=()=>{let n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let i=Ve.Start;i<Ve.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}let a=e.openGLActor.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.getShaderTemplate=(n,a,s)=>{n.Vertex=w1,n.Fragment=E1,n.Geometry=""},t.replaceShaderColor=(n,a,s)=>{let i=n.Vertex,o=n.Geometry,f=n.Fragment,c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),g=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];c&&(g=g.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];c&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),c&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(g=g.concat(["varying vec4 vertexColorVSOutput;"]),i=U.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=U.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=U.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=U.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?f=U.substitute(f,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?f=U.substitute(f,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(s.getBackfaceProperty()&&!e.drawingEdges&&(g=g.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),c?(g=g.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(g=g.concat(["uniform samplerBuffer texture1;"])),f=U.substitute(f,"//VTK::Color::Impl",u).result),f=U.substitute(f,"//VTK::Color::Dec",g).result,n.Vertex=i,n.Geometry=o,n.Fragment=f},t.replaceShaderLight=(n,a,s)=>{let i=n.Fragment,o="",f=e.lastBoundBO.getReferenceByName("lastLightComplexity"),c=e.lastBoundBO.getReferenceByName("lastLightCount"),g=[];switch(f){case 0:i=U.substitute(i,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:i=U.substitute(i,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<c;++u)g=g.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);i=U.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<c;++u)g=g.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${o}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${u});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=U.substitute(i,"//VTK::Light::Impl",g,!1).result;break;case 3:for(let u=0;u<c;++u)g=g.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);i=U.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<c;++u)g=g.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${u});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=U.substitute(i,"//VTK::Light::Impl",g,!1).result;break;default:Kr("bad light complexity")}n.Fragment=i},t.replaceShaderNormal=(n,a,s)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=n.Vertex,f=n.Geometry,c=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=U.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=U.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,f=U.substitute(f,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,f=U.substitute(f,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,c=U.substitute(c,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,c=U.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(c=U.substitute(c,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,c=U.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(s.getProperty().getRepresentation())===e.context.LINES?(c=U.substitute(c,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,c=U.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(c=U.substitute(c,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,c=U.substitute(c,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,c=U.substitute(c,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=o,n.Geometry=f,n.Fragment=c}},t.replaceShaderPositionVC=(n,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(n,a,s);let i=n.Vertex,o=n.Geometry,f=n.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(i=U.substitute(i,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,i=U.substitute(i,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,i=U.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=U.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=U.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,f=U.substitute(f,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,f=U.substitute(f,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(i=U.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=U.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=i,n.Geometry=o,n.Fragment=f},t.replaceShaderTCoord=(n,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=n.Vertex,o=n.Geometry,f=n.Fragment;if(e.drawingEdges)return;i=U.substitute(i,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;let c=e.openGLActor.getActiveTextures(),g=2,u=2;if(c&&c.length>0&&(g=c[0].getComponents(),c[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(g=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(i=U.substitute(i,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=U.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=U.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,f=U.substitute(f,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c&&c.length>=1)switch(g){case 1:f=U.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:f=U.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:f=U.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(i=U.substitute(i,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=U.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=U.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,f=U.substitute(f,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,g){case 1:f=U.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:f=U.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:f=U.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=i,n.Geometry=o,n.Fragment=f}},t.replaceShaderClip=(n,a,s)=>{let i=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let f=e.renderable.getNumberOfClippingPlanes();i=U.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${f}];`,`varying float clipDistancesVSOutput[${f}];`]).result,i=U.substitute(i,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${f}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=U.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${f}];`]).result,o=U.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${f}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=i,n.Fragment=o},t.getCoincidentParameters=(n,a)=>{let s={factor:0,offset:0},i=a.getProperty();if(e.renderable.getResolveCoincidentTopology()==yt.PolygonOffset||i.getEdgeVisibility()&&i.getRepresentation()===dn.SURFACE){let f=e.lastBoundBO.getPrimitiveType();f===Ve.Points||i.getRepresentation()===dn.POINTS?s=e.renderable.getCoincidentTopologyPointOffsetParameter():f===Ve.Lines||i.getRepresentation()===dn.WIREFRAME?s=e.renderable.getCoincidentTopologyLineOffsetParameters():(f===Ve.Tris||f===Ve.TriStrips)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(f===Ve.TrisEdges||f===Ve.TriStripsEdges)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),s.factor/=2,s.offset/=2)}let o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===Cf.FIELD_ASSOCIATION_POINTS&&(s.offset-=2),s},t.replaceShaderPicking=(n,a,s)=>{let i=n.Fragment,o=n.Vertex;if(i=U.substitute(i,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===_e.ID_LOW24||e.lastSelectionState===_e.ID_HIGH24)&&(o=U.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=U.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,i=U.substitute(i,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,i=U.substitute(i,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case _e.ID_LOW24:i=U.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case _e.ID_HIGH24:i=U.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:i=U.substitute(i,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,i=U.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=i,n.Vertex=o}},t.replaceShaderValues=(n,a,s)=>{if(t.replaceShaderColor(n,a,s),t.replaceShaderNormal(n,a,s),t.replaceShaderLight(n,a,s),t.replaceShaderTCoord(n,a,s),t.replaceShaderPicking(n,a,s),t.replaceShaderClip(n,a,s),t.replaceShaderCoincidentOffset(n,a,s),t.replaceShaderPositionVC(n,a,s),e.haveSeenDepthRequest){let i=n.Fragment;i=U.substitute(i,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,i=U.substitute(i,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=i}},t.getNeedToRebuildShaders=(n,a,s)=>{let i=0,o=0,f=n.getPrimitiveType(),c=e.currentInput,g=!1,u=c.getPointData().getNormals(),l=c.getCellData().getNormals(),p=s.getProperty().getInterpolation()===M1.FLAT,d=s.getProperty().getRepresentation(),h=n.getOpenGLMode(d,f);if((h===e.context.TRIANGLES||l&&!u||!p&&u||!p&&h===e.context.LINES)&&(g=!0),s.getProperty().getLighting()&&g){i=0;let x=a.getLightsByReference();for(let T=0;T<x.length;++T){let w=x[T];w.getSwitch()>0&&(o++,i===0&&(i=1)),i===1&&(o>1||w.getIntensity()!==1||!w.lightTypeIsHeadLight())&&(i=2),i<3&&w.getPositional()&&(i=3)}}let v=!1,y=e.lastBoundBO.getReferenceByName("lastLightComplexity"),C=e.lastBoundBO.getReferenceByName("lastLightCount");return(y!==i||C!==o)&&(e.lastBoundBO.set({lastLightComplexity:i},!0),e.lastBoundBO.set({lastLightCount:o},!0),v=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||v?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(n,a,s)=>{let i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,n,a,s)})},t.setMapperShaderParameters=(n,a,s)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){let f=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Kr("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&f>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Kr("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((c,g)=>{n.getProgram().isAttributeUsed(`${c}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${c}MC`,n.getCABO().getCustomData()[g].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[g].components,!1)||Kr(`Error setting ${c}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Kr("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Kr("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){let f=e.renderable.getNumberOfClippingPlanes(),c=[],u=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,l=u?O.copy(e.tmpMat4,s.getMatrix()):s.getMatrix();u&&(O.transpose(l,l),O.multiply(l,l,u),O.transpose(l,l));for(let p=0;p<f;p++){let d=[];e.renderable.getClippingPlaneInDataCoords(l,p,d);for(let h=0;h<4;h++)c.push(d[h])}n.getProgram().setUniformi("numClipPlanes",f),n.getProgram().setUniform4fv("clipPlanes",c)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());let i=e.openGLActor.getActiveTextures();if(i)for(let f=0;f<i.length;++f){let g=i[f].getTextureUnit(),u=`texture${g+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,g)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){let f=t.getCoincidentParameters(a,s);n.getProgram().setUniformf("coffset",f.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",f.factor)}n.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());let o=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(n,a,s)=>{let i=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(i<2)return;let o=n.getProgram(),f=0,c=a.getLightsByReference();for(let l=0;l<c.length;++l){let p=c[l];if(p.getSwitch()>0){let h=p.getColorByReference(),v=p.getIntensity();e.lightColor[0]=h[0]*v,e.lightColor[1]=h[1]*v,e.lightColor[2]=h[2]*v;let y=p.getDirection(),C=a.getActiveCamera().getViewMatrix(),x=[...y];p.lightTypeIsSceneLight()&&(x[0]=C[0]*y[0]+C[1]*y[1]+C[2]*y[2],x[1]=C[4]*y[0]+C[5]*y[1]+C[6]*y[2],x[2]=C[8]*y[0]+C[9]*y[1]+C[10]*y[2],ke(x)),e.lightDirection[0]=x[0],e.lightDirection[1]=x[1],e.lightDirection[2]=x[2],ke(e.lightDirection),o.setUniform3fArray(`lightColor${f}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${f}`,e.lightDirection),f++}}if(i<3)return;let u=a.getActiveCamera().getViewMatrix();O.transpose(u,u),f=0;for(let l=0;l<c.length;++l){let p=c[l];if(p.getSwitch()>0){let h=p.getTransformedPosition(),v=new Float64Array(3);N.transformMat4(v,h,u),o.setUniform3fArray(`lightAttenuation${f}`,p.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${f}`,p.getPositional()),o.setUniformf(`lightExponent${f}`,p.getExponent()),o.setUniformf(`lightConeAngle${f}`,p.getConeAngle()),o.setUniform3fArray(`lightPositionVC${f}`,[v[0],v[1],v[2]]),f++}}};function r(n,a,s){return a.identity(s),n.reduce((i,o,f)=>f===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(n,a,s)=>{let i=n.getProgram(),o=e.openGLCamera.getKeyMatrices(a),f=a.getActiveCamera(),c=e.openGLCamera.getKeyMatrixTime().getMTime(),g=i.getLastCameraMTime(),l=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,p=s.getIsIdentity(),d=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(s.getCoordinateSystem()===dD.DISPLAY){let h=e._openGLRenderer.getTiledSizeAndOrigin();O.identity(e.tmpMat4),e.tmpMat4[0]=2/h.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/h.vsize,e.tmpMat4[13]=-1,O.multiply(e.tmpMat4,e.tmpMat4,l),i.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else i.setUniformMatrix("MCPCMatrix",r([o.wcpc,d.mcwc,l],O,e.tmpMat4));i.isUniformUsed("MCVCMatrix")&&i.setUniformMatrix("MCVCMatrix",r([o.wcvc,d.mcwc,l],O,e.tmpMat4)),i.isUniformUsed("normalMatrix")&&i.setUniformMatrix3x3("normalMatrix",r([o.normalMatrix,d.normalMatrix],Se,e.tmpMat3)),g!==c&&(i.isUniformUsed("cameraParallel")&&i.setUniformi("cameraParallel",f.getParallelProjection()),i.setLastCameraMTime(c)),p||i.setLastCameraMTime(0)},t.setPropertyShaderParameters=(n,a,s)=>{let i=n.getProgram(),o=s.getProperty(),f=o.getOpacity(),c=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),g=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),u=e.drawingEdges?1:o.getAmbient(),l=e.drawingEdges?0:o.getDiffuse(),p=e.drawingEdges?0:o.getSpecular(),d=o.getSpecularPower();i.setUniformf("opacityUniform",f),i.setUniform3fArray("ambientColorUniform",c),i.setUniform3fArray("diffuseColorUniform",g),i.setUniformf("ambient",u),i.setUniformf("diffuse",l);let h=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(h<1)return;let v=o.getSpecularColorByReference();if(i.setUniform3fArray("specularColorUniform",v),i.setUniformf("specularPowerUniform",d),i.setUniformf("specular",p),i.isUniformUsed("ambientIntensityBF")){if(o=s.getBackfaceProperty(),f=o.getOpacity(),c=o.getAmbientColor(),u=o.getAmbient(),g=o.getDiffuseColor(),l=o.getDiffuse(),v=o.getSpecularColor(),p=o.getSpecular(),i.setUniformf("ambientIntensityBF",u),i.setUniformf("diffuseIntensityBF",l),i.setUniformf("opacityUniformBF",f),i.setUniform3fArray("ambientColorUniformBF",c),i.setUniform3fArray("diffuseColorUniformBF",g),h<1)return;i.setUniformf("specularIntensityBF",p),i.setUniform3fArray("specularColorUniformBF",v),i.setUniformf("specularPowerUniformBF",d)}},t.updateMaximumPointCellIds=(n,a)=>{let s=e._openGLRenderer.getSelector();if(!s)return;if(e.selectionWebGLIdsToVTKIds?.points?.length){let o=e.selectionWebGLIdsToVTKIds.points.length;s.setMaximumPointId(o-1)}if(e.selectionWebGLIdsToVTKIds?.cells?.length){let o=e.selectionWebGLIdsToVTKIds.cells.length;s.setMaximumCellId(o-1)}s.getFieldAssociation()===Cf.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(n,a)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;let s=yD(e._openGLRenderer);e.lastSelectionState!==s&&(e.selectionStateChanged.modified(),e.lastSelectionState=s),e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().renderProp(a),t.updateBufferObjects(n,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(n,a)=>{let s=a.getProperty().getRepresentation(),i=a.getProperty().getEdgeVisibility()&&s===dn.SURFACE,o=e._openGLRenderer.getSelector(),f=o&&o.getFieldAssociation()===Cf.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===_e.ID_LOW24||e.lastSelectionState===_e.ID_HIGH24);for(let c=Ve.Start;c<Ve.End;c++)e.primitives[c].setPointPicking(f),e.primitives[c].getCABO().getElementCount()&&(e.drawingEdges=i&&(c===Ve.TrisEdges||c===Ve.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[c],e.primitiveIDOffset+=e.primitives[c].drawArrays(n,a,s,t),e.vertexIDOffset+=e.primitives[c].getCABO().getElementCount()))},t.renderPieceFinish=(n,a)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(n,a)=>{if(t.invokeEvent(hD),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(vD),!e.currentInput){Kr("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;let s=e.context,i=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!i&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.FRONT)):(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.BACK)),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)},t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(n,a)=>{let s=e.VBOBuildTime.getMTime();return s<t.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()},t.buildBufferObjects=(n,a)=>{let s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,1);let i=e.renderable.getColorMapColors();e.haveCellScalars=!1;let o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Fs.USE_CELL_DATA||o===Fs.USE_CELL_FIELD_DATA||o===Fs.USE_FIELD_DATA||!s.getPointData().getScalars())&&o!==Fs.USE_POINT_FIELD_DATA&&i&&(e.haveCellScalars=!0);let f=a.getProperty().getInterpolation()!==M1.FLAT?s.getPointData().getNormals():null;f===null&&s.getCellData().getNormals()&&(e.haveCellNormals=!0,f=s.getCellData().getNormals());let c=a.getProperty().getRepresentation(),g=s.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(g=null);let u=!1;if(e.renderable.getColorCoordinates()){g=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Qe.newInstance({resizable:!0}));let p=e.internalColorTexture;p.setMinificationFilter(R1.NEAREST),p.setMagnificationFilter(R1.NEAREST),p.setWrapS(O1.CLAMP_TO_EDGE),p.setWrapT(O1.CLAMP_TO_EDGE),p.setOpenGLRenderWindow(e._openGLRenderWindow);let d=e.renderable.getColorTextureMap(),h=d.getExtent(),v=d.getPointData().getScalars();p.create2DFromRaw({width:h[1]-h[0]+1,height:h[3]-h[2]+1,numComps:v.getNumberOfComponents(),dataType:v.getDataType(),data:v.getData()}),p.activate(),p.sendParameters(),p.deactivate()}let l=`${s.getMTime()}A${c}B${s.getMTime()}C${f?f.getMTime():1}D${i?i.getMTime():1}E${a.getProperty().getEdgeVisibility()}F${g?g.getMTime():1}`;if(e.VBOBuildString!==l){let d={points:s.getPoints(),normals:f,tcoords:g,colors:i,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(y=>s.getPointData().getArrayByName(y))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});let h=[{inRep:"verts",cells:s.getVerts()},{inRep:"lines",cells:s.getLines()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()}],v=a.getProperty().getEdgeVisibility()&&c===dn.SURFACE;for(let y=Ve.Start;y<Ve.End;y++)y!==Ve.TrisEdges&&y!==Ve.TriStripsEdges?(d.cellOffset+=e.primitives[y].getCABO().createVBO(h[y].cells,h[y].inRep,c,d,e.selectionWebGLIdsToVTKIds),d.vertexOffset+=e.primitives[y].getCABO().getElementCount()):v?e.primitives[y].getCABO().createVBO(h[y].cells,h[y].inRep,dn.WIREFRAME,{...d,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[y].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=l}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(a=>{n+=a.getAllocatedGPUMemoryInBytes()}),n}}var TD={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:_e.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function SD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TD,r),I.extend(t,e,r),vn.implementReplaceShaderCoincidentOffset(t,e,r),vn.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Ve,e.tmpMat3=Se.identity(new Float64Array(9)),e.tmpMat4=O.identity(new Float64Array(16));for(let n=Ve.Start;n<Ve.End;n++)e.primitives[n]=Dt.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);re(t,e,["context"]),e.VBOBuildTime={},ne(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},ne(e.selectionStateChanged,{mtime:0}),xD(t,e)}var CD=j(SD,"vtkOpenGLPolyDataMapper");de("vtkMapper",CD);var D1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`;var L1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;var mf={BACKGROUND:0,FOREGROUND:1},wf={DisplayLocation:mf};var{primTypes:Ct}=Dt,{Filter:V1,Wrap:B1}=Qe,{vtkErrorMacro:Zn}=Ee,mD={type:"StartEvent"},wD={type:"EndEvent"};function ED(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=n=>{n&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=n=>{n&&t.render()},t.getShaderTemplate=(n,a,s)=>{n.Vertex=L1,n.Fragment=D1,n.Geometry=""},t.render=()=>{let n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let i=Ct.Start;i<Ct.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}let a=e.openGLActor2D.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.renderPiece=(n,a)=>{if(t.invokeEvent(mD),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(wD),!e.currentInput){Zn("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;let s=e.context;e._openGLRenderWindow.enableCullFace(),s.cullFace(s.BACK),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)},t.renderPieceStart=(n,a)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(a)}e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),t.updateBufferObjects(n,a),e.lastBoundBO=null},t.getNeedToRebuildShaders=(n,a,s)=>n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=(n,a)=>{let s=e.VBOBuildTime.getMTime();return!!(s<t.getMTime()||s<e._openGLRenderWindow.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&s<n.getMTime())},t.buildBufferObjects=(n,a)=>{let s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,a.getProperty().getOpacity());let i=e.renderable.getColorMapColors(),o=a.getProperty().getRepresentation(),f=s.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(f=null);let c=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),c=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Qe.newInstance({resizable:!0}));let d=e.internalColorTexture;d.setMinificationFilter(V1.NEAREST),d.setMagnificationFilter(V1.NEAREST),d.setWrapS(B1.CLAMP_TO_EDGE),d.setWrapT(B1.CLAMP_TO_EDGE),d.setOpenGLRenderWindow(e._openGLRenderWindow);let h=e.renderable.getColorTextureMap(),v=h.getExtent(),y=h.getPointData().getScalars();d.create2DFromRaw({width:v[1]-v[0]+1,height:v[3]-v[2]+1,numComps:y.getNumberOfComponents(),dataType:y.getDataType(),data:y.getData()}),d.activate(),d.sendParameters(),d.deactivate()}let g=e.renderable.getTransformCoordinate(),l=n.getRenderWindow().getViews()[0].getViewportSize(n),p=`${s.getMTime()}A${o}B${s.getMTime()}C${i?i.getMTime():1}D${f?f.getMTime():1}E${g?n.getMTime():1}F${l}`;if(e.VBOBuildString!==p){let d=s.getPoints();if(g){let v=nt.newInstance(),y=d.getNumberOfPoints();v.setNumberOfPoints(y);let C=[];for(let x=0;x<y;++x){d.getPoint(x,C),g.setValue(C);let T=g.getComputedDoubleViewportValue(n);v.setPoint(x,T[0],T[1],0)}d=v}let h={points:d,tcoords:f,colors:i,cellOffset:0,useTCoordsPerCell:c,haveCellScalars:e.renderable.getAreScalarsMappedFromCells(),customAttributes:e.renderable.getCustomShaderAttributes().map(v=>s.getPointData().getArrayByName(v))};h.cellOffset+=e.primitives[Ct.Points].getCABO().createVBO(s.getVerts(),"verts",o,h),h.cellOffset+=e.primitives[Ct.Lines].getCABO().createVBO(s.getLines(),"lines",o,h),h.cellOffset+=e.primitives[Ct.Tris].getCABO().createVBO(s.getPolys(),"polys",o,h),h.cellOffset+=e.primitives[Ct.TriStrips].getCABO().createVBO(s.getStrips(),"strips",o,h),e.VBOBuildTime.modified(),e.VBOBuildString=p}},t.renderPieceDraw=(n,a)=>{let s=a.getProperty().getRepresentation();e.context.depthMask(!0);for(let o=Ct.Start;o<Ct.End;o++)e.primitives[o].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[o],e.primitiveIDOffset+=e.primitives[o].drawArrays(n,a,s,t))},t.renderPieceFinish=(n,a)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.replaceShaderValues=(n,a,s)=>{t.replaceShaderColor(n,a,s),t.replaceShaderTCoord(n,a,s),t.replaceShaderPicking(n,a,s),t.replaceShaderPositionVC(n,a,s)},t.replaceShaderColor=(n,a,s)=>{let i=n.Vertex,o=n.Geometry,f=n.Fragment,c=["uniform vec3 diffuseColorUniform;","uniform float opacityUniform;"],g=["vec3 diffuseColor = diffuseColorUniform;","float opacity = opacityUniform;"];e.lastBoundBO.getCABO().getColorComponents()!==0?(c=c.concat(["varying vec4 vertexColorVSOutput;"]),i=U.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=U.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=U.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=U.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,f=U.substitute(f,"//VTK::Color::Impl",g.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result):e.renderable.getAreScalarsMappedFromCells()&&(g=g.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  opacity = opacity*texColor.a;"])),g=g.concat(["gl_FragData[0] = vec4(diffuseColor, opacity);"]),f=U.substitute(f,"//VTK::Color::Dec",c).result,f=U.substitute(f,"//VTK::Color::Impl",g).result,n.Vertex=i,n.Geometry=o,n.Fragment=f},t.replaceShaderTCoord=(n,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=n.Vertex,o=n.Geometry,f=n.Fragment,c=e.lastBoundBO.getCABO().getTCoordComponents();c===1?(i=U.substitute(i,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,i=U.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=U.substitute(o,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,o=U.substitute(o,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,f=U.substitute(f,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,f=U.substitute(f,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):c===2&&(i=U.substitute(i,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,i=U.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=U.substitute(o,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,o=U.substitute(o,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,f=U.substitute(f,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,f=U.substitute(f,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.renderable.getAreScalarsMappedFromCells()&&(o=U.substitute(o,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),n.Vertex=i,n.Geometry=o,n.Fragment=f}},t.replaceShaderPicking=(n,a,s)=>{let i=n.Fragment;i=U.substitute(i,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,i=U.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,n.Fragment=i},t.replaceShaderPositionVC=(n,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(n,a,s)},t.invokeShaderCallbacks=(n,a,s)=>{let i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,n,a,s)})},t.setMapperShaderParameters=(n,a,s)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Zn("Error setting vertexWC in shader VAO.")),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((f,c)=>{n.getProgram().isAttributeUsed(`${f}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${f}MC`,n.getCABO().getCustomData()[c].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[c].components,!1)||Zn(`Error setting ${f}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Zn("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Zn("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&e.internalColorTexture.getTextureUnit()>-1&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());let i=e.openGLActor2D.getActiveTextures();if(i)for(let f=0;f<i.length;++f){let g=i[f].getTextureUnit(),u=`texture${g+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,g)}n.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());let o=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(n,a,s)=>{let i=e.renderable.getColorMapColors();if(!i||i.getNumberOfComponents()===0){let o=n.getProgram(),f=s.getProperty(),c=f.getOpacity();o.setUniformf("opacityUniform",c);let g=f.getColor();o.setUniform3fArray("diffuseColorUniform",g)}},t.setLightingShaderParameters=(n,a,s)=>{};function r(n,a,s){return a.identity(s),n.reduce((i,o,f)=>f===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(n,a,s)=>{let i=n.getProgram(),f=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,g=a.getRenderWindow().getViews()[0].getViewportSize(a),u=a.getViewport(),l=s.getActualPositionCoordinate().getComputedDoubleViewportValue(a),p=[0,0,1,1],d=[0,0,1,1];if(d[0]=u[0]>=p[0]?u[0]:p[0],d[1]=u[1]>=p[1]?u[1]:p[1],d[2]=u[2]<=p[2]?u[2]:p[2],d[3]=u[3]<=p[3]?u[3]:p[3],d[0]>=d[2]||d[1]>=d[3])return;g[0]=Zr(g[0]*(d[2]-d[0])/(u[2]-u[0])),g[1]=Zr(g[1]*(d[3]-d[1])/(u[3]-u[1]));let h=e._openGLRenderer.getParent().getSize(),v=Zr(l[0]-(d[0]-u[0])*h[0]),y=Zr(l[1]-(d[1]-u[1])*h[1]),C=-v,x=-v+g[0],T=-y,w=-y+g[1];C===x&&(x=C+1),T===w&&(w=T+1);let S=O.identity(new Float64Array(16));S[0]=2/(x-C),S[5]=2/(w-T),S[3]=-1*(x+C)/(x-C),S[7]=-1*(w+T)/(w-T),S[10]=0,S[11]=s.getProperty().getDisplayLocation()===mf.FOREGROUND?-1:1,S[15]=1,O.transpose(S,S),i.setUniformMatrix("WCVCMatrix",r([S,f],O,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(a=>{n+=a.getAllocatedGPUMemoryInBytes()}),n}}var MD={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function RD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MD,r),I.extend(t,e,r),vn.implementReplaceShaderCoincidentOffset(t,e,r),vn.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Ct,e.tmpMat4=O.identity(new Float64Array(16));for(let n=Ct.Start;n<Ct.End;n++)e.primitives[n]=Dt.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);re(t,e,["context"]),e.VBOBuildTime={},ne(e.VBOBuildTime,{mtime:0}),ED(t,e)}var OD=j(RD,"vtkOpenGLPolyDataMapper2D");de("vtkMapper2D",OD);var{VectorMode:DD}=Lr;function Ef(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function F1(t,e){return r=>{let n=r.getLastSize(),a=(n[0]/700)**.8,s=(n[1]/700)**.8,i=Math.min(a,s),o=r.getAxisTextStyle(),f=r.getTickTextStyle();Object.assign(o,e.axisTextStyle),Object.assign(f,e.tickTextStyle),o.fontSize=Math.max(24*i,12),r.getLastAspectRatio()>1?f.fontSize=Math.max(20*i,10):f.fontSize=Math.max(16*i,10);let c=r.updateTextureAtlas();r.setTopTitle(!1);let g=r.getBoxSizeByReference();if(r.getLastAspectRatio()>1)r.setTickLabelPixelOffset(.3*f.fontSize),c.titleWidth<=c.tickWidth+r.getTickLabelPixelOffset()+.8*f.fontSize?(r.setTopTitle(!0),r.setAxisTitlePixelOffset(.2*f.fontSize),g[0]=2*(c.tickWidth+r.getTickLabelPixelOffset()+.8*f.fontSize)/n[0],r.setBoxPosition([.98-g[0],-.92])):(r.setAxisTitlePixelOffset(.2*f.fontSize),g[0]=2*(c.titleHeight+r.getAxisTitlePixelOffset()+c.tickWidth+r.getTickLabelPixelOffset()+.8*f.fontSize)/n[0],r.setBoxPosition([.99-g[0],-.92])),g[1]=Math.max(1.2,Math.min(1.84/s,1.84));else{r.setAxisTitlePixelOffset(1.2*f.fontSize),r.setTickLabelPixelOffset(.1*f.fontSize);let u=2*(.8*f.fontSize+c.titleHeight+r.getAxisTitlePixelOffset())/n[1],l=2*c.tickWidth/n[0];g[0]=Math.min(1.9,Math.max(1.4,1.4*l*(r.getTicks().length+3))),g[1]=u,r.setBoxPosition([-.5*g[0],-.97])}r.recomputeBarSegments(c)}}function k1(t,e){return r=>{let n=r.getLastTickBounds(),a=Ar().domain([n[0],n[1]]),s=a.ticks(5),i=a.tickFormat(5);r.setTicks(s),r.setTickStrings(s.map(i))}}function LD(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=a=>{e.renderable!==a&&(e.renderable=a,e.barActor.setProperty(a.getProperty()),e.barActor.setParentProp(a),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(a.getProperty()),e.tmActor.setParentProp(a),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=a.generateTicks,e.axisTextStyle={...a.getAxisTextStyle()},e.tickTextStyle={...a.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(a,s,i)=>{(e.lastSize[0]!==a[0]||e.lastSize[1]!==a[1])&&(e.lastSize[0]=a[0],e.lastSize[1]=a[1],e.lastAspectRatio=a[0]/a[1],e.forceUpdate=!0);let o=e.renderable.getScalarsToColors();if(!(!o||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(o),e.camera=s,e.renderWindow=i,e.forceUpdate||Math.max(o.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){let f=o.getMappingRange();if(e.lastTickBounds=[...f],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();let c=t.updateTextureAtlas();t.recomputeBarSegments(c)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";let a={},s=new Map,i=0,o=1;Ef(e.tmContext,e.axisTextStyle);let f=e.tmContext.measureText(e.renderable.getAxisLabel()),c={height:f.actualBoundingBoxAscent+2,startingHeight:o,width:f.width+2,textStyle:e.axisTextStyle};s.set(e.renderable.getAxisLabel(),c),o+=c.height,i=c.width,a.titleWidth=c.width,a.titleHeight=c.height,a.tickWidth=0,a.tickHeight=0,Ef(e.tmContext,e.tickTextStyle);let g=[...t.getTickStrings(),"NaN","Below","Above"];for(let u=0;u<g.length;u++)s.has(g[u])||(f=e.tmContext.measureText(g[u]),c={height:f.actualBoundingBoxAscent+2,startingHeight:o,width:f.width+2,textStyle:e.tickTextStyle},s.set(g[u],c),o+=c.height,i<c.width&&(i=c.width),a.tickWidth<c.width&&(a.tickWidth=c.width),a.tickHeight<c.height&&(a.tickHeight=c.height));return i=$e(i),o=$e(o),s.forEach(u=>{u.tcoords=[0,(o-u.startingHeight-u.height)/o,u.width/i,(o-u.startingHeight-u.height)/o,u.width/i,(o-u.startingHeight)/o,0,(o-u.startingHeight)/o]}),e.tmCanvas.width=i,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,o),s.forEach((u,l)=>{Ef(e.tmContext,u.textStyle),e.tmContext.fillText(l,1,u.startingHeight+u.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=s,a},t.computeBarSize=a=>{e.vertical=e.boxSize[1]>e.boxSize[0];let s=2*a.tickHeight/e.lastSize[1],i=[1,1];if(e.vertical){let o=2*(a.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){let f=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-o,e.barSize[1]=e.boxSize[1]-f}else{let f=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-f-o,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+o,e.barPosition[1]=e.boxPosition[1],i[1]=s}else{let o=(2*a.tickWidth-8)/e.lastSize[0],f=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-f,e.barPosition[1]=e.boxPosition[1],i[0]=o}return i},t.recomputeBarSegments=a=>{let s=t.computeBarSize(a);e.barSegments=[];let i=[0,0],o=e.vertical?1:0,f=e.vertical?.01:.02;function c(l,p){e.barSegments.push({corners:[[...i],[i[0]+s[0],i[1]],[i[0]+s[0],i[1]+s[1]],[i[0],i[1]+s[1]]],scalars:p,title:l}),i[o]+=s[o]+f}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&c("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&e.renderable.getScalarsToColors().getUseBelowRangeColor?.()&&c("Below",[-.1,-.1,-.1,-.1]);let g=e.renderable.getScalarsToColors().getUseAboveRangeColor?.();i[o]+=f;let u=s[o];s[o]=g?1-2*f-s[o]-i[o]:1-f-i[o],c("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&g&&(s[o]=u,i[o]+=f,c("Above",[1.1,1.1,1.1,1.1]))};let r=new Float64Array(3);t.createPolyDataForOneLabel=(a,s,i,o,f,c)=>{let g=e._tmAtlas.get(a);if(!g)return;let u=c.ptIdx,l=c.cellIdx;r[0]=(.5*s[0]+.5)*e.lastSize[0],r[1]=(.5*s[1]+.5)*e.lastSize[1],r[2]=s[2],r[0]+=f[0],r[1]+=f[1];let p=[],d=o==="vertical"?[1,0]:[0,1];o==="vertical"?(p[0]=g.width,p[1]=-g.height,i[0]==="middle"?r[1]-=g.width/2:i[0]==="right"&&(r[1]-=g.width),i[1]==="middle"?r[0]+=g.height/2:i[1]==="top"&&(r[0]+=g.height)):(p[0]=g.width,p[1]=g.height,i[0]==="middle"?r[0]-=g.width/2:i[0]==="right"&&(r[0]-=g.width),i[1]==="middle"?r[1]-=g.height/2:i[1]==="top"&&(r[1]-=g.height)),c.points[u*3]=r[0],c.points[u*3+1]=r[1],c.points[u*3+2]=r[2],c.tcoords[u*2]=g.tcoords[0],c.tcoords[u*2+1]=g.tcoords[1],u++,r[d[0]]+=p[0],c.points[u*3]=r[0],c.points[u*3+1]=r[1],c.points[u*3+2]=r[2],c.tcoords[u*2]=g.tcoords[2],c.tcoords[u*2+1]=g.tcoords[3],u++,r[d[1]]+=p[1],c.points[u*3]=r[0],c.points[u*3+1]=r[1],c.points[u*3+2]=r[2],c.tcoords[u*2]=g.tcoords[4],c.tcoords[u*2+1]=g.tcoords[5],u++,r[d[0]]-=p[0],c.points[u*3]=r[0],c.points[u*3+1]=r[1],c.points[u*3+2]=r[2],c.tcoords[u*2]=g.tcoords[6],c.tcoords[u*2+1]=g.tcoords[7],u++,c.polys[l*4]=3,c.polys[l*4+1]=u-4,c.polys[l*4+2]=u-3,c.polys[l*4+3]=u-2,l++,c.polys[l*4]=3,c.polys[l*4+1]=u-4,c.polys[l*4+2]=u-2,c.polys[l*4+3]=u-1,c.ptIdx+=4,c.cellIdx+=2};let n=new Float64Array(3);t.updatePolyDataForLabels=()=>{let a=t.getTickStrings().length+e.barSegments.length,s=a*4,i=a*2,o=new Float64Array(s*3),f=new Uint16Array(i*4),c=new Float32Array(s*2),g={ptIdx:0,cellIdx:0,polys:f,points:o,tcoords:c},u=e.vertical?0:1,l=e.vertical?1:0;n[2]=-.99;let p=e.vertical?["right","middle"]:["middle","bottom"],d=[0,1],h=[0,0];e.vertical?(h[0]=-e.tickLabelPixelOffset,e.topTitle?(n[0]=e.boxPosition[0]+.5*e.boxSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)):(n[0]=e.barPosition[0]+e.barSize[0],n[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],g)),d=[-1,0]):(h[1]=e.tickLabelPixelOffset,n[0]=e.barPosition[0]+.5*e.barSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)),n[u]=e.barPosition[u]+(.5*d[u]+.5)*e.barSize[u],n[l]=e.barPosition[l]+e.barSize[l]*.5;let v=null;for(let M=0;M<e.barSegments.length;M++){let E=e.barSegments[M];E.title==="ticks"?v=E:(n[l]=e.barPosition[l]+.5*e.barSize[l]*(E.corners[2][l]+E.corners[0][l]),t.createPolyDataForOneLabel(E.title,n,p,"horizontal",h,g))}let y=e.barPosition[l]+e.barSize[l]*v.corners[0][l],C=e.barSize[l]*(v.corners[2][l]-v.corners[0][l]),x=t.getTicks(),T=t.getTickStrings(),w=t.getTickPositions();for(let M=0;M<x.length;M++){let E=w?w[M]:(x[M]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);n[l]=y+C*E,t.createPolyDataForOneLabel(T[M],n,p,"horizontal",h,g)}let S=P.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(S),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(f,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{let a=e.renderable.getScalarsToColors(),s=0;e.renderable.getDrawNanAnnotation()&&a.getNanColor()&&(s+=1),e.renderable.getDrawBelowRangeSwatch()&&a.getUseBelowRangeColor?.()&&(s+=1),e.renderable.getDrawAboveRangeSwatch()&&a.getUseAboveRangeColor?.()&&(s+=1);let i=4*(1+s),o=i,f=1;a.getVectorMode()===DD.COMPONENT&&(f=a.getVectorComponent()+1);let c=new Float64Array(i*3),g=new Uint16Array(o*5),u=new Float32Array(i*f),l=0,p=0;for(let h=0;h<e.barSegments.length;h++){let v=e.barSegments[h];for(let y=0;y<4;y++){n[0]=e.barPosition[0]+v.corners[y][0]*e.barSize[0],n[1]=e.barPosition[1]+v.corners[y][1]*e.barSize[1],c[l*3]=(.5*n[0]+.5)*e.lastSize[0],c[l*3+1]=(.5*n[1]+.5)*e.lastSize[1],c[l*3+2]=n[2];for(let C=0;C<f;C++)u[l*f+C]=e.lastTickBounds[0]+v.scalars[y]*(e.lastTickBounds[1]-e.lastTickBounds[0]);l++}g[p*5]=4,g[p*5+1]=l-4,g[p*5+2]=l-3,g[p*5+3]=l-2,g[p*5+4]=l-1,p++}let d=P.newInstance({numberOfComponents:f,values:u,name:"Scalars"});e.polyData.getPointData().setScalars(d),e.polyData.getPoints().setData(c,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(g,1),e.polyData.getPolys().modified(),e.polyData.modified()}}var VD=m.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),m.obj(t,e),m.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings","tickPositions"]),m.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),m.getArray(t,e,["boxPosition","boxSize"]),m.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},m.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=qe.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=Ge.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=ct.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=Ge.newInstance(),e.tmMapper=qe.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=jt.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=ct.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],LD(t,e)},"vtkScalarBarActorHelper");function BD(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(F1(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(k1())}}function FD(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function U1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FD(r)),e.autoLayout||(e.autoLayout=F1(t,e)),e.generateTicks||(e.generateTicks=k1()),ct.extend(t,e,r),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),m.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),m.get(t,e,["axisTextStyle","tickTextStyle"]),m.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),m.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),BD(t,e)}var kD=m.newInstance(U1,"vtkScalarBarActor"),ks={newInstance:kD,extend:U1,newScalarBarActorHelper:VD};function UD(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}var ND={};function GD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ND,r),I.extend(t,e,r),e.scalarBarActorHelper=ks.newScalarBarActorHelper(),UD(t,e)}var _D=j(GD,"vtkOpenGLScalarBarActor");de("vtkScalarBarActor",_D);var{vtkErrorMacro:N1}=Ee;function bD(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=r=>{if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);let n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=(r,n)=>{if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);let a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);let s=e._openGLRenderer.getRenderable(),i=e.openGLCamera.getKeyMatrices(s),o=new Float64Array(16);if(O.invert(o,i.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){let f=s.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",f[0],f[1],f[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){let n=new Float32Array(12);for(let o=0;o<4;o++)n[o*3]=o%2*2-1,n[o*3+1]=o>1?1:-1,n[o*3+2]=1;let a=P.newInstance({numberOfComponents:3,values:n});a.setName("points");let s=new Uint16Array(8);s[0]=3,s[1]=0,s[2]=1,s[3]=3,s[4]=3,s[5]=0,s[6]=3,s[7]=2;let i=P.newInstance({numberOfComponents:1,values:s});e.tris.getCABO().createVBO(i,"polys",We.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||N1("Error setting vertexMC in shader VAO."));let r=e.renderable.getTextures();r.length||N1("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==r[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(r[0]))}}var zD={context:null};function WD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zD,r),I.extend(t,e,r),e.openGLTexture=Qe.newInstance(),e.tris=Dt.newInstance(),e.keyMatrixTime={},ne(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Se.identity(new Float64Array(9)),mcwc:O.identity(new Float64Array(16))},re(t,e,["context"]),pe(t,e,["activeTextures"]),bD(t,e)}var HD=j(WD);de("vtkSkybox",HD);var{vtkDebugMacro:AD}=Ee;function $D(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");let a=e._openGLRenderer.getAspectRatio(),s=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin(),o=null;if(e.renderable.getUseZValues()){let f=n.getZBufferTexture(),c=Math.floor(f.getWidth()),g=Math.floor(f.getHeight()),u=e._openGLRenderWindow.getContext();f.bind();let l=n.getFramebuffer();l?l.saveCurrentBindingsAndBuffers():AD("No framebuffer to save/restore");let p=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,p),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,f.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(c*g*4),u.viewport(0,0,c,g),u.readPixels(0,0,c,g,u.RGBA,u.UNSIGNED_BYTE,o)),l&&l.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)},t.queryPass=(r,n)=>{r&&e.renderable.getUseZValues()&&n.requestDepth()}}var jD={};function KD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jD,r),I.extend(t,e,r),$D(t,e)}var PD=j(KD,"vtkOpenGLPixelSpaceCallbackMapper");de("vtkPixelSpaceCallbackMapper",PD);function XD(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(r,n,a,s)=>{if(O.identity(r),e.renderable.getParallelProjection()){let i=e.renderable.getParallelScale(),o=i*n,f=i,c=(s[0]-1)*o,g=(s[0]+1)*o,u=(s[1]-1)*f,l=(s[1]+1)*f,p=1/(g-c),d=1/(l-u);r[0]=2*p,r[5]=2*d,r[10]=1/(a[1]-a[0]),r[12]=(g+c)*p,r[13]=(l+u)*d,r[14]=a[1]/(a[1]-a[0])}else{let i=Math.tan(Math.PI*e.renderable.getViewAngle()/360),o,f;e.renderable.getUseHorizontalViewAngle()===!0?(o=a[0]*i,f=a[0]*i/n):(o=a[0]*i*n,f=a[0]*i);let c=(s[0]-1)*o,g=(s[0]+1)*o,u=(s[1]-1)*f,l=(s[1]+1)*f;r[0]=2*a[0]/(g-c),r[5]=2*a[0]/(l-u),r[12]=(c+g)/(g-c),r[13]=(u+l)/(l-u),r[10]=0,r[14]=a[0],r[11]=-1,r[15]=0}},t.convertToOpenGLDepth=r=>{if(e.renderable.getParallelProjection())return 1-r;let n=e.renderable.getClippingRangeByReference(),a=-n[0]/r;return a=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(a*(n[1]-n[0])),.5*a+.5},t.getKeyMatrices=r=>{let n=r.getRenderable(),a=r.getParent();if(Math.max(a.getMTime(),t.getMTime(),n.getMTime(),e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatrixTime.getMTime()){let s=e.renderable.getViewMatrix();O.copy(e.keyMatrices.normalMatrix,s),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,O.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),O.transpose(e.keyMatrices.wcvc,s);let i=r.getStabilizedCenterByReference();O.translate(e.keyMatrices.scvc,e.keyMatrices.wcvc,i);let o=r.getAspectRatio(),f=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,f,e.renderable.getWindowCenterByReference()),O.multiply(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),O.invert(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}var YD={keyMatrixTime:null,keyMatrices:null};function ID(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YD,r),I.extend(t,e,r),e.keyMatrixTime={},m.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},m.setGet(t,e,["keyMatrixTime"]),XD(t,e)}var qD=m.newInstance(ID);De("vtkCamera",qD);var{vtkDebugMacro:ZD}=Ee,G1=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,QD=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Us=new Float64Array(16),_1=new Float64Array(16);function JD(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function eL(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{let r=e.camera.getClippingRange(),n=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),s=[],i=[];N.scale(i,a,.5*(r[0]+r[1])),N.add(s,n,i),N.sub(i,s,e.stabilizedCenter),N.len(i)/(r[1]-r[0])>e.recenterThreshold&&(e.stabilizedCenter=s,e.stabilizedTime.modified())},t.updateLights=()=>{let r=0,n=e.renderable.getLightsByReference();for(let a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(ZD("No lights are on, creating one."),e.renderable.createLight()),r},t.updateUBO=()=>{let r=e.UBO.getSendTime();if(e._parent.getMTime()>r||t.getMTime()>r||e.camera.getMTime()>r||e.renderable.getMTime()>r){let n=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",n.wcvc),e.UBO.setArray("SCPCMatrix",n.scpc),e.UBO.setArray("PCSCMatrix",n.pcsc),e.UBO.setArray("SCVCMatrix",n.scvc),e.UBO.setArray("VCPCMatrix",n.vcpc),e.UBO.setArray("WCVCNormals",n.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",e.renderable.getEnvironmentTexture()?.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());let a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());let s=e._parent.getDevice();e.UBO.sendIfNeeded(s)}},t.updateSSBO=()=>{let r=e.renderable.getLights(),n=e.webgpuCamera.getKeyMatrices(t),a=`${e.renderable.getMTime()}`;for(let s=0;s<r.length;s++)a+=r[s].getMTime();if(a!==e.lightTimeString){let s=new Float32Array(r.length*4),i=new Float32Array(r.length*4),o=new Float32Array(r.length*4),f=new Float32Array(r.length*4);for(let g=0;g<r.length;g++){let u=g*4,l=r[g].getPosition();N.transformMat4(l,l,n.wcvc),s[u]=l[0],s[u+1]=l[1],s[u+2]=l[2],s[u+3]=0,i[u]=-r[g].getDirection()[0],i[u+1]=-r[g].getDirection()[1],i[u+2]=-r[g].getDirection()[2],i[u+3]=0,o[u]=r[g].getColor()[0],o[u+1]=r[g].getColor()[1],o[u+2]=r[g].getColor()[2],o[u+3]=r[g].getIntensity()*5,f[u]=JD(r[g]),f[u+1]=Math.cos(oe(r[g].getConeAngle())),f[u+2]=Math.cos(oe(r[g].getConeAngle()+r[g].getConeFalloff())),f[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(r.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",s),e.SSBO.setAllInstancesFromArray("LightDir",i),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",f);let c=e._parent.getDevice();e.SSBO.send(c)}e.lightTimeString=a},t.scissorAndViewport=r=>{let n=t.getYInvertedTiledSizeAndOrigin();r.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),r.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},t.bindUBO=r=>{r.activateBindGroup(e.bindGroup)},t.opaquePass=r=>{r?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{if(e.renderable.getTransparent()||e.suppressClear)return;let r=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=xt.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(G1);let s=Tt.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&e.backgroundTex?.getImageLoaded()){e.clearFSQ.setFragmentShaderTemplate(QD);let s=Tt.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s);let i=r.getTextureManager().getTextureForVTKTexture(e.backgroundTex,"EnvironmentTexture");if(i.getReady()){let o=i.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([o]),e.backgroundTexLoaded=!0;let f=e.backgroundTex.getInterpolate()?"linear":"nearest";o.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:f,magFilter:f,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=xt.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(G1);let s=Tt.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s)}let n=e.webgpuCamera.getKeyMatrices(t),a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),O.transpose(_1,n.normalMatrix),O.mul(Us,n.scvc,n.pcsc),O.mul(Us,_1,Us),e.clearFSQ.getUBO().setArray("FSQMatrix",Us),e.clearFSQ.getUBO().sendIfNeeded(r),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{let r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.convertToOpenGLDepth=r=>e.webgpuCamera.convertToOpenGLDepth(r),t.getYInvertedTiledSizeAndOrigin=()=>{let r=t.getTiledSizeAndOrigin(),n=e._parent.getSizeByReference();return r.lowerLeftV=n[1]-r.vsize-r.lowerLeftV,r},t.getTiledSizeAndOrigin=()=>{let r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],s=r[1]-n[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),f=Math.round(i[1]),c=r[2]-n[0],g=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(c,g),l=Math.round(u[0])-o,p=Math.round(u[1])-f;return l<0&&(l=0),p<0&&(p=0),{usize:l,vsize:p,lowerLeftU:o,lowerLeftV:f}},t.getPropFromID=r=>{for(let n=0;n<e.children.length;n++)if((e.children[n].getPropID?e.children[n].getPropID():-1)===r)return e.children[n];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}var tL={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function rL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tL,r),I.extend(t,e,r),e.UBO=Tt.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=Kn.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=ls.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=O.identity(new Float64Array(16)),e.stabilizedTime={},ne(e.stabilizedTime,{mtime:0}),pe(t,e,["bindGroup","stabilizedTime"]),Ut(t,e,["stabilizedCenter"]),re(t,e,["renderEncoder","selector","suppressClear","UBO"]),eL(t,e)}var nL=j(rL,"vtkWebGPURenderer");De("vtkRenderer",nL);var{CoordinateSystem:b1}=Mt;function aL(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();let n=e.renderable.getMatrix();e.bufferShift[0]=n[3],e.bufferShift[1]=n[7],e.bufferShift[2]=n[11];let a=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===b1.WORLD&&(e.bufferShift[0]-=a[0],e.bufferShift[1]-=a[1],e.bufferShift[2]-=a[2]),O.transpose(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?O.identity(e.keyMatrices.normalMatrix):(O.copy(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,O.invert(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),O.transpose(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),O.translate(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===b1.WORLD?O.translate(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]):O.copy(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}var sL={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function iL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sL,r),I.extend(t,e,r),e.keyMatricesTime={},m.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},m.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],aL(t,e)}var oL=m.newInstance(iL);De("vtkActor",oL);var{CoordinateSystem:z1}=Mt;function fL(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;let n=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===z1.WORLD&&(e.bufferShift[0]-=n[0],e.bufferShift[1]-=n[1],e.bufferShift[2]-=n[2]),O.identity(e.keyMatrices.bcwc),O.identity(e.keyMatrices.normalMatrix),O.translate(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===z1.WORLD?O.translate(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-n[0],-n[1],-n[2]]):O.copy(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}var cL={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function uL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cL,r),I.extend(t,e,r),e.keyMatricesTime={},m.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},m.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],fL(t,e)}var gL=m.newInstance(uL);De("vtkActor2D",gL);function lL(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}var pL={};function hL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pL,r),I.extend(t,e,r),e.CubeAxesActorHelper=Bs.newCubeAxesActorHelper(),lL(t,e)}var vL=j(hL,"vtkWebGPUCubeAxesActor");De("vtkCubeAxesActor",vL);var{DisplayLocation:Mf}=wf;function dL(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(Mf.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(Mf.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(We.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(We.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(We.POINTS),t.getRepresentationAsString=()=>m.enumToString(We,e.representation)}var yL={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:We.SURFACE,displayLocation:Mf.FOREGROUND};function W1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yL,r),m.obj(t,e),m.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),m.setGetArray(t,e,["color"],3),dL(t,e)}var xL=m.newInstance(W1,"vtkProperty2D"),H1={newInstance:xL,extend:W1,...wf};var{BufferUsage:Ne,PrimitiveTypes:Xe}=et,{Representation:Ns}=ft,{ScalarMode:Gs}=qe,{CoordinateSystem:TL}=Mt,{DisplayLocation:A1}=H1,SL=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,CL=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

struct Material {
  ior: f32,
  roughness: f32,
  metallic: f32,
  base: vec3<f32>,
};

struct DirectionalLight {
  direction: vec3<f32>,
  color: vec3<f32>,
};

struct PointLight {
  position: vec3<f32>,
  color: vec3<f32>,
};

struct SpotLight {
  position: vec3<f32>,
  direction: vec3<f32>,
  cones: vec2<f32>,
  color: vec3<f32>,
};

const pi: f32 = 3.14159265359;

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;

  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, mat: Material, light: DirectionalLight) -> PBRData {
  var L: vec3<f32> = normalize(light.direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = light.color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf * incoming * angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: PointLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V);
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  var F: f32 = schlickFresnelIOR(V, N, mat.ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = light.color * (1.0 / (dist * dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: SpotLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);

  var theta: f32 = mdot(normalize(light.direction), L);
  var epsilon: f32 = light.cones.x - light.cones.y;
  var intensity: f32 = (theta - light.cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist * dist;

  var incoming: vec3<f32> = light.color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;
  var ior: f32 = mapperUBO.BaseIOR;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  // Use texture alpha for transparency
  computedColor.a = mapperUBO.Opacity * _diffuseMap.a;
  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function $1(t){return t.indexOf("edge")>=0}function mL(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=r=>{r&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==TL.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{let n=e.WebGPUActor.getRenderable().getProperty(),a=e.UBO.getSendTime();if(t.getMTime()<=a&&n.getMTime()<=a&&e.renderable.getMTime()<=a)return;let s=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",s.bcwc),e.UBO.setArray("BCSCMatrix",s.bcsc),e.UBO.setArray("MCWCNormals",s.normalMatrix),e.is2D){let o=n.getDisplayLocation?.()??A1.BACKGROUND;e.UBO.setValue("ZValue",o===A1.FOREGROUND?1:0);let f=n.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[...f,1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else e.UBO.setValue("AmbientIntensity",n.getAmbient()),e.UBO.setArray("AmbientColor",[...n.getAmbientColorByReference(),1]),e.UBO.setValue("DiffuseIntensity",n.getDiffuse()),e.UBO.setArray("DiffuseColor",[...n.getDiffuseColorByReference(),1]),e.UBO.setValue("Roughness",n.getRoughness()),e.UBO.setValue("BaseIOR",n.getBaseIOR()),e.UBO.setValue("Metallic",n.getMetallic()),e.UBO.setValue("NormalStrength",n.getNormalStrength()),e.UBO.setValue("Emission",n.getEmission()),e.UBO.setValue("SpecularIntensity",n.getSpecular()),n.getSpecularColorByReference()&&e.UBO.setArray("SpecularColor",[...n.getSpecularColorByReference(),1]);let i=n.getEdgeColorByReference?.();i&&e.UBO.setArray("EdgeColor",[...i,1]),e.UBO.setValue("LineWidth",n.getLineWidth()),e.UBO.setValue("Opacity",n.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID()),e.UBO.sendIfNeeded(e.WebGPURenderWindow.getDevice())},t.haveWideLines=()=>{let r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();return r.getProperty().getLineWidth()<=1||e.primitiveType===Xe.Verts?!1:e.primitiveType===Xe.Triangles||e.primitiveType===Xe.TriangleStrips?n===Ns.WIREFRAME:!0},t.replaceShaderPosition=(r,n,a)=>{let s=n.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();e.useRendererMatrix?(i=K.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(i=K.substitute(i,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(i=K.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(i=K.substitute(i,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(s.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),i=K.substitute(i,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),i=K.substitute(i,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(r,n,a)=>{let s=a.getBuffer("normalMC"),i=e.WebGPUActor.getRenderable();if(s){let o=n.getShaderDescription("vertex");o.hasOutput("normalVC")||o.addOutput("vec3<f32>","normalVC",s.getArrayInformation()[0].interpolation),o.hasOutput("tangentVC")||o.addOutput("vec3<f32>","tangentVC",s.getArrayInformation()[0].interpolation),o.hasOutput("bitangentVC")||o.addOutput("vec3<f32>","bitangentVC",s.getArrayInformation()[0].interpolation);let f=o.getCode();f=K.substitute(f,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,o.setCode(f);let c=n.getShaderDescription("fragment");f=c.getCode(),i.getProperty().getNormalTexture()?f=K.substitute(f,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:f=K.substitute(f,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,c.setCode(f)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(r,n,a)=>{if(r.includes("sel"))return;let s=n.getShaderDescription("vertex");s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");let i=e.WebGPURenderer.getRenderable(),o=n.getShaderDescription("fragment"),f=o.getCode();if(f.includes("var normal:")&&e.useRendererMatrix&&!$1(r)&&!e.is2D&&!r.includes("sel")){let c=["  let fragPos = vec3<f32>(input.vertexVC.xyz);","  let V = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  let baseColor = _diffuseMap.rgb * diffuseColor.rgb;","  let roughness = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  let metallic = mapperUBO.Metallic * _metallicMap.r;","  let alpha = roughness * roughness;","  let k = alpha * alpha / 2.0;","  var diffuse = vec3<f32>(0.);","  var specular = vec3<f32>(0.);","  let emission = _emissionMap.rgb * mapperUBO.Emission;","","  // Material struct","  let mat = Material(ior, roughness, metallic, baseColor);","","  {","    var i = 0;","    loop {","      if (!(i < rendererUBO.LightCount)) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let pointLight = PointLight(pos, color);","           let result = calcPointLight(normal, V, fragPos, mat, pointLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","          }","         // Directional light","         case 1 {","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let dirLight = DirectionalLight(dir, color);","           let result = calcDirectionalLight(normal, V, mat, dirLight); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         // Spot Light","         case 2 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let cones = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           let spotLight = SpotLight(pos, dir, cones, color);","           let result = calcSpotLight(normal, V, fragPos, mat, spotLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  let fresnel = min(1.0, schlickFresnelIOR(V, normal, ior, k)); // Fresnel","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  let fresnelMetallic = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  let kS = min(vec3<f32>(1.0), mix(vec3<f32>(fresnel), fresnelMetallic, metallic));","  let kD = (1.0 - kS) * (1.0 - metallic);","  let PBR = mapperUBO.DiffuseIntensity * kD * diffuse + kS * specular;","  computedColor = vec4<f32>(PBR + emission, mapperUBO.Opacity);"];i.getEnvironmentTexture()?.getImageLoaded()&&c.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  let diffuseIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  let diffuseCoords = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  let VreflN = normalize(reflect(-V, normal));","  let reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  let specularCoords = vecToRectCoord(reflectionIBLCoords);","  let diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  let level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  let specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  let specularIBLContribution = specularIBL.rgb * rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution * kS, 0);","  let diffuseIBLContribution = diffuseIBL.rgb * rendererUBO.BackgroundDiffuseStrength;","  computedColor += vec4<f32>(diffuseIBLContribution * baseColor * _ambientOcclusionMap.rgb * kD, 0);"),f=K.substitute(f,"//VTK::Light::Impl",c).result,o.setCode(f)}else f=K.substitute(f,"//VTK::Light::Impl",["  let diffuse = diffuseColor.rgb;","  let specular = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,o.setCode(f)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(r,n,a)=>{if($1(r)){let c=n.getShaderDescription("fragment"),g=c.getCode();g=K.substitute(g,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,c.setCode(g);return}let s=a.getBuffer("colorVI");if(!s)return;let i=n.getShaderDescription("vertex");i.addOutput("vec4<f32>","color",s.getArrayInformation()[0].interpolation);let o=i.getCode();o=K.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,i.setCode(o);let f=n.getShaderDescription("fragment");o=f.getCode(),o=K.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,f.setCode(o)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(r,n,a)=>{if(!a.hasAttribute("tcoord"))return;let s=n.getShaderDescription("vertex"),i=a.getBuffer("tcoord"),o=le.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format),f=s.getCode();s.addOutput(`vec${o}<f32>`,"tcoordVS"),f=K.substitute(f,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,s.setCode(f);let c=n.getShaderDescription("fragment");f=c.getCode();let g=e.WebGPUActor.getRenderable(),u=g.getProperty(),l=S=>S?S.getDimensionality()===o:!1,p=[],d=u.getDiffuseTexture?.();(d?.getImageLoaded()||g.getTextures()[0]||e.colorTexture)&&(l(d)||l(g.getTextures()[0])||l(e.colorTexture))&&p.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);");let h=u.getORMTexture?.(),v=u.getRMTexture?.(),y=u.getRoughnessTexture?.(),C=u.getMetallicTexture?.(),x=u.getAmbientOcclusionTexture?.(),T=u.getEmissionTexture?.(),w=u.getNormalTexture?.();h?.getImageLoaded()?l(h)&&p.push("_ambientOcclusionMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).rrra;","_roughnessMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).bbba;"):v?.getImageLoaded()?l(v)&&p.push("_roughnessMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).bbba;"):(y?.getImageLoaded()&&l(y)&&p.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS).ggga;"),C?.getImageLoaded()&&l(C)&&p.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS).bbba;"),x?.getImageLoaded()&&l(x)&&p.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS).rrra;")),T?.getImageLoaded()&&l(T)&&p.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),w?.getImageLoaded()&&l(w)&&p.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),f=K.substitute(f,"//VTK::TCoord::Impl",p).result,c.setCode(f)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(r,n,a)=>{if(r.includes("sel")){let s=n.getShaderDescription("fragment"),i=s.getCode();i=K.substitute(i,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,s.setCode(i)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(r,n)=>r===Ns.POINTS||n===Xe.Points?Ne.Verts:n===Xe.Lines?Ne.Lines:r===Ns.WIREFRAME?n===Xe.Triangles?Ne.LinesFromTriangles:Ne.LinesFromStrips:n===Xe.Triangles?Ne.Triangles:n===Xe.TriangleStrips?Ne.Strips:n===Xe.TriangleEdges?Ne.LinesFromTriangles:Ne.LinesFromStrips,t.getHashFromUsage=r=>`pt${r}`,t.getTopologyFromUsage=r=>{switch(r){case Ne.Triangles:return"triangle-list";case Ne.Verts:return"point-list";case Ne.Lines:default:return"line-list"}},t.buildVertexInput=()=>{let r=e.currentInput,n=e.cellArray,a=e.primitiveType,i=e.WebGPUActor.getRenderable().getProperty().getRepresentation(),o=e.WebGPURenderWindow.getDevice(),f=!1;a===Xe.TriangleEdges&&(f=!0,i=Ns.WIREFRAME);let c=e.vertexInput,g=r.getPoints(),u=null;if(n?(u=o.getBufferManager().getBuffer({hash:`R${i}P${a}${n.getMTime()}`,usage:Ne.Index,cells:n,numberOfPoints:g.getNumberOfPoints(),primitiveType:a,representation:i}),c.setIndexBuffer(u)):c.setIndexBuffer(null),g){let h=e.WebGPUActor.getBufferShift(e.WebGPURenderer);c.addBuffer(o.getBufferManager().getBuffer({hash:`${g.getMTime()}I${u?.getMTime?.()??0}${h.join()}float32x4`,usage:Ne.PointArray,format:"float32x4",dataArray:g,indexBuffer:u,shift:h,packExtra:!0}),["vertexBC"])}else c.removeBufferIfPresent("vertexBC");let l=t.getUsage(i,a);if(e._usesCellNormals=!1,!e.is2D&&(l===Ne.Triangles||l===Ne.Strips)){let h=r.getPointData().getNormals(),v={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};h?(v.hash=`${h.getMTime()}I${u.getMTime()}snorm8x4`,v.dataArray=h,v.usage=Ne.PointArray,c.addBuffer(o.getBufferManager().getBuffer(v),["normalMC"])):a===Xe.Triangles?(e._usesCellNormals=!0,v.hash=`PFN${g.getMTime()}I${u.getMTime()}snorm8x4`,v.dataArray=g,v.cells=n,v.usage=Ne.NormalsFromPoints,c.addBuffer(o.getBufferManager().getBuffer(v),["normalMC"])):c.removeBufferIfPresent("normalMC")}else c.removeBufferIfPresent("normalMC");let p=!1;if(e.renderable.getScalarVisibility()){let h=e.renderable.getColorMapColors();if(h&&!f){let v=e.renderable.getScalarMode(),y=(v===Gs.USE_CELL_DATA||v===Gs.USE_CELL_FIELD_DATA||v===Gs.USE_FIELD_DATA||!r.getPointData().getScalars())&&v!==Gs.USE_POINT_FIELD_DATA&&h;c.addBuffer(o.getBufferManager().getBuffer({usage:Ne.PointArray,format:"unorm8x4",hash:`${y}${h.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:h,indexBuffer:u,cellData:y,cellOffset:0}),["colorVI"]),p=!0}}p||c.removeBufferIfPresent("colorVI");let d=null;e.renderable.getInterpolateScalarsBeforeMapping?.()&&e.renderable.getColorCoordinates()?d=e.renderable.getColorCoordinates():d=r.getPointData().getTCoords(),d&&!f?c.addBuffer(o.getBufferManager().getBufferForPointArray(d,c.getIndexBuffer()),["tcoord"]):c.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{let r=[],n=[],a=e.renderable.getColorTextureMap?.();a&&!e.colorTexture&&(e.colorTexture=jt.newInstance({label:"polyDataColor"})),a&&(e.colorTexture.setInputData(a),n.push(["DiffuseTexture",e.colorTexture]));let s=e.WebGPUActor.getRenderable(),i=e.WebGPURenderer.getRenderable();[["DiffuseTexture",s.getProperty().getDiffuseTexture?.()],["DiffuseTexture",s.getTextures()[0]],["DiffuseTexture",e.colorTexture],["ORMTexture",s.getProperty().getORMTexture?.()],["RMTexture",s.getProperty().getRMTexture?.()],["RoughnessTexture",s.getProperty().getRoughnessTexture?.()],["MetallicTexture",s.getProperty().getMetallicTexture?.()],["NormalTexture",s.getProperty().getNormalTexture?.()],["AmbientOcclusionTexture",s.getProperty().getAmbientOcclusionTexture?.()],["EmissionTexture",s.getProperty().getEmissionTexture?.()],["EnvironmentTexture",i.getEnvironmentTexture?.()]].forEach(f=>{let[c,g]=f;g&&((g.getInputData()||g.getJsImageData()||g.getCanvas()||g.getImageBitmap())&&n.push([c,g]),g.getImage()&&g.getImageLoaded()&&n.push([c,g]))}),n.forEach(f=>{let[c,g]=f,u=e.device.getTextureManager().getTextureForVTKTexture(g,c);if(!u.getReady())return;let l=!1;for(let p=0;p<e.textures.length;++p)if(e.textures[p]===u){l=!0,r[p]=!0;break}if(!l){r[e.textures.length]=!0;let p=u.createView(c);e.textures.push(u),e.textureViews.push(p);let d=g.getInterpolate()?"linear":"nearest",h=null;g.getEdgeClamp()&&g.getRepeat()?h="mirror-repeat":g.getEdgeClamp()?h="clamp-to-edge":g.getRepeat()&&(h="repeat");let v={addressModeU:h,addressModeV:h,addressModeW:h,minFilter:d,magFilter:d};c==="EnvironmentTexture"&&(v={addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:d,magFilter:d,mipmapFilter:"linear"}),p.addSampler(e.device,v)}});for(let f=e.textures.length-1;f>=0;f--)r[f]||(e.textures.splice(f,1),e.textureViews.splice(f,1))},t.computePipelineHash=()=>{let r=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===Xe.TriangleEdges||e.primitiveType===Xe.TriangleStripEdges)r+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(r+="n"),e.vertexInput.hasAttribute("colorVI")&&(r+="c"),e.vertexInput.hasAttribute("tcoord")){let a=e.vertexInput.getBuffer("tcoord"),s=le.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);r+=`t${s}`}e.textures.length&&(r+=`tx${e.textures.length}`)}e._usesCellNormals&&(r+="cn"),e.SSBO&&(r+="ssbo");let n=t.getHashFromUsage(e.usage);r+=n,r+=e.renderEncoder.getPipelineHash(),e.pipelineHash=r},t.updateBuffers=()=>{e.primitiveType!==Xe.TriangleEdges&&e.primitiveType!==Xe.TriangleStripEdges&&t.updateTextures();let r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();e.usage=t.getUsage(n,e.primitiveType),t.buildVertexInput();let a=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(a.getSizeInBytes()/a.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){let s=r.getProperty();t.setNumberOfInstances(Math.ceil(s.getLineWidth()*2))}else t.setNumberOfInstances(1)}}var wL={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function j1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wL,r),fn.extend(t,e,r),e.fragmentShaderTemplate=CL,e.vertexShaderTemplate=SL,e._tmpMat3=Se.identity(new Float64Array(9)),e._tmpMat4=O.identity(new Float64Array(16)),e.UBO=Tt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),re(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],mL(t,e)}var EL=j(j1,"vtkWebGPUCellArrayMapper"),_s={newInstance:EL,extend:j1};var{PrimitiveTypes:gt}=et;function ML(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>_s.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();let n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{if(!r){q("No input!");return}let n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],a=[],s=0;for(let i=gt.Points;i<=gt.TriangleStrips;i++)if(n[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());let o=e.primitives[i];o.setCellArray(n[i]),o.setCurrentInput(r),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),s+=n[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility()){if(n[gt.Triangles].getNumberOfValues()>0){let i=gt.TriangleEdges;e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());let o=e.primitives[i];o.setCellArray(n[gt.Triangles]),o.setCurrentInput(r),o.setCellOffset(e.primitives[gt.Triangles].getCellOffset()),o.setPrimitiveType(i),o.setRenderable(e.renderable),a.push(o)}else e.primitives[gt.TriangleEdges]=null;if(n[gt.TriangleStrips].getNumberOfValues()>0){let i=gt.TriangleStripEdges;e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());let o=e.primitives[i];o.setCellArray(n[gt.TriangleStrips]),o.setCurrentInput(r),o.setCellOffset(e.primitives[gt.TriangleStrips].getCellOffset()),o.setPrimitiveType(i),o.setRenderable(e.renderable),a.push(o)}else e.primitives[gt.TriangleStripEdges]=null}t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}var RL={primitives:null};function OL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RL,r),I.extend(t,e,r),e.primitives=[],ML(t,e)}var DL=j(OL,"vtkWebGPUPolyDataMapper");De("vtkMapper",DL);var{PrimitiveTypes:K1}=et;function LL(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>_s.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();let n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{let n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],a=[],s=0;for(let i=K1.Points;i<=K1.Triangles;i++)if(n[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());let o=e.primitives[i];o.setCellArray(n[i]),o.setCurrentInput(r),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),o.setIs2D(!0),s+=n[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}function VL(t){return{primitives:[],...t}}function BL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VL(r)),I.extend(t,e,r),e.primitives=[],LL(t,e)}var FL=j(BL,"vtkWebGPUPolyDataMapper2D");De("vtkMapper2D",FL);function kL(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){let a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}var UL={};function NL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UL,r),I.extend(t,e,r),e.scalarBarActorHelper=ks.newScalarBarActorHelper(),kL(t,e)}var GL=j(NL,"vtkWebGPUScalarBarActor");De("vtkScalarBarActor",GL);function _L(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();let a=e.WebGPURenderer.getAspectRatio(),s=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)}}var bL={};function zL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bL,r),I.extend(t,e,r),_L(t,e)}var WL=m.newInstance(zL,"vtkWebGPUPixelSpaceCallbackMapper");De("vtkPixelSpaceCallbackMapper",WL);var HL={inflated:{lh:{offsetX:-90,offsetZ:0,rotateZ:20},rh:{offsetX:90,offsetZ:0,rotateZ:-20}},original:{lh:{offsetX:-45,offsetZ:0,rotateZ:20},rh:{offsetX:45,offsetZ:0,rotateZ:-20}},pial:{lh:{offsetX:-45,offsetZ:0,rotateZ:20},rh:{offsetX:45,offsetZ:0,rotateZ:-20}},white:{lh:{offsetX:-45,offsetZ:0,rotateZ:20},rh:{offsetX:45,offsetZ:0,rotateZ:-20}}},fe={hemisphereData:{lh:{meshData:null,actor:null,mapper:null,polyData:null,offsetX:-45,offsetZ:0,rotateZ:20},rh:{meshData:null,actor:null,mapper:null,polyData:null,offsetX:45,offsetZ:0,rotateZ:-20}},labelsData:null,labelNamesData:null,currentSelectedLabel:null,renderWindow:null,renderer:null,usePlainEnglishNames:!1,currentGeometry:"pial",geometryOffsets:HL,atlasesConfig:null,currentAtlas:null};function lt(t){return fe.hemisphereData[t]}function P1(t,e){Object.assign(fe.hemisphereData[t],e)}function X1(t,e){fe.renderer=t,fe.renderWindow=e}function Pt(){return fe.renderer}function dr(){return fe.renderWindow}function Rf(t){fe.labelsData=t}function Qn(){return fe.labelsData}function bs(t){fe.labelNamesData=t}function Y1(){return fe.labelNamesData}function Of(t){fe.currentSelectedLabel=t}function Pr(){return fe.currentSelectedLabel}function I1(){return fe.usePlainEnglishNames=!fe.usePlainEnglishNames,fe.usePlainEnglishNames}function q1(){return fe.usePlainEnglishNames}function AL(t,e){return fe.geometryOffsets[t]?.[e]||fe.geometryOffsets.pial[e]}function Z1(t){fe.currentGeometry=t,["lh","rh"].forEach(e=>{let r=AL(t,e);Object.assign(fe.hemisphereData[e],r)})}function Q1(){return fe.currentGeometry}function J1(t){fe.atlasesConfig=t}function Df(t){fe.currentAtlas=t}function ev(){return!fe.atlasesConfig||!fe.currentAtlas?null:fe.atlasesConfig.atlases.find(t=>t.id===fe.currentAtlas)}function yn(t,e=0,r=0,n=0){let{vertices:a,triangles:s,curvature:i}=t,o=nt.newInstance(),f=a.flat(),c=new Float32Array(f.length),g=n*Math.PI/180,u=Math.cos(g),l=Math.sin(g);for(let v=0;v<f.length;v+=3){let y=f[v],C=f[v+1],x=f[v+2],T=y*u-C*l,w=y*l+C*u;c[v]=T+e,c[v+1]=w,c[v+2]=x+r}o.setData(c);let p=[];for(let v=0;v<s.length;v++)p.push(3),p.push(...s[v]);let d=Nn.newInstance({values:new Uint32Array(p)}),h=Ge.newInstance();if(h.setPoints(o),h.setPolys(d),i){let v=P.newInstance({name:"Curvature",values:Float32Array.from(i),numberOfComponents:1});h.getPointData().setScalars(v)}return h}function tv(t,e,r,n,a){if(!e||e.length===0)return{center:[0,0,0],normal:[0,0,1]};let s=a*Math.PI/180,i=Math.cos(s),o=Math.sin(s),f=0,c=0,g=0,u=0,l=0,p=0,d=new Set(e);e.forEach(y=>{let C=t.vertices[y][0],x=t.vertices[y][1],T=t.vertices[y][2],w=C*i-x*o,S=C*o+x*i,M=w+r,E=S,R=T+n;f+=M,c+=E,g+=R});let h=e.length;f/=h,c/=h,g/=h;let v=0;if(t.triangles.forEach(y=>{let C=d.has(y[0]),x=d.has(y[1]),T=d.has(y[2]);if(C&&x||x&&T||C&&T){let w=t.vertices[y[0]],S=t.vertices[y[1]],M=t.vertices[y[2]],E=[S[0]-w[0],S[1]-w[1],S[2]-w[2]],R=[M[0]-w[0],M[1]-w[1],M[2]-w[2]],D=E[1]*R[2]-E[2]*R[1],L=E[2]*R[0]-E[0]*R[2],V=E[0]*R[1]-E[1]*R[0],B=D*i-L*o,F=D*o+L*i;u+=B,l+=F,p+=V,v++}}),v>0){let y=Math.sqrt(u*u+l*l+p*p);y>0&&(u/=y,l/=y,p/=y)}else{u=f-r,l=c,p=g-n;let y=Math.sqrt(u*u+l*l+p*p);y>0&&(u/=y,l/=y,p/=y)}return{center:[f,c,g],normal:[u,l,p]}}var $L={RGB:0,HSV:1,LAB:2,DIVERGING:3},jL={LINEAR:0,LOG10:1},Lf={ColorSpace:$L,Scale:jL};var{ColorSpace:pt,Scale:Vf}=Lf,{ScalarMappingTarget:zs}=Lr,{vtkDebugMacro:KL,vtkErrorMacro:Xt,vtkWarningMacro:PL}=m;function rv(t,e){let r=t[0],n=t[1],a=t[2],s=Math.sqrt(r*r+n*n+a*a),i=s>.001?Math.acos(r/s):0,o=i>.001?Math.atan2(a,n):0;e[0]=s,e[1]=i,e[2]=o}function XL(t,e){let r=t[0],n=t[1],a=t[2];e[0]=r*Math.cos(n),e[1]=r*Math.sin(n)*Math.cos(a),e[2]=r*Math.sin(n)*Math.sin(a)}function nv(t,e){if(t[0]>=e-.1)return t[2];let r=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+r:t[2]-r}function YL(t,e){let r=t-e;for(r<0&&(r=-r);r>=2*Math.PI;)r-=2*Math.PI;return r>Math.PI&&(r=2*Math.PI-r),r}function av(t,e,r,n){let a=[],s=[];tr(e,a),tr(r,s);let i=[],o=[];rv(a,i),rv(s,o);let f=t;if(i[1]>.05&&o[1]>.05&&YL(i[2],o[2])>.33*Math.PI){let u=Math.max(i[0],o[0]);u=Math.max(88,u),t<.5?(o[0]=u,o[1]=0,o[2]=0,f*=2):(i[0]=u,i[1]=0,i[2]=0,f=2*f-1)}i[1]<.05&&o[1]>.05?i[2]=nv(o,i[0]):o[1]<.05&&i[1]>.05&&(o[2]=nv(i,o[0]));let c=[];c[0]=(1-f)*i[0]+f*o[0],c[1]=(1-f)*i[1]+f*o[1],c[2]=(1-f)*i[2]+f*o[2];let g=[];XL(c,g),Rn(g,n)}function IL(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(r,n,a,s)=>t.addRGBPointLong(r,n,a,s,.5,0),t.addRGBPointLong=function(r,n,a,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(i<0||i>1)return Xt("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return Xt("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);let f={x:r,r:n,g:a,b:s,midpoint:i,sharpness:o};e.nodes.push(f),t.sortAndUpdateRange();let c=0;for(;c<e.nodes.length&&e.nodes[c].x!==r;c++);return c<e.nodes.length?c:-1},t.addHSVPoint=(r,n,a,s)=>t.addHSVPointLong(r,n,a,s,.5,0),t.addHSVPointLong=function(r,n,a,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,f=[];return zt([n,a,s],f),t.addRGBPoint(r,f[0],f[1],f[2],i,o)},t.setNodes=r=>{if(e.nodes!==r){let n=JSON.stringify(e.nodes);e.nodes=r;let a=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||n!==a)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{let r=JSON.stringify(e.nodes);e.nodes.sort((s,i)=>s.x-i.x);let n=JSON.stringify(e.nodes),a=t.updateRange();return!a&&r!==n?(t.modified(),!0):a},t.updateRange=()=>{let r=[2];r[0]=e.mappingRange[0],r[1]=e.mappingRange[1];let n=e.nodes.length;return n?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[n-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),r[0]===e.mappingRange[0]&&r[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n=0;for(;n<e.nodes.length&&e.nodes[n].x!==r;n++);let a=n;if(n>=e.nodes.length)return-1;let s=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(s=t.updateRange()),s||t.modified(),a},t.movePoint=(r,n)=>{if(r!==n){t.removePoint(n);for(let a=0;a<e.nodes.length;a++)if(e.nodes[a].x===r){e.nodes[a].x=n,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(r,n,a,s,i,o,f,c)=>{t.sortAndUpdateRange();for(let g=0;g<e.nodes.length;)e.nodes[g].x>=r&&e.nodes[g].x<=i?e.nodes.splice(g,1):g++;t.addRGBPointLong(r,n,a,s,.5,0),t.addRGBPointLong(i,o,f,c,.5,0),t.modified()},t.addHSVSegment=(r,n,a,s,i,o,f,c)=>{let g=[n,a,s],u=[o,f,c],l=[],p=[];zt(g,l),zt(u,p),t.addRGBSegment(r,l[0],l[1],l[2],i,p[0],p[1],p[2])},t.mapValue=r=>{let n=[];return t.getColor(r,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},t.getColor=(r,n)=>{if(e.indexedLookup){let a=t.getSize(),s=t.getAnnotatedValueIndexInternal(r);if(s<0||a===0){let i=t.getNanColorByReference();n[0]=i[0],n[1]=i[1],n[2]=i[2]}else{let i=[];t.getNodeValue(s%a,i),n[0]=i[1],n[1]=i[2],n[2]=i[3]}return}t.getTable(r,r,1,n)},t.getRedValue=r=>{let n=[];return t.getColor(r,n),n[0]},t.getGreenValue=r=>{let n=[];return t.getColor(r,n),n[1]},t.getBlueValue=r=>{let n=[];return t.getColor(r,n),n[2]},t.logScaleEnabled=()=>e.scale===Vf.LOG10,t.usingLogScale=()=>t.logScaleEnabled()&&e.mappingRange[0]>0,t.getTable=(r,n,a,s)=>{let i=t.usingLogScale(),o=i?Math.log10(Number(r)):Number(r),f=i?Math.log10(Number(n)):Number(n);if(wr(o)||wr(f)){for(let M=0;M<a;M++)s[M*3+0]=e.nanColor[0],s[M*3+1]=e.nanColor[1],s[M*3+2]=e.nanColor[2];return}let c=0,g=e.nodes.length,u=0,l=0,p=0;g!==0&&(u=e.nodes[g-1].r,l=e.nodes[g-1].g,p=e.nodes[g-1].b);let d=0,h=0,v=0,y=[0,0,0],C=[0,0,0],x=0,T=0,w=[],S=e.mappingRange;i&&(S=[Math.log10(e.mappingRange[0]),Math.log10(e.mappingRange[1])]);for(let M=0;M<a;M++){let E=3*M;if(a>1?d=o+M/(a-1)*(f-o):d=.5*(o+f),e.discretize){let R=S;if(d>=R[0]&&d<=R[1]){let D=e.numberOfValues,L=R[1]-R[0];if(D<=1)d=R[0]+L/2;else{let V=(d-R[0])/L,B=Ki(D*V);d=R[0]+B/(D-1)*L}}}for(;c<g&&d>e.nodes[c].x;)c++,c<g&&(h=e.nodes[c-1].x,v=e.nodes[c].x,y[0]=e.nodes[c-1].r,C[0]=e.nodes[c].r,y[1]=e.nodes[c-1].g,C[1]=e.nodes[c].g,y[2]=e.nodes[c-1].b,C[2]=e.nodes[c].b,x=e.nodes[c-1].midpoint,T=e.nodes[c-1].sharpness,x<1e-5&&(x=1e-5),x>.99999&&(x=.99999));if(d>S[1])s[E]=0,s[E+1]=0,s[E+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(s[E]=e.aboveRangeColor[0],s[E+1]=e.aboveRangeColor[1],s[E+2]=e.aboveRangeColor[2]):(s[E]=u,s[E+1]=l,s[E+2]=p));else if(d<S[0]||qi(d)&&d<0)s[E]=0,s[E+1]=0,s[E+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(s[E]=e.belowRangeColor[0],s[E+1]=e.belowRangeColor[1],s[E+2]=e.belowRangeColor[2]):g>0&&(s[E]=e.nodes[0].r,s[E+1]=e.nodes[0].g,s[E+2]=e.nodes[0].b));else if(c===0&&(Math.abs(d-o)<1e-6||e.discretize))g>0?(s[E]=e.nodes[0].r,s[E+1]=e.nodes[0].g,s[E+2]=e.nodes[0].b):(s[E]=0,s[E+1]=0,s[E+2]=0);else{let R=0;if(R=(d-h)/(v-h),R<x?R=.5*R/x:R=.5+.5*(R-x)/(1-x),T>.99)if(R<.5){s[E]=y[0],s[E+1]=y[1],s[E+2]=y[2];continue}else{s[E]=C[0],s[E+1]=C[1],s[E+2]=C[2];continue}if(T<.01){if(e.colorSpace===pt.RGB)s[E]=(1-R)*y[0]+R*C[0],s[E+1]=(1-R)*y[1]+R*C[1],s[E+2]=(1-R)*y[2]+R*C[2];else if(e.colorSpace===pt.HSV){let G=[],k=[];Jr(y,G),Jr(C,k),e.hSVWrap&&(G[0]-k[0]>.5||k[0]-G[0]>.5)&&(G[0]>k[0]?G[0]-=1:k[0]-=1);let _=[];_[0]=(1-R)*G[0]+R*k[0],_[0]<0&&(_[0]+=1),_[1]=(1-R)*G[1]+R*k[1],_[2]=(1-R)*G[2]+R*k[2],zt(_,w),s[E]=w[0],s[E+1]=w[1],s[E+2]=w[2]}else if(e.colorSpace===pt.LAB){let G=[],k=[];tr(y,G),tr(C,k);let _=[];_[0]=(1-R)*G[0]+R*k[0],_[1]=(1-R)*G[1]+R*k[1],_[2]=(1-R)*G[2]+R*k[2],Rn(_,w),s[E]=w[0],s[E+1]=w[1],s[E+2]=w[2]}else e.colorSpace===pt.DIVERGING?(av(R,y,C,w),s[E]=w[0],s[E+1]=w[1],s[E+2]=w[2]):Xt("ColorSpace set to invalid value.",e.colorSpace);continue}R<.5?R=.5*(R*2)**(1+10*T):R>.5&&(R=1-.5*((1-R)*2)**(1+10*T));let D=R*R,L=D*R,V=2*L-3*D+1,B=-2*L+3*D,F=L-2*D+R,z=L-D,b,W;if(e.colorSpace===pt.RGB)for(let G=0;G<3;G++)b=C[G]-y[G],W=(1-T)*b,s[E+G]=V*y[G]+B*C[G]+F*W+z*W;else if(e.colorSpace===pt.HSV){let G=[],k=[];Jr(y,G),Jr(C,k),e.hSVWrap&&(G[0]-k[0]>.5||k[0]-G[0]>.5)&&(G[0]>k[0]?G[0]-=1:k[0]-=1);let _=[];for(let H=0;H<3;H++)b=k[H]-G[H],W=(1-T)*b,_[H]=V*G[H]+B*k[H]+F*W+z*W,H===0&&_[H]<0&&(_[H]+=1);zt(_,w),s[E]=w[0],s[E+1]=w[1],s[E+2]=w[2]}else if(e.colorSpace===pt.LAB){let G=[],k=[];tr(y,G),tr(C,k);let _=[];for(let H=0;H<3;H++)b=k[H]-G[H],W=(1-T)*b,_[H]=V*G[H]+B*k[H]+F*W+z*W;Rn(_,w),s[E]=w[0],s[E+1]=w[1],s[E+2]=w[2]}else e.colorSpace===pt.DIVERGING?(av(R,y,C,w),s[E]=w[0],s[E+1]=w[1],s[E+2]=w[2]):Xt("ColorSpace set to invalid value.");for(let G=0;G<3;G++)s[E+G]=s[E+G]<0?0:s[E+G],s[E+G]=s[E+G]>1?1:s[E+G]}}},t.getUint8Table=function(r,n,a){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===a&&e.tableWithAlpha!==s)return e.table;if(e.nodes.length===0)return Xt("Attempting to lookup a value with no points in the function"),e.table;let i=s?4:3;(e.tableSize!==a||e.tableWithAlpha!==s)&&(e.table=new Uint8Array(a*i),e.tableSize=a,e.tableWithAlpha=s);let o=[];t.getTable(r,n,a,o);for(let f=0;f<a;f++)e.table[f*i+0]=Math.floor(o[f*3+0]*255+.5),e.table[f*i+1]=Math.floor(o[f*3+1]*255+.5),e.table[f*i+2]=Math.floor(o[f*3+2]*255+.5),s&&(e.table[f*i+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=r=>{t.removeAllPoints();let n=r.getNumberOfComponents();for(let a=0;a<r.getNumberOfTuples();a++)switch(n){case 3:{e.nodes.push({x:a,r:r.getComponent(a,0),g:r.getComponent(a,1),b:r.getComponent(a,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:r.getComponent(a,0),r:r.getComponent(a,1),g:r.getComponent(a,2),b:r.getComponent(a,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:a,r:r.getComponent(a,0),g:r.getComponent(a,1),b:r.getComponent(a,2),midpoint:r.getComponent(a,4),sharpness:r.getComponent(a,5)});break}case 6:{e.nodes.push({x:r.getComponent(a,0),r:r.getComponent(a,1),g:r.getComponent(a,2),b:r.getComponent(a,3),midpoint:r.getComponent(a,4),sharpness:r.getComponent(a,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(r,n,a,s)=>{let i=0;t.removeAllPoints(),a>1&&(i=(n-r)/(a-1));for(let o=0;o<a;o++){let f={x:r+i*o,r:s[o*3],g:s[o*3+1],b:s[o*3+2],sharpness:0,midpoint:.5};e.nodes.push(f)}t.sortAndUpdateRange()},t.getNodeValue=(r,n)=>r<0||r>=e.nodes.length?(Xt("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].r,n[2]=e.nodes[r].g,n[3]=e.nodes[r].b,n[4]=e.nodes[r].midpoint,n[5]=e.nodes[r].sharpness,1),t.setNodeValue=(r,n)=>{if(r<0||r>=e.nodes.length)return Xt("Index out of range!"),-1;let a=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].r=n[1],e.nodes[r].g=n[2],e.nodes[r].b=n[3],e.nodes[r].midpoint=n[4],e.nodes[r].sharpness=n[5],a!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;let r=e.nodes?.length??0;return Math.max(4094,r)},t.getIndexedColor=(r,n)=>{let a=t.getSize();if(a>0&&r>=0){let i=[];t.getNodeValue(r%a,i);for(let o=0;o<3;++o)n[o]=i[o+1];n[3]=1;return}let s=t.getNanColorByReference();n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=1},t.fillFromDataPointer=(r,n)=>{if(!(r<=0||!n)){t.removeAllPoints();for(let a=0;a<r;a++)t.addRGBPoint(n[a*4],n[a*4+1],n[a*4+2],n[a*4+3])}},t.setMappingRange=(r,n)=>{let a=[r,n],s=[r,n],i=t.getRange(),o=t.logScaleEnabled();if(i[1]===a[1]&&i[0]===a[0])return;if(a[1]===a[0]){Xt("attempt to set zero width color range");return}o&&(a[0]<=0?console.warn("attempt to set log scale color range with non-positive minimum"):(s[0]=Math.log10(a[0]),s[1]=Math.log10(a[1])));let f=(s[1]-s[0])/(i[1]-i[0]),c=s[0]-i[0]*f;for(let g=0;g<e.nodes.length;++g)e.nodes[g].x=e.nodes[g].x*f+c;e.mappingRange[0]=a[0],e.mappingRange[1]=a[1],t.modified()},t.adjustRange=r=>{let n=t.getRange(),a=[];n[0]<r[0]?(t.getColor(r[0],a),t.addRGBPoint(r[0],a[0],a[1],a[2])):(t.getColor(n[0],a),t.addRGBPoint(r[0],a[0],a[1],a[2])),n[1]>r[1]?(t.getColor(r[1],a),t.addRGBPoint(r[1],a[0],a[1],a[2])):(t.getColor(n[1],a),t.addRGBPoint(r[1],a[0],a[1],a[2])),t.sortAndUpdateRange();for(let s=0;s<e.nodes.length;)e.nodes[s].x>=r[0]&&e.nodes[s].x<=r[1]?e.nodes.splice(s,1):++s;return 1},t.estimateMinNumberOfSamples=(r,n)=>{let a=t.findMinimumXDistance();return Math.ceil((n-r)/a)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let r=Number.MAX_VALUE;for(let n=0;n<e.nodes.length-1;n++){let a=e.nodes[n+1].x-e.nodes[n].x;a<r&&(r=a)}return r},t.mapScalarsThroughTable=(r,n,a,s)=>{if(t.getSize()===0){KL("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(r,n,a,s):t.mapData(r,n,a,s)},t.mapData=(r,n,a,s)=>{if(t.getSize()===0){PL("Transfer Function Has No Points!");return}let i=Math.floor(t.getAlpha()*255+.5),o=r.getNumberOfTuples(),f=r.getNumberOfComponents(),c=n.getData(),g=r.getData(),u=[];if(a===zs.RGBA)for(let l=0;l<o;l++){let p=g[l*f+s];t.getColor(p,u),c[l*4]=Math.floor(u[0]*255+.5),c[l*4+1]=Math.floor(u[1]*255+.5),c[l*4+2]=Math.floor(u[2]*255+.5),c[l*4+3]=i}if(a===zs.RGB)for(let l=0;l<o;l++){let p=g[l*f+s];t.getColor(p,u),c[l*3]=Math.floor(u[0]*255+.5),c[l*3+1]=Math.floor(u[1]*255+.5),c[l*3+2]=Math.floor(u[2]*255+.5)}if(a===zs.LUMINANCE)for(let l=0;l<o;l++){let p=g[l*f+s];t.getColor(p,u),c[l]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(a===zs.LUMINANCE_ALPHA)for(let l=0;l<o;l++){let p=g[l*f+s];t.getColor(p,u),c[l*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),c[l*2+1]=i}},t.applyColorMap=r=>{let n=JSON.stringify(e.colorSpace);r.ColorSpace&&(e.colorSpace=pt[r.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Xt(`ColorSpace ${r.ColorSpace} not supported, using RGB instead`),e.colorSpace=pt.RGB));let a=n!==JSON.stringify(e.colorSpace),s=a||JSON.stringify(e.nanColor);if(r.NanColor)for(e.nanColor=[].concat(r.NanColor);e.nanColor.length<4;)e.nanColor.push(1);a=a||s!==JSON.stringify(e.nanColor);let i=a||JSON.stringify(e.nodes);if(r.RGBPoints){let c=r.RGBPoints.length;e.nodes=[];let g=.5,u=0;for(let l=0;l<c;l+=4)e.nodes.push({x:r.RGBPoints[l],r:r.RGBPoints[l+1],g:r.RGBPoints[l+2],b:r.RGBPoints[l+3],midpoint:g,sharpness:u})}let o=t.sortAndUpdateRange(),f=!o&&(a||i!==JSON.stringify(e.nodes));return f&&t.modified(),o||f}}var qL={clamping:!0,colorSpace:pt.RGB,hSVWrap:!0,scale:Vf.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function sv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qL,r),Lr.extend(t,e,r),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},m.obj(e.buildTime),m.get(t,e,["buildTime","mappingRange"]),m.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:pt},{type:"enum",name:"scale",enum:Vf}]),m.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),m.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),IL(t,e)}var ZL=m.newInstance(sv,"vtkColorTransferFunction"),Bf={newInstance:ZL,extend:sv,...Lf};function QL(){let t=Bf.newInstance();return t.addRGBPoint(-1,.3,.3,.3),t.addRGBPoint(-.2,.5,.5,.5),t.addRGBPoint(0,.7,.7,.7),t.addRGBPoint(.2,.85,.85,.85),t.addRGBPoint(1,.95,.95,.95),t}function JL(){let t=Bf.newInstance();return t.addRGBPoint(-1,.3,.3,.3),t.addRGBPoint(-.2,.5,.5,.5),t.addRGBPoint(0,.7,.7,.7),t.addRGBPoint(.2,.85,.85,.85),t.addRGBPoint(1,.95,.95,.95),t.addRGBPoint(5,1,.5,.2),t.addRGBPoint(10,1,.3,.1),t}function Jn(t,e){if(e.curvature){let r=QL();t.setLookupTable(r),t.setScalarModeToUsePointData(),t.setScalarVisibility(!0),t.setScalarRange(-1,1)}}function iv(t){let e=JL();t.setLookupTable(e),t.setScalarModeToUsePointData(),t.setScalarVisibility(!0),t.setScalarRange(-1,10)}var Ws=new Map;function ov(t,e,r=500,n=null,a=null){if(!t)return;let s=t.getProperty(),i=s.getOpacity();if(Math.abs(i-e)<.001){n&&n();return}let o=Ws.get(t);o&&cancelAnimationFrame(o.frameId);let f=Date.now();function c(){let u=Date.now()-f,l=Math.min(u/r,1),p=l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2,d=i+(e-i)*p;if(s.setOpacity(d),a&&a(),l<1){let h=requestAnimationFrame(c);Ws.set(t,{frameId:h,startTime:f})}else Ws.delete(t),n&&n()}let g=requestAnimationFrame(c);Ws.set(t,{frameId:g,startTime:f})}function eV(t,e,r,n,a,s,i,o){if(!r.meshData||!e.meshData)return!1;let f=r.rotateZ*Math.PI/180,c=Math.cos(f),g=Math.sin(f),u=r.meshData,l=r.offsetX,p=r.offsetZ||0,d=1/0,h=-1/0,v=1/0,y=-1/0,C=1/0,x=-1/0,T=Math.min(100,u.vertices.length),w=Math.max(1,Math.floor(u.vertices.length/T));for(let he=0;he<u.vertices.length;he+=w){let se=u.vertices[he],Ce=se[0],Ye=se[1],Be=se[2],be=Ce*c-Ye*g,vt=Ce*g+Ye*c,Yt=be+l,mt=vt,ea=Be+p;d=Math.min(d,Yt),h=Math.max(h,Yt),v=Math.min(v,mt),y=Math.max(y,mt),C=Math.min(C,ea),x=Math.max(x,ea)}let S=(d+h)/2,M=(v+y)/2,E=(C+x)/2,R=Math.sqrt(Math.pow(S-t[0],2)+Math.pow(M-t[1],2)+Math.pow(E-t[2],2)),D=Math.sqrt(Math.pow(s-t[0],2)+Math.pow(0-t[1],2)+Math.pow(i-t[2],2));if(R>D*1.3)return!1;let L=o*Math.PI/180,V=Math.cos(L),B=Math.sin(L),F=Math.min(50,Math.max(10,Math.floor(a.length/10))),z=Math.max(1,Math.floor(a.length/F)),b=0,W=Math.max(2,Math.floor(F*.1)),G=15,k=d-G,_=h+G,H=v-G,Q=y+G,A=C-G,He=x+G;for(let he=0;he<a.length;he+=z){let se=a[he],Ce=n.vertices[se],Ye=Ce[0],Be=Ce[1],be=Ce[2],vt=Ye*V-Be*B,Yt=Ye*B+Be*V,mt=vt+s,ea=Yt,kv=be+i,Zs=mt-t[0],Qs=ea-t[1],Js=kv-t[2],Xr=Math.sqrt(Zs*Zs+Qs*Qs+Js*Js);if(Xr<1)continue;let ei=Zs/Xr,ti=Qs/Xr,ri=Js/Xr,Ft=0,yr=Xr*.98,It=!0;if(Math.abs(ei)>1e-4){let qt=(k-t[0])/ei,Zt=(_-t[0])/ei;Ft=Math.max(Ft,Math.min(qt,Zt)),yr=Math.min(yr,Math.max(qt,Zt))}else(t[0]<k||t[0]>_)&&(It=!1);if(It&&Math.abs(ti)>1e-4){let qt=(H-t[1])/ti,Zt=(Q-t[1])/ti;Ft=Math.max(Ft,Math.min(qt,Zt)),yr=Math.min(yr,Math.max(qt,Zt))}else It&&(t[1]<H||t[1]>Q)&&(It=!1);if(It&&Math.abs(ri)>1e-4){let qt=(A-t[2])/ri,Zt=(He-t[2])/ri;Ft=Math.max(Ft,Math.min(qt,Zt)),yr=Math.min(yr,Math.max(qt,Zt))}else It&&(t[2]<A||t[2]>He)&&(It=!1);if(It&&Ft<=yr&&Ft>0&&Ft<Xr*.98&&(b++,b>=W))return!0}return b>=W}function Ff(t,e,r,n,a,s,i,o,f){if(!o)return;let g=o.getActiveCamera().getPosition(),l=i(t==="lh"?"rh":"lh"),p=i(t),d=eV(g,p,l,e,r,n,a,s);["lh","rh"].forEach(h=>{let v=i(h);if(!v.actor)return;let y=h===t?1:d?.2:1;ov(v.actor,y,500,null,f)})}function fv(t,e,r){t.forEach(n=>{let a=e(n);a.actor&&ov(a.actor,1,500,null,r)})}function cv(t,e,r,n,a){let s=t(),i=e();if(!s||!i)return;let o=s.getInteractor();o&&(o._occlusionListenerActive||(o._occlusionListenerActive=!0,o.onAnimation(()=>{let f=r();if(!f)return;let c=n();if(!c||!c[f])return;let g=c[f],u=g.hemi,l=g.vertices,p=a(u);p.meshData&&Ff(u,p.meshData,l,p.offsetX,p.offsetZ,p.rotateZ,a,i,()=>s.render())})))}Nf();async function Gf(t,e,r,n,a,s,i){let o=await kf(t),f=await Uf(e),c={vertices:o.vertices,triangles:o.triangles,curvature:Array.from(f)},g=yn(c,n,a,s),u=qe.newInstance();u.setInputData(g),Jn(u,c);let l=ct.newInstance();return l.setMapper(u),i.addActor(l),P1(r,{meshData:c,actor:l,mapper:u,polyData:g}),l}async function _f(t){try{return await(await fetch(t)).json()}catch(e){return console.warn("Could not load label names, using FreeSurfer names only:",e),null}}async function hv(t){return await(await fetch(t)).json()}async function bf(t,e){let{parseFreeSurferAnnotation:r}=await Promise.resolve().then(()=>(Nf(),pv)),a=await(await fetch(t)).arrayBuffer(),s=r(a),o=await(await fetch(e)).arrayBuffer(),f=r(o),c={};if(s.colorTable)for(let g of s.colorTable.entries){if(g.name==="unknown"||g.name==="corpuscallosum"||g.name==="Unknown"||g.name==="Medial_wall")continue;let u=[];for(let l=0;l<s.vertexLabels.length;l++)s.vertexLabels[l]===g.label&&u.push(s.vertexIndices[l]);if(u.length>0){let l=`${g.name}-lh`;c[l]={hemi:"lh",vertices:u,color:[g.r,g.g,g.b]}}}if(f.colorTable)for(let g of f.colorTable.entries){if(g.name==="unknown"||g.name==="corpuscallosum"||g.name==="Unknown"||g.name==="Medial_wall")continue;let u=[];for(let l=0;l<f.vertexLabels.length;l++)f.vertexLabels[l]===g.label&&u.push(f.vertexIndices[l]);if(u.length>0){let l=`${g.name}-rh`;c[l]={hemi:"rh",vertices:u,color:[g.r,g.g,g.b]}}}return c}var rV=t=>t,vv=1e-6,Hs=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=O.identity(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?Nt.toRadian:rV}rotateFromDirections(e,r){let n=new Float64Array(3),a=new Float64Array(3),s=new Float64Array(16);N.set(n,e[0],e[1],e[2]),N.set(a,r[0],r[1],r[2]),N.normalize(n,n),N.normalize(a,a);let i=N.dot(n,a);return i>=1?this:(N.cross(this.tmp,n,a),N.length(this.tmp)<vv&&(N.cross(this.tmp,[1,0,0],e),N.length(this.tmp)<vv&&N.cross(this.tmp,[0,1,0],e)),O.fromRotation(s,Math.acos(i),this.tmp),O.multiply(this.matrix,this.matrix,s),this)}rotate(e,r){return N.set(this.tmp,...r),N.normalize(this.tmp,this.tmp),O.rotate(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return O.rotateX(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return O.rotateY(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return O.rotateZ(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,r,n){return N.set(this.tmp,e,r,n),O.translate(this.matrix,this.matrix,this.tmp),this}scale(e,r,n){return N.set(this.tmp,e,r,n),O.scale(this.matrix,this.matrix,this.tmp),this}multiply(e){return O.multiply(this.matrix,this.matrix,e),this}multiply3x3(e){return O.multiply(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return O.invert(this.matrix,this.matrix),this}identity(){return O.identity(this.matrix),this}apply(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(er(Sa,this.matrix))return this;let a=n===-1?e.length:r+n*3;for(let s=r;s<a;s+=3)N.set(this.tmp,e[s],e[s+1],e[s+2]),N.transformMat4(this.tmp,this.tmp,this.matrix),e[s]=this.tmp[0],e[s+1]=this.tmp[1],e[s+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&O.copy(this.matrix,e),this}};function nV(){return new Hs(!0)}function aV(){return new Hs(!1)}var it={buildFromDegree:nV,buildFromRadian:aV};var{vtkErrorMacro:sV}=m;function iV(t,e){let r=0;return t.map((n,a)=>a===r?(r+=n+1,n):n+e)}function As(t,e,r,n){t.set(iV(e,r),n)}function oV(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(r,n)=>{let a=t.getNumberOfInputPorts();if(!a){sV("No input specified.");return}if(a===1){n[0]=r[0];return}let s=n[0]&&r[0]!==n[0]?n[0].initialize():Ge.newInstance(),i=0,o=0,f=1,c=1,g=0,u=0,l=0,p=0,d=!0,h=!0,v=!0;for(let L=0;L<a;L++){let V=r[L];if(!V)continue;let B=V.getPoints().getNumberOfPoints();i+=B,g+=V.getVerts().getNumberOfValues(),u+=V.getLines().getNumberOfValues(),l+=V.getStrips().getNumberOfValues(),p+=V.getPolys().getNumberOfValues(),B&&(c&&(c=0,o=V.getPoints().getDataType()),f=V.getPoints().getDataType(),o=o>f?o:f);let F=V.getPointData();F?(d=d&&F.getNormals()!==null,h=h&&F.getTCoords()!==null,v=v&&F.getScalars()!==null):(d=!1,h=!1,v=!1)}e.outputPointsPrecision===Gn.SINGLE?o=ge.FLOAT:e.outputPointsPrecision===Gn.DOUBLE&&(o=ge.DOUBLE);let y=nt.newInstance({dataType:o});y.setNumberOfPoints(i);let C=y.getData(),x=new Uint32Array(g),T=new Uint32Array(u),w=new Uint32Array(l),S=new Uint32Array(p),M=null,E=null,R=null,D=r[a-1];if(d){let L=D.getPointData().getNormals();M=P.newInstance({numberOfComponents:3,numberOfTuples:i,size:3*i,dataType:L.getDataType(),name:L.getName()})}if(h){let L=D.getPointData().getTCoords();E=P.newInstance({numberOfComponents:2,numberOfTuples:i,size:2*i,dataType:L.getDataType(),name:L.getName()})}if(v){let L=D.getPointData().getScalars();R=P.newInstance({numberOfComponents:L.getNumberOfComponents(),numberOfTuples:i,size:i*L.getNumberOfComponents(),dataType:L.getDataType(),name:L.getName()})}i=0,g=0,u=0,l=0,p=0;for(let L=0;L<a;L++){let V=r[L];C.set(V.getPoints().getData(),i*3),As(x,V.getVerts().getData(),i,g),g+=V.getVerts().getNumberOfValues(),As(T,V.getLines().getData(),i,u),u+=V.getLines().getNumberOfValues(),As(w,V.getStrips().getData(),i,l),l+=V.getStrips().getNumberOfValues(),As(S,V.getPolys().getData(),i,p),p+=V.getPolys().getNumberOfValues();let B=V.getPointData();if(d){let F=B.getNormals();M.getData().set(F.getData(),i*3)}if(h){let F=B.getTCoords();E.getData().set(F.getData(),i*2)}if(v){let F=B.getScalars();R.getData().set(F.getData(),i*R.getNumberOfComponents())}i+=V.getPoints().getNumberOfPoints()}s.setPoints(y),s.getVerts().setData(x),s.getLines().setData(T),s.getStrips().setData(w),s.getPolys().setData(S),M&&s.getPointData().setNormals(M),E&&s.getPointData().setTCoords(E),R&&s.getPointData().setScalars(R),n[0]=s}}var fV={outputPointsPrecision:Gn.DEFAULT};function dv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fV,r),m.setGet(t,e,["outputPointsPrecision"]),m.obj(t,e),m.algo(t,e,1,1),oV(t,e)}var cV=m.newInstance(dv,"vtkAppendPolyData"),$s={newInstance:cV,extend:dv};function uV(t,e){e.classHierarchy.push("vtkConeSource"),t.requestData=(r,n)=>{let a=2*Math.PI/e.resolution,s=-e.height/2,i=e.resolution+1,o=4*e.resolution+1+e.resolution,f=0,c=m.newTypedArray(e.pointType,i*3),g=0,u=new Uint32Array(o);c[0]=e.height/2,c[1]=0,c[2]=0,e.capping&&(u[g++]=e.resolution);for(let p=0;p<e.resolution;p++)f++,c[f*3+0]=s,c[f*3+1]=e.radius*Math.cos(p*a),c[f*3+2]=e.radius*Math.sin(p*a),e.capping&&(u[e.resolution-g+++1]=f);for(let p=0;p<e.resolution;p++)u[g++]=3,u[g++]=0,u[g++]=p+1,u[g++]=p+2>e.resolution?1:p+2;it.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(c);let l=n[0]?.initialize()||Ge.newInstance();l.getPoints().setData(c,3),l.getPolys().setData(u,1),n[0]=l}}var gV={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function yv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gV,r),m.obj(t,e),m.setGet(t,e,["height","radius","resolution","capping"]),m.setGetArray(t,e,["center","direction"],3),m.algo(t,e,0,1),uV(t,e)}var lV=m.newInstance(yv,"vtkConeSource"),xv={newInstance:lV,extend:yv};function pV(t,e){e.classHierarchy.push("vtkCylinderSource"),t.requestData=(r,n)=>{let a=2*Math.PI/e.resolution,s=2*e.resolution,i=5*e.resolution;e.capping&&(s=4*e.resolution,i=7*e.resolution+2);let o=m.newTypedArray(e.pointType,s*3),f=0,c=new Uint32Array(i),g=new Float32Array(s*3),u=P.newInstance({numberOfComponents:3,values:g,name:"Normals"}),l=new Float32Array(s*2),p=P.newInstance({numberOfComponents:2,values:l,name:"TCoords"}),d=[0,0,0],h=[0,0,0],v=[0,0,0],y=[0,0,0],C=[0,0],x=[0,0],T=e.otherRadius==null?e.radius:e.otherRadius;for(let S=0;S<e.resolution;S++){d[0]=Math.cos(S*a+e.initAngle),h[0]=d[0],v[0]=e.radius*d[0]+e.center[0],y[0]=v[0],C[0]=Math.abs(2*S/e.resolution-1),x[0]=C[0],v[1]=.5*e.height+e.center[1],y[1]=-.5*e.height+e.center[1],C[1]=0,x[1]=1,d[2]=-Math.sin(S*a+e.initAngle),h[2]=d[2],v[2]=T*d[2]+e.center[2],y[2]=v[2];let M=2*S;for(let E=0;E<3;E++)g[M*3+E]=d[E],g[(M+1)*3+E]=h[E],o[M*3+E]=v[E],o[(M+1)*3+E]=y[E],E<2&&(l[M*2+E]=C[E],l[(M+1)*2+E]=x[E])}for(let S=0;S<e.resolution;S++){c[f++]=4,c[f++]=2*S,c[f++]=2*S+1;let M=(2*S+3)%(2*e.resolution);c[f++]=M,c[f++]=M-1}if(e.capping){for(let S=0;S<e.resolution;S++){v[0]=e.radius*Math.cos(S*a+e.initAngle),y[0]=v[0],C[0]=v[0],x[0]=v[0],v[0]+=e.center[0],y[0]+=e.center[0],d[1]=1,h[1]=-1,v[1]=.5*e.height+e.center[1],y[1]=-.5*e.height+e.center[1],v[2]=-T*Math.sin(S*a+e.initAngle),y[2]=v[2],C[1]=v[2],x[1]=v[2],v[2]+=e.center[2],y[2]+=e.center[2];let M=2*e.resolution+S,E=3*e.resolution+e.resolution-S-1;for(let R=0;R<3;R++)g[3*M+R]=d[R],g[3*E+R]=h[R],o[3*M+R]=v[R],o[3*E+R]=y[R],R<2&&(l[2*M+R]=C[R],l[2*E+R]=x[R])}c[f++]=e.resolution;for(let S=0;S<e.resolution;S++)c[f++]=2*e.resolution+S;c[f++]=e.resolution;for(let S=0;S<e.resolution;S++)c[f++]=3*e.resolution+S}it.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(S=>S*-1)).apply(o);let w=n[0]?.initialize()||Ge.newInstance();w.getPoints().setData(o,3),w.getPolys().setData(c,1),w.getPointData().setNormals(u),w.getPointData().setTCoords(p),n[0]=w}}var hV={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function Tv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hV,r),m.obj(t,e),m.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),m.setGetArray(t,e,["center","direction"],3),m.algo(t,e,0,1),pV(t,e)}var vV=m.newInstance(Tv,"vtkCylinderSource"),Sv={newInstance:vV,extend:Tv};function dV(t,e){e.classHierarchy.push("vtkArrowSource"),t.requestData=(r,n)=>{let a=Sv.newInstance({capping:!0});a.setResolution(e.shaftResolution),a.setRadius(e.shaftRadius),a.setHeight(1-e.tipLength),a.setCenter(0,(1-e.tipLength)*.5,0);let s=a.getOutputData(),i=s.getPoints().getData(),o=s.getPointData().getNormals().getData();it.buildFromDegree().rotateZ(-90).apply(i).apply(o);let f=xv.newInstance();f.setResolution(e.tipResolution),f.setHeight(e.tipLength),f.setRadius(e.tipRadius);let c=f.getOutputData(),g=c.getPoints().getData();it.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(g);let u=$s.newInstance();u.setInputData(s),u.addInputData(c);let l=u.getOutputData(),p=l.getPoints().getData();it.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(p),e.invert?(it.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(p),n[0]=l):(it.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(p),n[0]=u.getOutputData())}}var yV={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function Cv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yV,r),m.obj(t,e),m.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),m.setGetArray(t,e,["direction"],3),m.algo(t,e,0,1),dV(t,e)}var xV=m.newInstance(Cv,"vtkArrowSource"),js={newInstance:xV,extend:Cv};function zf(t){let e=t.getPoints().getBounds(),r=[-(e[0]+e[1])*.5,-(e[2]+e[3])*.5,-(e[4]+e[5])*.5];it.buildFromDegree().translate(...r).apply(t.getPoints().getData())}function Wf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=t.getPoints().getBounds(),a=[0,0,0];r?a[e]=-n[e*2+1]:a[e]=-n[e*2],it.buildFromDegree().translate(...a).apply(t.getPoints().getData())}function Hf(t,e,r,n){let a=t.getPoints().getData().length,s=new Uint8ClampedArray(a),i=0;for(;i<a;)s[i++]=e,s[i++]=r,s[i++]=n;t.getPointData().setScalars(P.newInstance({name:"color",numberOfComponents:3,values:s}))}function TV(t,e){e.classHierarchy.push("vtkAxesActor");let r=qe.newInstance();t.setMapper(r),t.update=()=>{let a={...e.config,...e.xConfig},s=js.newInstance({direction:[1,0,0],...a}).getOutputData();e.config.recenter?zf(s):Wf(s,0,a.invert),Hf(s,...a.color),a={...e.config,...e.yConfig};let i=js.newInstance({direction:[0,1,0],...a}).getOutputData();e.config.recenter?zf(i):Wf(i,1,a.invert),Hf(i,...a.color),a={...e.config,...e.zConfig};let o=js.newInstance({direction:[0,0,1],...a}).getOutputData();e.config.recenter?zf(o):Wf(o,2,a.invert),Hf(o,...a.color);let f=$s.newInstance();f.setInputData(s),f.addInputData(i),f.addInputData(o),r.setInputConnection(f.getOutputPort())},t.update();let n=m.debounce(t.update,0);t.setXAxisColor=a=>t.setXConfig({...t.getXConfig(),color:a}),t.setYAxisColor=a=>t.setYConfig({...t.getYConfig(),color:a}),t.setZAxisColor=a=>t.setZConfig({...t.getZConfig(),color:a}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=n,e._onXConfigChanged=n,e._onYConfigChanged=n,e._onZConfigChanged=n}function SV(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t?.config},xConfig:{color:[255,0,0],invert:!1,...t?.xConfig},yConfig:{color:[255,255,0],invert:!1,...t?.yConfig},zConfig:{color:[0,128,0],invert:!1,...t?.zConfig}}}function mv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ct.extend(t,e,SV(r)),m.setGet(t,e,["config","xConfig","yConfig","zConfig"]),TV(t,e)}var CV=m.newInstance(mv,"vtkAxesActor"),wv={newInstance:CV,extend:mv};var mV={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"},Ks={Corners:mV};var{vtkErrorMacro:Af}=m,{Corners:Ps}=Ks;function wV(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");let r={...t},n=[],a=Wa.newInstance(),s=new ResizeObserver(l=>{t.updateViewport()}),i=null,o=null,f=null,c=null,g=null;function u(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{let l=e.parentRenderer||e._interactor.getCurrentRenderer(),[p,d,h,v]=l.getViewport(),y=e._interactor.getView(),C=y.getSize(),[x,T]=y.getViewportSize(l),w=Math.min(x,T),S=e.viewportSize*w;S=Math.max(Math.min(e.minPixelSize,w),Math.min(e.maxPixelSize,S));let M=S/C[0],E=S/C[1];switch(e.viewportCorner){case Ps.TOP_LEFT:return[p,v-E,p+M,v];case Ps.TOP_RIGHT:return[h-M,v-E,h,v];case Ps.BOTTOM_LEFT:return[p,d,p+M,d+E];case Ps.BOTTOM_RIGHT:return[h-M,d,h,d+E];default:return Af("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(a.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{let p=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!p)return;let d=p.getReferenceByName("position"),h=p.getReferenceByName("focalPoint"),v=p.getReferenceByName("viewUp");if(n[0]!==d[0]||n[1]!==d[1]||n[2]!==d[2]||n[3]!==h[0]||n[4]!==h[1]||n[5]!==h[2]||n[6]!==v[0]||n[7]!==v[1]||n[8]!==v[2]){n[0]=d[0],n[1]=d[1],n[2]=d[2],n[3]=h[0],n[4]=h[1],n[5]=h[2],n[6]=v[0],n[7]=v[1],n[8]=v[2];let y=a.getActiveCamera();y.setPosition(d[0],d[1],d[2]),y.setFocalPoint(h[0],h[1],h[2]),y.setViewUp(v[0],v[1],v[2]),a.resetCamera()}},t.setEnabled=l=>{if(l){if(e.enabled)return;if(!e.actor){Af("Must set actor before enabling orientation marker.");return}if(!e._interactor){Af("Must set interactor before enabling orientation marker.");return}let p=e.parentRenderer||e._interactor.getCurrentRenderer(),d=p.getRenderWindow();d.addRenderer(a),d.getNumberOfLayers()<2&&d.setNumberOfLayers(2),a.setLayer(d.getNumberOfLayers()-1),a.setInteractive(e.interactiveRenderer),a.addViewProp(e.actor),e.actor.setVisibility(!0),i=p.onEvent(h=>{h.type==="ActiveCameraEvent"&&(o&&o.unsubscribe(),o=h.camera.onModified(u))}),o=p.getActiveCamera().onModified(u),f=e._interactor.onAnimation(t.updateMarkerOrientation),c=e._interactor.onEndAnimation(t.updateMarkerOrientation),s.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,s.disconnect(),i.unsubscribe(),i=null,o.unsubscribe(),o=null,f.unsubscribe(),f=null,c.unsubscribe(),c=null,e.actor.setVisibility(!1),a.removeViewProp(e.actor);let p=e._interactor?.findPokedRenderer()?.getRenderWindow();p&&p.removeRenderer(a)}t.modified()},t.setViewportCorner=l=>{l!==e.viewportCorner&&(e.viewportCorner=l,t.updateViewport())},t.setViewportSize=l=>{let p=Math.min(1,Math.max(0,l));p!==e.viewportSize&&(e.viewportSize=p,t.updateViewport())},t.setActor=l=>{let p=e.enabled;t.setEnabled(!1),e.actor=l,t.setEnabled(p)},t.getRenderer=()=>a,t.delete=()=>{r.delete(),g&&(g.unsubscribe(),g=null),i&&(i.unsubscribe(),i=null),o&&(o.unsubscribe(),o=null),f&&(f.unsubscribe(),f=null),c&&(c.unsubscribe(),c=null),s.disconnect()},g=t.onModified(t.updateViewport)}var EV={viewportCorner:Ks.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function Ev(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EV,r),m.obj(t,e),m.get(t,e,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),m.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),m.get(t,e,["actor"]),m.moveToProtected(t,e,["interactor"]),wV(t,e)}var MV=m.newInstance(Ev,"vtkOrientationMarkerWidget"),$f={newInstance:MV,extend:Ev,...Ks};function Mv(t){let e=wv.newInstance(),r=$f.newInstance({actor:e,interactor:t.getInteractor()});return r.setEnabled(!0),r.setViewportCorner($f.Corners.BOTTOM_LEFT),r.setViewportSize(.15),r.setMinPixelSize(100),r.setMaxPixelSize(300),r}function Rv(t,e,r=800,n=null){let a=Pt();if(!a)return;let s=a.getActiveCamera(),i=[t[0]+e[0]*r,t[1]+e[1]*r,t[2]+e[2]*r],o=s.getPosition(),f=s.getFocalPoint(),c=800,g=Date.now();function u(){let l=Date.now()-g,p=Math.min(l/c,1),d=p<.5?4*p*p*p:1-Math.pow(-2*p+2,3)/2,h=[o[0]+(i[0]-o[0])*d,o[1]+(i[1]-o[1])*d,o[2]+(i[2]-o[2])*d],v=[f[0]+(t[0]-f[0])*d,f[1]+(t[1]-f[1])*d,f[2]+(t[2]-f[2])*d];s.setPosition(...h),s.setFocalPoint(...v),s.setViewUp(0,0,1),a.resetCameraClippingRange();let y=dr();y&&y.render(),p<1?requestAnimationFrame(u):n&&n()}u()}function jf(){let t=Pt(),e=dr();if(t){let r=t.getActiveCamera();t.resetCamera();let n=r.getFocalPoint(),a=r.getDistance(),s=-45*Math.PI/180,i=-150*Math.PI/180,o=0,f=-1,c=0,g=o*Math.cos(i)-f*Math.sin(i),u=o*Math.sin(i)+f*Math.cos(i);o=g,f=u;let l=f*Math.cos(s)-c*Math.sin(s),p=f*Math.sin(s)+c*Math.cos(s);f=l,c=p;let d=[n[0]-o*a,n[1]-f*a,n[2]-c*a];r.setPosition(...d),r.setFocalPoint(...n),r.setViewUp(0,0,1),t.resetCameraClippingRange()}e&&e.render()}function Kf(t){let e=Qn();if(!e||!e[t]){console.warn("Label not found:",t);return}let r=e[t],n=r.hemi,a=r.vertices,s=lt(n);if(!s.meshData){console.warn("Hemisphere data not loaded:",n);return}["lh","rh"].forEach(c=>{let g=lt(c);if(!g.meshData)return;let u=g.meshData,l=g.mapper;if(c===n){let p=new Set(a),d=u.vertices.length,h=new Float32Array(d);for(let C=0;C<d;C++)p.has(C)?h[C]=10:h[C]=u.curvature?u.curvature[C]:0;let v=yn(u,g.offsetX,g.offsetZ,g.rotateZ),y=P.newInstance({name:"BlendedData",values:h,numberOfComponents:1});v.getPointData().setScalars(y),l.setInputData(v),iv(l),g.polyData=v}else{let p=yn(u,g.offsetX,g.offsetZ,g.rotateZ);l.setInputData(p),Jn(l,u),g.polyData=p}});let{center:i,normal:o}=tv(s.meshData,a,s.offsetX,s.offsetZ,s.rotateZ),f=dr();f&&f.render(),Rv(i,o,800,()=>{cv(dr,Pt,Pr,Qn,lt);let c=Pt(),g=dr();c&&g&&Ff(n,s.meshData,a,s.offsetX,s.offsetZ,s.rotateZ,lt,c,()=>g.render())})}function Xs(){let t=dr();["lh","rh"].forEach(e=>{let r=lt(e);if(!r.meshData)return;let n=r.meshData,a=r.mapper,s=yn(n,r.offsetX,r.offsetZ,r.rotateZ);a.setInputData(s),Jn(a,n),r.polyData=s}),fv(["lh","rh"],lt,()=>{t&&t.render()}),t&&t.render()}function Ov(t){let e=Pr();document.querySelectorAll(".label-list li").forEach(r=>r.classList.remove("active")),e===t?(Of(null),Xs()):(Of(t),document.querySelectorAll(".label-list li").forEach(n=>{n.dataset.labelName===t&&n.classList.add("active")}),Kf(t))}function RV(t){let e=Y1();if(q1()&&e){let r=t.replace(/-lh$|-rh$/i,"");if(e[r])return e[r]}return t}function Ys(t){let e=document.getElementById("labels-lh"),r=document.getElementById("labels-rh");e.innerHTML="",r.innerHTML="",Object.keys(t).sort().forEach(a=>{let s=t[a],i=document.createElement("li");i.textContent=RV(a),i.dataset.labelName=a,i.addEventListener("click",()=>{Ov(a)}),s.hemi==="lh"?e.appendChild(i):s.hemi==="rh"&&r.appendChild(i)})}function Dv(){let t=document.getElementById("help-btn"),e=document.getElementById("instructions-modal"),r=e.querySelector(".close");t.addEventListener("click",()=>{e.classList.add("show")}),r.addEventListener("click",()=>{e.classList.remove("show")}),e.addEventListener("click",n=>{n.target===e&&e.classList.remove("show")})}function Lv(){let t=document.getElementById("toggle-names-btn");t.addEventListener("click",()=>{let e=I1();t.classList.toggle("active",e),e?t.title="Switch to FreeSurfer names":t.title="Switch to plain English names";let r=Qn();Ys(r);let n=Pr();n&&document.querySelectorAll(".label-list li").forEach(s=>{s.dataset.labelName===n&&s.classList.add("active")})})}function Pf(){let t=document.querySelector(".loading");t&&(t.style.display="block",t.textContent="Loading brain model...")}function Is(){let t=document.querySelector(".loading");t&&t.remove()}function qs(t){let e=document.querySelector(".loading");e&&(e.textContent=t,e.style.color="#ff6b6b")}function Vv(t){let e=document.getElementById("geometry-select");if(!e){console.warn("Geometry selector not found");return}e.addEventListener("change",r=>{let n=r.target.value;console.log("Geometry changed to:",n),t&&t(n)})}function Bv(t,e){let r=document.getElementById("atlas-select");if(!r){console.warn("Atlas selector not found");return}r.innerHTML="",t.atlases.forEach(n=>{let a=document.createElement("option");a.value=n.id,a.textContent=n.name,a.title=n.description,n.default&&(a.selected=!0),r.appendChild(a)}),r.addEventListener("change",n=>{let a=n.target.value;console.log("Atlas changed to:",a),e&&e(a)})}var OV=()=>{let t=window.location.pathname,e=t.match(/^\/([^\/]+)\//);return e&&e[1]!==""&&!t.startsWith("/index.html")?`/${e[1]}`:""},ht=OV();console.log("Base path:",ht||"(root)");async function Fv(t){let e=Pt();if(!e){console.error("Renderer not initialized");return}console.log(`Loading ${t} surfaces...`);let n={inflated:"inflated",original:"orig",pial:"pial",white:"white"}[t]||t,a=lt("lh");await Gf(`${ht}/data/fsaverage/surf/lh.${n}`,`${ht}/data/fsaverage/surf/lh.curv`,"lh",a.offsetX,a.offsetZ,a.rotateZ,e);let s=lt("rh");await Gf(`${ht}/data/fsaverage/surf/rh.${n}`,`${ht}/data/fsaverage/surf/rh.curv`,"rh",s.offsetX,s.offsetZ,s.rotateZ,e),console.log(`${t} surfaces loaded successfully`)}async function DV(t){try{Pf();let e=document.querySelector(".loading");e&&(e.textContent=`Loading ${t} geometry...`);let r=Pr();Z1(t);let n=Pt(),a=lt("lh"),s=lt("rh");a.actor&&n.removeActor(a.actor),s.actor&&n.removeActor(s.actor),await Fv(t),r?(Kf(r),document.querySelectorAll(".label-list li").forEach(i=>{i.dataset.labelName===r&&i.classList.add("active")})):(Xs(),jf()),Is()}catch(e){console.error("Error loading geometry:",e),qs(`Error loading ${t} geometry. File may not exist.`)}}async function LV(t){try{Pf();let e=document.querySelector(".loading");e&&(e.textContent="Loading new atlas..."),Df(t);let r=ev();if(!r)throw new Error(`Atlas ${t} not found`);console.log("Loading atlas:",r.name);let n=await bf(`${ht}/data/fsaverage/label/${r.files.lh}`,`${ht}/data/fsaverage/label/${r.files.rh}`);if(Rf(n),console.log("Labels loaded:",Object.keys(n).length),r.lookup){let a=await _f(`${ht}/data/lookups/${r.lookup}`);bs(a),a&&console.log("Label names loaded for",r.name)}else bs(null);Ys(n),Xs(),Is()}catch(e){console.error("Error loading atlas:",e),qs("Error loading atlas. Please try again.")}}async function VV(){try{let t=bh.newInstance({rootContainer:document.getElementById("vtk-container"),background:[.2,.3,.4]}),e=t.getRenderer(),r=t.getRenderWindow();X1(e,r),Mv(r),console.log("Loading atlases configuration...");let n=await hv(`${ht}/data/atlases.json`);J1(n);let a=n.atlases.find(o=>o.default)||n.atlases[0];Df(a.id),console.log("Default atlas:",a.name),console.log("Loading labels from annotation files...");let s=await bf(`${ht}/data/fsaverage/label/${a.files.lh}`,`${ht}/data/fsaverage/label/${a.files.rh}`);if(Rf(s),console.log("Labels loaded:",Object.keys(s).length),a.lookup){let o=await _f(`${ht}/data/lookups/${a.lookup}`);bs(o),o&&console.log("Label names loaded for",a.name)}Ys(s),Dv(),Lv(),Vv(DV),Bv(n,LV);let i=Q1();await Fv(i),console.log("Brain model loaded successfully!"),Is(),jf()}catch(t){console.error("Error loading brain model:",t),qs("Error loading brain model. Check console for details.")}}document.addEventListener("DOMContentLoaded",VV);})();
